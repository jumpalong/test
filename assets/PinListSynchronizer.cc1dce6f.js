var s=Object.defineProperty;var e=(p,o,t)=>o in p?s(p,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[o]=t;var m=(p,o,t)=>(e(p,typeof o!="symbol"?o+"":o,t),t);import{g as c}from"./error.469adc75.js";import{b as g}from"./NaddrLink.vue_vue_type_script_setup_true_lang.e9edc141.js";import{o as n}from"./use.b23b6c29.js";import{R as u}from"./Provides.b6aac14f.js";import"./nostr.c03670ae.js";import"./index.8f62a545.js";import"./login.0b8718d8.js";import"./nostr.ad89cf30.js";import"./nostr.0043d5e6.js";import"./createEventSourceTracers.1da380d1.js";import"./Staff.e039c64f.js";import"./Markdown.05f716d1.js";import"./CategorizedBookmarksSynchronizer.87c6986d.js";import"./SynchronizerAbstract.b6083252.js";import"./Papaw.635c4eff.js";import"./RegExpUtils.102c01f0.js";import"./utils.e1137b57.js";import"./is-browser.f4df612e.js";import"./Scrollbar.8d5a1903.js";import"./use-rtl.6d35c504.js";import"./cssr.21c6f8e2.js";import"./use-css-vars-class.1ada0b07.js";import"./fade-in-scale-up.cssr.5ebe4351.js";import"./use-locale.cbb1f83b.js";import"./Loading.0b953150.js";import"./use-style.d8216a24.js";import"./Follower.7ba57362.js";import"./Icon.1c3d6ebf.js";import"./replaceable.815b8f5c.js";import"./Button.22997a19.js";import"./create-key.7b548031.js";import"./Tooltip.d86a0762.js";import"./Popover.6590eae2.js";import"./format-length.3612bbc8.js";import"./Card.6e48fdd4.js";import"./index.62f1e1b0.js";import"./keysOf.8a025f7e.js";import"./Close.dba1bcea.js";import"./Close.7d56270d.js";import"./Icon.904bc99e.js";import"./Empty.81d9c633.js";import"./UserLink.vue_vue_type_script_setup_true_lang.0cad1bf3.js";import"./RelayAddButton.vue_vue_type_script_setup_true_lang.03e333cd.js";import"./RelayConnectList.vue_vue_type_script_setup_true_lang.2443e1f7.js";import"./RelayInfoView.0394eae9.js";import"./Ellipsis.021c946e.js";import"./use-theme-vars.c704e62a.js";import"./ListItem.5a517004.js";import"./MavonEditor.aa4b0597.js";import"./Tag.7e30ed31.js";import"./Space.32f062de.js";import"./get-slot.4ceacf82.js";import"./DrawerProvide.vue_vue_type_script_setup_true_lang.da186b5d.js";import"./DrawerContent.bb261013.js";import"./index.71604e6f.js";import"./Scrollbar.c7e90ffe.js";import"./LoadProgress.a8e5dee8.js";import"./Scrollbar.75edf2b0.js";import"./fade-in-height-expand.cssr.a4865c47.js";import"./naiveUi.02e209d9.js";import"./composables.10bdf172.js";import"./Input.90533fe2.js";import"./nostrApiUse.43d55506.js";import"./ContentBlacklistView.1f898a24.js";import"./Dropdown.09a70bb4.js";import"./render.568a1ab1.js";import"./create.2deeaf6a.js";import"./profile-2-400x400.3309f571.js";import"./Checkbox.fc71365b.js";import"./PubkeyLink.vue_vue_type_script_setup_true_lang.1d1b2ee1.js";import"./RadioGroup.b3ff4b7f.js";import"./injectWindowNostr.759c669e.js";import"./NostrConnect.ef90b4f4.js";import"./Upload.39a290a3.js";import"./Warning.6502c178.js";import"./Add.d66e299e.js";import"./Upload.b5c9ebfa.js";import"./Modal.2a8cd6ad.js";import"./omit.ef9bf2ca.js";class Ft extends u{constructor(){super("PinListSync");m(this,"kind",10001)}createDefault(){return{tagMap:new Map}}async getFilters(){const t=await c();return t?[{authors:[t],kinds:[this.kind]}]:[]}async serializeToData(t){const i=new Map;for(const r of t.tags)i.set(JSON.stringify(r),r);return{tagMap:i}}async deserializeToEvent(t,i){return await g({tags:[...t.tagMap.values()],created_at:i,kind:this.kind})}getPinListSync(){return this.getDataSync()}createPinTag(t){const i=t.kind;if(i===0)return["p",t.pubkey];if(i===1)return["e",t.id];if(i>=3e4&&i<=39999){const r=n("a",t.tags);if(r)return r;const a=n("d",t.tags);return a&&a[1]?["a",`${t.kind}:${t.pubkey}:${a[1]}`]:null}else return["e",t.id]}has(t){return this.getPinListSync().tagMap.has(JSON.stringify(t))}hasByEvent(t){const i=this.createPinTag(t);return i?this.getPinListSync().tagMap.has(JSON.stringify(i)):!1}addPin(t){this.getPinListSync().tagMap.set(JSON.stringify(t),t)}removePin(t){this.getPinListSync().tagMap.delete(JSON.stringify(t))}async pin(t,i){const r=this.createPinTag(t);!r||this.has(r)||(this.addPin(r),this.toChanged(),await this.save(i))}async unpin(t,i){const r=this.createPinTag(t);!r||!this.has(r)||(this.removePin(r),this.toChanged(),await this.save(i))}}export{Ft as PinListSynchronizer};
