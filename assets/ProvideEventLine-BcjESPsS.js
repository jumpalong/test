import{w as Eb,d as xb,b as Lb,e as Ab,g as Sb,s as $b,n as Hh}from"./utils-BXkRfzfk.js";import{ah as Ib,L as le,p as gs,j as $r,k as nn,q as qr,bw as Bb,H as Kt,R as Cp,O as ll,bb as kb,bB as Ob,b9 as Ub,al as _b,bQ as Cb,ap as ys,S as Rb,U as Tb,G as Pb,aq as fl}from"./index-DVMYH3P6.js";var Nb=Object.defineProperty,Hb=(e,n,r)=>n in e?Nb(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,io=(e,n,r)=>(Hb(e,typeof n!="symbol"?n+"":n,r),r);const uu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function hl(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}const cu=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Ot=(e,n)=>e<<32-n|e>>>n,jb=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!jb)throw new Error("Non little-endian hardware is not supported");const Fb=Array.from({length:256},(e,n)=>n.toString(16).padStart(2,"0"));function dl(e){if(!hl(e))throw new Error("Uint8Array expected");let n="";for(let r=0;r<e.length;r++)n+=Fb[e[r]];return n}const on={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function jh(e){if(e>=on._0&&e<=on._9)return e-on._0;if(e>=on._A&&e<=on._F)return e-(on._A-10);if(e>=on._a&&e<=on._f)return e-(on._a-10)}function ws(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const n=e.length,r=n/2;if(n%2)throw new Error("padded hex string expected, got unpadded hex of length "+n);const i=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){const a=jh(e.charCodeAt(s)),u=jh(e.charCodeAt(s+1));if(a===void 0||u===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[o]=a*16+u}return i}function Mb(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function pl(e){if(typeof e=="string"&&(e=Mb(e)),!hl(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function zb(...e){let n=0;for(let i=0;i<e.length;i++){const o=e[i];if(!hl(o))throw new Error("Uint8Array expected");n+=o.length}const r=new Uint8Array(n);for(let i=0,o=0;i<e.length;i++){const s=e[i];r.set(s,o),o+=s.length}return r}let Rp=class{clone(){return this._cloneInto()}};function qb(e){const n=i=>e().update(pl(i)).digest(),r=e();return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=()=>e(),n}function Tp(e=32){if(uu&&typeof uu.getRandomValues=="function")return uu.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Fh(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Kb(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function Pp(e,...n){if(!Kb(e))throw new Error("Expected Uint8Array");if(n.length>0&&!n.includes(e.length))throw new Error(`Expected Uint8Array of length ${n}, not of length=${e.length}`)}function Db(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Fh(e.outputLen),Fh(e.blockLen)}function ms(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function Vb(e,n){Pp(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}function Wb(e,n,r,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(n,r,i);const o=BigInt(32),s=BigInt(4294967295),a=Number(r>>o&s),u=Number(r&s),c=i?4:0,l=i?0:4;e.setUint32(n+c,a,i),e.setUint32(n+l,u,i)}let Gb=class extends Rp{constructor(n,r,i,o){super(),this.blockLen=n,this.outputLen=r,this.padOffset=i,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(n),this.view=cu(this.buffer)}update(n){ms(this);const{view:r,buffer:i,blockLen:o}=this;n=pl(n);const s=n.length;for(let a=0;a<s;){const u=Math.min(o-this.pos,s-a);if(u===o){const c=cu(n);for(;o<=s-a;a+=o)this.process(c,a);continue}i.set(n.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=n.length,this.roundClean(),this}digestInto(n){ms(this),Vb(n,this),this.finished=!0;const{buffer:r,view:i,blockLen:o,isLE:s}=this;let{pos:a}=this;r[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(i,0),a=0);for(let h=a;h<o;h++)r[h]=0;Wb(i,o-8,BigInt(this.length*8),s),this.process(i,0);const u=cu(n),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)u.setUint32(4*h,f[h],s)}digest(){const{buffer:n,outputLen:r}=this;this.digestInto(n);const i=n.slice(0,r);return this.destroy(),i}_cloneInto(n){n||(n=new this.constructor),n.set(...this.get());const{blockLen:r,buffer:i,length:o,finished:s,destroyed:a,pos:u}=this;return n.length=o,n.pos=u,n.finished=s,n.destroyed=a,o%r&&n.buffer.set(i),n}};const Zb=(e,n,r)=>e&n^~e&r,Jb=(e,n,r)=>e&n^e&r^n&r,Yb=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Rn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Tn=new Uint32Array(64);let Xb=class extends Gb{constructor(){super(64,32,8,!1),this.A=Rn[0]|0,this.B=Rn[1]|0,this.C=Rn[2]|0,this.D=Rn[3]|0,this.E=Rn[4]|0,this.F=Rn[5]|0,this.G=Rn[6]|0,this.H=Rn[7]|0}get(){const{A:n,B:r,C:i,D:o,E:s,F:a,G:u,H:c}=this;return[n,r,i,o,s,a,u,c]}set(n,r,i,o,s,a,u,c){this.A=n|0,this.B=r|0,this.C=i|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=u|0,this.H=c|0}process(n,r){for(let h=0;h<16;h++,r+=4)Tn[h]=n.getUint32(r,!1);for(let h=16;h<64;h++){const p=Tn[h-15],b=Tn[h-2],y=Ot(p,7)^Ot(p,18)^p>>>3,d=Ot(b,17)^Ot(b,19)^b>>>10;Tn[h]=d+Tn[h-7]+y+Tn[h-16]|0}let{A:i,B:o,C:s,D:a,E:u,F:c,G:l,H:f}=this;for(let h=0;h<64;h++){const p=Ot(u,6)^Ot(u,11)^Ot(u,25),b=f+p+Zb(u,c,l)+Yb[h]+Tn[h]|0,y=(Ot(i,2)^Ot(i,13)^Ot(i,22))+Jb(i,o,s)|0;f=l,l=c,c=u,u=a+b|0,a=s,s=o,o=i,i=b+y|0}i=i+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,u=u+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(i,o,s,a,u,c,l,f)}roundClean(){Tn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const ac=qb(()=>new Xb);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Np=BigInt(0),Qs=BigInt(1),Qb=BigInt(2);function Yt(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}const e2=Array.from({length:256},(e,n)=>n.toString(16).padStart(2,"0"));function xi(e){if(!Yt(e))throw new Error("Uint8Array expected");let n="";for(let r=0;r<e.length;r++)n+=e2[e[r]];return n}function Hp(e){const n=e.toString(16);return n.length&1?`0${n}`:n}function gl(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}const sn={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Mh(e){if(e>=sn._0&&e<=sn._9)return e-sn._0;if(e>=sn._A&&e<=sn._F)return e-(sn._A-10);if(e>=sn._a&&e<=sn._f)return e-(sn._a-10)}function Li(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const n=e.length,r=n/2;if(n%2)throw new Error("padded hex string expected, got unpadded hex of length "+n);const i=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){const a=Mh(e.charCodeAt(s)),u=Mh(e.charCodeAt(s+1));if(a===void 0||u===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[o]=a*16+u}return i}function it(e){return gl(xi(e))}function yl(e){if(!Yt(e))throw new Error("Uint8Array expected");return gl(xi(Uint8Array.from(e).reverse()))}function or(e,n){return Li(e.toString(16).padStart(n*2,"0"))}function wl(e,n){return or(e,n).reverse()}function t2(e){return Li(Hp(e))}function Ze(e,n,r){let i;if(typeof n=="string")try{i=Li(n)}catch(s){throw new Error(`${e} must be valid hex string, got "${n}". Cause: ${s}`)}else if(Yt(n))i=Uint8Array.from(n);else throw new Error(`${e} must be hex string or Uint8Array`);const o=i.length;if(typeof r=="number"&&o!==r)throw new Error(`${e} expected ${r} bytes, got ${o}`);return i}function Kr(...e){let n=0;for(let o=0;o<e.length;o++){const s=e[o];if(!Yt(s))throw new Error("Uint8Array expected");n+=s.length}let r=new Uint8Array(n),i=0;for(let o=0;o<e.length;o++){const s=e[o];r.set(s,i),i+=s.length}return r}function n2(e,n){if(e.length!==n.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^n[i];return r===0}function r2(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function i2(e){let n;for(n=0;e>Np;e>>=Qs,n+=1);return n}function o2(e,n){return e>>BigInt(n)&Qs}const s2=(e,n,r)=>e|(r?Qs:Np)<<BigInt(n),ml=e=>(Qb<<BigInt(e-1))-Qs,lu=e=>new Uint8Array(e),zh=e=>Uint8Array.from(e);function jp(e,n,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof n!="number"||n<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=lu(e),o=lu(e),s=0;const a=()=>{i.fill(1),o.fill(0),s=0},u=(...f)=>r(o,i,...f),c=(f=lu())=>{o=u(zh([0]),f),i=u(),f.length!==0&&(o=u(zh([1]),f),i=u())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<n;){i=u();const p=i.slice();h.push(p),f+=i.length}return Kr(...h)};return(f,h)=>{a(),c(f);let p;for(;!(p=h(l()));)c();return a(),p}}const a2={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||Yt(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,n)=>n.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function xo(e,n,r={}){const i=(o,s,a)=>{const u=a2[s];if(typeof u!="function")throw new Error(`Invalid validator "${s}", expected function`);const c=e[o];if(!(a&&c===void 0)&&!u(c,e))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(const[o,s]of Object.entries(n))i(o,s,!1);for(const[o,s]of Object.entries(r))i(o,s,!0);return e}const u2=Object.freeze(Object.defineProperty({__proto__:null,bitGet:o2,bitLen:i2,bitMask:ml,bitSet:s2,bytesToHex:xi,bytesToNumberBE:it,bytesToNumberLE:yl,concatBytes:Kr,createHmacDrbg:jp,ensureBytes:Ze,equalBytes:n2,hexToBytes:Li,hexToNumber:gl,isBytes:Yt,numberToBytesBE:or,numberToBytesLE:wl,numberToHexUnpadded:Hp,numberToVarBytesBE:t2,utf8ToBytes:r2,validateObject:xo},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Oe=BigInt(0),he=BigInt(1),Ir=BigInt(2),c2=BigInt(3),uc=BigInt(4),qh=BigInt(5),Kh=BigInt(8);BigInt(9);BigInt(16);function ze(e,n){const r=e%n;return r>=Oe?r:n+r}function l2(e,n,r){if(r<=Oe||n<Oe)throw new Error("Expected power/modulo > 0");if(r===he)return Oe;let i=he;for(;n>Oe;)n&he&&(i=i*e%r),e=e*e%r,n>>=he;return i}function lt(e,n,r){let i=e;for(;n-- >Oe;)i*=i,i%=r;return i}function cc(e,n){if(e===Oe||n<=Oe)throw new Error(`invert: expected positive integers, got n=${e} mod=${n}`);let r=ze(e,n),i=n,o=Oe,s=he;for(;r!==Oe;){const a=i/r,u=i%r,c=o-s*a;i=r,r=u,o=s,s=c}if(i!==he)throw new Error("invert: does not exist");return ze(o,n)}function f2(e){const n=(e-he)/Ir;let r,i,o;for(r=e-he,i=0;r%Ir===Oe;r/=Ir,i++);for(o=Ir;o<e&&l2(o,n,e)!==e-he;o++);if(i===1){const a=(e+he)/uc;return function(u,c){const l=u.pow(c,a);if(!u.eql(u.sqr(l),c))throw new Error("Cannot find square root");return l}}const s=(r+he)/Ir;return function(a,u){if(a.pow(u,n)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,l=a.pow(a.mul(a.ONE,o),r),f=a.pow(u,s),h=a.pow(u,r);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let p=1;for(let y=a.sqr(h);p<c&&!a.eql(y,a.ONE);p++)y=a.sqr(y);const b=a.pow(l,he<<BigInt(c-p-1));l=a.sqr(b),f=a.mul(f,b),h=a.mul(h,l),c=p}return f}}function h2(e){if(e%uc===c2){const n=(e+he)/uc;return function(r,i){const o=r.pow(i,n);if(!r.eql(r.sqr(o),i))throw new Error("Cannot find square root");return o}}if(e%Kh===qh){const n=(e-qh)/Kh;return function(r,i){const o=r.mul(i,Ir),s=r.pow(o,n),a=r.mul(i,s),u=r.mul(r.mul(a,Ir),s),c=r.mul(a,r.sub(u,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return f2(e)}const d2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function p2(e){const n={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=d2.reduce((i,o)=>(i[o]="function",i),n);return xo(e,r)}function g2(e,n,r){if(r<Oe)throw new Error("Expected power > 0");if(r===Oe)return e.ONE;if(r===he)return n;let i=e.ONE,o=n;for(;r>Oe;)r&he&&(i=e.mul(i,o)),o=e.sqr(o),r>>=he;return i}function y2(e,n){const r=new Array(n.length),i=n.reduce((s,a,u)=>e.is0(a)?s:(r[u]=s,e.mul(s,a)),e.ONE),o=e.inv(i);return n.reduceRight((s,a,u)=>e.is0(a)?s:(r[u]=e.mul(s,r[u]),e.mul(s,a)),o),r}function Fp(e,n){const r=n!==void 0?n:e.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function w2(e,n,r=!1,i={}){if(e<=Oe)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:s}=Fp(e,n);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const a=h2(e),u=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:ml(o),ZERO:Oe,ONE:he,create:c=>ze(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return Oe<=c&&c<e},is0:c=>c===Oe,isOdd:c=>(c&he)===he,neg:c=>ze(-c,e),eql:(c,l)=>c===l,sqr:c=>ze(c*c,e),add:(c,l)=>ze(c+l,e),sub:(c,l)=>ze(c-l,e),mul:(c,l)=>ze(c*l,e),pow:(c,l)=>g2(u,c,l),div:(c,l)=>ze(c*cc(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>cc(c,e),sqrt:i.sqrt||(c=>a(u,c)),invertBatch:c=>y2(u,c),cmov:(c,l,f)=>f?l:c,toBytes:c=>r?wl(c,s):or(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return r?yl(c):it(c)}});return Object.freeze(u)}function Mp(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const n=e.toString(2).length;return Math.ceil(n/8)}function zp(e){const n=Mp(e);return n+Math.ceil(n/2)}function m2(e,n,r=!1){const i=e.length,o=Mp(n),s=zp(n);if(i<16||i<s||i>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${i}`);const a=r?it(e):yl(e),u=ze(a,n-he)+he;return r?wl(u,o):or(u,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const b2=BigInt(0),fu=BigInt(1);function v2(e,n){const r=(o,s)=>{const a=s.negate();return o?a:s},i=o=>{const s=Math.ceil(n/o)+1,a=2**(o-1);return{windows:s,windowSize:a}};return{constTimeNegate:r,unsafeLadder(o,s){let a=e.ZERO,u=o;for(;s>b2;)s&fu&&(a=a.add(u)),u=u.double(),s>>=fu;return a},precomputeWindow(o,s){const{windows:a,windowSize:u}=i(s),c=[];let l=o,f=l;for(let h=0;h<a;h++){f=l,c.push(f);for(let p=1;p<u;p++)f=f.add(l),c.push(f);l=f.double()}return c},wNAF(o,s,a){const{windows:u,windowSize:c}=i(o);let l=e.ZERO,f=e.BASE;const h=BigInt(2**o-1),p=2**o,b=BigInt(o);for(let y=0;y<u;y++){const d=y*c;let g=Number(a&h);a>>=b,g>c&&(g-=p,a+=fu);const m=d,x=d+Math.abs(g)-1,S=y%2!==0,O=g<0;g===0?f=f.add(r(S,s[m])):l=l.add(r(O,s[x]))}return{p:l,f}},wNAFCached(o,s,a,u){const c=o._WINDOW_SIZE||1;let l=s.get(o);return l||(l=this.precomputeWindow(o,c),c!==1&&s.set(o,u(l))),this.wNAF(c,l,a)}}}function qp(e){return p2(e.Fp),xo(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Fp(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function E2(e){const n=qp(e);xo(n,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:i,a:o}=n;if(r){if(!i.eql(o,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...n})}const{bytesToNumberBE:x2,hexToBytes:L2}=u2,Rr={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:n}=Rr;if(e.length<2||e[0]!==2)throw new n("Invalid signature integer tag");const r=e[1],i=e.subarray(2,r+2);if(!r||i.length!==r)throw new n("Invalid signature integer: wrong length");if(i[0]&128)throw new n("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new n("Invalid signature integer: unnecessary leading zero");return{d:x2(i),l:e.subarray(r+2)}},toSig(e){const{Err:n}=Rr,r=typeof e=="string"?L2(e):e;if(!Yt(r))throw new Error("ui8a expected");let i=r.length;if(i<2||r[0]!=48)throw new n("Invalid signature tag");if(r[1]!==i-2)throw new n("Invalid signature: incorrect length");const{d:o,l:s}=Rr._parseInt(r.subarray(2)),{d:a,l:u}=Rr._parseInt(s);if(u.length)throw new n("Invalid signature: left bytes after parsing");return{r:o,s:a}},hexFromSig(e){const n=l=>Number.parseInt(l[0],16)&8?"00"+l:l,r=l=>{const f=l.toString(16);return f.length&1?`0${f}`:f},i=n(r(e.s)),o=n(r(e.r)),s=i.length/2,a=o.length/2,u=r(s),c=r(a);return`30${r(a+s+4)}02${c}${o}02${u}${i}`}},dn=BigInt(0),wt=BigInt(1);BigInt(2);const Dh=BigInt(3);BigInt(4);function A2(e){const n=E2(e),{Fp:r}=n,i=n.toBytes||((y,d,g)=>{const m=d.toAffine();return Kr(Uint8Array.from([4]),r.toBytes(m.x),r.toBytes(m.y))}),o=n.fromBytes||(y=>{const d=y.subarray(1),g=r.fromBytes(d.subarray(0,r.BYTES)),m=r.fromBytes(d.subarray(r.BYTES,2*r.BYTES));return{x:g,y:m}});function s(y){const{a:d,b:g}=n,m=r.sqr(y),x=r.mul(m,y);return r.add(r.add(x,r.mul(y,d)),g)}if(!r.eql(r.sqr(n.Gy),s(n.Gx)))throw new Error("bad generator point: equation left != right");function a(y){return typeof y=="bigint"&&dn<y&&y<n.n}function u(y){if(!a(y))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(y){const{allowedPrivateKeyLengths:d,nByteLength:g,wrapPrivateKey:m,n:x}=n;if(d&&typeof y!="bigint"){if(Yt(y)&&(y=xi(y)),typeof y!="string"||!d.includes(y.length))throw new Error("Invalid key");y=y.padStart(g*2,"0")}let S;try{S=typeof y=="bigint"?y:it(Ze("private key",y,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof y}`)}return m&&(S=ze(S,x)),u(S),S}const l=new Map;function f(y){if(!(y instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(d,g,m){if(this.px=d,this.py=g,this.pz=m,d==null||!r.isValid(d))throw new Error("x required");if(g==null||!r.isValid(g))throw new Error("y required");if(m==null||!r.isValid(m))throw new Error("z required")}static fromAffine(d){const{x:g,y:m}=d||{};if(!d||!r.isValid(g)||!r.isValid(m))throw new Error("invalid affine point");if(d instanceof h)throw new Error("projective point not allowed");const x=S=>r.eql(S,r.ZERO);return x(g)&&x(m)?h.ZERO:new h(g,m,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const g=r.invertBatch(d.map(m=>m.pz));return d.map((m,x)=>m.toAffine(g[x])).map(h.fromAffine)}static fromHex(d){const g=h.fromAffine(o(Ze("pointHex",d)));return g.assertValidity(),g}static fromPrivateKey(d){return h.BASE.multiply(c(d))}_setWindowSize(d){this._WINDOW_SIZE=d,l.delete(this)}assertValidity(){if(this.is0()){if(n.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:d,y:g}=this.toAffine();if(!r.isValid(d)||!r.isValid(g))throw new Error("bad point: x or y not FE");const m=r.sqr(g),x=s(d);if(!r.eql(m,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:d}=this.toAffine();if(r.isOdd)return!r.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){f(d);const{px:g,py:m,pz:x}=this,{px:S,py:O,pz:B}=d,E=r.eql(r.mul(g,B),r.mul(S,x)),L=r.eql(r.mul(m,B),r.mul(O,x));return E&&L}negate(){return new h(this.px,r.neg(this.py),this.pz)}double(){const{a:d,b:g}=n,m=r.mul(g,Dh),{px:x,py:S,pz:O}=this;let B=r.ZERO,E=r.ZERO,L=r.ZERO,I=r.mul(x,x),R=r.mul(S,S),U=r.mul(O,O),k=r.mul(x,S);return k=r.add(k,k),L=r.mul(x,O),L=r.add(L,L),B=r.mul(d,L),E=r.mul(m,U),E=r.add(B,E),B=r.sub(R,E),E=r.add(R,E),E=r.mul(B,E),B=r.mul(k,B),L=r.mul(m,L),U=r.mul(d,U),k=r.sub(I,U),k=r.mul(d,k),k=r.add(k,L),L=r.add(I,I),I=r.add(L,I),I=r.add(I,U),I=r.mul(I,k),E=r.add(E,I),U=r.mul(S,O),U=r.add(U,U),I=r.mul(U,k),B=r.sub(B,I),L=r.mul(U,R),L=r.add(L,L),L=r.add(L,L),new h(B,E,L)}add(d){f(d);const{px:g,py:m,pz:x}=this,{px:S,py:O,pz:B}=d;let E=r.ZERO,L=r.ZERO,I=r.ZERO;const R=n.a,U=r.mul(n.b,Dh);let k=r.mul(g,S),P=r.mul(m,O),T=r.mul(x,B),H=r.add(g,m),w=r.add(S,O);H=r.mul(H,w),w=r.add(k,P),H=r.sub(H,w),w=r.add(g,x);let v=r.add(S,B);return w=r.mul(w,v),v=r.add(k,T),w=r.sub(w,v),v=r.add(m,x),E=r.add(O,B),v=r.mul(v,E),E=r.add(P,T),v=r.sub(v,E),I=r.mul(R,w),E=r.mul(U,T),I=r.add(E,I),E=r.sub(P,I),I=r.add(P,I),L=r.mul(E,I),P=r.add(k,k),P=r.add(P,k),T=r.mul(R,T),w=r.mul(U,w),P=r.add(P,T),T=r.sub(k,T),T=r.mul(R,T),w=r.add(w,T),k=r.mul(P,w),L=r.add(L,k),k=r.mul(v,w),E=r.mul(H,E),E=r.sub(E,k),k=r.mul(H,P),I=r.mul(v,I),I=r.add(I,k),new h(E,L,I)}subtract(d){return this.add(d.negate())}is0(){return this.equals(h.ZERO)}wNAF(d){return b.wNAFCached(this,l,d,g=>{const m=r.invertBatch(g.map(x=>x.pz));return g.map((x,S)=>x.toAffine(m[S])).map(h.fromAffine)})}multiplyUnsafe(d){const g=h.ZERO;if(d===dn)return g;if(u(d),d===wt)return this;const{endo:m}=n;if(!m)return b.unsafeLadder(this,d);let{k1neg:x,k1:S,k2neg:O,k2:B}=m.splitScalar(d),E=g,L=g,I=this;for(;S>dn||B>dn;)S&wt&&(E=E.add(I)),B&wt&&(L=L.add(I)),I=I.double(),S>>=wt,B>>=wt;return x&&(E=E.negate()),O&&(L=L.negate()),L=new h(r.mul(L.px,m.beta),L.py,L.pz),E.add(L)}multiply(d){u(d);let g=d,m,x;const{endo:S}=n;if(S){const{k1neg:O,k1:B,k2neg:E,k2:L}=S.splitScalar(g);let{p:I,f:R}=this.wNAF(B),{p:U,f:k}=this.wNAF(L);I=b.constTimeNegate(O,I),U=b.constTimeNegate(E,U),U=new h(r.mul(U.px,S.beta),U.py,U.pz),m=I.add(U),x=R.add(k)}else{const{p:O,f:B}=this.wNAF(g);m=O,x=B}return h.normalizeZ([m,x])[0]}multiplyAndAddUnsafe(d,g,m){const x=h.BASE,S=(B,E)=>E===dn||E===wt||!B.equals(x)?B.multiplyUnsafe(E):B.multiply(E),O=S(this,g).add(S(d,m));return O.is0()?void 0:O}toAffine(d){const{px:g,py:m,pz:x}=this,S=this.is0();d==null&&(d=S?r.ONE:r.inv(x));const O=r.mul(g,d),B=r.mul(m,d),E=r.mul(x,d);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(E,r.ONE))throw new Error("invZ was invalid");return{x:O,y:B}}isTorsionFree(){const{h:d,isTorsionFree:g}=n;if(d===wt)return!0;if(g)return g(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:g}=n;return d===wt?this:g?g(h,this):this.multiplyUnsafe(n.h)}toRawBytes(d=!0){return this.assertValidity(),i(h,this,d)}toHex(d=!0){return xi(this.toRawBytes(d))}}h.BASE=new h(n.Gx,n.Gy,r.ONE),h.ZERO=new h(r.ZERO,r.ONE,r.ZERO);const p=n.nBitLength,b=v2(h,n.endo?Math.ceil(p/2):p);return{CURVE:n,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:a}}function S2(e){const n=qp(e);return xo(n,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...n})}function $2(e){const n=S2(e),{Fp:r,n:i}=n,o=r.BYTES+1,s=2*r.BYTES+1;function a(w){return dn<w&&w<r.ORDER}function u(w){return ze(w,i)}function c(w){return cc(w,i)}const{ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:h,isWithinCurveOrder:p}=A2({...n,toBytes(w,v,$){const _=v.toAffine(),A=r.toBytes(_.x),C=Kr;return $?C(Uint8Array.from([v.hasEvenY()?2:3]),A):C(Uint8Array.from([4]),A,r.toBytes(_.y))},fromBytes(w){const v=w.length,$=w[0],_=w.subarray(1);if(v===o&&($===2||$===3)){const A=it(_);if(!a(A))throw new Error("Point is not on curve");const C=h(A);let N=r.sqrt(C);const j=(N&wt)===wt;return($&1)===1!==j&&(N=r.neg(N)),{x:A,y:N}}else if(v===s&&$===4){const A=r.fromBytes(_.subarray(0,r.BYTES)),C=r.fromBytes(_.subarray(r.BYTES,2*r.BYTES));return{x:A,y:C}}else throw new Error(`Point of length ${v} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),b=w=>xi(or(w,n.nByteLength));function y(w){const v=i>>wt;return w>v}function d(w){return y(w)?u(-w):w}const g=(w,v,$)=>it(w.slice(v,$));class m{constructor(v,$,_){this.r=v,this.s=$,this.recovery=_,this.assertValidity()}static fromCompact(v){const $=n.nByteLength;return v=Ze("compactSignature",v,$*2),new m(g(v,0,$),g(v,$,2*$))}static fromDER(v){const{r:$,s:_}=Rr.toSig(Ze("DER",v));return new m($,_)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(v){return new m(this.r,this.s,v)}recoverPublicKey(v){const{r:$,s:_,recovery:A}=this,C=L(Ze("msgHash",v));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");const N=A===2||A===3?$+n.n:$;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const j=A&1?"03":"02",F=l.fromHex(j+b(N)),q=c(N),K=u(-C*q),G=u(_*q),D=l.BASE.multiplyAndAddUnsafe(F,K,G);if(!D)throw new Error("point at infinify");return D.assertValidity(),D}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,u(-this.s),this.recovery):this}toDERRawBytes(){return Li(this.toDERHex())}toDERHex(){return Rr.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Li(this.toCompactHex())}toCompactHex(){return b(this.r)+b(this.s)}}const x={isValidPrivateKey(w){try{return f(w),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const w=zp(n.n);return m2(n.randomBytes(w),n.n)},precompute(w=8,v=l.BASE){return v._setWindowSize(w),v.multiply(BigInt(3)),v}};function S(w,v=!0){return l.fromPrivateKey(w).toRawBytes(v)}function O(w){const v=Yt(w),$=typeof w=="string",_=(v||$)&&w.length;return v?_===o||_===s:$?_===2*o||_===2*s:w instanceof l}function B(w,v,$=!0){if(O(w))throw new Error("first arg must be private key");if(!O(v))throw new Error("second arg must be public key");return l.fromHex(v).multiply(f(w)).toRawBytes($)}const E=n.bits2int||function(w){const v=it(w),$=w.length*8-n.nBitLength;return $>0?v>>BigInt($):v},L=n.bits2int_modN||function(w){return u(E(w))},I=ml(n.nBitLength);function R(w){if(typeof w!="bigint")throw new Error("bigint expected");if(!(dn<=w&&w<I))throw new Error(`bigint expected < 2^${n.nBitLength}`);return or(w,n.nByteLength)}function U(w,v,$=k){if(["recovered","canonical"].some(V=>V in $))throw new Error("sign() legacy options not supported");const{hash:_,randomBytes:A}=n;let{lowS:C,prehash:N,extraEntropy:j}=$;C==null&&(C=!0),w=Ze("msgHash",w),N&&(w=Ze("prehashed msgHash",_(w)));const F=L(w),q=f(v),K=[R(q),R(F)];if(j!=null){const V=j===!0?A(r.BYTES):j;K.push(Ze("extraEntropy",V))}const G=Kr(...K),D=F;function Z(V){const ee=E(V);if(!p(ee))return;const ue=c(ee),W=l.BASE.multiply(ee).toAffine(),J=u(W.x);if(J===dn)return;const ce=u(ue*u(D+J*q));if(ce===dn)return;let tt=(W.x===J?0:2)|Number(W.y&wt),nt=ce;return C&&y(ce)&&(nt=d(ce),tt^=1),new m(J,nt,tt)}return{seed:G,k2sig:Z}}const k={lowS:n.lowS,prehash:!1},P={lowS:n.lowS,prehash:!1};function T(w,v,$=k){const{seed:_,k2sig:A}=U(w,v,$),C=n;return jp(C.hash.outputLen,C.nByteLength,C.hmac)(_,A)}l.BASE._setWindowSize(8);function H(w,v,$,_=P){var A;const C=w;if(v=Ze("msgHash",v),$=Ze("publicKey",$),"strict"in _)throw new Error("options.strict was renamed to lowS");const{lowS:N,prehash:j}=_;let F,q;try{if(typeof C=="string"||Yt(C))try{F=m.fromDER(C)}catch(W){if(!(W instanceof Rr.Err))throw W;F=m.fromCompact(C)}else if(typeof C=="object"&&typeof C.r=="bigint"&&typeof C.s=="bigint"){const{r:W,s:J}=C;F=new m(W,J)}else throw new Error("PARSE");q=l.fromHex($)}catch(W){if(W.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(N&&F.hasHighS())return!1;j&&(v=n.hash(v));const{r:K,s:G}=F,D=L(v),Z=c(G),V=u(D*Z),ee=u(K*Z),ue=(A=l.BASE.multiplyAndAddUnsafe(q,V,ee))==null?void 0:A.toAffine();return ue?u(ue.x)===K:!1}return{CURVE:n,getPublicKey:S,getSharedSecret:B,sign:T,verify:H,ProjectivePoint:l,Signature:m,utils:x}}let Kp=class extends Rp{constructor(n,r){super(),this.finished=!1,this.destroyed=!1,Db(n);const i=pl(r);if(this.iHash=n.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?n.create().update(i).digest():i);for(let a=0;a<s.length;a++)s[a]^=54;this.iHash.update(s),this.oHash=n.create();for(let a=0;a<s.length;a++)s[a]^=106;this.oHash.update(s),s.fill(0)}update(n){return ms(this),this.iHash.update(n),this}digestInto(n){ms(this),Pp(n,this.outputLen),this.finished=!0,this.iHash.digestInto(n),this.oHash.update(n),this.oHash.digestInto(n),this.destroy()}digest(){const n=new Uint8Array(this.oHash.outputLen);return this.digestInto(n),n}_cloneInto(n){n||(n=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:o,destroyed:s,blockLen:a,outputLen:u}=this;return n=n,n.finished=o,n.destroyed=s,n.blockLen=a,n.outputLen=u,n.oHash=r._cloneInto(n.oHash),n.iHash=i._cloneInto(n.iHash),n}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Dp=(e,n,r)=>new Kp(e,n).update(r).digest();Dp.create=(e,n)=>new Kp(e,n);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function I2(e){return{hash:e,hmac:(n,...r)=>Dp(e,n,zb(...r)),randomBytes:Tp}}function B2(e,n){const r=i=>$2({...e,...I2(i)});return Object.freeze({...r(n),create:r})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ea=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),bs=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Vp=BigInt(1),vs=BigInt(2),Vh=(e,n)=>(e+n/vs)/n;function Wp(e){const n=ea,r=BigInt(3),i=BigInt(6),o=BigInt(11),s=BigInt(22),a=BigInt(23),u=BigInt(44),c=BigInt(88),l=e*e*e%n,f=l*l*e%n,h=lt(f,r,n)*f%n,p=lt(h,r,n)*f%n,b=lt(p,vs,n)*l%n,y=lt(b,o,n)*b%n,d=lt(y,s,n)*y%n,g=lt(d,u,n)*d%n,m=lt(g,c,n)*g%n,x=lt(m,u,n)*d%n,S=lt(x,r,n)*f%n,O=lt(S,a,n)*y%n,B=lt(O,i,n)*l%n,E=lt(B,vs,n);if(!lc.eql(lc.sqr(E),e))throw new Error("Cannot find square root");return E}const lc=w2(ea,void 0,void 0,{sqrt:Wp}),bl=B2({a:BigInt(0),b:BigInt(7),Fp:lc,n:bs,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const n=bs,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Vp*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,a=BigInt("0x100000000000000000000000000000000"),u=Vh(s*e,n),c=Vh(-i*e,n);let l=ze(e-u*r-c*o,n),f=ze(-u*i-c*s,n);const h=l>a,p=f>a;if(h&&(l=n-l),p&&(f=n-f),l>a||f>a)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:p,k2:f}}}},ac),ta=BigInt(0),Gp=e=>typeof e=="bigint"&&ta<e&&e<ea,k2=e=>typeof e=="bigint"&&ta<e&&e<bs,Wh={};function Es(e,...n){let r=Wh[e];if(r===void 0){const i=ac(Uint8Array.from(e,o=>o.charCodeAt(0)));r=Kr(i,i),Wh[e]=r}return ac(Kr(r,...n))}const vl=e=>e.toRawBytes(!0).slice(1),fc=e=>or(e,32),hu=e=>ze(e,ea),fo=e=>ze(e,bs),El=bl.ProjectivePoint,O2=(e,n,r)=>El.BASE.multiplyAndAddUnsafe(e,n,r);function hc(e){let n=bl.utils.normPrivateKeyToScalar(e),r=El.fromPrivateKey(n);return{scalar:r.hasEvenY()?n:fo(-n),bytes:vl(r)}}function Zp(e){if(!Gp(e))throw new Error("bad x: need 0 < x < p");const n=hu(e*e),r=hu(n*e+BigInt(7));let i=Wp(r);i%vs!==ta&&(i=hu(-i));const o=new El(e,i,Vp);return o.assertValidity(),o}function Jp(...e){return fo(it(Es("BIP0340/challenge",...e)))}function U2(e){return hc(e).bytes}function _2(e,n,r=Tp(32)){const i=Ze("message",e),{bytes:o,scalar:s}=hc(n),a=Ze("auxRand",r,32),u=fc(s^it(Es("BIP0340/aux",a))),c=Es("BIP0340/nonce",u,o,i),l=fo(it(c));if(l===ta)throw new Error("sign failed: k is zero");const{bytes:f,scalar:h}=hc(l),p=Jp(f,o,i),b=new Uint8Array(64);if(b.set(f,0),b.set(fc(fo(h+p*s)),32),!Yp(b,i,o))throw new Error("sign: Invalid signature produced");return b}function Yp(e,n,r){const i=Ze("signature",e,64),o=Ze("message",n),s=Ze("publicKey",r,32);try{const a=Zp(it(s)),u=it(i.subarray(0,32));if(!Gp(u))return!1;const c=it(i.subarray(32,64));if(!k2(c))return!1;const l=Jp(fc(u),vl(a),o),f=O2(a,c,fo(-l));return!(!f||!f.hasEvenY()||f.toAffine().x!==u)}catch{return!1}}const Xp={getPublicKey:U2,sign:_2,verify:Yp,utils:{randomPrivateKey:bl.utils.randomPrivateKey,lift_x:Zp,pointToBytes:vl,numberToBytesBE:or,bytesToNumberBE:it,taggedHash:Es,mod:ze}};function Gh(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Qp(e,...n){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(n.length>0&&!n.includes(e.length))throw new Error(`Expected Uint8Array of length ${n}, not of length=${e.length}`)}function C2(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Gh(e.outputLen),Gh(e.blockLen)}function xs(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function R2(e,n){Qp(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const du=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const eg=e=>e instanceof Uint8Array,pu=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Ut=(e,n)=>e<<32-n|e>>>n,T2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!T2)throw new Error("Non little-endian hardware is not supported");function P2(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function xl(e){if(typeof e=="string"&&(e=P2(e)),!eg(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function N2(...e){const n=new Uint8Array(e.reduce((i,o)=>i+o.length,0));let r=0;return e.forEach(i=>{if(!eg(i))throw new Error("Uint8Array expected");n.set(i,r),r+=i.length}),n}let tg=class{clone(){return this._cloneInto()}};function H2(e){const n=i=>e().update(xl(i)).digest(),r=e();return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=()=>e(),n}function ng(e=32){if(du&&typeof du.getRandomValues=="function")return du.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function j2(e,n,r,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(n,r,i);const o=BigInt(32),s=BigInt(4294967295),a=Number(r>>o&s),u=Number(r&s),c=i?4:0,l=i?0:4;e.setUint32(n+c,a,i),e.setUint32(n+l,u,i)}let F2=class extends tg{constructor(n,r,i,o){super(),this.blockLen=n,this.outputLen=r,this.padOffset=i,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(n),this.view=pu(this.buffer)}update(n){xs(this);const{view:r,buffer:i,blockLen:o}=this;n=xl(n);const s=n.length;for(let a=0;a<s;){const u=Math.min(o-this.pos,s-a);if(u===o){const c=pu(n);for(;o<=s-a;a+=o)this.process(c,a);continue}i.set(n.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=n.length,this.roundClean(),this}digestInto(n){xs(this),R2(n,this),this.finished=!0;const{buffer:r,view:i,blockLen:o,isLE:s}=this;let{pos:a}=this;r[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(i,0),a=0);for(let h=a;h<o;h++)r[h]=0;j2(i,o-8,BigInt(this.length*8),s),this.process(i,0);const u=pu(n),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)u.setUint32(4*h,f[h],s)}digest(){const{buffer:n,outputLen:r}=this;this.digestInto(n);const i=n.slice(0,r);return this.destroy(),i}_cloneInto(n){n||(n=new this.constructor),n.set(...this.get());const{blockLen:r,buffer:i,length:o,finished:s,destroyed:a,pos:u}=this;return n.length=o,n.pos=u,n.finished=s,n.destroyed=a,o%r&&n.buffer.set(i),n}};const M2=(e,n,r)=>e&n^~e&r,z2=(e,n,r)=>e&n^e&r^n&r,q2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Pn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Nn=new Uint32Array(64);let K2=class extends F2{constructor(){super(64,32,8,!1),this.A=Pn[0]|0,this.B=Pn[1]|0,this.C=Pn[2]|0,this.D=Pn[3]|0,this.E=Pn[4]|0,this.F=Pn[5]|0,this.G=Pn[6]|0,this.H=Pn[7]|0}get(){const{A:n,B:r,C:i,D:o,E:s,F:a,G:u,H:c}=this;return[n,r,i,o,s,a,u,c]}set(n,r,i,o,s,a,u,c){this.A=n|0,this.B=r|0,this.C=i|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=u|0,this.H=c|0}process(n,r){for(let h=0;h<16;h++,r+=4)Nn[h]=n.getUint32(r,!1);for(let h=16;h<64;h++){const p=Nn[h-15],b=Nn[h-2],y=Ut(p,7)^Ut(p,18)^p>>>3,d=Ut(b,17)^Ut(b,19)^b>>>10;Nn[h]=d+Nn[h-7]+y+Nn[h-16]|0}let{A:i,B:o,C:s,D:a,E:u,F:c,G:l,H:f}=this;for(let h=0;h<64;h++){const p=Ut(u,6)^Ut(u,11)^Ut(u,25),b=f+p+M2(u,c,l)+q2[h]+Nn[h]|0,y=(Ut(i,2)^Ut(i,13)^Ut(i,22))+z2(i,o,s)|0;f=l,l=c,c=u,u=a+b|0,a=s,s=o,o=i,i=b+y|0}i=i+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,u=u+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(i,o,s,a,u,c,l,f)}roundClean(){Nn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const dc=H2(()=>new K2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const rg=BigInt(0),na=BigInt(1),D2=BigInt(2),ra=e=>e instanceof Uint8Array,V2=Array.from({length:256},(e,n)=>n.toString(16).padStart(2,"0"));function Ai(e){if(!ra(e))throw new Error("Uint8Array expected");let n="";for(let r=0;r<e.length;r++)n+=V2[e[r]];return n}function ig(e){const n=e.toString(16);return n.length&1?`0${n}`:n}function Ll(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Si(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const n=e.length;if(n%2)throw new Error("padded hex string expected, got unpadded hex of length "+n);const r=new Uint8Array(n/2);for(let i=0;i<r.length;i++){const o=i*2,s=e.slice(o,o+2),a=Number.parseInt(s,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");r[i]=a}return r}function ot(e){return Ll(Ai(e))}function Al(e){if(!ra(e))throw new Error("Uint8Array expected");return Ll(Ai(Uint8Array.from(e).reverse()))}function sr(e,n){return Si(e.toString(16).padStart(n*2,"0"))}function Sl(e,n){return sr(e,n).reverse()}function W2(e){return Si(ig(e))}function Je(e,n,r){let i;if(typeof n=="string")try{i=Si(n)}catch(s){throw new Error(`${e} must be valid hex string, got "${n}". Cause: ${s}`)}else if(ra(n))i=Uint8Array.from(n);else throw new Error(`${e} must be hex string or Uint8Array`);const o=i.length;if(typeof r=="number"&&o!==r)throw new Error(`${e} expected ${r} bytes, got ${o}`);return i}function Dr(...e){const n=new Uint8Array(e.reduce((i,o)=>i+o.length,0));let r=0;return e.forEach(i=>{if(!ra(i))throw new Error("Uint8Array expected");n.set(i,r),r+=i.length}),n}function G2(e,n){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}function Z2(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function J2(e){let n;for(n=0;e>rg;e>>=na,n+=1);return n}function Y2(e,n){return e>>BigInt(n)&na}const X2=(e,n,r)=>e|(r?na:rg)<<BigInt(n),$l=e=>(D2<<BigInt(e-1))-na,gu=e=>new Uint8Array(e),Zh=e=>Uint8Array.from(e);function og(e,n,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof n!="number"||n<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=gu(e),o=gu(e),s=0;const a=()=>{i.fill(1),o.fill(0),s=0},u=(...f)=>r(o,i,...f),c=(f=gu())=>{o=u(Zh([0]),f),i=u(),f.length!==0&&(o=u(Zh([1]),f),i=u())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<n;){i=u();const p=i.slice();h.push(p),f+=i.length}return Dr(...h)};return(f,h)=>{a(),c(f);let p;for(;!(p=h(l()));)c();return a(),p}}const Q2={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,n)=>n.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Lo(e,n,r={}){const i=(o,s,a)=>{const u=Q2[s];if(typeof u!="function")throw new Error(`Invalid validator "${s}", expected function`);const c=e[o];if(!(a&&c===void 0)&&!u(c,e))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(const[o,s]of Object.entries(n))i(o,s,!1);for(const[o,s]of Object.entries(r))i(o,s,!0);return e}const ev=Object.freeze(Object.defineProperty({__proto__:null,bitGet:Y2,bitLen:J2,bitMask:$l,bitSet:X2,bytesToHex:Ai,bytesToNumberBE:ot,bytesToNumberLE:Al,concatBytes:Dr,createHmacDrbg:og,ensureBytes:Je,equalBytes:G2,hexToBytes:Si,hexToNumber:Ll,numberToBytesBE:sr,numberToBytesLE:Sl,numberToHexUnpadded:ig,numberToVarBytesBE:W2,utf8ToBytes:Z2,validateObject:Lo},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ue=BigInt(0),de=BigInt(1),Br=BigInt(2),tv=BigInt(3),pc=BigInt(4),Jh=BigInt(5),Yh=BigInt(8);BigInt(9);BigInt(16);function qe(e,n){const r=e%n;return r>=Ue?r:n+r}function nv(e,n,r){if(r<=Ue||n<Ue)throw new Error("Expected power/modulo > 0");if(r===de)return Ue;let i=de;for(;n>Ue;)n&de&&(i=i*e%r),e=e*e%r,n>>=de;return i}function ft(e,n,r){let i=e;for(;n-- >Ue;)i*=i,i%=r;return i}function gc(e,n){if(e===Ue||n<=Ue)throw new Error(`invert: expected positive integers, got n=${e} mod=${n}`);let r=qe(e,n),i=n,o=Ue,s=de;for(;r!==Ue;){const a=i/r,u=i%r,c=o-s*a;i=r,r=u,o=s,s=c}if(i!==de)throw new Error("invert: does not exist");return qe(o,n)}function rv(e){const n=(e-de)/Br;let r,i,o;for(r=e-de,i=0;r%Br===Ue;r/=Br,i++);for(o=Br;o<e&&nv(o,n,e)!==e-de;o++);if(i===1){const a=(e+de)/pc;return function(u,c){const l=u.pow(c,a);if(!u.eql(u.sqr(l),c))throw new Error("Cannot find square root");return l}}const s=(r+de)/Br;return function(a,u){if(a.pow(u,n)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,l=a.pow(a.mul(a.ONE,o),r),f=a.pow(u,s),h=a.pow(u,r);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let p=1;for(let y=a.sqr(h);p<c&&!a.eql(y,a.ONE);p++)y=a.sqr(y);const b=a.pow(l,de<<BigInt(c-p-1));l=a.sqr(b),f=a.mul(f,b),h=a.mul(h,l),c=p}return f}}function iv(e){if(e%pc===tv){const n=(e+de)/pc;return function(r,i){const o=r.pow(i,n);if(!r.eql(r.sqr(o),i))throw new Error("Cannot find square root");return o}}if(e%Yh===Jh){const n=(e-Jh)/Yh;return function(r,i){const o=r.mul(i,Br),s=r.pow(o,n),a=r.mul(i,s),u=r.mul(r.mul(a,Br),s),c=r.mul(a,r.sub(u,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return rv(e)}const ov=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sv(e){const n={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=ov.reduce((i,o)=>(i[o]="function",i),n);return Lo(e,r)}function av(e,n,r){if(r<Ue)throw new Error("Expected power > 0");if(r===Ue)return e.ONE;if(r===de)return n;let i=e.ONE,o=n;for(;r>Ue;)r&de&&(i=e.mul(i,o)),o=e.sqr(o),r>>=de;return i}function uv(e,n){const r=new Array(n.length),i=n.reduce((s,a,u)=>e.is0(a)?s:(r[u]=s,e.mul(s,a)),e.ONE),o=e.inv(i);return n.reduceRight((s,a,u)=>e.is0(a)?s:(r[u]=e.mul(s,r[u]),e.mul(s,a)),o),r}function sg(e,n){const r=n!==void 0?n:e.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function cv(e,n,r=!1,i={}){if(e<=Ue)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:s}=sg(e,n);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const a=iv(e),u=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:$l(o),ZERO:Ue,ONE:de,create:c=>qe(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return Ue<=c&&c<e},is0:c=>c===Ue,isOdd:c=>(c&de)===de,neg:c=>qe(-c,e),eql:(c,l)=>c===l,sqr:c=>qe(c*c,e),add:(c,l)=>qe(c+l,e),sub:(c,l)=>qe(c-l,e),mul:(c,l)=>qe(c*l,e),pow:(c,l)=>av(u,c,l),div:(c,l)=>qe(c*gc(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>gc(c,e),sqrt:i.sqrt||(c=>a(u,c)),invertBatch:c=>uv(u,c),cmov:(c,l,f)=>f?l:c,toBytes:c=>r?Sl(c,s):sr(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return r?Al(c):ot(c)}});return Object.freeze(u)}function ag(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const n=e.toString(2).length;return Math.ceil(n/8)}function ug(e){const n=ag(e);return n+Math.ceil(n/2)}function lv(e,n,r=!1){const i=e.length,o=ag(n),s=ug(n);if(i<16||i<s||i>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${i}`);const a=r?ot(e):Al(e),u=qe(a,n-de)+de;return r?Sl(u,o):sr(u,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const fv=BigInt(0),yu=BigInt(1);function hv(e,n){const r=(o,s)=>{const a=s.negate();return o?a:s},i=o=>{const s=Math.ceil(n/o)+1,a=2**(o-1);return{windows:s,windowSize:a}};return{constTimeNegate:r,unsafeLadder(o,s){let a=e.ZERO,u=o;for(;s>fv;)s&yu&&(a=a.add(u)),u=u.double(),s>>=yu;return a},precomputeWindow(o,s){const{windows:a,windowSize:u}=i(s),c=[];let l=o,f=l;for(let h=0;h<a;h++){f=l,c.push(f);for(let p=1;p<u;p++)f=f.add(l),c.push(f);l=f.double()}return c},wNAF(o,s,a){const{windows:u,windowSize:c}=i(o);let l=e.ZERO,f=e.BASE;const h=BigInt(2**o-1),p=2**o,b=BigInt(o);for(let y=0;y<u;y++){const d=y*c;let g=Number(a&h);a>>=b,g>c&&(g-=p,a+=yu);const m=d,x=d+Math.abs(g)-1,S=y%2!==0,O=g<0;g===0?f=f.add(r(S,s[m])):l=l.add(r(O,s[x]))}return{p:l,f}},wNAFCached(o,s,a,u){const c=o._WINDOW_SIZE||1;let l=s.get(o);return l||(l=this.precomputeWindow(o,c),c!==1&&s.set(o,u(l))),this.wNAF(c,l,a)}}}function cg(e){return sv(e.Fp),Lo(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...sg(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function dv(e){const n=cg(e);Lo(n,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:i,a:o}=n;if(r){if(!i.eql(o,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...n})}const{bytesToNumberBE:pv,hexToBytes:gv}=ev,Tr={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:n}=Tr;if(e.length<2||e[0]!==2)throw new n("Invalid signature integer tag");const r=e[1],i=e.subarray(2,r+2);if(!r||i.length!==r)throw new n("Invalid signature integer: wrong length");if(i[0]&128)throw new n("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new n("Invalid signature integer: unnecessary leading zero");return{d:pv(i),l:e.subarray(r+2)}},toSig(e){const{Err:n}=Tr,r=typeof e=="string"?gv(e):e;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let i=r.length;if(i<2||r[0]!=48)throw new n("Invalid signature tag");if(r[1]!==i-2)throw new n("Invalid signature: incorrect length");const{d:o,l:s}=Tr._parseInt(r.subarray(2)),{d:a,l:u}=Tr._parseInt(s);if(u.length)throw new n("Invalid signature: left bytes after parsing");return{r:o,s:a}},hexFromSig(e){const n=l=>Number.parseInt(l[0],16)&8?"00"+l:l,r=l=>{const f=l.toString(16);return f.length&1?`0${f}`:f},i=n(r(e.s)),o=n(r(e.r)),s=i.length/2,a=o.length/2,u=r(s),c=r(a);return`30${r(a+s+4)}02${c}${o}02${u}${i}`}},pn=BigInt(0),mt=BigInt(1);BigInt(2);const Xh=BigInt(3);BigInt(4);function yv(e){const n=dv(e),{Fp:r}=n,i=n.toBytes||((y,d,g)=>{const m=d.toAffine();return Dr(Uint8Array.from([4]),r.toBytes(m.x),r.toBytes(m.y))}),o=n.fromBytes||(y=>{const d=y.subarray(1),g=r.fromBytes(d.subarray(0,r.BYTES)),m=r.fromBytes(d.subarray(r.BYTES,2*r.BYTES));return{x:g,y:m}});function s(y){const{a:d,b:g}=n,m=r.sqr(y),x=r.mul(m,y);return r.add(r.add(x,r.mul(y,d)),g)}if(!r.eql(r.sqr(n.Gy),s(n.Gx)))throw new Error("bad generator point: equation left != right");function a(y){return typeof y=="bigint"&&pn<y&&y<n.n}function u(y){if(!a(y))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(y){const{allowedPrivateKeyLengths:d,nByteLength:g,wrapPrivateKey:m,n:x}=n;if(d&&typeof y!="bigint"){if(y instanceof Uint8Array&&(y=Ai(y)),typeof y!="string"||!d.includes(y.length))throw new Error("Invalid key");y=y.padStart(g*2,"0")}let S;try{S=typeof y=="bigint"?y:ot(Je("private key",y,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof y}`)}return m&&(S=qe(S,x)),u(S),S}const l=new Map;function f(y){if(!(y instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(d,g,m){if(this.px=d,this.py=g,this.pz=m,d==null||!r.isValid(d))throw new Error("x required");if(g==null||!r.isValid(g))throw new Error("y required");if(m==null||!r.isValid(m))throw new Error("z required")}static fromAffine(d){const{x:g,y:m}=d||{};if(!d||!r.isValid(g)||!r.isValid(m))throw new Error("invalid affine point");if(d instanceof h)throw new Error("projective point not allowed");const x=S=>r.eql(S,r.ZERO);return x(g)&&x(m)?h.ZERO:new h(g,m,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const g=r.invertBatch(d.map(m=>m.pz));return d.map((m,x)=>m.toAffine(g[x])).map(h.fromAffine)}static fromHex(d){const g=h.fromAffine(o(Je("pointHex",d)));return g.assertValidity(),g}static fromPrivateKey(d){return h.BASE.multiply(c(d))}_setWindowSize(d){this._WINDOW_SIZE=d,l.delete(this)}assertValidity(){if(this.is0()){if(n.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:d,y:g}=this.toAffine();if(!r.isValid(d)||!r.isValid(g))throw new Error("bad point: x or y not FE");const m=r.sqr(g),x=s(d);if(!r.eql(m,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:d}=this.toAffine();if(r.isOdd)return!r.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){f(d);const{px:g,py:m,pz:x}=this,{px:S,py:O,pz:B}=d,E=r.eql(r.mul(g,B),r.mul(S,x)),L=r.eql(r.mul(m,B),r.mul(O,x));return E&&L}negate(){return new h(this.px,r.neg(this.py),this.pz)}double(){const{a:d,b:g}=n,m=r.mul(g,Xh),{px:x,py:S,pz:O}=this;let B=r.ZERO,E=r.ZERO,L=r.ZERO,I=r.mul(x,x),R=r.mul(S,S),U=r.mul(O,O),k=r.mul(x,S);return k=r.add(k,k),L=r.mul(x,O),L=r.add(L,L),B=r.mul(d,L),E=r.mul(m,U),E=r.add(B,E),B=r.sub(R,E),E=r.add(R,E),E=r.mul(B,E),B=r.mul(k,B),L=r.mul(m,L),U=r.mul(d,U),k=r.sub(I,U),k=r.mul(d,k),k=r.add(k,L),L=r.add(I,I),I=r.add(L,I),I=r.add(I,U),I=r.mul(I,k),E=r.add(E,I),U=r.mul(S,O),U=r.add(U,U),I=r.mul(U,k),B=r.sub(B,I),L=r.mul(U,R),L=r.add(L,L),L=r.add(L,L),new h(B,E,L)}add(d){f(d);const{px:g,py:m,pz:x}=this,{px:S,py:O,pz:B}=d;let E=r.ZERO,L=r.ZERO,I=r.ZERO;const R=n.a,U=r.mul(n.b,Xh);let k=r.mul(g,S),P=r.mul(m,O),T=r.mul(x,B),H=r.add(g,m),w=r.add(S,O);H=r.mul(H,w),w=r.add(k,P),H=r.sub(H,w),w=r.add(g,x);let v=r.add(S,B);return w=r.mul(w,v),v=r.add(k,T),w=r.sub(w,v),v=r.add(m,x),E=r.add(O,B),v=r.mul(v,E),E=r.add(P,T),v=r.sub(v,E),I=r.mul(R,w),E=r.mul(U,T),I=r.add(E,I),E=r.sub(P,I),I=r.add(P,I),L=r.mul(E,I),P=r.add(k,k),P=r.add(P,k),T=r.mul(R,T),w=r.mul(U,w),P=r.add(P,T),T=r.sub(k,T),T=r.mul(R,T),w=r.add(w,T),k=r.mul(P,w),L=r.add(L,k),k=r.mul(v,w),E=r.mul(H,E),E=r.sub(E,k),k=r.mul(H,P),I=r.mul(v,I),I=r.add(I,k),new h(E,L,I)}subtract(d){return this.add(d.negate())}is0(){return this.equals(h.ZERO)}wNAF(d){return b.wNAFCached(this,l,d,g=>{const m=r.invertBatch(g.map(x=>x.pz));return g.map((x,S)=>x.toAffine(m[S])).map(h.fromAffine)})}multiplyUnsafe(d){const g=h.ZERO;if(d===pn)return g;if(u(d),d===mt)return this;const{endo:m}=n;if(!m)return b.unsafeLadder(this,d);let{k1neg:x,k1:S,k2neg:O,k2:B}=m.splitScalar(d),E=g,L=g,I=this;for(;S>pn||B>pn;)S&mt&&(E=E.add(I)),B&mt&&(L=L.add(I)),I=I.double(),S>>=mt,B>>=mt;return x&&(E=E.negate()),O&&(L=L.negate()),L=new h(r.mul(L.px,m.beta),L.py,L.pz),E.add(L)}multiply(d){u(d);let g=d,m,x;const{endo:S}=n;if(S){const{k1neg:O,k1:B,k2neg:E,k2:L}=S.splitScalar(g);let{p:I,f:R}=this.wNAF(B),{p:U,f:k}=this.wNAF(L);I=b.constTimeNegate(O,I),U=b.constTimeNegate(E,U),U=new h(r.mul(U.px,S.beta),U.py,U.pz),m=I.add(U),x=R.add(k)}else{const{p:O,f:B}=this.wNAF(g);m=O,x=B}return h.normalizeZ([m,x])[0]}multiplyAndAddUnsafe(d,g,m){const x=h.BASE,S=(B,E)=>E===pn||E===mt||!B.equals(x)?B.multiplyUnsafe(E):B.multiply(E),O=S(this,g).add(S(d,m));return O.is0()?void 0:O}toAffine(d){const{px:g,py:m,pz:x}=this,S=this.is0();d==null&&(d=S?r.ONE:r.inv(x));const O=r.mul(g,d),B=r.mul(m,d),E=r.mul(x,d);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(E,r.ONE))throw new Error("invZ was invalid");return{x:O,y:B}}isTorsionFree(){const{h:d,isTorsionFree:g}=n;if(d===mt)return!0;if(g)return g(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:g}=n;return d===mt?this:g?g(h,this):this.multiplyUnsafe(n.h)}toRawBytes(d=!0){return this.assertValidity(),i(h,this,d)}toHex(d=!0){return Ai(this.toRawBytes(d))}}h.BASE=new h(n.Gx,n.Gy,r.ONE),h.ZERO=new h(r.ZERO,r.ONE,r.ZERO);const p=n.nBitLength,b=hv(h,n.endo?Math.ceil(p/2):p);return{CURVE:n,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:a}}function wv(e){const n=cg(e);return Lo(n,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...n})}function mv(e){const n=wv(e),{Fp:r,n:i}=n,o=r.BYTES+1,s=2*r.BYTES+1;function a(w){return pn<w&&w<r.ORDER}function u(w){return qe(w,i)}function c(w){return gc(w,i)}const{ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:h,isWithinCurveOrder:p}=yv({...n,toBytes(w,v,$){const _=v.toAffine(),A=r.toBytes(_.x),C=Dr;return $?C(Uint8Array.from([v.hasEvenY()?2:3]),A):C(Uint8Array.from([4]),A,r.toBytes(_.y))},fromBytes(w){const v=w.length,$=w[0],_=w.subarray(1);if(v===o&&($===2||$===3)){const A=ot(_);if(!a(A))throw new Error("Point is not on curve");const C=h(A);let N=r.sqrt(C);const j=(N&mt)===mt;return($&1)===1!==j&&(N=r.neg(N)),{x:A,y:N}}else if(v===s&&$===4){const A=r.fromBytes(_.subarray(0,r.BYTES)),C=r.fromBytes(_.subarray(r.BYTES,2*r.BYTES));return{x:A,y:C}}else throw new Error(`Point of length ${v} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),b=w=>Ai(sr(w,n.nByteLength));function y(w){const v=i>>mt;return w>v}function d(w){return y(w)?u(-w):w}const g=(w,v,$)=>ot(w.slice(v,$));class m{constructor(v,$,_){this.r=v,this.s=$,this.recovery=_,this.assertValidity()}static fromCompact(v){const $=n.nByteLength;return v=Je("compactSignature",v,$*2),new m(g(v,0,$),g(v,$,2*$))}static fromDER(v){const{r:$,s:_}=Tr.toSig(Je("DER",v));return new m($,_)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(v){return new m(this.r,this.s,v)}recoverPublicKey(v){const{r:$,s:_,recovery:A}=this,C=L(Je("msgHash",v));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");const N=A===2||A===3?$+n.n:$;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const j=A&1?"03":"02",F=l.fromHex(j+b(N)),q=c(N),K=u(-C*q),G=u(_*q),D=l.BASE.multiplyAndAddUnsafe(F,K,G);if(!D)throw new Error("point at infinify");return D.assertValidity(),D}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,u(-this.s),this.recovery):this}toDERRawBytes(){return Si(this.toDERHex())}toDERHex(){return Tr.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Si(this.toCompactHex())}toCompactHex(){return b(this.r)+b(this.s)}}const x={isValidPrivateKey(w){try{return f(w),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const w=ug(n.n);return lv(n.randomBytes(w),n.n)},precompute(w=8,v=l.BASE){return v._setWindowSize(w),v.multiply(BigInt(3)),v}};function S(w,v=!0){return l.fromPrivateKey(w).toRawBytes(v)}function O(w){const v=w instanceof Uint8Array,$=typeof w=="string",_=(v||$)&&w.length;return v?_===o||_===s:$?_===2*o||_===2*s:w instanceof l}function B(w,v,$=!0){if(O(w))throw new Error("first arg must be private key");if(!O(v))throw new Error("second arg must be public key");return l.fromHex(v).multiply(f(w)).toRawBytes($)}const E=n.bits2int||function(w){const v=ot(w),$=w.length*8-n.nBitLength;return $>0?v>>BigInt($):v},L=n.bits2int_modN||function(w){return u(E(w))},I=$l(n.nBitLength);function R(w){if(typeof w!="bigint")throw new Error("bigint expected");if(!(pn<=w&&w<I))throw new Error(`bigint expected < 2^${n.nBitLength}`);return sr(w,n.nByteLength)}function U(w,v,$=k){if(["recovered","canonical"].some(V=>V in $))throw new Error("sign() legacy options not supported");const{hash:_,randomBytes:A}=n;let{lowS:C,prehash:N,extraEntropy:j}=$;C==null&&(C=!0),w=Je("msgHash",w),N&&(w=Je("prehashed msgHash",_(w)));const F=L(w),q=f(v),K=[R(q),R(F)];if(j!=null){const V=j===!0?A(r.BYTES):j;K.push(Je("extraEntropy",V))}const G=Dr(...K),D=F;function Z(V){const ee=E(V);if(!p(ee))return;const ue=c(ee),W=l.BASE.multiply(ee).toAffine(),J=u(W.x);if(J===pn)return;const ce=u(ue*u(D+J*q));if(ce===pn)return;let tt=(W.x===J?0:2)|Number(W.y&mt),nt=ce;return C&&y(ce)&&(nt=d(ce),tt^=1),new m(J,nt,tt)}return{seed:G,k2sig:Z}}const k={lowS:n.lowS,prehash:!1},P={lowS:n.lowS,prehash:!1};function T(w,v,$=k){const{seed:_,k2sig:A}=U(w,v,$),C=n;return og(C.hash.outputLen,C.nByteLength,C.hmac)(_,A)}l.BASE._setWindowSize(8);function H(w,v,$,_=P){var A;const C=w;if(v=Je("msgHash",v),$=Je("publicKey",$),"strict"in _)throw new Error("options.strict was renamed to lowS");const{lowS:N,prehash:j}=_;let F,q;try{if(typeof C=="string"||C instanceof Uint8Array)try{F=m.fromDER(C)}catch(W){if(!(W instanceof Tr.Err))throw W;F=m.fromCompact(C)}else if(typeof C=="object"&&typeof C.r=="bigint"&&typeof C.s=="bigint"){const{r:W,s:J}=C;F=new m(W,J)}else throw new Error("PARSE");q=l.fromHex($)}catch(W){if(W.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(N&&F.hasHighS())return!1;j&&(v=n.hash(v));const{r:K,s:G}=F,D=L(v),Z=c(G),V=u(D*Z),ee=u(K*Z),ue=(A=l.BASE.multiplyAndAddUnsafe(q,V,ee))==null?void 0:A.toAffine();return ue?u(ue.x)===K:!1}return{CURVE:n,getPublicKey:S,getSharedSecret:B,sign:T,verify:H,ProjectivePoint:l,Signature:m,utils:x}}let lg=class extends tg{constructor(n,r){super(),this.finished=!1,this.destroyed=!1,C2(n);const i=xl(r);if(this.iHash=n.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?n.create().update(i).digest():i);for(let a=0;a<s.length;a++)s[a]^=54;this.iHash.update(s),this.oHash=n.create();for(let a=0;a<s.length;a++)s[a]^=106;this.oHash.update(s),s.fill(0)}update(n){return xs(this),this.iHash.update(n),this}digestInto(n){xs(this),Qp(n,this.outputLen),this.finished=!0,this.iHash.digestInto(n),this.oHash.update(n),this.oHash.digestInto(n),this.destroy()}digest(){const n=new Uint8Array(this.oHash.outputLen);return this.digestInto(n),n}_cloneInto(n){n||(n=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:o,destroyed:s,blockLen:a,outputLen:u}=this;return n=n,n.finished=o,n.destroyed=s,n.blockLen=a,n.outputLen=u,n.oHash=r._cloneInto(n.oHash),n.iHash=i._cloneInto(n.iHash),n}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const fg=(e,n,r)=>new lg(e,n).update(r).digest();fg.create=(e,n)=>new lg(e,n);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function bv(e){return{hash:e,hmac:(n,...r)=>fg(e,n,N2(...r)),randomBytes:ng}}function vv(e,n){const r=i=>mv({...e,...bv(i)});return Object.freeze({...r(n),create:r})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ia=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ls=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),hg=BigInt(1),As=BigInt(2),Qh=(e,n)=>(e+n/As)/n;function dg(e){const n=ia,r=BigInt(3),i=BigInt(6),o=BigInt(11),s=BigInt(22),a=BigInt(23),u=BigInt(44),c=BigInt(88),l=e*e*e%n,f=l*l*e%n,h=ft(f,r,n)*f%n,p=ft(h,r,n)*f%n,b=ft(p,As,n)*l%n,y=ft(b,o,n)*b%n,d=ft(y,s,n)*y%n,g=ft(d,u,n)*d%n,m=ft(g,c,n)*g%n,x=ft(m,u,n)*d%n,S=ft(x,r,n)*f%n,O=ft(S,a,n)*y%n,B=ft(O,i,n)*l%n,E=ft(B,As,n);if(!yc.eql(yc.sqr(E),e))throw new Error("Cannot find square root");return E}const yc=cv(ia,void 0,void 0,{sqrt:dg}),zi=vv({a:BigInt(0),b:BigInt(7),Fp:yc,n:Ls,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const n=Ls,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-hg*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,a=BigInt("0x100000000000000000000000000000000"),u=Qh(s*e,n),c=Qh(-i*e,n);let l=qe(e-u*r-c*o,n),f=qe(-u*i-c*s,n);const h=l>a,p=f>a;if(h&&(l=n-l),p&&(f=n-f),l>a||f>a)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:p,k2:f}}}},dc),oa=BigInt(0),pg=e=>typeof e=="bigint"&&oa<e&&e<ia,Ev=e=>typeof e=="bigint"&&oa<e&&e<Ls,ed={};function Ss(e,...n){let r=ed[e];if(r===void 0){const i=dc(Uint8Array.from(e,o=>o.charCodeAt(0)));r=Dr(i,i),ed[e]=r}return dc(Dr(r,...n))}const Il=e=>e.toRawBytes(!0).slice(1),wc=e=>sr(e,32),wu=e=>qe(e,ia),ho=e=>qe(e,Ls),Bl=zi.ProjectivePoint,xv=(e,n,r)=>Bl.BASE.multiplyAndAddUnsafe(e,n,r);function mc(e){let n=zi.utils.normPrivateKeyToScalar(e),r=Bl.fromPrivateKey(n);return{scalar:r.hasEvenY()?n:ho(-n),bytes:Il(r)}}function gg(e){if(!pg(e))throw new Error("bad x: need 0 < x < p");const n=wu(e*e),r=wu(n*e+BigInt(7));let i=dg(r);i%As!==oa&&(i=wu(-i));const o=new Bl(e,i,hg);return o.assertValidity(),o}function yg(...e){return ho(ot(Ss("BIP0340/challenge",...e)))}function Lv(e){return mc(e).bytes}function Av(e,n,r=ng(32)){const i=Je("message",e),{bytes:o,scalar:s}=mc(n),a=Je("auxRand",r,32),u=wc(s^ot(Ss("BIP0340/aux",a))),c=Ss("BIP0340/nonce",u,o,i),l=ho(ot(c));if(l===oa)throw new Error("sign failed: k is zero");const{bytes:f,scalar:h}=mc(l),p=yg(f,o,i),b=new Uint8Array(64);if(b.set(f,0),b.set(wc(ho(h+p*s)),32),!wg(b,i,o))throw new Error("sign: Invalid signature produced");return b}function wg(e,n,r){const i=Je("signature",e,64),o=Je("message",n),s=Je("publicKey",r,32);try{const a=gg(ot(s)),u=ot(i.subarray(0,32));if(!pg(u))return!1;const c=ot(i.subarray(32,64));if(!Ev(c))return!1;const l=yg(wc(u),Il(a),o),f=xv(a,c,ho(-l));return!(!f||!f.hasEvenY()||f.toAffine().x!==u)}catch{return!1}}const Ht={getPublicKey:Lv,sign:Av,verify:wg,utils:{randomPrivateKey:zi.utils.randomPrivateKey,lift_x:gg,pointToBytes:Il,numberToBytesBE:sr,bytesToNumberBE:ot,taggedHash:Ss,mod:qe}},mu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const kl=e=>e instanceof Uint8Array,bu=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),_t=(e,n)=>e<<32-n|e>>>n,Sv=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Sv)throw new Error("Non little-endian hardware is not supported");const $v=Array.from({length:256},(e,n)=>n.toString(16).padStart(2,"0"));function Ie(e){if(!kl(e))throw new Error("Uint8Array expected");let n="";for(let r=0;r<e.length;r++)n+=$v[e[r]];return n}function $i(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const n=e.length;if(n%2)throw new Error("padded hex string expected, got unpadded hex of length "+n);const r=new Uint8Array(n/2);for(let i=0;i<r.length;i++){const o=i*2,s=e.slice(o,o+2),a=Number.parseInt(s,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");r[i]=a}return r}function mg(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function po(e){if(typeof e=="string"&&(e=mg(e)),!kl(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function $s(...e){const n=new Uint8Array(e.reduce((i,o)=>i+o.length,0));let r=0;return e.forEach(i=>{if(!kl(i))throw new Error("Uint8Array expected");n.set(i,r),r+=i.length}),n}let bg=class{clone(){return this._cloneInto()}};function vg(e){const n=i=>e().update(po(i)).digest(),r=e();return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=()=>e(),n}function Eg(e=32){if(mu&&typeof mu.getRandomValues=="function")return mu.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function bc(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Iv(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function xg(e,...n){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(n.length>0&&!n.includes(e.length))throw new Error(`Expected Uint8Array of length ${n}, not of length=${e.length}`)}function Bv(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");bc(e.outputLen),bc(e.blockLen)}function kv(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function Ov(e,n){xg(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const Dt={number:bc,bool:Iv,bytes:xg,hash:Bv,exists:kv,output:Ov};function Uv(e,n,r,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(n,r,i);const o=BigInt(32),s=BigInt(4294967295),a=Number(r>>o&s),u=Number(r&s),c=i?4:0,l=i?0:4;e.setUint32(n+c,a,i),e.setUint32(n+l,u,i)}let _v=class extends bg{constructor(n,r,i,o){super(),this.blockLen=n,this.outputLen=r,this.padOffset=i,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(n),this.view=bu(this.buffer)}update(n){Dt.exists(this);const{view:r,buffer:i,blockLen:o}=this;n=po(n);const s=n.length;for(let a=0;a<s;){const u=Math.min(o-this.pos,s-a);if(u===o){const c=bu(n);for(;o<=s-a;a+=o)this.process(c,a);continue}i.set(n.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=n.length,this.roundClean(),this}digestInto(n){Dt.exists(this),Dt.output(n,this),this.finished=!0;const{buffer:r,view:i,blockLen:o,isLE:s}=this;let{pos:a}=this;r[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(i,0),a=0);for(let h=a;h<o;h++)r[h]=0;Uv(i,o-8,BigInt(this.length*8),s),this.process(i,0);const u=bu(n),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)u.setUint32(4*h,f[h],s)}digest(){const{buffer:n,outputLen:r}=this;this.digestInto(n);const i=n.slice(0,r);return this.destroy(),i}_cloneInto(n){n||(n=new this.constructor),n.set(...this.get());const{blockLen:r,buffer:i,length:o,finished:s,destroyed:a,pos:u}=this;return n.length=o,n.pos=u,n.finished=s,n.destroyed=a,o%r&&n.buffer.set(i),n}};const Cv=(e,n,r)=>e&n^~e&r,Rv=(e,n,r)=>e&n^e&r^n&r,Tv=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Hn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),jn=new Uint32Array(64);let Lg=class extends _v{constructor(){super(64,32,8,!1),this.A=Hn[0]|0,this.B=Hn[1]|0,this.C=Hn[2]|0,this.D=Hn[3]|0,this.E=Hn[4]|0,this.F=Hn[5]|0,this.G=Hn[6]|0,this.H=Hn[7]|0}get(){const{A:n,B:r,C:i,D:o,E:s,F:a,G:u,H:c}=this;return[n,r,i,o,s,a,u,c]}set(n,r,i,o,s,a,u,c){this.A=n|0,this.B=r|0,this.C=i|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=u|0,this.H=c|0}process(n,r){for(let h=0;h<16;h++,r+=4)jn[h]=n.getUint32(r,!1);for(let h=16;h<64;h++){const p=jn[h-15],b=jn[h-2],y=_t(p,7)^_t(p,18)^p>>>3,d=_t(b,17)^_t(b,19)^b>>>10;jn[h]=d+jn[h-7]+y+jn[h-16]|0}let{A:i,B:o,C:s,D:a,E:u,F:c,G:l,H:f}=this;for(let h=0;h<64;h++){const p=_t(u,6)^_t(u,11)^_t(u,25),b=f+p+Cv(u,c,l)+Tv[h]+jn[h]|0,y=(_t(i,2)^_t(i,13)^_t(i,22))+Rv(i,o,s)|0;f=l,l=c,c=u,u=a+b|0,a=s,s=o,o=i,i=b+y|0}i=i+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,u=u+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(i,o,s,a,u,c,l,f)}roundClean(){jn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},Pv=class extends Lg{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};const fi=vg(()=>new Lg);vg(()=>new Pv);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function qi(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function An(...e){const n=(o,s)=>a=>o(s(a)),r=Array.from(e).reverse().reduce((o,s)=>o?n(o,s.encode):s.encode,void 0),i=e.reduce((o,s)=>o?n(o,s.decode):s.decode,void 0);return{encode:r,decode:i}}function Sn(e){return{encode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return n.map(r=>{if(qi(r),r<0||r>=e.length)throw new Error(`Digit index outside alphabet: ${r} (alphabet: ${e.length})`);return e[r]})},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("alphabet.decode input should be array of strings");return n.map(r=>{if(typeof r!="string")throw new Error(`alphabet.decode: not string element=${r}`);const i=e.indexOf(r);if(i===-1)throw new Error(`Unknown letter: "${r}". Allowed: ${e}`);return i})}}}function $n(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("join.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`join.encode: non-string input=${r}`);return n.join(e)},decode:n=>{if(typeof n!="string")throw new Error("join.decode input should be string");return n.split(e)}}}function sa(e,n="="){if(qi(e),typeof n!="string")throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of r)if(typeof i!="string")throw new Error(`padding.encode: non-string input=${i}`);for(;r.length*e%8;)r.push(n);return r},decode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of r)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let i=r.length;if(i*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;i>0&&r[i-1]===n;i--)if(!((i-1)*e%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,i)}}}function Ag(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:n=>n,decode:n=>e(n)}}function td(e,n,r){if(n<2)throw new Error(`convertRadix: wrong from=${n}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let i=0;const o=[],s=Array.from(e);for(s.forEach(a=>{if(qi(a),a<0||a>=n)throw new Error(`Wrong integer: ${a}`)});;){let a=0,u=!0;for(let c=i;c<s.length;c++){const l=s[c],f=n*a+l;if(!Number.isSafeInteger(f)||n*a/n!==a||f-l!==n*a)throw new Error("convertRadix: carry overflow");if(a=f%r,s[c]=Math.floor(f/r),!Number.isSafeInteger(s[c])||s[c]*r+a!==f)throw new Error("convertRadix: carry overflow");if(u)s[c]?u=!1:i=c;else continue}if(o.push(a),u)break}for(let a=0;a<e.length-1&&e[a]===0;a++)o.push(0);return o.reverse()}const Sg=(e,n)=>n?Sg(n,e%n):e,Is=(e,n)=>e+(n-Sg(e,n));function vc(e,n,r,i){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(n<=0||n>32)throw new Error(`convertRadix2: wrong from=${n}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Is(n,r)>32)throw new Error(`convertRadix2: carry overflow from=${n} to=${r} carryBits=${Is(n,r)}`);let o=0,s=0;const a=2**r-1,u=[];for(const c of e){if(qi(c),c>=2**n)throw new Error(`convertRadix2: invalid data word=${c} from=${n}`);if(o=o<<n|c,s+n>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${n}`);for(s+=n;s>=r;s-=r)u.push((o>>s-r&a)>>>0);o&=2**s-1}if(o=o<<r-s&a,!i&&s>=n)throw new Error("Excess padding");if(!i&&o)throw new Error(`Non-zero padding: ${o}`);return i&&s>0&&u.push(o>>>0),u}function Nv(e){return qi(e),{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return td(Array.from(n),2**8,e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(td(n,e,2**8))}}}function gr(e,n=!1){if(qi(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Is(8,e)>32||Is(e,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return vc(Array.from(r),8,e,!n)},decode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(vc(r,e,8,n))}}}function nd(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...n){try{return e.apply(null,n)}catch{}}}const Hv=An(gr(4),Sn("0123456789ABCDEF"),$n("")),jv=An(gr(5),Sn("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),sa(5),$n(""));An(gr(5),Sn("0123456789ABCDEFGHIJKLMNOPQRSTUV"),sa(5),$n(""));An(gr(5),Sn("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),$n(""),Ag(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const En=An(gr(6),Sn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),sa(6),$n("")),Fv=An(gr(6),Sn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),sa(6),$n("")),Ol=e=>An(Nv(58),Sn(e),$n("")),Ec=Ol("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Ol("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");Ol("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const rd=[0,2,3,5,6,7,9,10,11],Mv={encode(e){let n="";for(let r=0;r<e.length;r+=8){const i=e.subarray(r,r+8);n+=Ec.encode(i).padStart(rd[i.length],"1")}return n},decode(e){let n=[];for(let r=0;r<e.length;r+=11){const i=e.slice(r,r+11),o=rd.indexOf(i.length),s=Ec.decode(i);for(let a=0;a<s.length-o;a++)if(s[a]!==0)throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(n)}},xc=An(Sn("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),$n("")),id=[996825010,642813549,513874426,1027748829,705979059];function Xi(e){const n=e>>25;let r=(e&33554431)<<5;for(let i=0;i<id.length;i++)(n>>i&1)===1&&(r^=id[i]);return r}function od(e,n,r=1){const i=e.length;let o=1;for(let s=0;s<i;s++){const a=e.charCodeAt(s);if(a<33||a>126)throw new Error(`Invalid prefix (${e})`);o=Xi(o)^a>>5}o=Xi(o);for(let s=0;s<i;s++)o=Xi(o)^e.charCodeAt(s)&31;for(let s of n)o=Xi(o)^s;for(let s=0;s<6;s++)o=Xi(o);return o^=r,xc.encode(vc([o%2**30],30,5,!1))}function $g(e){const n=e==="bech32"?1:734539939,r=gr(5),i=r.decode,o=r.encode,s=nd(i);function a(f,h,p=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(h)||h.length&&typeof h[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof h}`);const b=f.length+7+h.length;if(p!==!1&&b>p)throw new TypeError(`Length ${b} exceeds limit ${p}`);return f=f.toLowerCase(),`${f}1${xc.encode(h)}${od(f,h,n)}`}function u(f,h=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||h!==!1&&f.length>h)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${h})`);const p=f.toLowerCase();if(f!==p&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=p;const b=f.lastIndexOf("1");if(b===0||b===-1)throw new Error('Letter "1" must be present between prefix and data only');const y=f.slice(0,b),d=f.slice(b+1);if(d.length<6)throw new Error("Data must be at least 6 characters long");const g=xc.decode(d).slice(0,-6),m=od(y,g,n);if(!d.endsWith(m))throw new Error(`Invalid checksum in ${f}: expected "${m}"`);return{prefix:y,words:g}}const c=nd(u);function l(f){const{prefix:h,words:p}=u(f,!1);return{prefix:h,words:p,bytes:i(p)}}return{encode:a,decode:u,decodeToBytes:l,decodeUnsafe:c,fromWords:i,fromWordsUnsafe:s,toWords:o}}const Ii=$g("bech32");$g("bech32m");const zv={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},qv=An(gr(4),Sn("0123456789abcdef"),$n(""),Ag(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),Kv={utf8:zv,hex:qv,base16:Hv,base32:jv,base64:En,base64url:Fv,base58:Ec,base58xmr:Mv};`${Object.keys(Kv).join(", ")}`;function vu(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function sd(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function Ig(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function St(e,...n){if(!Ig(e))throw new Error("Uint8Array expected");if(n.length>0&&!n.includes(e.length))throw new Error(`Uint8Array expected of length ${n}, not of length=${e.length}`)}function Bi(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function Ul(e,n){St(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const we=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Dv=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Vv=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Vv)throw new Error("Non little-endian hardware is not supported");function _l(e){if(typeof e!="string")throw new Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ar(e){if(typeof e=="string")e=_l(e);else if(Ig(e))e=e.slice();else throw new Error(`Uint8Array expected, got ${typeof e}`);return e}function Wv(e,n){if(n==null||typeof n!="object")throw new Error("options must be defined");return Object.assign(e,n)}function Gv(e,n){if(e.length!==n.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^n[i];return r===0}const Zv=(e,n)=>(Object.assign(n,e),n),ln=16,Cl=new Uint8Array(16),jt=we(Cl),Jv=225,Yv=(e,n,r,i)=>{const o=i&1;return{s3:r<<31|i>>>1,s2:n<<31|r>>>1,s1:e<<31|n>>>1,s0:e>>>1^Jv<<24&-(o&1)}},bt=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255|0;function Xv(e){e.reverse();const n=e[15]&1;let r=0;for(let i=0;i<e.length;i++){const o=e[i];e[i]=o>>>1|r,r=(o&1)<<7}return e[0]^=-n&225,e}const Qv=e=>e>64*1024?8:e>1024?4:2;let Bg=class{constructor(n,r){this.blockLen=ln,this.outputLen=ln,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,n=ar(n),St(n,16);const i=Dv(n);let o=i.getUint32(0,!1),s=i.getUint32(4,!1),a=i.getUint32(8,!1),u=i.getUint32(12,!1);const c=[];for(let b=0;b<128;b++)c.push({s0:bt(o),s1:bt(s),s2:bt(a),s3:bt(u)}),{s0:o,s1:s,s2:a,s3:u}=Yv(o,s,a,u);const l=Qv(r||1024);if(![1,2,4,8].includes(l))throw new Error(`ghash: wrong window size=${l}, should be 2, 4 or 8`);this.W=l;const f=128/l,h=this.windowSize=2**l,p=[];for(let b=0;b<f;b++)for(let y=0;y<h;y++){let d=0,g=0,m=0,x=0;for(let S=0;S<l;S++){if(!(y>>>l-S-1&1))continue;const{s0:O,s1:B,s2:E,s3:L}=c[l*b+S];d^=O,g^=B,m^=E,x^=L}p.push({s0:d,s1:g,s2:m,s3:x})}this.t=p}_updateBlock(n,r,i,o){n^=this.s0,r^=this.s1,i^=this.s2,o^=this.s3;const{W:s,t:a,windowSize:u}=this;let c=0,l=0,f=0,h=0;const p=(1<<s)-1;let b=0;for(const y of[n,r,i,o])for(let d=0;d<4;d++){const g=y>>>8*d&255;for(let m=8/s-1;m>=0;m--){const x=g>>>s*m&p,{s0:S,s1:O,s2:B,s3:E}=a[b*u+x];c^=S,l^=O,f^=B,h^=E,b+=1}}this.s0=c,this.s1=l,this.s2=f,this.s3=h}update(n){n=ar(n),Bi(this);const r=we(n),i=Math.floor(n.length/ln),o=n.length%ln;for(let s=0;s<i;s++)this._updateBlock(r[s*4+0],r[s*4+1],r[s*4+2],r[s*4+3]);return o&&(Cl.set(n.subarray(i*ln)),this._updateBlock(jt[0],jt[1],jt[2],jt[3]),jt.fill(0)),this}destroy(){const{t:n}=this;for(const r of n)r.s0=0,r.s1=0,r.s2=0,r.s3=0}digestInto(n){Bi(this),Ul(n,this),this.finished=!0;const{s0:r,s1:i,s2:o,s3:s}=this,a=we(n);return a[0]=r,a[1]=i,a[2]=o,a[3]=s,n}digest(){const n=new Uint8Array(ln);return this.digestInto(n),this.destroy(),n}},eE=class extends Bg{constructor(n,r){n=ar(n);const i=Xv(n.slice());super(i,r),i.fill(0)}update(n){n=ar(n),Bi(this);const r=we(n),i=n.length%ln,o=Math.floor(n.length/ln);for(let s=0;s<o;s++)this._updateBlock(bt(r[s*4+3]),bt(r[s*4+2]),bt(r[s*4+1]),bt(r[s*4+0]));return i&&(Cl.set(n.subarray(o*ln)),this._updateBlock(bt(jt[3]),bt(jt[2]),bt(jt[1]),bt(jt[0])),jt.fill(0)),this}digestInto(n){Bi(this),Ul(n,this),this.finished=!0;const{s0:r,s1:i,s2:o,s3:s}=this,a=we(n);return a[0]=r,a[1]=i,a[2]=o,a[3]=s,n.reverse()}};function kg(e){const n=(i,o)=>e(o,i.length).update(ar(i)).digest(),r=e(new Uint8Array(16),0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=(i,o)=>e(i,o),n}kg((e,n)=>new Bg(e,n));kg((e,n)=>new eE(e,n));const nr=16,tE=283;function Rl(e){return e<<1^tE&-(e>>7)}function ai(e,n){let r=0;for(;n>0;n>>=1)r^=e&-(n&1),e=Rl(e);return r}const Lc=(()=>{let e=new Uint8Array(256);for(let r=0,i=1;r<256;r++,i^=Rl(i))e[r]=i;const n=new Uint8Array(256);n[0]=99;for(let r=0;r<255;r++){let i=e[255-r];i|=i<<8,n[e[r]]=(i^i>>4^i>>5^i>>6^i>>7^99)&255}return n})(),nE=Lc.map((e,n)=>Lc.indexOf(n)),rE=e=>e<<24|e>>>8,Eu=e=>e<<8|e>>>24;function Og(e,n){if(e.length!==256)throw new Error("Wrong sbox length");const r=new Uint32Array(256).map((l,f)=>n(e[f])),i=r.map(Eu),o=i.map(Eu),s=o.map(Eu),a=new Uint32Array(256*256),u=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let l=0;l<256;l++)for(let f=0;f<256;f++){const h=l*256+f;a[h]=r[l]^i[f],u[h]=o[l]^s[f],c[h]=e[l]<<8|e[f]}return{sbox:e,sbox2:c,T0:r,T1:i,T2:o,T3:s,T01:a,T23:u}}const Tl=Og(Lc,e=>ai(e,3)<<24|e<<16|e<<8|ai(e,2)),Ug=Og(nE,e=>ai(e,11)<<24|ai(e,13)<<16|ai(e,9)<<8|ai(e,14)),iE=(()=>{const e=new Uint8Array(16);for(let n=0,r=1;n<16;n++,r=Rl(r))e[n]=r;return e})();function _g(e){St(e);const n=e.length;if(![16,24,32].includes(n))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${n}`);const{sbox2:r}=Tl,i=we(e),o=i.length,s=u=>Vt(r,u,u,u,u),a=new Uint32Array(n+28);a.set(i);for(let u=o;u<a.length;u++){let c=a[u-1];u%o===0?c=s(rE(c))^iE[u/o-1]:o>6&&u%o===4&&(c=s(c)),a[u]=a[u-o]^c}return a}function oE(e){const n=_g(e),r=n.slice(),i=n.length,{sbox2:o}=Tl,{T0:s,T1:a,T2:u,T3:c}=Ug;for(let l=0;l<i;l+=4)for(let f=0;f<4;f++)r[l+f]=n[i-l-4+f];n.fill(0);for(let l=4;l<i-4;l++){const f=r[l],h=Vt(o,f,f,f,f);r[l]=s[h&255]^a[h>>>8&255]^u[h>>>16&255]^c[h>>>24]}return r}function Qn(e,n,r,i,o,s){return e[r<<8&65280|i>>>8&255]^n[o>>>8&65280|s>>>24&255]}function Vt(e,n,r,i,o){return e[n&255|r&65280]|e[i>>>16&255|o>>>16&65280]<<16}function ad(e,n,r,i,o){const{sbox2:s,T01:a,T23:u}=Tl;let c=0;n^=e[c++],r^=e[c++],i^=e[c++],o^=e[c++];const l=e.length/4-2;for(let y=0;y<l;y++){const d=e[c++]^Qn(a,u,n,r,i,o),g=e[c++]^Qn(a,u,r,i,o,n),m=e[c++]^Qn(a,u,i,o,n,r),x=e[c++]^Qn(a,u,o,n,r,i);n=d,r=g,i=m,o=x}const f=e[c++]^Vt(s,n,r,i,o),h=e[c++]^Vt(s,r,i,o,n),p=e[c++]^Vt(s,i,o,n,r),b=e[c++]^Vt(s,o,n,r,i);return{s0:f,s1:h,s2:p,s3:b}}function sE(e,n,r,i,o){const{sbox2:s,T01:a,T23:u}=Ug;let c=0;n^=e[c++],r^=e[c++],i^=e[c++],o^=e[c++];const l=e.length/4-2;for(let y=0;y<l;y++){const d=e[c++]^Qn(a,u,n,o,i,r),g=e[c++]^Qn(a,u,r,n,o,i),m=e[c++]^Qn(a,u,i,r,n,o),x=e[c++]^Qn(a,u,o,i,r,n);n=d,r=g,i=m,o=x}const f=e[c++]^Vt(s,n,o,i,r),h=e[c++]^Vt(s,r,n,o,i),p=e[c++]^Vt(s,i,r,n,o),b=e[c++]^Vt(s,o,i,r,n);return{s0:f,s1:h,s2:p,s3:b}}function Cg(e,n){if(!n)return new Uint8Array(e);if(St(n),n.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${n.length}`);return n}function aE(e){if(St(e),e.length%nr!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${nr}`)}function uE(e,n,r){let i=e.length;const o=i%nr;if(!n&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=we(e);if(n){let c=nr-o;c||(c=nr),i=i+c}const a=Cg(i,r),u=we(a);return{b:s,o:u,out:a}}function cE(e,n){if(!n)return e;const r=e.length;if(!r)throw new Error("aes/pcks5: empty ciphertext not allowed");const i=e[r-1];if(i<=0||i>16)throw new Error(`aes/pcks5: wrong padding byte: ${i}`);const o=e.subarray(0,-i);for(let s=0;s<i;s++)if(e[r-s-1]!==i)throw new Error("aes/pcks5: wrong padding");return o}function lE(e){const n=new Uint8Array(16),r=we(n);n.set(e);const i=nr-e.length;for(let o=nr-i;o<nr;o++)n[o]=i;return r}const Rg=Zv({blockSize:16,nonceLength:16},function(e,n,r={}){St(e),St(n,16);const i=!r.disablePadding;return{encrypt:(o,s)=>{const a=_g(e),{b:u,o:c,out:l}=uE(o,i,s),f=we(n);let h=f[0],p=f[1],b=f[2],y=f[3],d=0;for(;d+4<=u.length;)h^=u[d+0],p^=u[d+1],b^=u[d+2],y^=u[d+3],{s0:h,s1:p,s2:b,s3:y}=ad(a,h,p,b,y),c[d++]=h,c[d++]=p,c[d++]=b,c[d++]=y;if(i){const g=lE(o.subarray(d*4));h^=g[0],p^=g[1],b^=g[2],y^=g[3],{s0:h,s1:p,s2:b,s3:y}=ad(a,h,p,b,y),c[d++]=h,c[d++]=p,c[d++]=b,c[d++]=y}return a.fill(0),l},decrypt:(o,s)=>{aE(o);const a=oE(e),u=we(n),c=Cg(o.length,s),l=we(o),f=we(c);let h=u[0],p=u[1],b=u[2],y=u[3];for(let d=0;d+4<=l.length;){const g=h,m=p,x=b,S=y;h=l[d+0],p=l[d+1],b=l[d+2],y=l[d+3];const{s0:O,s1:B,s2:E,s3:L}=sE(a,h,p,b,y);f[d++]=O^g,f[d++]=B^m,f[d++]=E^x,f[d++]=L^S}return a.fill(0),cE(c,i)}}}),Te=(e,n)=>e[n++]&255|(e[n++]&255)<<8;let fE=class{constructor(n){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,n=ar(n),St(n,32);const r=Te(n,0),i=Te(n,2),o=Te(n,4),s=Te(n,6),a=Te(n,8),u=Te(n,10),c=Te(n,12),l=Te(n,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|a<<12)&255,this.r[5]=a>>>1&8190,this.r[6]=(a>>>14|u<<2)&8191,this.r[7]=(u>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let f=0;f<8;f++)this.pad[f]=Te(n,16+2*f)}process(n,r,i=!1){const o=i?0:2048,{h:s,r:a}=this,u=a[0],c=a[1],l=a[2],f=a[3],h=a[4],p=a[5],b=a[6],y=a[7],d=a[8],g=a[9],m=Te(n,r+0),x=Te(n,r+2),S=Te(n,r+4),O=Te(n,r+6),B=Te(n,r+8),E=Te(n,r+10),L=Te(n,r+12),I=Te(n,r+14);let R=s[0]+(m&8191),U=s[1]+((m>>>13|x<<3)&8191),k=s[2]+((x>>>10|S<<6)&8191),P=s[3]+((S>>>7|O<<9)&8191),T=s[4]+((O>>>4|B<<12)&8191),H=s[5]+(B>>>1&8191),w=s[6]+((B>>>14|E<<2)&8191),v=s[7]+((E>>>11|L<<5)&8191),$=s[8]+((L>>>8|I<<8)&8191),_=s[9]+(I>>>5|o),A=0,C=A+R*u+U*(5*g)+k*(5*d)+P*(5*y)+T*(5*b);A=C>>>13,C&=8191,C+=H*(5*p)+w*(5*h)+v*(5*f)+$*(5*l)+_*(5*c),A+=C>>>13,C&=8191;let N=A+R*c+U*u+k*(5*g)+P*(5*d)+T*(5*y);A=N>>>13,N&=8191,N+=H*(5*b)+w*(5*p)+v*(5*h)+$*(5*f)+_*(5*l),A+=N>>>13,N&=8191;let j=A+R*l+U*c+k*u+P*(5*g)+T*(5*d);A=j>>>13,j&=8191,j+=H*(5*y)+w*(5*b)+v*(5*p)+$*(5*h)+_*(5*f),A+=j>>>13,j&=8191;let F=A+R*f+U*l+k*c+P*u+T*(5*g);A=F>>>13,F&=8191,F+=H*(5*d)+w*(5*y)+v*(5*b)+$*(5*p)+_*(5*h),A+=F>>>13,F&=8191;let q=A+R*h+U*f+k*l+P*c+T*u;A=q>>>13,q&=8191,q+=H*(5*g)+w*(5*d)+v*(5*y)+$*(5*b)+_*(5*p),A+=q>>>13,q&=8191;let K=A+R*p+U*h+k*f+P*l+T*c;A=K>>>13,K&=8191,K+=H*u+w*(5*g)+v*(5*d)+$*(5*y)+_*(5*b),A+=K>>>13,K&=8191;let G=A+R*b+U*p+k*h+P*f+T*l;A=G>>>13,G&=8191,G+=H*c+w*u+v*(5*g)+$*(5*d)+_*(5*y),A+=G>>>13,G&=8191;let D=A+R*y+U*b+k*p+P*h+T*f;A=D>>>13,D&=8191,D+=H*l+w*c+v*u+$*(5*g)+_*(5*d),A+=D>>>13,D&=8191;let Z=A+R*d+U*y+k*b+P*p+T*h;A=Z>>>13,Z&=8191,Z+=H*f+w*l+v*c+$*u+_*(5*g),A+=Z>>>13,Z&=8191;let V=A+R*g+U*d+k*y+P*b+T*p;A=V>>>13,V&=8191,V+=H*h+w*f+v*l+$*c+_*u,A+=V>>>13,V&=8191,A=(A<<2)+A|0,A=A+C|0,C=A&8191,A=A>>>13,N+=A,s[0]=C,s[1]=N,s[2]=j,s[3]=F,s[4]=q,s[5]=K,s[6]=G,s[7]=D,s[8]=Z,s[9]=V}finalize(){const{h:n,pad:r}=this,i=new Uint16Array(10);let o=n[1]>>>13;n[1]&=8191;for(let u=2;u<10;u++)n[u]+=o,o=n[u]>>>13,n[u]&=8191;n[0]+=o*5,o=n[0]>>>13,n[0]&=8191,n[1]+=o,o=n[1]>>>13,n[1]&=8191,n[2]+=o,i[0]=n[0]+5,o=i[0]>>>13,i[0]&=8191;for(let u=1;u<10;u++)i[u]=n[u]+o,o=i[u]>>>13,i[u]&=8191;i[9]-=8192;let s=(o^1)-1;for(let u=0;u<10;u++)i[u]&=s;s=~s;for(let u=0;u<10;u++)n[u]=n[u]&s|i[u];n[0]=(n[0]|n[1]<<13)&65535,n[1]=(n[1]>>>3|n[2]<<10)&65535,n[2]=(n[2]>>>6|n[3]<<7)&65535,n[3]=(n[3]>>>9|n[4]<<4)&65535,n[4]=(n[4]>>>12|n[5]<<1|n[6]<<14)&65535,n[5]=(n[6]>>>2|n[7]<<11)&65535,n[6]=(n[7]>>>5|n[8]<<8)&65535,n[7]=(n[8]>>>8|n[9]<<5)&65535;let a=n[0]+r[0];n[0]=a&65535;for(let u=1;u<8;u++)a=(n[u]+r[u]|0)+(a>>>16)|0,n[u]=a&65535}update(n){Bi(this);const{buffer:r,blockLen:i}=this;n=ar(n);const o=n.length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a===i){for(;i<=o-s;s+=i)this.process(n,s);continue}r.set(n.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(n){Bi(this),Ul(n,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:o}=this;if(o){for(r[o++]=1;o<16;o++)r[o]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let a=0;a<8;a++)n[s++]=i[a]>>>0,n[s++]=i[a]>>>8;return n}digest(){const{buffer:n,outputLen:r}=this;this.digestInto(n);const i=n.slice(0,r);return this.destroy(),i}};function hE(e){const n=(i,o)=>e(o).update(ar(i)).digest(),r=e(new Uint8Array(32));return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=i=>e(i),n}hE(e=>new fE(e));const dE=_l("expand 16-byte k"),pE=_l("expand 32-byte k"),gE=we(dE),yE=we(pE);function Y(e,n){return e<<n|e>>>32-n}function Ac(e){return e.byteOffset%4===0}const Fo=64,wE=16,Tg=2**32-1,ud=new Uint32Array;function mE(e,n,r,i,o,s,a,u){const c=o.length,l=new Uint8Array(Fo),f=we(l),h=Ac(o)&&Ac(s),p=h?we(o):ud,b=h?we(s):ud;for(let y=0;y<c;a++){if(e(n,r,i,f,a,u),a>=Tg)throw new Error("arx: counter overflow");const d=Math.min(Fo,c-y);if(h&&d===Fo){const g=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let m=0,x;m<wE;m++)x=g+m,b[x]=p[x]^f[m];y+=Fo;continue}for(let g=0,m;g<d;g++)m=y+g,s[m]=o[m]^l[g];y+=d}}function bE(e,n){const{allowShortKeys:r,extendNonceFn:i,counterLength:o,counterRight:s,rounds:a}=Wv({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},n);if(typeof e!="function")throw new Error("core must be a function");return vu(o),vu(a),sd(s),sd(r),(u,c,l,f,h=0)=>{St(u),St(c),St(l);const p=l.length;if(f||(f=new Uint8Array(p)),St(f),vu(h),h<0||h>=Tg)throw new Error("arx: counter overflow");if(f.length<p)throw new Error(`arx: output (${f.length}) is shorter than data (${p})`);const b=[];let y=u.length,d,g;if(y===32)d=u.slice(),b.push(d),g=yE;else if(y===16&&r)d=new Uint8Array(32),d.set(u),d.set(u,16),g=gE,b.push(d);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);Ac(c)||(c=c.slice(),b.push(c));const m=we(d);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(g,m,we(c.subarray(0,16)),m),c=c.subarray(16)}const x=16-o;if(x!==c.length)throw new Error(`arx: nonce must be ${x} or 16 bytes`);if(x!==12){const O=new Uint8Array(12);O.set(c,s?0:12-c.length),c=O,b.push(c)}const S=we(c);for(mE(e,g,m,S,l,f,h,a);b.length>0;)b.pop().fill(0);return f}}function vE(e,n,r,i,o,s=20){let a=e[0],u=e[1],c=e[2],l=e[3],f=n[0],h=n[1],p=n[2],b=n[3],y=n[4],d=n[5],g=n[6],m=n[7],x=o,S=r[0],O=r[1],B=r[2],E=a,L=u,I=c,R=l,U=f,k=h,P=p,T=b,H=y,w=d,v=g,$=m,_=x,A=S,C=O,N=B;for(let F=0;F<s;F+=2)E=E+U|0,_=Y(_^E,16),H=H+_|0,U=Y(U^H,12),E=E+U|0,_=Y(_^E,8),H=H+_|0,U=Y(U^H,7),L=L+k|0,A=Y(A^L,16),w=w+A|0,k=Y(k^w,12),L=L+k|0,A=Y(A^L,8),w=w+A|0,k=Y(k^w,7),I=I+P|0,C=Y(C^I,16),v=v+C|0,P=Y(P^v,12),I=I+P|0,C=Y(C^I,8),v=v+C|0,P=Y(P^v,7),R=R+T|0,N=Y(N^R,16),$=$+N|0,T=Y(T^$,12),R=R+T|0,N=Y(N^R,8),$=$+N|0,T=Y(T^$,7),E=E+k|0,N=Y(N^E,16),v=v+N|0,k=Y(k^v,12),E=E+k|0,N=Y(N^E,8),v=v+N|0,k=Y(k^v,7),L=L+P|0,_=Y(_^L,16),$=$+_|0,P=Y(P^$,12),L=L+P|0,_=Y(_^L,8),$=$+_|0,P=Y(P^$,7),I=I+T|0,A=Y(A^I,16),H=H+A|0,T=Y(T^H,12),I=I+T|0,A=Y(A^I,8),H=H+A|0,T=Y(T^H,7),R=R+U|0,C=Y(C^R,16),w=w+C|0,U=Y(U^w,12),R=R+U|0,C=Y(C^R,8),w=w+C|0,U=Y(U^w,7);let j=0;i[j++]=a+E|0,i[j++]=u+L|0,i[j++]=c+I|0,i[j++]=l+R|0,i[j++]=f+U|0,i[j++]=h+k|0,i[j++]=p+P|0,i[j++]=b+T|0,i[j++]=y+H|0,i[j++]=d+w|0,i[j++]=g+v|0,i[j++]=m+$|0,i[j++]=x+_|0,i[j++]=S+A|0,i[j++]=O+C|0,i[j++]=B+N|0}const Pg=bE(vE,{counterRight:!1,counterLength:4,allowShortKeys:!1});let Ng=class extends bg{constructor(n,r){super(),this.finished=!1,this.destroyed=!1,Dt.hash(n);const i=po(r);if(this.iHash=n.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?n.create().update(i).digest():i);for(let a=0;a<s.length;a++)s[a]^=54;this.iHash.update(s),this.oHash=n.create();for(let a=0;a<s.length;a++)s[a]^=106;this.oHash.update(s),s.fill(0)}update(n){return Dt.exists(this),this.iHash.update(n),this}digestInto(n){Dt.exists(this),Dt.bytes(n,this.outputLen),this.finished=!0,this.iHash.digestInto(n),this.oHash.update(n),this.oHash.digestInto(n),this.destroy()}digest(){const n=new Uint8Array(this.oHash.outputLen);return this.digestInto(n),n}_cloneInto(n){n||(n=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:o,destroyed:s,blockLen:a,outputLen:u}=this;return n=n,n.finished=o,n.destroyed=s,n.blockLen=a,n.outputLen=u,n.oHash=r._cloneInto(n.oHash),n.iHash=i._cloneInto(n.iHash),n}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const aa=(e,n,r)=>new Ng(e,n).update(r).digest();aa.create=(e,n)=>new Ng(e,n);function EE(e,n,r){return Dt.hash(e),r===void 0&&(r=new Uint8Array(e.outputLen)),aa(e,po(r),po(n))}const xu=new Uint8Array([0]),cd=new Uint8Array;function xE(e,n,r,i=32){if(Dt.hash(e),Dt.number(i),i>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(i/e.outputLen);r===void 0&&(r=cd);const s=new Uint8Array(o*e.outputLen),a=aa.create(e,n),u=a._cloneInto(),c=new Uint8Array(a.outputLen);for(let l=0;l<o;l++)xu[0]=l+1,u.update(l===0?cd:c).update(r).update(xu).digestInto(c),s.set(c,e.outputLen*l),a._cloneInto(u);return a.destroy(),u.destroy(),c.fill(0),xu.fill(0),s.slice(0,i)}var LE=Object.defineProperty,ve=(e,n)=>{for(var r in n)LE(e,r,{get:n[r],enumerable:!0})},Lr=Symbol("verified"),AE=e=>e instanceof Object;function Hg(e){if(!AE(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let n=0;n<e.tags.length;n++){let r=e.tags[n];if(!Array.isArray(r))return!1;for(let i=0;i<r.length;i++)if(typeof r[i]=="object")return!1}return!0}var SE={};ve(SE,{Queue:()=>kE,QueueNode:()=>jg,binarySearch:()=>Pl,insertEventIntoAscendingList:()=>BE,insertEventIntoDescendingList:()=>IE,normalizeURL:()=>$E,utf8Decoder:()=>gn,utf8Encoder:()=>Xt});var gn=new TextDecoder("utf-8"),Xt=new TextEncoder;function $E(e){e.indexOf("://")===-1&&(e="wss://"+e);let n=new URL(e);return n.pathname=n.pathname.replace(/\/+/g,"/"),n.pathname.endsWith("/")&&(n.pathname=n.pathname.slice(0,-1)),(n.port==="80"&&n.protocol==="ws:"||n.port==="443"&&n.protocol==="wss:")&&(n.port=""),n.searchParams.sort(),n.hash="",n.toString()}function IE(e,n){const[r,i]=Pl(e,o=>n.id===o.id?0:n.created_at===o.created_at?-1:o.created_at-n.created_at);return i||e.splice(r,0,n),e}function BE(e,n){const[r,i]=Pl(e,o=>n.id===o.id?0:n.created_at===o.created_at?-1:n.created_at-o.created_at);return i||e.splice(r,0,n),e}function Pl(e,n){let r=0,i=e.length-1;for(;r<=i;){const o=Math.floor((r+i)/2),s=n(e[o]);if(s===0)return[o,!0];s<0?i=o-1:r=o+1}return[r,!1]}var jg=class{constructor(e){io(this,"value"),io(this,"next",null),io(this,"prev",null),this.value=e}},kE=class{constructor(){io(this,"first"),io(this,"last"),this.first=null,this.last=null}enqueue(n){const r=new jg(n);return this.last?this.last===this.first?(this.last=r,this.last.prev=this.first,this.first.next=r):(r.prev=this.last,this.last.next=r,this.last=r):(this.first=r,this.last=r),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const r=this.first;return this.first=null,this.last=null,r.value}const n=this.first;return this.first=n.next,n.value}},OE=class{generateSecretKey(){return Ht.utils.randomPrivateKey()}getPublicKey(n){return Ie(Ht.getPublicKey(n))}finalizeEvent(n,r){const i=n;return i.pubkey=Ie(Ht.getPublicKey(r)),i.id=hi(i),i.sig=Ie(Ht.sign(hi(i),r)),i[Lr]=!0,i}verifyEvent(n){if(typeof n[Lr]=="boolean")return n[Lr];const r=hi(n);if(r!==n.id)return n[Lr]=!1,!1;try{const i=Ht.verify(n.sig,r,n.pubkey);return n[Lr]=i,i}catch{return n[Lr]=!1,!1}}};function UE(e){if(!Hg(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function hi(e){let n=fi(Xt.encode(UE(e)));return Ie(n)}var ua=new OE;ua.generateSecretKey;ua.getPublicKey;var yr=ua.finalizeEvent,Nl=ua.verifyEvent,_E={};ve(_E,{Application:()=>_3,BadgeAward:()=>ME,BadgeDefinition:()=>S3,BlockedRelaysList:()=>l3,BookmarkList:()=>a3,Bookmarksets:()=>x3,Calendar:()=>j3,CalendarEventRSVP:()=>F3,ChannelCreation:()=>Kg,ChannelHideMessage:()=>Wg,ChannelMessage:()=>Vg,ChannelMetadata:()=>Dg,ChannelMuteUser:()=>Gg,ClassifiedListing:()=>T3,ClientAuth:()=>Zg,CommunitiesList:()=>u3,CommunityDefinition:()=>q3,CommunityPostApproval:()=>JE,Contacts:()=>NE,CreateOrUpdateProduct:()=>B3,CreateOrUpdateStall:()=>I3,Curationsets:()=>L3,Date:()=>N3,DraftClassifiedListing:()=>P3,DraftLong:()=>O3,Emojisets:()=>U3,EncryptedDirectMessage:()=>HE,EncryptedDirectMessages:()=>jE,EventDeletion:()=>FE,FileMetadata:()=>KE,FileServerPreference:()=>p3,Followsets:()=>b3,GenericRepost:()=>zE,Genericlists:()=>v3,HTTPAuth:()=>Fl,Handlerinformation:()=>z3,Handlerrecommendation:()=>M3,Highlights:()=>r3,InterestsList:()=>h3,Interestsets:()=>$3,JobFeedback:()=>QE,JobRequest:()=>YE,JobResult:()=>XE,Label:()=>ZE,LightningPubRPC:()=>y3,LiveChatMessage:()=>DE,LiveEvent:()=>C3,LongFormArticle:()=>k3,Metadata:()=>RE,Mutelist:()=>i3,NWCWalletInfo:()=>g3,NWCWalletRequest:()=>Jg,NWCWalletResponse:()=>w3,NostrConnect:()=>m3,OpenTimestamps:()=>qE,Pinlist:()=>o3,ProblemTracker:()=>VE,ProfileBadges:()=>A3,PublicChatsList:()=>c3,Reaction:()=>jl,RecommendRelay:()=>PE,RelayList:()=>s3,Relaysets:()=>E3,Report:()=>WE,Reporting:()=>GE,Repost:()=>Hl,SearchRelaysList:()=>f3,ShortTextNote:()=>TE,Time:()=>H3,UserEmojiList:()=>d3,UserStatuses:()=>R3,Zap:()=>n3,ZapGoal:()=>e3,ZapRequest:()=>t3,classifyKind:()=>CE,isEphemeralKind:()=>zg,isParameterizedReplaceableKind:()=>qg,isRegularKind:()=>Fg,isReplaceableKind:()=>Mg});function Fg(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function Mg(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function zg(e){return 2e4<=e&&e<3e4}function qg(e){return 3e4<=e&&e<4e4}function CE(e){return Fg(e)?"regular":Mg(e)?"replaceable":zg(e)?"ephemeral":qg(e)?"parameterized":"unknown"}var RE=0,TE=1,PE=2,NE=3,HE=4,jE=4,FE=5,Hl=6,jl=7,ME=8,zE=16,Kg=40,Dg=41,Vg=42,Wg=43,Gg=44,qE=1040,KE=1063,DE=1311,VE=1971,WE=1984,GE=1984,ZE=1985,JE=4550,YE=5999,XE=6999,QE=7e3,e3=9041,t3=9734,n3=9735,r3=9802,i3=1e4,o3=10001,s3=10002,a3=10003,u3=10004,c3=10005,l3=10006,f3=10007,h3=10015,d3=10030,p3=10096,g3=13194,y3=21e3,Zg=22242,Jg=23194,w3=23195,m3=24133,Fl=27235,b3=3e4,v3=30001,E3=30002,x3=30003,L3=30004,A3=30008,S3=30009,$3=30015,I3=30017,B3=30018,k3=30023,O3=30024,U3=30030,_3=30078,C3=30311,R3=30315,T3=30402,P3=30403,N3=31922,H3=31923,j3=31924,F3=31925,M3=31989,z3=31990,q3=34550,K3={};ve(K3,{getHex64:()=>Ml,getInt:()=>Yg,getSubscriptionId:()=>D3,matchEventId:()=>V3,matchEventKind:()=>G3,matchEventPubkey:()=>W3});function Ml(e,n){let r=n.length+3,i=e.indexOf(`"${n}":`)+r,o=e.slice(i).indexOf('"')+i+1;return e.slice(o,o+64)}function Yg(e,n){let r=n.length,i=e.indexOf(`"${n}":`)+r+3,o=e.slice(i),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function D3(e){let n=e.slice(0,22).indexOf('"EVENT"');if(n===-1)return null;let r=e.slice(n+7+1).indexOf('"');if(r===-1)return null;let i=n+7+1+r,o=e.slice(i+1,80).indexOf('"');if(o===-1)return null;let s=i+1+o;return e.slice(i+1,s)}function V3(e,n){return n===Ml(e,"id")}function W3(e,n){return n===Ml(e,"pubkey")}function G3(e,n){return n===Yg(e,"kind")}var Z3={};ve(Z3,{makeAuthEvent:()=>J3});function J3(e,n){return{kind:Zg,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",n]],content:""}}var Y3;try{Y3=WebSocket}catch{}var ct={};ve(ct,{BECH32_REGEX:()=>Xg,Bech32MaxSize:()=>zl,decode:()=>ca,encodeBytes:()=>la,naddrEncode:()=>i8,neventEncode:()=>r8,noteEncode:()=>t8,nprofileEncode:()=>n8,npubEncode:()=>e8,nrelayEncode:()=>o8,nsecEncode:()=>Q3});var zl=5e3,Xg=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function X3(e){const n=new Uint8Array(4);return n[0]=e>>24&255,n[1]=e>>16&255,n[2]=e>>8&255,n[3]=e&255,n}function ca(e){var n,r,i,o,s,a,u,c;let{prefix:l,words:f}=Ii.decode(e,zl),h=new Uint8Array(Ii.fromWords(f));switch(l){case"nprofile":{let p=Mo(h);if(!((n=p[0])!=null&&n[0]))throw new Error("missing TLV 0 for nprofile");if(p[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Ie(p[0][0]),relays:p[1]?p[1].map(b=>gn.decode(b)):[]}}}case"nevent":{let p=Mo(h);if(!((r=p[0])!=null&&r[0]))throw new Error("missing TLV 0 for nevent");if(p[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(p[2]&&p[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(p[3]&&p[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Ie(p[0][0]),relays:p[1]?p[1].map(b=>gn.decode(b)):[],author:(i=p[2])!=null&&i[0]?Ie(p[2][0]):void 0,kind:(o=p[3])!=null&&o[0]?parseInt(Ie(p[3][0]),16):void 0}}}case"naddr":{let p=Mo(h);if(!((s=p[0])!=null&&s[0]))throw new Error("missing TLV 0 for naddr");if(!((a=p[2])!=null&&a[0]))throw new Error("missing TLV 2 for naddr");if(p[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((u=p[3])!=null&&u[0]))throw new Error("missing TLV 3 for naddr");if(p[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:gn.decode(p[0][0]),pubkey:Ie(p[2][0]),kind:parseInt(Ie(p[3][0]),16),relays:p[1]?p[1].map(b=>gn.decode(b)):[]}}}case"nrelay":{let p=Mo(h);if(!((c=p[0])!=null&&c[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:gn.decode(p[0][0])}}case"nsec":return{type:l,data:h};case"npub":case"note":return{type:l,data:Ie(h)};default:throw new Error(`unknown prefix ${l}`)}}function Mo(e){let n={},r=e;for(;r.length>0;){let i=r[0],o=r[1],s=r.slice(2,2+o);if(r=r.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${i}`);n[i]=n[i]||[],n[i].push(s)}return n}function Q3(e){return la("nsec",e)}function e8(e){return la("npub",$i(e))}function t8(e){return la("note",$i(e))}function Ao(e,n){let r=Ii.toWords(n);return Ii.encode(e,r,zl)}function la(e,n){return Ao(e,n)}function n8(e){let n=fa({0:[$i(e.pubkey)],1:(e.relays||[]).map(r=>Xt.encode(r))});return Ao("nprofile",n)}function r8(e){let n;e.kind!==void 0&&(n=X3(e.kind));let r=fa({0:[$i(e.id)],1:(e.relays||[]).map(i=>Xt.encode(i)),2:e.author?[$i(e.author)]:[],3:n?[new Uint8Array(n)]:[]});return Ao("nevent",r)}function i8(e){let n=new ArrayBuffer(4);new DataView(n).setUint32(0,e.kind,!1);let r=fa({0:[Xt.encode(e.identifier)],1:(e.relays||[]).map(i=>Xt.encode(i)),2:[$i(e.pubkey)],3:[new Uint8Array(n)]});return Ao("naddr",r)}function o8(e){let n=fa({0:[Xt.encode(e)]});return Ao("nrelay",n)}function fa(e){let n=[];return Object.entries(e).reverse().forEach(([r,i])=>{i.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(r)],0),s.set([o.length],1),s.set(o,2),n.push(s)})}),$s(...n)}var s8={};ve(s8,{decrypt:()=>a8,encrypt:()=>Qg});async function Qg(e,n,r){const i=e instanceof Uint8Array?Ie(e):e,o=zi.getSharedSecret(i,"02"+n),s=ey(o);let a=Uint8Array.from(Eg(16)),u=Xt.encode(r),c=Rg(s,a).encrypt(u),l=En.encode(new Uint8Array(c)),f=En.encode(new Uint8Array(a.buffer));return`${l}?iv=${f}`}async function a8(e,n,r){const i=e instanceof Uint8Array?Ie(e):e;let[o,s]=r.split("?iv="),a=zi.getSharedSecret(i,"02"+n),u=ey(a),c=En.decode(s),l=En.decode(o),f=Rg(u,c).decrypt(l);return gn.decode(f)}function ey(e){return e.slice(1,33)}var u8={};ve(u8,{NIP05_REGEX:()=>ty,isValid:()=>f8,queryProfile:()=>ny,searchDomain:()=>l8,useFetchImplementation:()=>c8});var ty=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,ha;try{ha=fetch}catch{}function c8(e){ha=e}async function l8(e,n=""){try{const r=`https://${e}/.well-known/nostr.json?name=${n}`;return(await(await ha(r,{redirect:"error"})).json()).names}catch{return{}}}async function ny(e){var n;const r=e.match(ty);if(!r)return null;const[i,o="_",s]=r;try{const a=`https://${s}/.well-known/nostr.json?name=${o}`,u=await(await ha(a,{redirect:"error"})).json();let c=u.names[o];return c?{pubkey:c,relays:(n=u.relays)==null?void 0:n[c]}:null}catch{return null}}async function f8(e,n){let r=await ny(n);return r?r.pubkey===e:!1}var h8={};ve(h8,{parse:()=>d8});function d8(e){const n={reply:void 0,root:void 0,mentions:[],profiles:[]},r=[];for(const i of e.tags)i[0]==="e"&&i[1]&&r.push(i),i[0]==="p"&&i[1]&&n.profiles.push({pubkey:i[1],relays:i[2]?[i[2]]:[]});for(let i=0;i<r.length;i++){const o=r[i],[s,a,u,c]=o,l={id:a,relays:u?[u]:[]},f=i===0,h=i===r.length-1;if(c==="root"){n.root=l;continue}if(c==="reply"){n.reply=l;continue}if(c==="mention"){n.mentions.push(l);continue}if(f){n.root=l;continue}if(h){n.reply=l;continue}n.mentions.push(l)}return n}var p8={};ve(p8,{fetchRelayInformation:()=>y8,useFetchImplementation:()=>g8});var ry;try{ry=fetch}catch{}function g8(e){ry=e}async function y8(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var w8={};ve(w8,{getPow:()=>iy,minePow:()=>m8});function iy(e){let n=0;for(let r=0;r<e.length;r++){const i=parseInt(e[r],16);if(i===0)n+=4;else{n+=Math.clz32(i)-28;break}}return n}function m8(e,n){let r=0;const i=e,o=["nonce",r.toString(),n.toString()];for(i.tags.push(o);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==i.created_at&&(r=0,i.created_at=s),o[1]=(++r).toString(),i.id=hi(i),iy(i.id)>=n)break}return i}var b8={};ve(b8,{finishRepostEvent:()=>v8,getRepostedEvent:()=>E8,getRepostedEventPointer:()=>oy});function v8(e,n,r,i){return yr({kind:Hl,tags:[...e.tags??[],["e",n.id,r],["p",n.pubkey]],content:e.content===""?"":JSON.stringify(n),created_at:e.created_at},i)}function oy(e){if(e.kind!==Hl)return;let n,r;for(let i=e.tags.length-1;i>=0&&(n===void 0||r===void 0);i--){const o=e.tags[i];o.length>=2&&(o[0]==="e"&&n===void 0?n=o:o[0]==="p"&&r===void 0&&(r=o))}if(n!==void 0)return{id:n[1],relays:[n[2],r==null?void 0:r[2]].filter(i=>typeof i=="string"),author:r==null?void 0:r[1]}}function E8(e,{skipVerification:n}={}){const r=oy(e);if(r===void 0||e.content==="")return;let i;try{i=JSON.parse(e.content)}catch{return}if(i.id===r.id&&!(!n&&!Nl(i)))return i}var x8={};ve(x8,{NOSTR_URI_REGEX:()=>da,parse:()=>A8,test:()=>L8});var da=new RegExp(`nostr:(${Xg.source})`);function L8(e){return typeof e=="string"&&new RegExp(`^${da.source}$`).test(e)}function A8(e){const n=e.match(new RegExp(`^${da.source}$`));if(!n)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:n[0],value:n[1],decoded:ca(n[1])}}var S8={};ve(S8,{finishReactionEvent:()=>$8,getReactedEventPointer:()=>I8});function $8(e,n,r){const i=n.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return yr({...e,kind:jl,tags:[...e.tags??[],...i,["e",n.id],["p",n.pubkey]],content:e.content??"+"},r)}function I8(e){if(e.kind!==jl)return;let n,r;for(let i=e.tags.length-1;i>=0&&(n===void 0||r===void 0);i--){const o=e.tags[i];o.length>=2&&(o[0]==="e"&&n===void 0?n=o:o[0]==="p"&&r===void 0&&(r=o))}if(!(n===void 0||r===void 0))return{id:n[1],relays:[n[2],r[2]].filter(i=>i!==void 0),author:r[1]}}var B8={};ve(B8,{matchAll:()=>k8,regex:()=>ql,replaceAll:()=>O8});var ql=()=>new RegExp(`\\b${da.source}\\b`,"g");function*k8(e){const n=e.matchAll(ql());for(const r of n)try{const[i,o]=r;yield{uri:i,value:o,decoded:ca(o),start:r.index,end:r.index+i.length}}catch{}}function O8(e,n){return e.replaceAll(ql(),(r,i)=>n({uri:r,value:i,decoded:ca(i)}))}var U8={};ve(U8,{channelCreateEvent:()=>_8,channelHideMessageEvent:()=>T8,channelMessageEvent:()=>R8,channelMetadataEvent:()=>C8,channelMuteUserEvent:()=>P8});var _8=(e,n)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return yr({kind:Kg,tags:[...e.tags??[]],content:r,created_at:e.created_at},n)},C8=(e,n)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return yr({kind:Dg,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:r,created_at:e.created_at},n)},R8=(e,n)=>{const r=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&r.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),yr({kind:Vg,tags:[...r,...e.tags??[]],content:e.content,created_at:e.created_at},n)},T8=(e,n)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return yr({kind:Wg,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:r,created_at:e.created_at},n)},P8=(e,n)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return yr({kind:Gg,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:r,created_at:e.created_at},n)},N8={};ve(N8,{EMOJI_SHORTCODE_REGEX:()=>sy,matchAll:()=>H8,regex:()=>Kl,replaceAll:()=>j8});var sy=/:(\w+):/,Kl=()=>new RegExp(`\\B${sy.source}\\B`,"g");function*H8(e){const n=e.matchAll(Kl());for(const r of n)try{const[i,o]=r;yield{shortcode:i,name:o,start:r.index,end:r.index+i.length}}catch{}}function j8(e,n){return e.replaceAll(Kl(),(r,i)=>n({shortcode:r,name:i}))}var F8={};ve(F8,{useFetchImplementation:()=>M8,validateGithub:()=>z8});var Dl;try{Dl=fetch}catch{}function M8(e){Dl=e}async function z8(e,n,r){try{return await(await Dl(`https://gist.github.com/${n}/${r}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var q8={};ve(q8,{default:()=>W8,v2:()=>ay});var K8=new TextDecoder,je={minPlaintextSize:1,maxPlaintextSize:65535,utf8Encode:mg,utf8Decode(e){return K8.decode(e)},getConversationKey(e,n){const r=zi.getSharedSecret(e,"02"+n).subarray(1,33);return EE(fi,r,"nip44-v2")},getMessageKeys(e,n){const r=xE(fi,e,n,76);return{chacha_key:r.subarray(0,32),chacha_nonce:r.subarray(32,44),hmac_key:r.subarray(44,76)}},calcPaddedLen(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const n=1<<Math.floor(Math.log2(e-1))+1,r=n<=256?32:n/8;return r*(Math.floor((e-1)/r)+1)},writeU16BE(e){if(!Number.isSafeInteger(e)||e<je.minPlaintextSize||e>je.maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const n=new Uint8Array(2);return new DataView(n.buffer).setUint16(0,e,!1),n},pad(e){const n=je.utf8Encode(e),r=n.length,i=je.writeU16BE(r),o=new Uint8Array(je.calcPaddedLen(r)-r);return $s(i,n,o)},unpad(e){const n=new DataView(e.buffer).getUint16(0),r=e.subarray(2,2+n);if(n<je.minPlaintextSize||n>je.maxPlaintextSize||r.length!==n||e.length!==2+je.calcPaddedLen(n))throw new Error("invalid padding");return je.utf8Decode(r)},hmacAad(e,n,r){if(r.length!==32)throw new Error("AAD associated data must be 32 bytes");const i=$s(r,n);return aa(fi,e,i)},decodePayload(e){if(typeof e!="string")throw new Error("payload must be a valid string");const n=e.length;if(n<132||n>87472)throw new Error("invalid payload length: "+n);if(e[0]==="#")throw new Error("unknown encryption version");let r;try{r=En.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const i=r.length;if(i<99||i>65603)throw new Error("invalid data length: "+i);const o=r[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:r.subarray(1,33),ciphertext:r.subarray(33,-32),mac:r.subarray(-32)}}};function D8(e,n,r=Eg(32)){const{chacha_key:i,chacha_nonce:o,hmac_key:s}=je.getMessageKeys(n,r),a=je.pad(e),u=Pg(i,o,a),c=je.hmacAad(s,u,r);return En.encode($s(new Uint8Array([2]),r,u,c))}function V8(e,n){const{nonce:r,ciphertext:i,mac:o}=je.decodePayload(e),{chacha_key:s,chacha_nonce:a,hmac_key:u}=je.getMessageKeys(n,r),c=je.hmacAad(u,i,r);if(!Gv(c,o))throw new Error("invalid MAC");const l=Pg(s,a,i);return je.unpad(l)}var ay={utils:je,encrypt:D8,decrypt:V8},W8={v2:ay},G8={};ve(G8,{makeNwcRequestEvent:()=>J8,parseConnectionString:()=>Z8});function Z8(e){const{pathname:n,searchParams:r}=new URL(e),i=n,o=r.get("relay"),s=r.get("secret");if(!i||!o||!s)throw new Error("invalid connection string");return{pubkey:i,relay:o,secret:s}}async function J8(e,n,r){const i=await Qg(n,e,JSON.stringify({method:"pay_invoice",params:{invoice:r}})),o={kind:Jg,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e]]};return yr(o,n)}var Y8={};ve(Y8,{getZapEndpoint:()=>Q8,makeZapReceipt:()=>n4,makeZapRequest:()=>e4,useFetchImplementation:()=>X8,validateZapRequest:()=>t4});var Vl;try{Vl=fetch}catch{}function X8(e){Vl=e}async function Q8(e){try{let n="",{lud06:r,lud16:i}=JSON.parse(e.content);if(r){let{words:s}=Ii.decode(r,1e3),a=Ii.fromWords(s);n=gn.decode(a)}else if(i){let[s,a]=i.split("@");n=new URL(`/.well-known/lnurlp/${s}`,`https://${a}`).toString()}else return null;let o=await(await Vl(n)).json();if(o.allowsNostr&&o.nostrPubkey)return o.callback}catch{}return null}function e4({profile:e,event:n,amount:r,relays:i,comment:o=""}){if(!r)throw new Error("amount not given");if(!e)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e],["amount",r.toString()],["relays",...i]]};return n&&s.tags.push(["e",n]),s}function t4(e){let n;try{n=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!Hg(n))return"Zap request is not a valid Nostr event.";if(!Nl(n))return"Invalid signature on zap request.";let r=n.tags.find(([o,s])=>o==="p"&&s);if(!r)return"Zap request doesn't have a 'p' tag.";if(!r[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let i=n.tags.find(([o,s])=>o==="e"&&s);return i&&!i[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":n.tags.find(([o,s])=>o==="relays"&&s)?null:"Zap request doesn't have a 'relays' tag."}function n4({zapRequest:e,preimage:n,bolt11:r,paidAt:i}){let o=JSON.parse(e),s=o.tags.filter(([u])=>u==="e"||u==="p"||u==="a"),a={kind:9735,created_at:Math.round(i.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",r],["description",e]]};return n&&a.tags.push(["preimage",n]),a}var r4={};ve(r4,{getToken:()=>i4,hashPayload:()=>Wl,unpackEventFromToken:()=>cy,validateEvent:()=>gy,validateEventKind:()=>fy,validateEventMethodTag:()=>dy,validateEventPayloadTag:()=>py,validateEventTimestamp:()=>ly,validateEventUrlTag:()=>hy,validateToken:()=>o4});var uy="Nostr ";async function i4(e,n,r,i=!1,o){const s={kind:Fl,tags:[["u",e],["method",n]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",Wl(o)]);const a=await r(s);return(i?uy:"")+En.encode(Xt.encode(JSON.stringify(a)))}async function o4(e,n,r){const i=await cy(e).catch(o=>{throw o});return await gy(i,n,r).catch(o=>{throw o})}async function cy(e){if(!e)throw new Error("Missing token");e=e.replace(uy,"");const n=gn.decode(En.decode(e));if(!n||n.length===0||!n.startsWith("{"))throw new Error("Invalid token");return JSON.parse(n)}function ly(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function fy(e){return e.kind===Fl}function hy(e,n){const r=e.tags.find(i=>i[0]==="u");return r?r.length>0&&r[1]===n:!1}function dy(e,n){const r=e.tags.find(i=>i[0]==="method");return r?r.length>0&&r[1].toLowerCase()===n.toLowerCase():!1}function Wl(e){const n=fi(Xt.encode(JSON.stringify(e)));return Ie(n)}function py(e,n){const r=e.tags.find(o=>o[0]==="payload");if(!r)return!1;const i=Wl(n);return r.length>0&&r[1]===i}async function gy(e,n,r,i){if(!Nl(e))throw new Error("Invalid nostr event, signature invalid");if(!fy(e))throw new Error("Invalid nostr event, kind invalid");if(!ly(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!hy(e,n))throw new Error("Invalid nostr event, url tag invalid");if(!dy(e,r))throw new Error("Invalid nostr event, method tag invalid");if(i&&typeof i=="object"&&Object.keys(i).length>0&&!py(e,i))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var Yr=Symbol("verified"),s4=e=>e instanceof Object;function a4(e){if(!s4(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let n=0;n<e.tags.length;n++){let r=e.tags[n];if(!Array.isArray(r))return!1;for(let i=0;i<r.length;i++)if(typeof r[i]=="object")return!1}return!0}new TextDecoder("utf-8");var u4=new TextEncoder,c4=class{generateSecretKey(){return Ht.utils.randomPrivateKey()}getPublicKey(n){return Ie(Ht.getPublicKey(n))}finalizeEvent(n,r){const i=n;return i.pubkey=Ie(Ht.getPublicKey(r)),i.id=Lu(i),i.sig=Ie(Ht.sign(Lu(i),r)),i[Yr]=!0,i}verifyEvent(n){if(typeof n[Yr]=="boolean")return n[Yr];const r=Lu(n);if(r!==n.id)return n[Yr]=!1,!1;try{const i=Ht.verify(n.sig,r,n.pubkey);return n[Yr]=i,i}catch{return n[Yr]=!1,!1}}};function l4(e){if(!a4(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Lu(e){let n=fi(u4.encode(l4(e)));return Ie(n)}var pa=new c4,yy=pa.generateSecretKey,f4=pa.getPublicKey;pa.finalizeEvent;pa.verifyEvent;(()=>{try{if(window.WeakMap)return()=>new WeakMap}catch{}return()=>new Map})();function Gl(e){const n=h4(e,"|",15,36);if(n===-1)throw new Error("CacheString:Expecting a '|'");const[r,i]=e.slice(0,n).split(","),o=e.slice(n+1),s=parseInt(r),a=parseInt(i),u=JSON.parse(o);return{updateTime:s,duration:a,value:u}}function h4(e,n,r,i){e.length-1<i&&(i=e.length-1);for(let o=r;o<=i;o++)if(e[o]===n)return o;return-1}let d4=class{constructor(n){this.LIST_KEY=n,this.init()}init(){const n=localStorage.getItem(this.LIST_KEY);if(!n){this.keyList=new Set;return}const r=JSON.parse(n);if(!Array.isArray(r)){this.keyList=new Set;return}this.keyList=new Set(r)}add(n){this.keyList.add(n),this.updateKeyList()}delete(n){this.keyList.delete(n),this.updateKeyList()}getKeys(){return this.keyList}updateKeyList(){const n=JSON.stringify(Array.from(this.keyList));localStorage.setItem(this.LIST_KEY,n)}clear(){localStorage.removeItem(this.LIST_KEY)}};const wy=new d4("__cache_key_list_");setTimeout(()=>{p4()});function p4(){const e=window.localStorage,n=wy.getKeys();for(const r of n)try{const i=e.getItem(r);if(!i)continue;const o=Gl(i);if(!Zl(o))continue;x4(o)}catch{e.removeItem(r)}}window.clearCache=g4;function g4(){const e=window.localStorage,n=wy.getKeys();for(const r of n)try{const i=e.getItem(r);if(!i)continue;const o=Gl(i);if(!Zl(o))continue;e.removeItem(r)}catch{}}window.clearCacheAll=y4;function y4(){const e=window.localStorage,n=e.length;for(let r=0;r<n;r++){const i=e.key(r);if(!i)continue;const o=e.getItem(i);if(o)try{const s=Gl(o);if(!Zl(s))continue;e.removeItem(i)}catch{continue}}}var di=typeof Reflect=="object"?Reflect:null,ld=di&&typeof di.apply=="function"?di.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},Xo;di&&typeof di.ownKeys=="function"?Xo=di.ownKeys:Object.getOwnPropertySymbols?Xo=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Xo=function(e){return Object.getOwnPropertyNames(e)};function w4(e){console&&console.warn&&console.warn(e)}var my=Number.isNaN||function(e){return e!==e};function te(){te.init.call(this)}te.EventEmitter=te;te.prototype._events=void 0;te.prototype._eventsCount=0;te.prototype._maxListeners=void 0;var fd=10;function ga(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(te,"defaultMaxListeners",{enumerable:!0,get:function(){return fd},set:function(e){if(typeof e!="number"||e<0||my(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");fd=e}});te.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};te.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||my(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function by(e){return e._maxListeners===void 0?te.defaultMaxListeners:e._maxListeners}te.prototype.getMaxListeners=function(){return by(this)};te.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")ld(u,this,n);else for(var c=u.length,l=Ay(u,c),r=0;r<c;++r)ld(l[r],this,n);return!0};function vy(e,n,r,i){var o,s,a;if(ga(r),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",n,r.listener?r.listener:r),s=e._events),a=s[n]),a===void 0)a=s[n]=r,++e._eventsCount;else if(typeof a=="function"?a=s[n]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),o=by(e),o>0&&a.length>o&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=n,u.count=a.length,w4(u)}return e}te.prototype.addListener=function(e,n){return vy(this,e,n,!1)};te.prototype.on=te.prototype.addListener;te.prototype.prependListener=function(e,n){return vy(this,e,n,!0)};function m4(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ey(e,n,r){var i={fired:!1,wrapFn:void 0,target:e,type:n,listener:r},o=m4.bind(i);return o.listener=r,i.wrapFn=o,o}te.prototype.once=function(e,n){return ga(n),this.on(e,Ey(this,e,n)),this};te.prototype.prependOnceListener=function(e,n){return ga(n),this.prependListener(e,Ey(this,e,n)),this};te.prototype.removeListener=function(e,n){var r,i,o,s,a;if(ga(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){a=r[s].listener,o=s;break}if(o<0)return this;o===0?r.shift():b4(r,o),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};te.prototype.off=te.prototype.removeListener;te.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function xy(e,n,r){var i=e._events;if(i===void 0)return[];var o=i[n];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?v4(o):Ay(o,o.length)}te.prototype.listeners=function(e){return xy(this,e,!0)};te.prototype.rawListeners=function(e){return xy(this,e,!1)};te.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):Ly.call(e,n)};te.prototype.listenerCount=Ly;function Ly(e){var n=this._events;if(n!==void 0){var r=n[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}te.prototype.eventNames=function(){return this._eventsCount>0?Xo(this._events):[]};function Ay(e,n){for(var r=new Array(n),i=0;i<n;++i)r[i]=e[i];return r}function b4(e,n){for(;n+1<e.length;n++)e[n]=e[n+1];e.pop()}function v4(e){for(var n=new Array(e.length),r=0;r<n.length;++r)n[r]=e[r].listener||e[r];return n}const E4=new te;E4.setMaxListeners(1e3);const Au=Symbol("noCache");function x4(e){if(!e)throw Au;const n=Date.now(),r=e.updateTime,i=e.duration;try{if(!(n-r<i))throw Au}catch{throw Au}}function Zl(e){return!(!e||typeof e!="object"||typeof e.updateTime!="number"||typeof e.duration!="number")}function Sy(e){const n=new Set;for(const r of e)r[0]==="r"&&n.add(r[1]);return n.delete(""),n}function D_(e,n){let r=new Set(n);return e.filter(i=>r.has(i[0]))}function V_(e){for(const n of e)if(n[0]==="e"&&n[3]==="root")return n}function L4(e,n){for(const r of n)if(r[0]===e)return r;return null}function W_(e){return Object.entries(e).map(([n,{read:r,write:i}])=>{let o=["r",n];if(r){if(i)return o;o.push("read")}else o.push("write");return o})}function G_(e){const n=new Set,r=new Set,i={};if(e)for(const o of e)o[0]==="r"&&(o[2]==="read"?(n.add(o[1]),i[o[1]]={read:!0,write:!1}):o[2]==="write"?(r.add(o[1]),i[o[1]]={read:!1,write:!0}):(n.add(o[1]),r.add(o[1]),i[o[1]]={read:!0,write:!0}));return{read:n,write:r,config:i}}function Z_(e){const{read:n,write:r}=A4(e),i={read:n,write:r,config:{}};for(const o of n)(i.config[o]??(i.config[o]={read:!1,write:!1})).read=!0;for(const o of r)(i.config[o]??(i.config[o]={read:!1,write:!1})).write=!0;return{relayConfiguration:i,readUrl:n,writeUrl:r}}function A4(e){const n=new Set,r=new Set,i=new Set;if(e)for(const o of e)o[0]==="r"&&(i.add(o[1]),o[2]==="read"?n.add(o[1]):(o[2]==="write"||n.add(o[1]),r.add(o[1])));return{read:n,write:r,urls:i}}function J_(e){try{const n=ct.decode(e);switch(n.type){case"nprofile":return n.data;case"npub":return{pubkey:n.data};default:return null}}catch{try{return ct.npubEncode(e),{pubkey:e}}catch{return null}}}function S4(e){try{const o=ct.decode(e);if(o.type==="naddr")return o.data}catch{}const[n,r,i]=e.split(":");if(n&&r&&i)try{return{kind:parseInt(n),identifier:i,pubkey:r}}catch{}return null}function $4(e){if(!e)return null;if(I4(e))return Bs.fromHex(e);try{const n=ct.decode(e);return n.type==="nsec"?Bs.fromHex(n.data):null}catch{return null}}function I4(e){try{const n=ct.nsecEncode(Bs.fromHex(e));return Bs.fromUint8Array(ct.decode(n).data).toHex()===e}catch{return!1}}function Y_(e){try{const n=ct.decode(e);switch(n.type){case"nevent":return n.data;case"note":return{id:n.data,relays:[]};default:return null}}catch{try{return ct.noteEncode(e),{id:e,relays:[]}}catch{return null}}}function X_(e,n){const r=Sy(e.tags);return e.tags.forEach(i=>{(i[0]==="e"||i[0]==="p")&&i[2]&&r.add(i[2])}),ct.neventEncode({id:e.id,relays:[...r,...n??[]]})}function Q_(){return dl(yy())}function B4(e){return new Iy(Xp.getPublicKey(e))}let $y=class Sc extends Uint8Array{constructor(n){super(typeof n=="string"?ws(n):n),this._hex=null}static fromHex(n){return new Sc(ws(n))}static fromUint8Array(n){return new Sc(n)}toHex(){return this._hex||(this._hex=dl(this))}toString(){return this.toHex()}},Bs=class Qo extends $y{constructor(){super(...arguments),this._pubkey=null}static create(){return new Qo(yy())}static fromHex(n){return new Qo(ws(n))}static fromString(n){return $4(n)}static fromUint8Array(n){return new Qo(n)}getPubkey(){return this._pubkey||(this._pubkey=Iy.fromHex(f4(this)))}getNsec(){return ct.nsecEncode(this)}},Iy=class es extends $y{constructor(){super(...arguments),this.relays=[]}static fromPrikey(n){return n.getPubkey()}static fromHex(n){return new es(ws(n))}static fromUint8Array(n){return new es(n)}static fromMaybeHex(n){return typeof n=="string"?es.fromHex(n):n}getNpub(){return ct.npubEncode(this.toHex())}toNpub(){return this.getNpub()}toNprofile(n){ct.nprofileEncode({pubkey:this.toHex(),relays:n&&this.relays})}};function k4(e,n){return Xp.sign(hi(e),n)}function eC(e,n){const r=e;return r.pubkey=B4(n).toString(),r.id=hi(r),r.sig=dl(k4(r,n)),r[Lr]=!0,r}function tC(e){console.log("e.content",e),console.log("e.content",e.content);try{return JSON.parse(e.content)}catch{return{}}}function nC(e){const n=L4("d",e.tags);if(!(n&&n[1]))return;const r=Sy(e.tags);return ct.naddrEncode({identifier:n[1],pubkey:e.pubkey,kind:e.kind,relays:[...r]})}const O4={type:"emoji",handle(e){return{type:"emoji",shortcode:e[1],imageUrl:e[2]}},toTagArray(e){return[e.type,e.shortcode,e.imageUrl]},isEq(e,n){return["type","shortcode","imageUrl"].every(r=>e[r]===n[r])}},U4={type:"relay",handle(e){return{type:"relay",relay:e[1]}},toTagArray(e){return[e.type,e.relay]},isEq(e,n){return e.type===n.type&&e.relay===n.relay}},_4={type:"a",handle(e){const n=S4(e[1]);return{type:"a",relayUrl:e[2],identifier:(n==null?void 0:n.identifier)??"",pubkey:(n==null?void 0:n.pubkey)??"",kind:(n==null?void 0:n.kind)??0}},toTagArray(e){let n=[e.type,`${e.kind}:${e.pubkey}:${e.identifier}`];return e.relayUrl&&n.push(e.relayUrl),n},isEq(e,n){return["type","kind","pubkey","identifier"].every(r=>e[r]===n[r])}},C4={type:"r",handle(e){return{type:"r",urls:e[1],petname:e[2]}},toTagArray(e){let n=[e.type,e.urls];return e.petname&&n.push(e.petname),n},isEq(e,n){return e.type===n.type&&e.urls===n.urls}},R4={type:"word",handle(e){return{type:"word",value:e[1]}},toTagArray(e){return[e.type,e.value]},isEq(e,n){return e.type===n.type&&e.value===n.value}},T4={type:"t",handle(e){return{type:"t",name:e[1]}},toTagArray(e){return[e.type,e.name]},isEq(e,n){return e.type===n.type&&e.name===n.name}},P4={type:"p",handle(e){return{type:"p",pubkey:e[1],relay:e[2]}},toTagArray(e){let n=[e.type,e.pubkey];return e.relay&&n.push(e.relay),n},isEq(e,n){return e.type===n.type&&e.pubkey===n.pubkey}},N4={type:"e",handle(e){return{type:"e",id:e[1],relay:e[2]}},toTagArray(e){return[e.type,e.id,...e.relay?[e.relay]:[]]},isEq(e,n){return e.type===n.type&&e.id===n.id}},H4={type:"i",handle(e){return{type:"i",value:e[1]}},toTagArray(e){return[e.type,e.value]},isEq(e,n){return e.type===n.type&&e.value===n.value}},j4={type:"version",handle(e){return{type:"version",value:e[1]}},toTagArray(e){return[e.type,e.value]},isEq(e,n){return e.type===n.type&&e.value===n.value}},F4={type:"p",handle(e){return{type:"p",pubkey:e[1],relay:e[2],petname:e[3]}},toTagArray(e){let n=[e.type,e.pubkey];return e.relay&&n.push(e.relay),n},isEq(e,n){return e.pubkey===n.pubkey}},rC=Object.freeze(Object.defineProperty({__proto__:null,a:_4,e:N4,emoji:O4,follow:F4,i:H4,p:P4,r:C4,relay:U4,t:T4,version:j4,word:R4},Symbol.toStringTag,{value:"Module"}));let iC=class{constructor(n){this.handleMap={};for(const r of n)this.add(r)}add(n){return this.handleMap[n.type]=n,this}tagIsEq(n,r){if(n.type!==r.type)return!1;const i=n.type;let o=this.getHandle(i);return o?o.isEq(n,r):JSON.stringify(n)===JSON.stringify(r)}getHandle(n){return this.handleMap[n]}handleOne(n){let r=n[0];if(!r)return;let i=this.getHandle(r);if(i)return i.handle(n)}handle(n){let r=[];for(const i of n){let o=this.handleOne(i);o&&r.push(o)}return r}toTagArray(n){let r=this.getHandle(n.type);if(r)return r.toTagArray(n)}toTagArrayList(n){const r=[];for(const i of n){let o=this.toTagArray(i);o&&r.push(o)}return r}};var Su={},M4=Object.defineProperty,z4=(e,n,r)=>n in e?M4(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,oo=(e,n,r)=>(z4(e,typeof n!="symbol"?n+"":n,r),r),kt=(e=>(e.NotLogin="NotLogin",e.WindowNostr="WindowNostr",e.PrivateKey="PrivateKey",e.NostrConnect="NostrConnect",e))(kt||{});function go(){const e=localStorage.getItem("__nostr_api_mode");return e==="WindowNostr"?"WindowNostr":e==="PrivateKey"?"PrivateKey":e==="NostrConnect"?"NostrConnect":"NotLogin"}function so(e){localStorage.setItem("__nostr_api_mode",String(e))}const sC="prikey";function By(e){let n;return()=>n||(n=e())}function Ki(e){let n=e();return()=>n}let q4=class{constructor(){this.reset()}toResolve(...[e]){this.resolve(e)}toReject(e){this.reject(e)}reset(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}};function Jl(e=0){return{isRun:!1,queue:[],interval:e,run(){this.isRun=!0;const n=this.queue.pop();if(!n){this.isRun=!1;return}n.task(),setTimeout(()=>this.run(),this.interval)},unShift(n){this.insert(n,0),this._run()},insert(n,r){let i={task:n,priority:r};const o=Oy(this.queue,i,s=>s.priority);this.queue.splice(o,0,i),this._run()},clear(){this.queue=[]},_run(){this.isRun||this.run()}}}function ya(){return Math.floor(Date.now()/1e3)}function K4(e,n){if(!e)return{...n};if(!n)return e;for(const r in n)e[r]??(e[r]=n[r]);return e}function rt(e=0){return new Promise((n,r)=>{setTimeout(()=>{n()},e)})}function D4(e){return!!e&&typeof e.then=="function"}(()=>{try{if(window.WeakMap)return()=>new WeakMap}catch{}return()=>new Map})();function ky(){return(Math.random()*2**52).toString(36)}function hd(e,n=1e3,r=n*4){if(n<=0)return e;let i,o;const s=(...a)=>{clearTimeout(i),i=setTimeout(()=>{clearTimeout(o),e(...a)},n),!o&&(o=setTimeout(()=>{o=null,clearTimeout(i),e(...a)},r))};return s.clear=()=>{clearTimeout(i),i=void 0},s}function Oy(e,n,r){const i=e.length;if(i===0)return 0;const o=c=>r(e[c]),s=r(n);if(e.length===0||s<o(0))return 0;if(s>o(i-1))return i;let a=0,u=i-1;for(;a<u;){let c=Math.floor(a+(u-a)/2);if(o(c)===s)return c;o(c)>s?u=c:a=c+1}return a}function Yl(e,n,r){let i=Oy(e,n,r);e.splice(i,0,n)}function Uy(e,n,r){let i=V4(e,n,r);e.splice(i,0,n)}function V4(e,n,r){const i=e.length;if(i===0)return 0;const o=c=>r(e[c]);let s=r(n);if(s>o(0))return 0;if(s<o(i-1))return i;let a=0,u=i-1;for(;a<u;){let c=Math.floor(a+(u-a)/2),l=o(c);if(l===s)return c;s>l?u=c:a=c+1}return u}function Yn(e,...n){for(const r of n)for(const i of r??[])e.add(i);return e}function W4(e,n){for(const r of e)n.has(r)&&e.delete(r);return e}async function G4(e,n=3,r=1e3){return new Promise(async(i,o)=>{let s=n;for(;s>0;){try{i(await e());return}catch(a){if(s--,s<=0){o(a);return}}await rt(r)}})}function Z4(e){let{max:n,min:r=0}=e??{},i=new Array;return{add(o){n&&i.length>=n&&i.pop(),i.unshift(o)},getBallotBox(){return i},isValidVote(){return i.length>=r},takeCountOfVotes(){let o=new Map;return i.forEach(s=>{let a=o.get(s);if(a){o.set(s,a+1);return}o.set(s,1)}),o},rate(o,s){let a=this.takeCountOfVotes(),u=a.get(o)??0,c=a.get(s)??0;return console.log(u,c),u/c},proportion(o){return(this.takeCountOfVotes().get(o)??0)/i.length}}}function $c(e){if(typeof e=="object"){if(Array.isArray(e))return e.map(n=>$c(n));{let n=Object.fromEntries(Object.entries(e).map(([r,i])=>[r,$c(i)]));return n.__proto__=e.__proto__,n}}else return e}function J4(e){return Object.fromEntries(Object.entries(e).map(([n,r])=>[n,$c(r)]))}function _y(e){return e()}function Y4(e){return e??(n=>n)}const ks={useMemoryCache:!0,useLocalStorage:!0,requestMerge:!0,cacheError:!0};function X4(e,n=36e5){return{value:e,updateTime:Date.now(),duration:n}}function Q4(e){return`${e.updateTime},${e.duration}|${JSON.stringify(e.value)}`}function wa(e){const n=ex(e,"|",15,36);if(n===-1)throw new Error("CacheString:Expecting a '|'");const[r,i]=e.slice(0,n).split(","),o=e.slice(n+1),s=parseInt(r),a=parseInt(i),u=JSON.parse(o);return{updateTime:s,duration:a,value:u}}function ex(e,n,r,i){e.length-1<i&&(i=e.length-1);for(let o=r;o<=i;o++)if(e[o]===n)return o;return-1}let Xl=class{constructor(e){this.LIST_KEY=e,this.init()}init(){const e=localStorage.getItem(this.LIST_KEY);if(!e){this.keyList=new Set;return}const n=JSON.parse(e);if(!Array.isArray(n)){this.keyList=new Set;return}this.keyList=new Set(n)}add(e){this.keyList.add(e),this.updateKeyList()}delete(e){this.keyList.delete(e),this.updateKeyList()}getKeys(){return this.keyList}updateKeyList(){const e=JSON.stringify(Array.from(this.keyList));localStorage.setItem(this.LIST_KEY,e)}clear(){localStorage.removeItem(this.LIST_KEY)}},Ql=class{constructor(e){this.map=null,this.keyList=new Xl(e)}set(e,n){localStorage.setItem(e,JSON.stringify(n)),this.keyList.add(e),this.getMap().set(e,n)}get(e){return this.map?this.map.get(e)??null:this.localGet(e)}has(e){return!!this.get(e)}localGet(e){const n=localStorage.getItem(e);return n?JSON.parse(n):null}remote(e){var n;localStorage.removeItem(e),this.keyList.delete(e),(n=this.map)==null||n.delete(e)}getValues(){return[...this.getMap().values()]}getKeys(){return this.keyList.getKeys()}getMap(){if(this.map)return this.map;this.map=new Map;const e=this.keyList.getKeys();for(const n of e){const r=this.localGet(n);r&&this.map.set(n,r)}return this.map}clear(){for(const e of this.getKeys())this.remote(e);this.keyList.clear(),this.keyList.init()}};const So=new Xl("__cache_key_list_");setTimeout(()=>{tx()});function tx(){const e=window.localStorage,n=So.getKeys();for(const r of n)try{const i=e.getItem(r);if(!i)continue;const o=wa(i);if(!rf(o))continue;nf(o)}catch{e.removeItem(r)}}window.clearCache=nx;function nx(){const e=window.localStorage,n=So.getKeys();for(const r of n)try{const i=e.getItem(r);if(!i)continue;const o=wa(i);if(!rf(o))continue;e.removeItem(r)}catch{}}window.clearCacheAll=rx;function rx(){const e=window.localStorage,n=e.length;for(let r=0;r<n;r++){const i=e.key(r);if(!i)continue;const o=e.getItem(i);if(o)try{const s=wa(o);if(!rf(s))continue;e.removeItem(i)}catch{continue}}}var pi=typeof Reflect=="object"?Reflect:null,dd=pi&&typeof pi.apply=="function"?pi.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},ts;pi&&typeof pi.ownKeys=="function"?ts=pi.ownKeys:Object.getOwnPropertySymbols?ts=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ts=function(e){return Object.getOwnPropertyNames(e)};function ix(e){console&&console.warn&&console.warn(e)}var Cy=Number.isNaN||function(e){return e!==e};function ne(){ne.init.call(this)}ne.EventEmitter=ne;ne.prototype._events=void 0;ne.prototype._eventsCount=0;ne.prototype._maxListeners=void 0;var pd=10;function ma(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(ne,"defaultMaxListeners",{enumerable:!0,get:function(){return pd},set:function(e){if(typeof e!="number"||e<0||Cy(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");pd=e}});ne.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ne.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Cy(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Ry(e){return e._maxListeners===void 0?ne.defaultMaxListeners:e._maxListeners}ne.prototype.getMaxListeners=function(){return Ry(this)};ne.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")dd(u,this,n);else for(var c=u.length,l=jy(u,c),r=0;r<c;++r)dd(l[r],this,n);return!0};function Ty(e,n,r,i){var o,s,a;if(ma(r),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",n,r.listener?r.listener:r),s=e._events),a=s[n]),a===void 0)a=s[n]=r,++e._eventsCount;else if(typeof a=="function"?a=s[n]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),o=Ry(e),o>0&&a.length>o&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=n,u.count=a.length,ix(u)}return e}ne.prototype.addListener=function(e,n){return Ty(this,e,n,!1)};ne.prototype.on=ne.prototype.addListener;ne.prototype.prependListener=function(e,n){return Ty(this,e,n,!0)};function ox(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Py(e,n,r){var i={fired:!1,wrapFn:void 0,target:e,type:n,listener:r},o=ox.bind(i);return o.listener=r,i.wrapFn=o,o}ne.prototype.once=function(e,n){return ma(n),this.on(e,Py(this,e,n)),this};ne.prototype.prependOnceListener=function(e,n){return ma(n),this.prependListener(e,Py(this,e,n)),this};ne.prototype.removeListener=function(e,n){var r,i,o,s,a;if(ma(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){a=r[s].listener,o=s;break}if(o<0)return this;o===0?r.shift():sx(r,o),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};ne.prototype.off=ne.prototype.removeListener;ne.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function Ny(e,n,r){var i=e._events;if(i===void 0)return[];var o=i[n];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?ax(o):jy(o,o.length)}ne.prototype.listeners=function(e){return Ny(this,e,!0)};ne.prototype.rawListeners=function(e){return Ny(this,e,!1)};ne.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):Hy.call(e,n)};ne.prototype.listenerCount=Hy;function Hy(e){var n=this._events;if(n!==void 0){var r=n[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}ne.prototype.eventNames=function(){return this._eventsCount>0?ts(this._events):[]};function jy(e,n){for(var r=new Array(n),i=0;i<n;++i)r[i]=e[i];return r}function sx(e,n){for(;n+1<e.length;n++)e[n]=e[n+1];e.pop()}function ax(e){for(var n=new Array(e.length),r=0;r<n.length;++r)n[r]=e[r].listener||e[r];return n}let ef={};const ii=new ne;ii.setMaxListeners(1e3);function Fy(e,n,r=ks,...i){K4(r,ks);try{return tf(e,r)}catch{return ux(e,n,r,i)}}const ns=Symbol("noCache"),gd=Symbol("skip");function ux(e,n,r,i){const o=s=>(ki(e,s,r),s);return r.requestMerge?cx(e,n,r,i):My(e,n,r,i,s=>s.then(o,r.cacheError?o:void 0))}function cx(e,n,r,i){const o=`res:${e}`,s=`rej:${e}`,a=l=>ii.emit(o,l),u=l=>ii.emit(s,l),c=()=>new Promise((l,f)=>{ii.once(o,l),ii.once(s,f)});return ii.listenerCount(o)>0?c():My(e,n,r,i,l=>(l.then(f=>{ki(e,f,r),a(f)},f=>{r.cacheError&&ki(e,f,r),u(f)}),c()))}function My(e,n,r,i,o){const s=n(...i);return D4(s)?o(s):(ki(e,s,r),s)}function tf(e,n=ks){try{if(!n.useMemoryCache)throw gd;return fx(e)}catch{if(!n.useLocalStorage)throw gd;return hx(e)}}function lx(e,n){try{return tf(e,n)}catch{return null}}function ki(e,n,r){const i=X4(n,r==null?void 0:r.duration);r!=null&&r.useMemoryCache&&yx(e,i),r!=null&&r.useLocalStorage&&wx(e,i)}function fx(e){const n=ef[e];return nf(n),n.value}function hx(e){const n=gx(e);try{const r=wa(n);return nf(r),r.value}catch(r){throw So.delete(e),r}}function zy(e){px(e),dx(e)}function dx(e){delete ef[e]}function px(e){So.delete(e),localStorage.removeItem(e)}function gx(e){const n=localStorage.getItem(e);if(!n)throw ns;return n}function yx(e,n){ef[e]=n}function wx(e,n){So.add(e),localStorage.setItem(e,Q4(n))}function nf(e){if(!e)throw ns;const n=Date.now(),r=e.updateTime,i=e.duration;try{if(!(n-r<i))throw ns}catch{throw ns}}function rf(e){return!(!e||typeof e!="object"||typeof e.updateTime!="number"||typeof e.duration!="number")}let mx=class qy{constructor(){this.children={},this.values=[]}addValue(n){this.values.push(n)}getNodeBy(n){}getNode(n){return this.children[n]}addNode(n){return this.children[n]||(this.children[n]=new qy),this.children[n]}getValues(){return this.values}},bx=class{constructor(){this.root=new mx}setValue(e,n){let r=this.root;const i=e.split("/").filter(o=>o);console.log("keys",i);for(let o=0;o<i.length;o++)r=r.addNode(i[o]);r.addValue(n)}getValue(e){let n=this.root;const r=e.split("/").filter(i=>i);for(let i=0;i<r.length;i++){if(!n.getNode(r[i]))return[];n=n.getNode(r[i])}return n.getValues()}getChildrenPathName(e){let n=this.root;const r=e.split("/").filter(o=>o),i=[];for(let o=0;o<r.length;o++){if(!n.getNode(r[o]))return[];n=n.getNode(r[o])}for(const o in n.children)i.push(o);return i}getChildrenPath(e){const n=this.getChildrenPathName(e);return e=e.endsWith("/")?e:`${e}/`,e=e.startsWith("/")?e:`/${e}`,n.map(r=>`${e}${r}`)}getParentPath(e){const n=e.split("/").filter(r=>r);return n.length===1?null:n.slice(0,-1).join("/")}getDeepValues(e){let n=this.root;const r=e.split("/").filter(s=>s),i=[];function o(s){i.push(...s.getValues());for(const a of Object.values(s.children))o(a)}for(let s=0;s<r.length;s++){if(!n.getNode(r[s]))return[];n=n.getNode(r[s])}return o(n),i}},yd=class rs{constructor(n){this.binaryBits=16,this.uint16Array=new Uint16Array(n)}get hexBits(){return this.binaryBits/4}static fromHex(n){let r=4,i=[];for(let o=n.length-1;o>=0;o-=r){let s=o-r,a=s<0?0:s,u=n.slice(a,o+1);i[Math.floor(o/r)]=parseInt(u,16)}return new rs(i)}static fromStr(n){let r=16,i=[];for(let o=n.length-1;o>=0;o-=r){let s=o-r,a=s<0?0:s,u=n.slice(a,o+1);i[Math.floor(o/16)]=parseInt(u,2)}return new rs(i)}XOR(n){return this.uint16Array.length>n.uint16Array.length?this._XOR(n,this):this._XOR(this,n)}_XOR(n,r){let i=n.uint16Array.length,o=r.uint16Array.length,s=new Array(o);for(let a=0;a<i;a++)s[a]=n.uint16Array[a]^r.uint16Array[a];return s.push(...r.uint16Array.slice(i)),new rs(s)}toString(n=2){let r="";for(let i=this.uint16Array.length-1;i>=0;i--)r=this.uint16Array[i].toString(n).padStart(Math.log(65536)/Math.log(n),"0")+r;return r}get(n){let r=this.uint16Array.length-1-Math.floor(n/this.binaryBits),i=n%this.binaryBits;return!!(this.uint16Array[r]&1<<i)}characteristic(){if(this.uint16Array.length===1)return this.uint16Array[0];let n=this.uint16Array.length,r=0,i=0;for(let o=0;o<this.binaryBits;o++){let s=0;for(let a=0;a<n;a++)this.get(i)&&s++,i++;s/n>.5&&(r=r|1<<o)}return r}leadingZeroNumber(){let n=0;for(let r=this.uint16Array.length*16-1;r>=0;r--){if(this.get(r))return n;n++}return n}};function aC(e,n){if(n&&(e.push("nostr"),!!n.getPublicKey)){try{vx(e,n)}catch{}try{n.getPublicKey().then(r=>{e.push("getPublicKey"),Ex(n.nip04,e,r)})}catch{}if(n.getRelays)try{n.getRelays().then(()=>{e.push("getRelays")})}catch{}}}function vx(e,n){if(n.signEvent)try{n.signEvent({kind:1,tags:[],content:"test content",created_at:ya()}).then(()=>{e.push("signEvent")})}catch{}}async function Ex(e,n,r){if(e)try{if(n.push("nip04"),!e.encrypt)return;const i="test",o=await e.encrypt(r,i);if(n.push("nip04.encrypt"),!e.decrypt||await e.decrypt(r,o)!==i)return;n.push("nip04.decrypt")}catch{}}function uC(e,n){if(n&&(e.push("nostr"),!!n.getPublicKey)){try{n.getPublicKey().then(r=>{e.push("getPublicKey"),Lx(n,e,r),xx(e,n)})}catch{}if(n.getRelays)try{n.getRelays().then(()=>{e.push("getRelays")},()=>{})}catch{}}}function xx(e,n){if(n.signEvent)try{n.signEvent({kind:1,tags:[],content:"test content",created_at:ya()}).then(()=>{e.push("signEvent")})}catch{}}async function Lx(e,n,r){if(e)try{if(n.push("nip04"),!e.encrypt)return;const i="test",o=await e.encrypt(r,i);if(n.push("nip04.encrypt"),console.log("plaintext",o),!e.decrypt)return;const s=await e.decrypt(r,o);if(console.log("test",s),s!==i)return;n.push("nip04.decrypt")}catch(i){logger.error(i)}}const cC=["nostr","getPublicKey","getRelays","signEvent","nip04","nip04.encrypt","nip04.decrypt"];class Ky extends Error{constructor(n){super(`NotFoundError:Not Found ${n}`)}}class ba{constructor(n){this.nostrApiProvide=Promise.withResolvers(),this._pubkey=null,n&&this.nostrApiProvide.resolve(n()),this.getNostrApi=Ki(()=>this.nostrApiProvide.promise)}async getPublicKey(){return this._pubkey=await this.run("getPublicKey"),this._pubkey}getPubkey(){return this.getPublicKey().then(n=>{this._pubkey=n}),this._pubkey}signEvent(n){return this.run("signEvent",JSON.parse(JSON.stringify(n)))}getRelays(){return this.run("getRelays")}encrypt(n,r){return this.run("encrypt",n,r)}decrypt(n,r){return this.run("decrypt",n,r)}async run(n,...r){let i=(await this.getNostrApi())[n];if(!i)throw new Ky(n);return await i(...r)}}(()=>{try{if(window.WeakMap)return()=>new WeakMap}catch{}return()=>new Map})();function of(e){const n=Ax(e,"|",15,36);if(n===-1)throw new Error("CacheString:Expecting a '|'");const[r,i]=e.slice(0,n).split(","),o=e.slice(n+1),s=parseInt(r),a=parseInt(i),u=JSON.parse(o);return{updateTime:s,duration:a,value:u}}function Ax(e,n,r,i){e.length-1<i&&(i=e.length-1);for(let o=r;o<=i;o++)if(e[o]===n)return o;return-1}let Sx=class{constructor(e){this.LIST_KEY=e,this.init()}init(){const e=localStorage.getItem(this.LIST_KEY);if(!e){this.keyList=new Set;return}const n=JSON.parse(e);if(!Array.isArray(n)){this.keyList=new Set;return}this.keyList=new Set(n)}add(e){this.keyList.add(e),this.updateKeyList()}delete(e){this.keyList.delete(e),this.updateKeyList()}getKeys(){return this.keyList}updateKeyList(){const e=JSON.stringify(Array.from(this.keyList));localStorage.setItem(this.LIST_KEY,e)}clear(){localStorage.removeItem(this.LIST_KEY)}};const Dy=new Sx("__cache_key_list_");setTimeout(()=>{$x()});function $x(){const e=window.localStorage,n=Dy.getKeys();for(const r of n)try{const i=e.getItem(r);if(!i)continue;const o=of(i);if(!sf(o))continue;Rx(o)}catch{e.removeItem(r)}}window.clearCache=Ix;function Ix(){const e=window.localStorage,n=Dy.getKeys();for(const r of n)try{const i=e.getItem(r);if(!i)continue;const o=of(i);if(!sf(o))continue;e.removeItem(r)}catch{}}window.clearCacheAll=Bx;function Bx(){const e=window.localStorage,n=e.length;for(let r=0;r<n;r++){const i=e.key(r);if(!i)continue;const o=e.getItem(i);if(o)try{const s=of(o);if(!sf(s))continue;e.removeItem(i)}catch{continue}}}var gi=typeof Reflect=="object"?Reflect:null,wd=gi&&typeof gi.apply=="function"?gi.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},is;gi&&typeof gi.ownKeys=="function"?is=gi.ownKeys:Object.getOwnPropertySymbols?is=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:is=function(e){return Object.getOwnPropertyNames(e)};function kx(e){console&&console.warn&&console.warn(e)}var Vy=Number.isNaN||function(e){return e!==e};function re(){re.init.call(this)}re.EventEmitter=re;re.prototype._events=void 0;re.prototype._eventsCount=0;re.prototype._maxListeners=void 0;var md=10;function va(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(re,"defaultMaxListeners",{enumerable:!0,get:function(){return md},set:function(e){if(typeof e!="number"||e<0||Vy(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");md=e}});re.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};re.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Vy(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Wy(e){return e._maxListeners===void 0?re.defaultMaxListeners:e._maxListeners}re.prototype.getMaxListeners=function(){return Wy(this)};re.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")wd(u,this,n);else for(var c=u.length,l=Xy(u,c),r=0;r<c;++r)wd(l[r],this,n);return!0};function Gy(e,n,r,i){var o,s,a;if(va(r),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",n,r.listener?r.listener:r),s=e._events),a=s[n]),a===void 0)a=s[n]=r,++e._eventsCount;else if(typeof a=="function"?a=s[n]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),o=Wy(e),o>0&&a.length>o&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=n,u.count=a.length,kx(u)}return e}re.prototype.addListener=function(e,n){return Gy(this,e,n,!1)};re.prototype.on=re.prototype.addListener;re.prototype.prependListener=function(e,n){return Gy(this,e,n,!0)};function Ox(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Zy(e,n,r){var i={fired:!1,wrapFn:void 0,target:e,type:n,listener:r},o=Ox.bind(i);return o.listener=r,i.wrapFn=o,o}re.prototype.once=function(e,n){return va(n),this.on(e,Zy(this,e,n)),this};re.prototype.prependOnceListener=function(e,n){return va(n),this.prependListener(e,Zy(this,e,n)),this};re.prototype.removeListener=function(e,n){var r,i,o,s,a;if(va(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){a=r[s].listener,o=s;break}if(o<0)return this;o===0?r.shift():Ux(r,o),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};re.prototype.off=re.prototype.removeListener;re.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function Jy(e,n,r){var i=e._events;if(i===void 0)return[];var o=i[n];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?_x(o):Xy(o,o.length)}re.prototype.listeners=function(e){return Jy(this,e,!0)};re.prototype.rawListeners=function(e){return Jy(this,e,!1)};re.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):Yy.call(e,n)};re.prototype.listenerCount=Yy;function Yy(e){var n=this._events;if(n!==void 0){var r=n[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}re.prototype.eventNames=function(){return this._eventsCount>0?is(this._events):[]};function Xy(e,n){for(var r=new Array(n),i=0;i<n;++i)r[i]=e[i];return r}function Ux(e,n){for(;n+1<e.length;n++)e[n]=e[n+1];e.pop()}function _x(e){for(var n=new Array(e.length),r=0;r<n.length;++r)n[r]=e[r].listener||e[r];return n}const Cx=new re;Cx.setMaxListeners(1e3);const $u=Symbol("noCache");function Rx(e){if(!e)throw $u;const n=Date.now(),r=e.updateTime,i=e.duration;try{if(!(n-r<i))throw $u}catch{throw $u}}function sf(e){return!(!e||typeof e!="object"||typeof e.updateTime!="number"||typeof e.duration!="number")}let Qy=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/core/src/LineEmitter.ts");console.log("logger",Qy);Qy.debug("xx");let Tx=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/core/src/staff.ts");function e0(e,n,...r){const i=typeof e=="string"?{name:e}:e;return z(i.id??i.name,o=>o.assignFeat({[i.name]:new n(o.out(),...r)}))}function t0(e,n){const r=typeof e=="string"?{name:e}:e;return n.Staff=e0(r,n,...r.rest??[]),n}function z(...e){if(Tx.debug("create-staff",e),e.length===1){if(!e[0])throw new Error("staff cannot be undefined");return zo(e[0]),Xr(()=>[],void 0,e[0])}else{if(Iu(e[0]))return zo(e[1]),Xr(()=>[],e[0],e[1]);if(Array.isArray(e[0])||typeof e[0]=="function"&&!e[0].__staff__)return Iu(e[1])?(zo(e[2]),Xr(e[0],e[1],e[2])):(zo(e[1]),Xr(e[0],void 0,e[1]));if(Px(e[e.length-1]))return Iu(e[e.length-2])?Xr(e.slice(0,e.length-2),e[e.length-2],e[e.length-1]):Xr(e.slice(0,e.length-1),void 0,e[e.length-1])}throw new Error("createStaff INVALID PARAMETER")}function Iu(e){return typeof e=="string"}function Px(e){return!(!e||!(typeof e=="function"&&!e.__staff__))}function zo(e){if(e){if(!(typeof e=="function"&&!e.__staff__))throw new Error("Not is a StaffStructure")}else throw new Error("StaffStructure cannot be undefined")}function Xr(e,n,r){if(Array.isArray(e)){let i=e;e=()=>i}return Object.assign(r,{dependents:e,id:n,__staff__:!0}),r}function n0(e){return z(e,n=>{throw new Error(`Not Inject '${e}' Staff`)})}const Nx=z(({mod:e,line:n})=>e.defineEmit()),wr=z(()=>[Nx],e=>e.assignFeat({onCreateChildDep(n){n(this),this.on("create-child",(r,i)=>{i.onCreateChildDep(n)})}})),Hx=z(({mod:e,line:n})=>e.defineEmit()),r0=z(()=>[Hx],({mod:e,line:n})=>e.assignFeat({onCreate(r){r(this),this.on("create",i=>{i.onCreate(r)})}}));z(()=>[wr],({mod:e,line:n})=>e.defineEmit().defineEmit().assignOwnFeat(()=>({parseState:!0})).assignFeat({emitParse(r,i){console.log("emitParse",(r??this).mod.id),this.emit({type:"pause",noPause:!0},r??this,i)},parse(r){this.parseState=!0,this.emitParse(void 0,r)},emitContinue(r){this.emit({type:"continue",noPause:!0},r)},continue(r){this.parseState=!1,this.emitContinue(r)},async awaitToRun(){var r;if((r=this.parent)!=null&&r.awaitToRun&&await this.parent.awaitToRun(),this.parseState)return new Promise((i,o)=>{this.on("continue",()=>i(),{once:!0})})}}).inLine(r=>r.onCreateChildDep(i=>{var o;(o=i.parent)==null||o.on("pause",(...s)=>{i.emitParse(...s)})})));const yo=z(()=>[rn,wr],({mod:e,line:n})=>{let r=new WeakMap;return n.onCreateChildDep(i=>{i.onEvent((o,s)=>{let a=r.get(i);if(a){if(a.has(s.id))return!0}else a=new Set,r.set(i,a);return a.add(s.id),!1},{unShift:!0})}),e});class af extends ba{constructor(){super(),this.nostrApiProvide.resolve({})}}function bd(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function i0(e,...n){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(n.length>0&&!n.includes(e.length))throw new Error(`Expected Uint8Array of length ${n}, not of length=${e.length}`)}function jx(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");bd(e.outputLen),bd(e.blockLen)}function Os(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function Fx(e,n){i0(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const Bu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const o0=e=>e instanceof Uint8Array,ku=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Ct=(e,n)=>e<<32-n|e>>>n,Mx=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Mx)throw new Error("Non little-endian hardware is not supported");function zx(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function uf(e){if(typeof e=="string"&&(e=zx(e)),!o0(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function qx(...e){const n=new Uint8Array(e.reduce((i,o)=>i+o.length,0));let r=0;return e.forEach(i=>{if(!o0(i))throw new Error("Uint8Array expected");n.set(i,r),r+=i.length}),n}let s0=class{clone(){return this._cloneInto()}};function Kx(e){const n=i=>e().update(uf(i)).digest(),r=e();return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=()=>e(),n}function a0(e=32){if(Bu&&typeof Bu.getRandomValues=="function")return Bu.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Dx(e,n,r,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(n,r,i);const o=BigInt(32),s=BigInt(4294967295),a=Number(r>>o&s),u=Number(r&s),c=i?4:0,l=i?0:4;e.setUint32(n+c,a,i),e.setUint32(n+l,u,i)}let Vx=class extends s0{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ku(this.buffer)}update(e){Os(this);const{view:n,buffer:r,blockLen:i}=this;e=uf(e);const o=e.length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a===i){const u=ku(e);for(;i<=o-s;s+=i)this.process(u,s);continue}r.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Os(this),Fx(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:o}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(r,0),s=0);for(let f=s;f<i;f++)n[f]=0;Dx(r,i-8,BigInt(this.length*8),o),this.process(r,0);const a=ku(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,l[f],o)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%n&&e.buffer.set(r),e}};const Wx=(e,n,r)=>e&n^~e&r,Gx=(e,n,r)=>e&n^e&r^n&r,Zx=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Fn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Mn=new Uint32Array(64);let Jx=class extends Vx{constructor(){super(64,32,8,!1),this.A=Fn[0]|0,this.B=Fn[1]|0,this.C=Fn[2]|0,this.D=Fn[3]|0,this.E=Fn[4]|0,this.F=Fn[5]|0,this.G=Fn[6]|0,this.H=Fn[7]|0}get(){const{A:e,B:n,C:r,D:i,E:o,F:s,G:a,H:u}=this;return[e,n,r,i,o,s,a,u]}set(e,n,r,i,o,s,a,u){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,n){for(let f=0;f<16;f++,n+=4)Mn[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=Mn[f-15],p=Mn[f-2],b=Ct(h,7)^Ct(h,18)^h>>>3,y=Ct(p,17)^Ct(p,19)^p>>>10;Mn[f]=y+Mn[f-7]+b+Mn[f-16]|0}let{A:r,B:i,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let f=0;f<64;f++){const h=Ct(a,6)^Ct(a,11)^Ct(a,25),p=l+h+Wx(a,u,c)+Zx[f]+Mn[f]|0,b=(Ct(r,2)^Ct(r,13)^Ct(r,22))+Gx(r,i,o)|0;l=c,c=u,u=a,a=s+p|0,s=o,o=i,i=r,r=p+b|0}r=r+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(r,i,o,s,a,u,c,l)}roundClean(){Mn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Ic=Kx(()=>new Jx);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u0=BigInt(0),Ea=BigInt(1),Yx=BigInt(2),xa=e=>e instanceof Uint8Array,Xx=Array.from({length:256},(e,n)=>n.toString(16).padStart(2,"0"));function Oi(e){if(!xa(e))throw new Error("Uint8Array expected");let n="";for(let r=0;r<e.length;r++)n+=Xx[e[r]];return n}function c0(e){const n=e.toString(16);return n.length&1?`0${n}`:n}function cf(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Ui(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const n=e.length;if(n%2)throw new Error("padded hex string expected, got unpadded hex of length "+n);const r=new Uint8Array(n/2);for(let i=0;i<r.length;i++){const o=i*2,s=e.slice(o,o+2),a=Number.parseInt(s,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");r[i]=a}return r}function st(e){return cf(Oi(e))}function lf(e){if(!xa(e))throw new Error("Uint8Array expected");return cf(Oi(Uint8Array.from(e).reverse()))}function ur(e,n){return Ui(e.toString(16).padStart(n*2,"0"))}function ff(e,n){return ur(e,n).reverse()}function Qx(e){return Ui(c0(e))}function Ye(e,n,r){let i;if(typeof n=="string")try{i=Ui(n)}catch(s){throw new Error(`${e} must be valid hex string, got "${n}". Cause: ${s}`)}else if(xa(n))i=Uint8Array.from(n);else throw new Error(`${e} must be hex string or Uint8Array`);const o=i.length;if(typeof r=="number"&&o!==r)throw new Error(`${e} expected ${r} bytes, got ${o}`);return i}function Vr(...e){const n=new Uint8Array(e.reduce((i,o)=>i+o.length,0));let r=0;return e.forEach(i=>{if(!xa(i))throw new Error("Uint8Array expected");n.set(i,r),r+=i.length}),n}function e5(e,n){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}function t5(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function n5(e){let n;for(n=0;e>u0;e>>=Ea,n+=1);return n}function r5(e,n){return e>>BigInt(n)&Ea}const i5=(e,n,r)=>e|(r?Ea:u0)<<BigInt(n),hf=e=>(Yx<<BigInt(e-1))-Ea,Ou=e=>new Uint8Array(e),vd=e=>Uint8Array.from(e);function l0(e,n,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof n!="number"||n<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=Ou(e),o=Ou(e),s=0;const a=()=>{i.fill(1),o.fill(0),s=0},u=(...f)=>r(o,i,...f),c=(f=Ou())=>{o=u(vd([0]),f),i=u(),f.length!==0&&(o=u(vd([1]),f),i=u())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<n;){i=u();const p=i.slice();h.push(p),f+=i.length}return Vr(...h)};return(f,h)=>{a(),c(f);let p;for(;!(p=h(l()));)c();return a(),p}}const o5={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,n)=>n.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function $o(e,n,r={}){const i=(o,s,a)=>{const u=o5[s];if(typeof u!="function")throw new Error(`Invalid validator "${s}", expected function`);const c=e[o];if(!(a&&c===void 0)&&!u(c,e))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(const[o,s]of Object.entries(n))i(o,s,!1);for(const[o,s]of Object.entries(r))i(o,s,!0);return e}const s5=Object.freeze(Object.defineProperty({__proto__:null,bitGet:r5,bitLen:n5,bitMask:hf,bitSet:i5,bytesToHex:Oi,bytesToNumberBE:st,bytesToNumberLE:lf,concatBytes:Vr,createHmacDrbg:l0,ensureBytes:Ye,equalBytes:e5,hexToBytes:Ui,hexToNumber:cf,numberToBytesBE:ur,numberToBytesLE:ff,numberToHexUnpadded:c0,numberToVarBytesBE:Qx,utf8ToBytes:t5,validateObject:$o},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _e=BigInt(0),pe=BigInt(1),kr=BigInt(2),a5=BigInt(3),Bc=BigInt(4),Ed=BigInt(5),xd=BigInt(8);BigInt(9);BigInt(16);function Ke(e,n){const r=e%n;return r>=_e?r:n+r}function u5(e,n,r){if(r<=_e||n<_e)throw new Error("Expected power/modulo > 0");if(r===pe)return _e;let i=pe;for(;n>_e;)n&pe&&(i=i*e%r),e=e*e%r,n>>=pe;return i}function ht(e,n,r){let i=e;for(;n-- >_e;)i*=i,i%=r;return i}function kc(e,n){if(e===_e||n<=_e)throw new Error(`invert: expected positive integers, got n=${e} mod=${n}`);let r=Ke(e,n),i=n,o=_e,s=pe;for(;r!==_e;){const a=i/r,u=i%r,c=o-s*a;i=r,r=u,o=s,s=c}if(i!==pe)throw new Error("invert: does not exist");return Ke(o,n)}function c5(e){const n=(e-pe)/kr;let r,i,o;for(r=e-pe,i=0;r%kr===_e;r/=kr,i++);for(o=kr;o<e&&u5(o,n,e)!==e-pe;o++);if(i===1){const a=(e+pe)/Bc;return function(u,c){const l=u.pow(c,a);if(!u.eql(u.sqr(l),c))throw new Error("Cannot find square root");return l}}const s=(r+pe)/kr;return function(a,u){if(a.pow(u,n)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,l=a.pow(a.mul(a.ONE,o),r),f=a.pow(u,s),h=a.pow(u,r);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let p=1;for(let y=a.sqr(h);p<c&&!a.eql(y,a.ONE);p++)y=a.sqr(y);const b=a.pow(l,pe<<BigInt(c-p-1));l=a.sqr(b),f=a.mul(f,b),h=a.mul(h,l),c=p}return f}}function l5(e){if(e%Bc===a5){const n=(e+pe)/Bc;return function(r,i){const o=r.pow(i,n);if(!r.eql(r.sqr(o),i))throw new Error("Cannot find square root");return o}}if(e%xd===Ed){const n=(e-Ed)/xd;return function(r,i){const o=r.mul(i,kr),s=r.pow(o,n),a=r.mul(i,s),u=r.mul(r.mul(a,kr),s),c=r.mul(a,r.sub(u,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return c5(e)}const f5=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function h5(e){const n={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=f5.reduce((i,o)=>(i[o]="function",i),n);return $o(e,r)}function d5(e,n,r){if(r<_e)throw new Error("Expected power > 0");if(r===_e)return e.ONE;if(r===pe)return n;let i=e.ONE,o=n;for(;r>_e;)r&pe&&(i=e.mul(i,o)),o=e.sqr(o),r>>=pe;return i}function p5(e,n){const r=new Array(n.length),i=n.reduce((s,a,u)=>e.is0(a)?s:(r[u]=s,e.mul(s,a)),e.ONE),o=e.inv(i);return n.reduceRight((s,a,u)=>e.is0(a)?s:(r[u]=e.mul(s,r[u]),e.mul(s,a)),o),r}function f0(e,n){const r=n!==void 0?n:e.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function g5(e,n,r=!1,i={}){if(e<=_e)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:s}=f0(e,n);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const a=l5(e),u=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:hf(o),ZERO:_e,ONE:pe,create:c=>Ke(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return _e<=c&&c<e},is0:c=>c===_e,isOdd:c=>(c&pe)===pe,neg:c=>Ke(-c,e),eql:(c,l)=>c===l,sqr:c=>Ke(c*c,e),add:(c,l)=>Ke(c+l,e),sub:(c,l)=>Ke(c-l,e),mul:(c,l)=>Ke(c*l,e),pow:(c,l)=>d5(u,c,l),div:(c,l)=>Ke(c*kc(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>kc(c,e),sqrt:i.sqrt||(c=>a(u,c)),invertBatch:c=>p5(u,c),cmov:(c,l,f)=>f?l:c,toBytes:c=>r?ff(c,s):ur(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return r?lf(c):st(c)}});return Object.freeze(u)}function h0(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const n=e.toString(2).length;return Math.ceil(n/8)}function d0(e){const n=h0(e);return n+Math.ceil(n/2)}function y5(e,n,r=!1){const i=e.length,o=h0(n),s=d0(n);if(i<16||i<s||i>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${i}`);const a=r?st(e):lf(e),u=Ke(a,n-pe)+pe;return r?ff(u,o):ur(u,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const w5=BigInt(0),Uu=BigInt(1);function m5(e,n){const r=(o,s)=>{const a=s.negate();return o?a:s},i=o=>{const s=Math.ceil(n/o)+1,a=2**(o-1);return{windows:s,windowSize:a}};return{constTimeNegate:r,unsafeLadder(o,s){let a=e.ZERO,u=o;for(;s>w5;)s&Uu&&(a=a.add(u)),u=u.double(),s>>=Uu;return a},precomputeWindow(o,s){const{windows:a,windowSize:u}=i(s),c=[];let l=o,f=l;for(let h=0;h<a;h++){f=l,c.push(f);for(let p=1;p<u;p++)f=f.add(l),c.push(f);l=f.double()}return c},wNAF(o,s,a){const{windows:u,windowSize:c}=i(o);let l=e.ZERO,f=e.BASE;const h=BigInt(2**o-1),p=2**o,b=BigInt(o);for(let y=0;y<u;y++){const d=y*c;let g=Number(a&h);a>>=b,g>c&&(g-=p,a+=Uu);const m=d,x=d+Math.abs(g)-1,S=y%2!==0,O=g<0;g===0?f=f.add(r(S,s[m])):l=l.add(r(O,s[x]))}return{p:l,f}},wNAFCached(o,s,a,u){const c=o._WINDOW_SIZE||1;let l=s.get(o);return l||(l=this.precomputeWindow(o,c),c!==1&&s.set(o,u(l))),this.wNAF(c,l,a)}}}function p0(e){return h5(e.Fp),$o(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...f0(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function b5(e){const n=p0(e);$o(n,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:i,a:o}=n;if(r){if(!i.eql(o,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...n})}const{bytesToNumberBE:v5,hexToBytes:E5}=s5,Pr={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:n}=Pr;if(e.length<2||e[0]!==2)throw new n("Invalid signature integer tag");const r=e[1],i=e.subarray(2,r+2);if(!r||i.length!==r)throw new n("Invalid signature integer: wrong length");if(i[0]&128)throw new n("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new n("Invalid signature integer: unnecessary leading zero");return{d:v5(i),l:e.subarray(r+2)}},toSig(e){const{Err:n}=Pr,r=typeof e=="string"?E5(e):e;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let i=r.length;if(i<2||r[0]!=48)throw new n("Invalid signature tag");if(r[1]!==i-2)throw new n("Invalid signature: incorrect length");const{d:o,l:s}=Pr._parseInt(r.subarray(2)),{d:a,l:u}=Pr._parseInt(s);if(u.length)throw new n("Invalid signature: left bytes after parsing");return{r:o,s:a}},hexFromSig(e){const n=l=>Number.parseInt(l[0],16)&8?"00"+l:l,r=l=>{const f=l.toString(16);return f.length&1?`0${f}`:f},i=n(r(e.s)),o=n(r(e.r)),s=i.length/2,a=o.length/2,u=r(s),c=r(a);return`30${r(a+s+4)}02${c}${o}02${u}${i}`}},yn=BigInt(0),vt=BigInt(1);BigInt(2);const Ld=BigInt(3);BigInt(4);function x5(e){const n=b5(e),{Fp:r}=n,i=n.toBytes||((y,d,g)=>{const m=d.toAffine();return Vr(Uint8Array.from([4]),r.toBytes(m.x),r.toBytes(m.y))}),o=n.fromBytes||(y=>{const d=y.subarray(1),g=r.fromBytes(d.subarray(0,r.BYTES)),m=r.fromBytes(d.subarray(r.BYTES,2*r.BYTES));return{x:g,y:m}});function s(y){const{a:d,b:g}=n,m=r.sqr(y),x=r.mul(m,y);return r.add(r.add(x,r.mul(y,d)),g)}if(!r.eql(r.sqr(n.Gy),s(n.Gx)))throw new Error("bad generator point: equation left != right");function a(y){return typeof y=="bigint"&&yn<y&&y<n.n}function u(y){if(!a(y))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(y){const{allowedPrivateKeyLengths:d,nByteLength:g,wrapPrivateKey:m,n:x}=n;if(d&&typeof y!="bigint"){if(y instanceof Uint8Array&&(y=Oi(y)),typeof y!="string"||!d.includes(y.length))throw new Error("Invalid key");y=y.padStart(g*2,"0")}let S;try{S=typeof y=="bigint"?y:st(Ye("private key",y,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof y}`)}return m&&(S=Ke(S,x)),u(S),S}const l=new Map;function f(y){if(!(y instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(d,g,m){if(this.px=d,this.py=g,this.pz=m,d==null||!r.isValid(d))throw new Error("x required");if(g==null||!r.isValid(g))throw new Error("y required");if(m==null||!r.isValid(m))throw new Error("z required")}static fromAffine(d){const{x:g,y:m}=d||{};if(!d||!r.isValid(g)||!r.isValid(m))throw new Error("invalid affine point");if(d instanceof h)throw new Error("projective point not allowed");const x=S=>r.eql(S,r.ZERO);return x(g)&&x(m)?h.ZERO:new h(g,m,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const g=r.invertBatch(d.map(m=>m.pz));return d.map((m,x)=>m.toAffine(g[x])).map(h.fromAffine)}static fromHex(d){const g=h.fromAffine(o(Ye("pointHex",d)));return g.assertValidity(),g}static fromPrivateKey(d){return h.BASE.multiply(c(d))}_setWindowSize(d){this._WINDOW_SIZE=d,l.delete(this)}assertValidity(){if(this.is0()){if(n.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:d,y:g}=this.toAffine();if(!r.isValid(d)||!r.isValid(g))throw new Error("bad point: x or y not FE");const m=r.sqr(g),x=s(d);if(!r.eql(m,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:d}=this.toAffine();if(r.isOdd)return!r.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){f(d);const{px:g,py:m,pz:x}=this,{px:S,py:O,pz:B}=d,E=r.eql(r.mul(g,B),r.mul(S,x)),L=r.eql(r.mul(m,B),r.mul(O,x));return E&&L}negate(){return new h(this.px,r.neg(this.py),this.pz)}double(){const{a:d,b:g}=n,m=r.mul(g,Ld),{px:x,py:S,pz:O}=this;let B=r.ZERO,E=r.ZERO,L=r.ZERO,I=r.mul(x,x),R=r.mul(S,S),U=r.mul(O,O),k=r.mul(x,S);return k=r.add(k,k),L=r.mul(x,O),L=r.add(L,L),B=r.mul(d,L),E=r.mul(m,U),E=r.add(B,E),B=r.sub(R,E),E=r.add(R,E),E=r.mul(B,E),B=r.mul(k,B),L=r.mul(m,L),U=r.mul(d,U),k=r.sub(I,U),k=r.mul(d,k),k=r.add(k,L),L=r.add(I,I),I=r.add(L,I),I=r.add(I,U),I=r.mul(I,k),E=r.add(E,I),U=r.mul(S,O),U=r.add(U,U),I=r.mul(U,k),B=r.sub(B,I),L=r.mul(U,R),L=r.add(L,L),L=r.add(L,L),new h(B,E,L)}add(d){f(d);const{px:g,py:m,pz:x}=this,{px:S,py:O,pz:B}=d;let E=r.ZERO,L=r.ZERO,I=r.ZERO;const R=n.a,U=r.mul(n.b,Ld);let k=r.mul(g,S),P=r.mul(m,O),T=r.mul(x,B),H=r.add(g,m),w=r.add(S,O);H=r.mul(H,w),w=r.add(k,P),H=r.sub(H,w),w=r.add(g,x);let v=r.add(S,B);return w=r.mul(w,v),v=r.add(k,T),w=r.sub(w,v),v=r.add(m,x),E=r.add(O,B),v=r.mul(v,E),E=r.add(P,T),v=r.sub(v,E),I=r.mul(R,w),E=r.mul(U,T),I=r.add(E,I),E=r.sub(P,I),I=r.add(P,I),L=r.mul(E,I),P=r.add(k,k),P=r.add(P,k),T=r.mul(R,T),w=r.mul(U,w),P=r.add(P,T),T=r.sub(k,T),T=r.mul(R,T),w=r.add(w,T),k=r.mul(P,w),L=r.add(L,k),k=r.mul(v,w),E=r.mul(H,E),E=r.sub(E,k),k=r.mul(H,P),I=r.mul(v,I),I=r.add(I,k),new h(E,L,I)}subtract(d){return this.add(d.negate())}is0(){return this.equals(h.ZERO)}wNAF(d){return b.wNAFCached(this,l,d,g=>{const m=r.invertBatch(g.map(x=>x.pz));return g.map((x,S)=>x.toAffine(m[S])).map(h.fromAffine)})}multiplyUnsafe(d){const g=h.ZERO;if(d===yn)return g;if(u(d),d===vt)return this;const{endo:m}=n;if(!m)return b.unsafeLadder(this,d);let{k1neg:x,k1:S,k2neg:O,k2:B}=m.splitScalar(d),E=g,L=g,I=this;for(;S>yn||B>yn;)S&vt&&(E=E.add(I)),B&vt&&(L=L.add(I)),I=I.double(),S>>=vt,B>>=vt;return x&&(E=E.negate()),O&&(L=L.negate()),L=new h(r.mul(L.px,m.beta),L.py,L.pz),E.add(L)}multiply(d){u(d);let g=d,m,x;const{endo:S}=n;if(S){const{k1neg:O,k1:B,k2neg:E,k2:L}=S.splitScalar(g);let{p:I,f:R}=this.wNAF(B),{p:U,f:k}=this.wNAF(L);I=b.constTimeNegate(O,I),U=b.constTimeNegate(E,U),U=new h(r.mul(U.px,S.beta),U.py,U.pz),m=I.add(U),x=R.add(k)}else{const{p:O,f:B}=this.wNAF(g);m=O,x=B}return h.normalizeZ([m,x])[0]}multiplyAndAddUnsafe(d,g,m){const x=h.BASE,S=(B,E)=>E===yn||E===vt||!B.equals(x)?B.multiplyUnsafe(E):B.multiply(E),O=S(this,g).add(S(d,m));return O.is0()?void 0:O}toAffine(d){const{px:g,py:m,pz:x}=this,S=this.is0();d==null&&(d=S?r.ONE:r.inv(x));const O=r.mul(g,d),B=r.mul(m,d),E=r.mul(x,d);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(E,r.ONE))throw new Error("invZ was invalid");return{x:O,y:B}}isTorsionFree(){const{h:d,isTorsionFree:g}=n;if(d===vt)return!0;if(g)return g(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:g}=n;return d===vt?this:g?g(h,this):this.multiplyUnsafe(n.h)}toRawBytes(d=!0){return this.assertValidity(),i(h,this,d)}toHex(d=!0){return Oi(this.toRawBytes(d))}}h.BASE=new h(n.Gx,n.Gy,r.ONE),h.ZERO=new h(r.ZERO,r.ONE,r.ZERO);const p=n.nBitLength,b=m5(h,n.endo?Math.ceil(p/2):p);return{CURVE:n,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:a}}function L5(e){const n=p0(e);return $o(n,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...n})}function A5(e){const n=L5(e),{Fp:r,n:i}=n,o=r.BYTES+1,s=2*r.BYTES+1;function a(w){return yn<w&&w<r.ORDER}function u(w){return Ke(w,i)}function c(w){return kc(w,i)}const{ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:h,isWithinCurveOrder:p}=x5({...n,toBytes(w,v,$){const _=v.toAffine(),A=r.toBytes(_.x),C=Vr;return $?C(Uint8Array.from([v.hasEvenY()?2:3]),A):C(Uint8Array.from([4]),A,r.toBytes(_.y))},fromBytes(w){const v=w.length,$=w[0],_=w.subarray(1);if(v===o&&($===2||$===3)){const A=st(_);if(!a(A))throw new Error("Point is not on curve");const C=h(A);let N=r.sqrt(C);const j=(N&vt)===vt;return($&1)===1!==j&&(N=r.neg(N)),{x:A,y:N}}else if(v===s&&$===4){const A=r.fromBytes(_.subarray(0,r.BYTES)),C=r.fromBytes(_.subarray(r.BYTES,2*r.BYTES));return{x:A,y:C}}else throw new Error(`Point of length ${v} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),b=w=>Oi(ur(w,n.nByteLength));function y(w){const v=i>>vt;return w>v}function d(w){return y(w)?u(-w):w}const g=(w,v,$)=>st(w.slice(v,$));class m{constructor(v,$,_){this.r=v,this.s=$,this.recovery=_,this.assertValidity()}static fromCompact(v){const $=n.nByteLength;return v=Ye("compactSignature",v,$*2),new m(g(v,0,$),g(v,$,2*$))}static fromDER(v){const{r:$,s:_}=Pr.toSig(Ye("DER",v));return new m($,_)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(v){return new m(this.r,this.s,v)}recoverPublicKey(v){const{r:$,s:_,recovery:A}=this,C=L(Ye("msgHash",v));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");const N=A===2||A===3?$+n.n:$;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const j=A&1?"03":"02",F=l.fromHex(j+b(N)),q=c(N),K=u(-C*q),G=u(_*q),D=l.BASE.multiplyAndAddUnsafe(F,K,G);if(!D)throw new Error("point at infinify");return D.assertValidity(),D}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,u(-this.s),this.recovery):this}toDERRawBytes(){return Ui(this.toDERHex())}toDERHex(){return Pr.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ui(this.toCompactHex())}toCompactHex(){return b(this.r)+b(this.s)}}const x={isValidPrivateKey(w){try{return f(w),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const w=d0(n.n);return y5(n.randomBytes(w),n.n)},precompute(w=8,v=l.BASE){return v._setWindowSize(w),v.multiply(BigInt(3)),v}};function S(w,v=!0){return l.fromPrivateKey(w).toRawBytes(v)}function O(w){const v=w instanceof Uint8Array,$=typeof w=="string",_=(v||$)&&w.length;return v?_===o||_===s:$?_===2*o||_===2*s:w instanceof l}function B(w,v,$=!0){if(O(w))throw new Error("first arg must be private key");if(!O(v))throw new Error("second arg must be public key");return l.fromHex(v).multiply(f(w)).toRawBytes($)}const E=n.bits2int||function(w){const v=st(w),$=w.length*8-n.nBitLength;return $>0?v>>BigInt($):v},L=n.bits2int_modN||function(w){return u(E(w))},I=hf(n.nBitLength);function R(w){if(typeof w!="bigint")throw new Error("bigint expected");if(!(yn<=w&&w<I))throw new Error(`bigint expected < 2^${n.nBitLength}`);return ur(w,n.nByteLength)}function U(w,v,$=k){if(["recovered","canonical"].some(V=>V in $))throw new Error("sign() legacy options not supported");const{hash:_,randomBytes:A}=n;let{lowS:C,prehash:N,extraEntropy:j}=$;C==null&&(C=!0),w=Ye("msgHash",w),N&&(w=Ye("prehashed msgHash",_(w)));const F=L(w),q=f(v),K=[R(q),R(F)];if(j!=null){const V=j===!0?A(r.BYTES):j;K.push(Ye("extraEntropy",V))}const G=Vr(...K),D=F;function Z(V){const ee=E(V);if(!p(ee))return;const ue=c(ee),W=l.BASE.multiply(ee).toAffine(),J=u(W.x);if(J===yn)return;const ce=u(ue*u(D+J*q));if(ce===yn)return;let tt=(W.x===J?0:2)|Number(W.y&vt),nt=ce;return C&&y(ce)&&(nt=d(ce),tt^=1),new m(J,nt,tt)}return{seed:G,k2sig:Z}}const k={lowS:n.lowS,prehash:!1},P={lowS:n.lowS,prehash:!1};function T(w,v,$=k){const{seed:_,k2sig:A}=U(w,v,$),C=n;return l0(C.hash.outputLen,C.nByteLength,C.hmac)(_,A)}l.BASE._setWindowSize(8);function H(w,v,$,_=P){var A;const C=w;if(v=Ye("msgHash",v),$=Ye("publicKey",$),"strict"in _)throw new Error("options.strict was renamed to lowS");const{lowS:N,prehash:j}=_;let F,q;try{if(typeof C=="string"||C instanceof Uint8Array)try{F=m.fromDER(C)}catch(W){if(!(W instanceof Pr.Err))throw W;F=m.fromCompact(C)}else if(typeof C=="object"&&typeof C.r=="bigint"&&typeof C.s=="bigint"){const{r:W,s:J}=C;F=new m(W,J)}else throw new Error("PARSE");q=l.fromHex($)}catch(W){if(W.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(N&&F.hasHighS())return!1;j&&(v=n.hash(v));const{r:K,s:G}=F,D=L(v),Z=c(G),V=u(D*Z),ee=u(K*Z),ue=(A=l.BASE.multiplyAndAddUnsafe(q,V,ee))==null?void 0:A.toAffine();return ue?u(ue.x)===K:!1}return{CURVE:n,getPublicKey:S,getSharedSecret:B,sign:T,verify:H,ProjectivePoint:l,Signature:m,utils:x}}let g0=class extends s0{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,jx(e);const r=uf(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,o=new Uint8Array(i);o.set(r.length>i?e.create().update(r).digest():r);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=e.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),o.fill(0)}update(e){return Os(this),this.iHash.update(e),this}digestInto(e){Os(this),i0(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:o,blockLen:s,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=o,e.blockLen=s,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const y0=(e,n,r)=>new g0(e,n).update(r).digest();y0.create=(e,n)=>new g0(e,n);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function S5(e){return{hash:e,hmac:(n,...r)=>y0(e,n,qx(...r)),randomBytes:a0}}function $5(e,n){const r=i=>A5({...e,...S5(i)});return Object.freeze({...r(n),create:r})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const La=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Us=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),w0=BigInt(1),_s=BigInt(2),Ad=(e,n)=>(e+n/_s)/n;function m0(e){const n=La,r=BigInt(3),i=BigInt(6),o=BigInt(11),s=BigInt(22),a=BigInt(23),u=BigInt(44),c=BigInt(88),l=e*e*e%n,f=l*l*e%n,h=ht(f,r,n)*f%n,p=ht(h,r,n)*f%n,b=ht(p,_s,n)*l%n,y=ht(b,o,n)*b%n,d=ht(y,s,n)*y%n,g=ht(d,u,n)*d%n,m=ht(g,c,n)*g%n,x=ht(m,u,n)*d%n,S=ht(x,r,n)*f%n,O=ht(S,a,n)*y%n,B=ht(O,i,n)*l%n,E=ht(B,_s,n);if(!Oc.eql(Oc.sqr(E),e))throw new Error("Cannot find square root");return E}const Oc=g5(La,void 0,void 0,{sqrt:m0}),Di=$5({a:BigInt(0),b:BigInt(7),Fp:Oc,n:Us,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const n=Us,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-w0*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,a=BigInt("0x100000000000000000000000000000000"),u=Ad(s*e,n),c=Ad(-i*e,n);let l=Ke(e-u*r-c*o,n),f=Ke(-u*i-c*s,n);const h=l>a,p=f>a;if(h&&(l=n-l),p&&(f=n-f),l>a||f>a)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:p,k2:f}}}},Ic),Aa=BigInt(0),b0=e=>typeof e=="bigint"&&Aa<e&&e<La,I5=e=>typeof e=="bigint"&&Aa<e&&e<Us,Sd={};function Cs(e,...n){let r=Sd[e];if(r===void 0){const i=Ic(Uint8Array.from(e,o=>o.charCodeAt(0)));r=Vr(i,i),Sd[e]=r}return Ic(Vr(r,...n))}const df=e=>e.toRawBytes(!0).slice(1),Uc=e=>ur(e,32),_u=e=>Ke(e,La),wo=e=>Ke(e,Us),pf=Di.ProjectivePoint,B5=(e,n,r)=>pf.BASE.multiplyAndAddUnsafe(e,n,r);function _c(e){let n=Di.utils.normPrivateKeyToScalar(e),r=pf.fromPrivateKey(n);return{scalar:r.hasEvenY()?n:wo(-n),bytes:df(r)}}function v0(e){if(!b0(e))throw new Error("bad x: need 0 < x < p");const n=_u(e*e),r=_u(n*e+BigInt(7));let i=m0(r);i%_s!==Aa&&(i=_u(-i));const o=new pf(e,i,w0);return o.assertValidity(),o}function E0(...e){return wo(st(Cs("BIP0340/challenge",...e)))}function k5(e){return _c(e).bytes}function O5(e,n,r=a0(32)){const i=Ye("message",e),{bytes:o,scalar:s}=_c(n),a=Ye("auxRand",r,32),u=Uc(s^st(Cs("BIP0340/aux",a))),c=Cs("BIP0340/nonce",u,o,i),l=wo(st(c));if(l===Aa)throw new Error("sign failed: k is zero");const{bytes:f,scalar:h}=_c(l),p=E0(f,o,i),b=new Uint8Array(64);if(b.set(f,0),b.set(Uc(wo(h+p*s)),32),!x0(b,i,o))throw new Error("sign: Invalid signature produced");return b}function x0(e,n,r){const i=Ye("signature",e,64),o=Ye("message",n),s=Ye("publicKey",r,32);try{const a=v0(st(s)),u=st(i.subarray(0,32));if(!b0(u))return!1;const c=st(i.subarray(32,64));if(!I5(c))return!1;const l=E0(Uc(u),df(a),o),f=B5(a,c,wo(-l));return!(!f||!f.hasEvenY()||f.toAffine().x!==u)}catch{return!1}}const Ft={getPublicKey:k5,sign:O5,verify:x0,utils:{randomPrivateKey:Di.utils.randomPrivateKey,lift_x:v0,pointToBytes:df,numberToBytesBE:ur,bytesToNumberBE:st,taggedHash:Cs,mod:Ke}},Cu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const gf=e=>e instanceof Uint8Array,Ru=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Rt=(e,n)=>e<<32-n|e>>>n,U5=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!U5)throw new Error("Non little-endian hardware is not supported");const _5=Array.from({length:256},(e,n)=>n.toString(16).padStart(2,"0"));function Be(e){if(!gf(e))throw new Error("Uint8Array expected");let n="";for(let r=0;r<e.length;r++)n+=_5[e[r]];return n}function _i(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const n=e.length;if(n%2)throw new Error("padded hex string expected, got unpadded hex of length "+n);const r=new Uint8Array(n/2);for(let i=0;i<r.length;i++){const o=i*2,s=e.slice(o,o+2),a=Number.parseInt(s,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");r[i]=a}return r}function L0(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function mo(e){if(typeof e=="string"&&(e=L0(e)),!gf(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Rs(...e){const n=new Uint8Array(e.reduce((i,o)=>i+o.length,0));let r=0;return e.forEach(i=>{if(!gf(i))throw new Error("Uint8Array expected");n.set(i,r),r+=i.length}),n}class A0{clone(){return this._cloneInto()}}function S0(e){const n=i=>e().update(mo(i)).digest(),r=e();return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=()=>e(),n}function $0(e=32){if(Cu&&typeof Cu.getRandomValues=="function")return Cu.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Cc(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function C5(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function I0(e,...n){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(n.length>0&&!n.includes(e.length))throw new Error(`Expected Uint8Array of length ${n}, not of length=${e.length}`)}function R5(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Cc(e.outputLen),Cc(e.blockLen)}function T5(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function P5(e,n){I0(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const Wt={number:Cc,bool:C5,bytes:I0,hash:R5,exists:T5,output:P5};function N5(e,n,r,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(n,r,i);const o=BigInt(32),s=BigInt(4294967295),a=Number(r>>o&s),u=Number(r&s),c=i?4:0,l=i?0:4;e.setUint32(n+c,a,i),e.setUint32(n+l,u,i)}class H5 extends A0{constructor(n,r,i,o){super(),this.blockLen=n,this.outputLen=r,this.padOffset=i,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(n),this.view=Ru(this.buffer)}update(n){Wt.exists(this);const{view:r,buffer:i,blockLen:o}=this;n=mo(n);const s=n.length;for(let a=0;a<s;){const u=Math.min(o-this.pos,s-a);if(u===o){const c=Ru(n);for(;o<=s-a;a+=o)this.process(c,a);continue}i.set(n.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=n.length,this.roundClean(),this}digestInto(n){Wt.exists(this),Wt.output(n,this),this.finished=!0;const{buffer:r,view:i,blockLen:o,isLE:s}=this;let{pos:a}=this;r[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(i,0),a=0);for(let h=a;h<o;h++)r[h]=0;N5(i,o-8,BigInt(this.length*8),s),this.process(i,0);const u=Ru(n),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)u.setUint32(4*h,f[h],s)}digest(){const{buffer:n,outputLen:r}=this;this.digestInto(n);const i=n.slice(0,r);return this.destroy(),i}_cloneInto(n){n||(n=new this.constructor),n.set(...this.get());const{blockLen:r,buffer:i,length:o,finished:s,destroyed:a,pos:u}=this;return n.length=o,n.pos=u,n.finished=s,n.destroyed=a,o%r&&n.buffer.set(i),n}}const j5=(e,n,r)=>e&n^~e&r,F5=(e,n,r)=>e&n^e&r^n&r,M5=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),zn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),qn=new Uint32Array(64);class B0 extends H5{constructor(){super(64,32,8,!1),this.A=zn[0]|0,this.B=zn[1]|0,this.C=zn[2]|0,this.D=zn[3]|0,this.E=zn[4]|0,this.F=zn[5]|0,this.G=zn[6]|0,this.H=zn[7]|0}get(){const{A:n,B:r,C:i,D:o,E:s,F:a,G:u,H:c}=this;return[n,r,i,o,s,a,u,c]}set(n,r,i,o,s,a,u,c){this.A=n|0,this.B=r|0,this.C=i|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=u|0,this.H=c|0}process(n,r){for(let h=0;h<16;h++,r+=4)qn[h]=n.getUint32(r,!1);for(let h=16;h<64;h++){const p=qn[h-15],b=qn[h-2],y=Rt(p,7)^Rt(p,18)^p>>>3,d=Rt(b,17)^Rt(b,19)^b>>>10;qn[h]=d+qn[h-7]+y+qn[h-16]|0}let{A:i,B:o,C:s,D:a,E:u,F:c,G:l,H:f}=this;for(let h=0;h<64;h++){const p=Rt(u,6)^Rt(u,11)^Rt(u,25),b=f+p+j5(u,c,l)+M5[h]+qn[h]|0,y=(Rt(i,2)^Rt(i,13)^Rt(i,22))+F5(i,o,s)|0;f=l,l=c,c=u,u=a+b|0,a=s,s=o,o=i,i=b+y|0}i=i+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,u=u+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(i,o,s,a,u,c,l,f)}roundClean(){qn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class z5 extends B0{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const yi=S0(()=>new B0);S0(()=>new z5);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Vi(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function In(...e){const n=(o,s)=>a=>o(s(a)),r=Array.from(e).reverse().reduce((o,s)=>o?n(o,s.encode):s.encode,void 0),i=e.reduce((o,s)=>o?n(o,s.decode):s.decode,void 0);return{encode:r,decode:i}}function Bn(e){return{encode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return n.map(r=>{if(Vi(r),r<0||r>=e.length)throw new Error(`Digit index outside alphabet: ${r} (alphabet: ${e.length})`);return e[r]})},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("alphabet.decode input should be array of strings");return n.map(r=>{if(typeof r!="string")throw new Error(`alphabet.decode: not string element=${r}`);const i=e.indexOf(r);if(i===-1)throw new Error(`Unknown letter: "${r}". Allowed: ${e}`);return i})}}}function kn(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("join.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`join.encode: non-string input=${r}`);return n.join(e)},decode:n=>{if(typeof n!="string")throw new Error("join.decode input should be string");return n.split(e)}}}function Sa(e,n="="){if(Vi(e),typeof n!="string")throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of r)if(typeof i!="string")throw new Error(`padding.encode: non-string input=${i}`);for(;r.length*e%8;)r.push(n);return r},decode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of r)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let i=r.length;if(i*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;i>0&&r[i-1]===n;i--)if(!((i-1)*e%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,i)}}}function k0(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:n=>n,decode:n=>e(n)}}function $d(e,n,r){if(n<2)throw new Error(`convertRadix: wrong from=${n}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let i=0;const o=[],s=Array.from(e);for(s.forEach(a=>{if(Vi(a),a<0||a>=n)throw new Error(`Wrong integer: ${a}`)});;){let a=0,u=!0;for(let c=i;c<s.length;c++){const l=s[c],f=n*a+l;if(!Number.isSafeInteger(f)||n*a/n!==a||f-l!==n*a)throw new Error("convertRadix: carry overflow");if(a=f%r,s[c]=Math.floor(f/r),!Number.isSafeInteger(s[c])||s[c]*r+a!==f)throw new Error("convertRadix: carry overflow");if(u)s[c]?u=!1:i=c;else continue}if(o.push(a),u)break}for(let a=0;a<e.length-1&&e[a]===0;a++)o.push(0);return o.reverse()}const O0=(e,n)=>n?O0(n,e%n):e,Ts=(e,n)=>e+(n-O0(e,n));function Rc(e,n,r,i){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(n<=0||n>32)throw new Error(`convertRadix2: wrong from=${n}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Ts(n,r)>32)throw new Error(`convertRadix2: carry overflow from=${n} to=${r} carryBits=${Ts(n,r)}`);let o=0,s=0;const a=2**r-1,u=[];for(const c of e){if(Vi(c),c>=2**n)throw new Error(`convertRadix2: invalid data word=${c} from=${n}`);if(o=o<<n|c,s+n>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${n}`);for(s+=n;s>=r;s-=r)u.push((o>>s-r&a)>>>0);o&=2**s-1}if(o=o<<r-s&a,!i&&s>=n)throw new Error("Excess padding");if(!i&&o)throw new Error(`Non-zero padding: ${o}`);return i&&s>0&&u.push(o>>>0),u}function q5(e){return Vi(e),{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return $d(Array.from(n),2**8,e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from($d(n,e,2**8))}}}function mr(e,n=!1){if(Vi(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Ts(8,e)>32||Ts(e,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Rc(Array.from(r),8,e,!n)},decode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Rc(r,e,8,n))}}}function Id(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...n){try{return e.apply(null,n)}catch{}}}const K5=In(mr(4),Bn("0123456789ABCDEF"),kn("")),D5=In(mr(5),Bn("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Sa(5),kn(""));In(mr(5),Bn("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Sa(5),kn(""));In(mr(5),Bn("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),kn(""),k0(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const xn=In(mr(6),Bn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Sa(6),kn("")),V5=In(mr(6),Bn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Sa(6),kn("")),yf=e=>In(q5(58),Bn(e),kn("")),Tc=yf("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");yf("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");yf("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Bd=[0,2,3,5,6,7,9,10,11],W5={encode(e){let n="";for(let r=0;r<e.length;r+=8){const i=e.subarray(r,r+8);n+=Tc.encode(i).padStart(Bd[i.length],"1")}return n},decode(e){let n=[];for(let r=0;r<e.length;r+=11){const i=e.slice(r,r+11),o=Bd.indexOf(i.length),s=Tc.decode(i);for(let a=0;a<s.length-o;a++)if(s[a]!==0)throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(n)}},Pc=In(Bn("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),kn("")),kd=[996825010,642813549,513874426,1027748829,705979059];function Qi(e){const n=e>>25;let r=(e&33554431)<<5;for(let i=0;i<kd.length;i++)(n>>i&1)===1&&(r^=kd[i]);return r}function Od(e,n,r=1){const i=e.length;let o=1;for(let s=0;s<i;s++){const a=e.charCodeAt(s);if(a<33||a>126)throw new Error(`Invalid prefix (${e})`);o=Qi(o)^a>>5}o=Qi(o);for(let s=0;s<i;s++)o=Qi(o)^e.charCodeAt(s)&31;for(let s of n)o=Qi(o)^s;for(let s=0;s<6;s++)o=Qi(o);return o^=r,Pc.encode(Rc([o%2**30],30,5,!1))}function U0(e){const n=e==="bech32"?1:734539939,r=mr(5),i=r.decode,o=r.encode,s=Id(i);function a(f,h,p=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(h)||h.length&&typeof h[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof h}`);const b=f.length+7+h.length;if(p!==!1&&b>p)throw new TypeError(`Length ${b} exceeds limit ${p}`);return f=f.toLowerCase(),`${f}1${Pc.encode(h)}${Od(f,h,n)}`}function u(f,h=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||h!==!1&&f.length>h)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${h})`);const p=f.toLowerCase();if(f!==p&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=p;const b=f.lastIndexOf("1");if(b===0||b===-1)throw new Error('Letter "1" must be present between prefix and data only');const y=f.slice(0,b),d=f.slice(b+1);if(d.length<6)throw new Error("Data must be at least 6 characters long");const g=Pc.decode(d).slice(0,-6),m=Od(y,g,n);if(!d.endsWith(m))throw new Error(`Invalid checksum in ${f}: expected "${m}"`);return{prefix:y,words:g}}const c=Id(u);function l(f){const{prefix:h,words:p}=u(f,!1);return{prefix:h,words:p,bytes:i(p)}}return{encode:a,decode:u,decodeToBytes:l,decodeUnsafe:c,fromWords:i,fromWordsUnsafe:s,toWords:o}}const Ci=U0("bech32");U0("bech32m");const G5={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},Z5=In(mr(4),Bn("0123456789abcdef"),kn(""),k0(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),J5={utf8:G5,hex:Z5,base16:K5,base32:D5,base64:xn,base64url:V5,base58:Tc,base58xmr:W5};`${Object.keys(J5).join(", ")}`;function Tu(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Ud(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function _0(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function $t(e,...n){if(!_0(e))throw new Error("Uint8Array expected");if(n.length>0&&!n.includes(e.length))throw new Error(`Uint8Array expected of length ${n}, not of length=${e.length}`)}function Ri(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function wf(e,n){$t(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const me=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Y5=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),X5=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!X5)throw new Error("Non little-endian hardware is not supported");function mf(e){if(typeof e!="string")throw new Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function cr(e){if(typeof e=="string")e=mf(e);else if(_0(e))e=e.slice();else throw new Error(`Uint8Array expected, got ${typeof e}`);return e}function Q5(e,n){if(n==null||typeof n!="object")throw new Error("options must be defined");return Object.assign(e,n)}function eL(e,n){if(e.length!==n.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^n[i];return r===0}const tL=(e,n)=>(Object.assign(n,e),n),fn=16,bf=new Uint8Array(16),Mt=me(bf),nL=225,rL=(e,n,r,i)=>{const o=i&1;return{s3:r<<31|i>>>1,s2:n<<31|r>>>1,s1:e<<31|n>>>1,s0:e>>>1^nL<<24&-(o&1)}},Et=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255|0;function iL(e){e.reverse();const n=e[15]&1;let r=0;for(let i=0;i<e.length;i++){const o=e[i];e[i]=o>>>1|r,r=(o&1)<<7}return e[0]^=-n&225,e}const oL=e=>e>64*1024?8:e>1024?4:2;class C0{constructor(n,r){this.blockLen=fn,this.outputLen=fn,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,n=cr(n),$t(n,16);const i=Y5(n);let o=i.getUint32(0,!1),s=i.getUint32(4,!1),a=i.getUint32(8,!1),u=i.getUint32(12,!1);const c=[];for(let b=0;b<128;b++)c.push({s0:Et(o),s1:Et(s),s2:Et(a),s3:Et(u)}),{s0:o,s1:s,s2:a,s3:u}=rL(o,s,a,u);const l=oL(r||1024);if(![1,2,4,8].includes(l))throw new Error(`ghash: wrong window size=${l}, should be 2, 4 or 8`);this.W=l;const f=128/l,h=this.windowSize=2**l,p=[];for(let b=0;b<f;b++)for(let y=0;y<h;y++){let d=0,g=0,m=0,x=0;for(let S=0;S<l;S++){if(!(y>>>l-S-1&1))continue;const{s0:O,s1:B,s2:E,s3:L}=c[l*b+S];d^=O,g^=B,m^=E,x^=L}p.push({s0:d,s1:g,s2:m,s3:x})}this.t=p}_updateBlock(n,r,i,o){n^=this.s0,r^=this.s1,i^=this.s2,o^=this.s3;const{W:s,t:a,windowSize:u}=this;let c=0,l=0,f=0,h=0;const p=(1<<s)-1;let b=0;for(const y of[n,r,i,o])for(let d=0;d<4;d++){const g=y>>>8*d&255;for(let m=8/s-1;m>=0;m--){const x=g>>>s*m&p,{s0:S,s1:O,s2:B,s3:E}=a[b*u+x];c^=S,l^=O,f^=B,h^=E,b+=1}}this.s0=c,this.s1=l,this.s2=f,this.s3=h}update(n){n=cr(n),Ri(this);const r=me(n),i=Math.floor(n.length/fn),o=n.length%fn;for(let s=0;s<i;s++)this._updateBlock(r[s*4+0],r[s*4+1],r[s*4+2],r[s*4+3]);return o&&(bf.set(n.subarray(i*fn)),this._updateBlock(Mt[0],Mt[1],Mt[2],Mt[3]),Mt.fill(0)),this}destroy(){const{t:n}=this;for(const r of n)r.s0=0,r.s1=0,r.s2=0,r.s3=0}digestInto(n){Ri(this),wf(n,this),this.finished=!0;const{s0:r,s1:i,s2:o,s3:s}=this,a=me(n);return a[0]=r,a[1]=i,a[2]=o,a[3]=s,n}digest(){const n=new Uint8Array(fn);return this.digestInto(n),this.destroy(),n}}class sL extends C0{constructor(n,r){n=cr(n);const i=iL(n.slice());super(i,r),i.fill(0)}update(n){n=cr(n),Ri(this);const r=me(n),i=n.length%fn,o=Math.floor(n.length/fn);for(let s=0;s<o;s++)this._updateBlock(Et(r[s*4+3]),Et(r[s*4+2]),Et(r[s*4+1]),Et(r[s*4+0]));return i&&(bf.set(n.subarray(o*fn)),this._updateBlock(Et(Mt[3]),Et(Mt[2]),Et(Mt[1]),Et(Mt[0])),Mt.fill(0)),this}digestInto(n){Ri(this),wf(n,this),this.finished=!0;const{s0:r,s1:i,s2:o,s3:s}=this,a=me(n);return a[0]=r,a[1]=i,a[2]=o,a[3]=s,n.reverse()}}function R0(e){const n=(i,o)=>e(o,i.length).update(cr(i)).digest(),r=e(new Uint8Array(16),0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=(i,o)=>e(i,o),n}R0((e,n)=>new C0(e,n));R0((e,n)=>new sL(e,n));const rr=16,aL=283;function vf(e){return e<<1^aL&-(e>>7)}function ui(e,n){let r=0;for(;n>0;n>>=1)r^=e&-(n&1),e=vf(e);return r}const Nc=(()=>{let e=new Uint8Array(256);for(let r=0,i=1;r<256;r++,i^=vf(i))e[r]=i;const n=new Uint8Array(256);n[0]=99;for(let r=0;r<255;r++){let i=e[255-r];i|=i<<8,n[e[r]]=(i^i>>4^i>>5^i>>6^i>>7^99)&255}return n})(),uL=Nc.map((e,n)=>Nc.indexOf(n)),cL=e=>e<<24|e>>>8,Pu=e=>e<<8|e>>>24;function T0(e,n){if(e.length!==256)throw new Error("Wrong sbox length");const r=new Uint32Array(256).map((l,f)=>n(e[f])),i=r.map(Pu),o=i.map(Pu),s=o.map(Pu),a=new Uint32Array(256*256),u=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let l=0;l<256;l++)for(let f=0;f<256;f++){const h=l*256+f;a[h]=r[l]^i[f],u[h]=o[l]^s[f],c[h]=e[l]<<8|e[f]}return{sbox:e,sbox2:c,T0:r,T1:i,T2:o,T3:s,T01:a,T23:u}}const Ef=T0(Nc,e=>ui(e,3)<<24|e<<16|e<<8|ui(e,2)),P0=T0(uL,e=>ui(e,11)<<24|ui(e,13)<<16|ui(e,9)<<8|ui(e,14)),lL=(()=>{const e=new Uint8Array(16);for(let n=0,r=1;n<16;n++,r=vf(r))e[n]=r;return e})();function N0(e){$t(e);const n=e.length;if(![16,24,32].includes(n))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${n}`);const{sbox2:r}=Ef,i=me(e),o=i.length,s=u=>Gt(r,u,u,u,u),a=new Uint32Array(n+28);a.set(i);for(let u=o;u<a.length;u++){let c=a[u-1];u%o===0?c=s(cL(c))^lL[u/o-1]:o>6&&u%o===4&&(c=s(c)),a[u]=a[u-o]^c}return a}function fL(e){const n=N0(e),r=n.slice(),i=n.length,{sbox2:o}=Ef,{T0:s,T1:a,T2:u,T3:c}=P0;for(let l=0;l<i;l+=4)for(let f=0;f<4;f++)r[l+f]=n[i-l-4+f];n.fill(0);for(let l=4;l<i-4;l++){const f=r[l],h=Gt(o,f,f,f,f);r[l]=s[h&255]^a[h>>>8&255]^u[h>>>16&255]^c[h>>>24]}return r}function er(e,n,r,i,o,s){return e[r<<8&65280|i>>>8&255]^n[o>>>8&65280|s>>>24&255]}function Gt(e,n,r,i,o){return e[n&255|r&65280]|e[i>>>16&255|o>>>16&65280]<<16}function _d(e,n,r,i,o){const{sbox2:s,T01:a,T23:u}=Ef;let c=0;n^=e[c++],r^=e[c++],i^=e[c++],o^=e[c++];const l=e.length/4-2;for(let y=0;y<l;y++){const d=e[c++]^er(a,u,n,r,i,o),g=e[c++]^er(a,u,r,i,o,n),m=e[c++]^er(a,u,i,o,n,r),x=e[c++]^er(a,u,o,n,r,i);n=d,r=g,i=m,o=x}const f=e[c++]^Gt(s,n,r,i,o),h=e[c++]^Gt(s,r,i,o,n),p=e[c++]^Gt(s,i,o,n,r),b=e[c++]^Gt(s,o,n,r,i);return{s0:f,s1:h,s2:p,s3:b}}function hL(e,n,r,i,o){const{sbox2:s,T01:a,T23:u}=P0;let c=0;n^=e[c++],r^=e[c++],i^=e[c++],o^=e[c++];const l=e.length/4-2;for(let y=0;y<l;y++){const d=e[c++]^er(a,u,n,o,i,r),g=e[c++]^er(a,u,r,n,o,i),m=e[c++]^er(a,u,i,r,n,o),x=e[c++]^er(a,u,o,i,r,n);n=d,r=g,i=m,o=x}const f=e[c++]^Gt(s,n,o,i,r),h=e[c++]^Gt(s,r,n,o,i),p=e[c++]^Gt(s,i,r,n,o),b=e[c++]^Gt(s,o,i,r,n);return{s0:f,s1:h,s2:p,s3:b}}function H0(e,n){if(!n)return new Uint8Array(e);if($t(n),n.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${n.length}`);return n}function dL(e){if($t(e),e.length%rr!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${rr}`)}function pL(e,n,r){let i=e.length;const o=i%rr;if(!n&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=me(e);if(n){let c=rr-o;c||(c=rr),i=i+c}const a=H0(i,r),u=me(a);return{b:s,o:u,out:a}}function gL(e,n){if(!n)return e;const r=e.length;if(!r)throw new Error("aes/pcks5: empty ciphertext not allowed");const i=e[r-1];if(i<=0||i>16)throw new Error(`aes/pcks5: wrong padding byte: ${i}`);const o=e.subarray(0,-i);for(let s=0;s<i;s++)if(e[r-s-1]!==i)throw new Error("aes/pcks5: wrong padding");return o}function yL(e){const n=new Uint8Array(16),r=me(n);n.set(e);const i=rr-e.length;for(let o=rr-i;o<rr;o++)n[o]=i;return r}const j0=tL({blockSize:16,nonceLength:16},function(e,n,r={}){$t(e),$t(n,16);const i=!r.disablePadding;return{encrypt:(o,s)=>{const a=N0(e),{b:u,o:c,out:l}=pL(o,i,s),f=me(n);let h=f[0],p=f[1],b=f[2],y=f[3],d=0;for(;d+4<=u.length;)h^=u[d+0],p^=u[d+1],b^=u[d+2],y^=u[d+3],{s0:h,s1:p,s2:b,s3:y}=_d(a,h,p,b,y),c[d++]=h,c[d++]=p,c[d++]=b,c[d++]=y;if(i){const g=yL(o.subarray(d*4));h^=g[0],p^=g[1],b^=g[2],y^=g[3],{s0:h,s1:p,s2:b,s3:y}=_d(a,h,p,b,y),c[d++]=h,c[d++]=p,c[d++]=b,c[d++]=y}return a.fill(0),l},decrypt:(o,s)=>{dL(o);const a=fL(e),u=me(n),c=H0(o.length,s),l=me(o),f=me(c);let h=u[0],p=u[1],b=u[2],y=u[3];for(let d=0;d+4<=l.length;){const g=h,m=p,x=b,S=y;h=l[d+0],p=l[d+1],b=l[d+2],y=l[d+3];const{s0:O,s1:B,s2:E,s3:L}=hL(a,h,p,b,y);f[d++]=O^g,f[d++]=B^m,f[d++]=E^x,f[d++]=L^S}return a.fill(0),gL(c,i)}}}),Pe=(e,n)=>e[n++]&255|(e[n++]&255)<<8;class wL{constructor(n){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,n=cr(n),$t(n,32);const r=Pe(n,0),i=Pe(n,2),o=Pe(n,4),s=Pe(n,6),a=Pe(n,8),u=Pe(n,10),c=Pe(n,12),l=Pe(n,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|a<<12)&255,this.r[5]=a>>>1&8190,this.r[6]=(a>>>14|u<<2)&8191,this.r[7]=(u>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let f=0;f<8;f++)this.pad[f]=Pe(n,16+2*f)}process(n,r,i=!1){const o=i?0:2048,{h:s,r:a}=this,u=a[0],c=a[1],l=a[2],f=a[3],h=a[4],p=a[5],b=a[6],y=a[7],d=a[8],g=a[9],m=Pe(n,r+0),x=Pe(n,r+2),S=Pe(n,r+4),O=Pe(n,r+6),B=Pe(n,r+8),E=Pe(n,r+10),L=Pe(n,r+12),I=Pe(n,r+14);let R=s[0]+(m&8191),U=s[1]+((m>>>13|x<<3)&8191),k=s[2]+((x>>>10|S<<6)&8191),P=s[3]+((S>>>7|O<<9)&8191),T=s[4]+((O>>>4|B<<12)&8191),H=s[5]+(B>>>1&8191),w=s[6]+((B>>>14|E<<2)&8191),v=s[7]+((E>>>11|L<<5)&8191),$=s[8]+((L>>>8|I<<8)&8191),_=s[9]+(I>>>5|o),A=0,C=A+R*u+U*(5*g)+k*(5*d)+P*(5*y)+T*(5*b);A=C>>>13,C&=8191,C+=H*(5*p)+w*(5*h)+v*(5*f)+$*(5*l)+_*(5*c),A+=C>>>13,C&=8191;let N=A+R*c+U*u+k*(5*g)+P*(5*d)+T*(5*y);A=N>>>13,N&=8191,N+=H*(5*b)+w*(5*p)+v*(5*h)+$*(5*f)+_*(5*l),A+=N>>>13,N&=8191;let j=A+R*l+U*c+k*u+P*(5*g)+T*(5*d);A=j>>>13,j&=8191,j+=H*(5*y)+w*(5*b)+v*(5*p)+$*(5*h)+_*(5*f),A+=j>>>13,j&=8191;let F=A+R*f+U*l+k*c+P*u+T*(5*g);A=F>>>13,F&=8191,F+=H*(5*d)+w*(5*y)+v*(5*b)+$*(5*p)+_*(5*h),A+=F>>>13,F&=8191;let q=A+R*h+U*f+k*l+P*c+T*u;A=q>>>13,q&=8191,q+=H*(5*g)+w*(5*d)+v*(5*y)+$*(5*b)+_*(5*p),A+=q>>>13,q&=8191;let K=A+R*p+U*h+k*f+P*l+T*c;A=K>>>13,K&=8191,K+=H*u+w*(5*g)+v*(5*d)+$*(5*y)+_*(5*b),A+=K>>>13,K&=8191;let G=A+R*b+U*p+k*h+P*f+T*l;A=G>>>13,G&=8191,G+=H*c+w*u+v*(5*g)+$*(5*d)+_*(5*y),A+=G>>>13,G&=8191;let D=A+R*y+U*b+k*p+P*h+T*f;A=D>>>13,D&=8191,D+=H*l+w*c+v*u+$*(5*g)+_*(5*d),A+=D>>>13,D&=8191;let Z=A+R*d+U*y+k*b+P*p+T*h;A=Z>>>13,Z&=8191,Z+=H*f+w*l+v*c+$*u+_*(5*g),A+=Z>>>13,Z&=8191;let V=A+R*g+U*d+k*y+P*b+T*p;A=V>>>13,V&=8191,V+=H*h+w*f+v*l+$*c+_*u,A+=V>>>13,V&=8191,A=(A<<2)+A|0,A=A+C|0,C=A&8191,A=A>>>13,N+=A,s[0]=C,s[1]=N,s[2]=j,s[3]=F,s[4]=q,s[5]=K,s[6]=G,s[7]=D,s[8]=Z,s[9]=V}finalize(){const{h:n,pad:r}=this,i=new Uint16Array(10);let o=n[1]>>>13;n[1]&=8191;for(let u=2;u<10;u++)n[u]+=o,o=n[u]>>>13,n[u]&=8191;n[0]+=o*5,o=n[0]>>>13,n[0]&=8191,n[1]+=o,o=n[1]>>>13,n[1]&=8191,n[2]+=o,i[0]=n[0]+5,o=i[0]>>>13,i[0]&=8191;for(let u=1;u<10;u++)i[u]=n[u]+o,o=i[u]>>>13,i[u]&=8191;i[9]-=8192;let s=(o^1)-1;for(let u=0;u<10;u++)i[u]&=s;s=~s;for(let u=0;u<10;u++)n[u]=n[u]&s|i[u];n[0]=(n[0]|n[1]<<13)&65535,n[1]=(n[1]>>>3|n[2]<<10)&65535,n[2]=(n[2]>>>6|n[3]<<7)&65535,n[3]=(n[3]>>>9|n[4]<<4)&65535,n[4]=(n[4]>>>12|n[5]<<1|n[6]<<14)&65535,n[5]=(n[6]>>>2|n[7]<<11)&65535,n[6]=(n[7]>>>5|n[8]<<8)&65535,n[7]=(n[8]>>>8|n[9]<<5)&65535;let a=n[0]+r[0];n[0]=a&65535;for(let u=1;u<8;u++)a=(n[u]+r[u]|0)+(a>>>16)|0,n[u]=a&65535}update(n){Ri(this);const{buffer:r,blockLen:i}=this;n=cr(n);const o=n.length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a===i){for(;i<=o-s;s+=i)this.process(n,s);continue}r.set(n.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(n){Ri(this),wf(n,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:o}=this;if(o){for(r[o++]=1;o<16;o++)r[o]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let a=0;a<8;a++)n[s++]=i[a]>>>0,n[s++]=i[a]>>>8;return n}digest(){const{buffer:n,outputLen:r}=this;this.digestInto(n);const i=n.slice(0,r);return this.destroy(),i}}function mL(e){const n=(i,o)=>e(o).update(cr(i)).digest(),r=e(new Uint8Array(32));return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=i=>e(i),n}mL(e=>new wL(e));const bL=mf("expand 16-byte k"),vL=mf("expand 32-byte k"),EL=me(bL),xL=me(vL);function X(e,n){return e<<n|e>>>32-n}function Hc(e){return e.byteOffset%4===0}const qo=64,LL=16,F0=2**32-1,Cd=new Uint32Array;function AL(e,n,r,i,o,s,a,u){const c=o.length,l=new Uint8Array(qo),f=me(l),h=Hc(o)&&Hc(s),p=h?me(o):Cd,b=h?me(s):Cd;for(let y=0;y<c;a++){if(e(n,r,i,f,a,u),a>=F0)throw new Error("arx: counter overflow");const d=Math.min(qo,c-y);if(h&&d===qo){const g=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let m=0,x;m<LL;m++)x=g+m,b[x]=p[x]^f[m];y+=qo;continue}for(let g=0,m;g<d;g++)m=y+g,s[m]=o[m]^l[g];y+=d}}function SL(e,n){const{allowShortKeys:r,extendNonceFn:i,counterLength:o,counterRight:s,rounds:a}=Q5({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},n);if(typeof e!="function")throw new Error("core must be a function");return Tu(o),Tu(a),Ud(s),Ud(r),(u,c,l,f,h=0)=>{$t(u),$t(c),$t(l);const p=l.length;if(f||(f=new Uint8Array(p)),$t(f),Tu(h),h<0||h>=F0)throw new Error("arx: counter overflow");if(f.length<p)throw new Error(`arx: output (${f.length}) is shorter than data (${p})`);const b=[];let y=u.length,d,g;if(y===32)d=u.slice(),b.push(d),g=xL;else if(y===16&&r)d=new Uint8Array(32),d.set(u),d.set(u,16),g=EL,b.push(d);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);Hc(c)||(c=c.slice(),b.push(c));const m=me(d);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(g,m,me(c.subarray(0,16)),m),c=c.subarray(16)}const x=16-o;if(x!==c.length)throw new Error(`arx: nonce must be ${x} or 16 bytes`);if(x!==12){const O=new Uint8Array(12);O.set(c,s?0:12-c.length),c=O,b.push(c)}const S=me(c);for(AL(e,g,m,S,l,f,h,a);b.length>0;)b.pop().fill(0);return f}}function $L(e,n,r,i,o,s=20){let a=e[0],u=e[1],c=e[2],l=e[3],f=n[0],h=n[1],p=n[2],b=n[3],y=n[4],d=n[5],g=n[6],m=n[7],x=o,S=r[0],O=r[1],B=r[2],E=a,L=u,I=c,R=l,U=f,k=h,P=p,T=b,H=y,w=d,v=g,$=m,_=x,A=S,C=O,N=B;for(let F=0;F<s;F+=2)E=E+U|0,_=X(_^E,16),H=H+_|0,U=X(U^H,12),E=E+U|0,_=X(_^E,8),H=H+_|0,U=X(U^H,7),L=L+k|0,A=X(A^L,16),w=w+A|0,k=X(k^w,12),L=L+k|0,A=X(A^L,8),w=w+A|0,k=X(k^w,7),I=I+P|0,C=X(C^I,16),v=v+C|0,P=X(P^v,12),I=I+P|0,C=X(C^I,8),v=v+C|0,P=X(P^v,7),R=R+T|0,N=X(N^R,16),$=$+N|0,T=X(T^$,12),R=R+T|0,N=X(N^R,8),$=$+N|0,T=X(T^$,7),E=E+k|0,N=X(N^E,16),v=v+N|0,k=X(k^v,12),E=E+k|0,N=X(N^E,8),v=v+N|0,k=X(k^v,7),L=L+P|0,_=X(_^L,16),$=$+_|0,P=X(P^$,12),L=L+P|0,_=X(_^L,8),$=$+_|0,P=X(P^$,7),I=I+T|0,A=X(A^I,16),H=H+A|0,T=X(T^H,12),I=I+T|0,A=X(A^I,8),H=H+A|0,T=X(T^H,7),R=R+U|0,C=X(C^R,16),w=w+C|0,U=X(U^w,12),R=R+U|0,C=X(C^R,8),w=w+C|0,U=X(U^w,7);let j=0;i[j++]=a+E|0,i[j++]=u+L|0,i[j++]=c+I|0,i[j++]=l+R|0,i[j++]=f+U|0,i[j++]=h+k|0,i[j++]=p+P|0,i[j++]=b+T|0,i[j++]=y+H|0,i[j++]=d+w|0,i[j++]=g+v|0,i[j++]=m+$|0,i[j++]=x+_|0,i[j++]=S+A|0,i[j++]=O+C|0,i[j++]=B+N|0}const M0=SL($L,{counterRight:!1,counterLength:4,allowShortKeys:!1});class z0 extends A0{constructor(n,r){super(),this.finished=!1,this.destroyed=!1,Wt.hash(n);const i=mo(r);if(this.iHash=n.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?n.create().update(i).digest():i);for(let a=0;a<s.length;a++)s[a]^=54;this.iHash.update(s),this.oHash=n.create();for(let a=0;a<s.length;a++)s[a]^=106;this.oHash.update(s),s.fill(0)}update(n){return Wt.exists(this),this.iHash.update(n),this}digestInto(n){Wt.exists(this),Wt.bytes(n,this.outputLen),this.finished=!0,this.iHash.digestInto(n),this.oHash.update(n),this.oHash.digestInto(n),this.destroy()}digest(){const n=new Uint8Array(this.oHash.outputLen);return this.digestInto(n),n}_cloneInto(n){n||(n=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:o,destroyed:s,blockLen:a,outputLen:u}=this;return n=n,n.finished=o,n.destroyed=s,n.blockLen=a,n.outputLen=u,n.oHash=r._cloneInto(n.oHash),n.iHash=i._cloneInto(n.iHash),n}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const $a=(e,n,r)=>new z0(e,n).update(r).digest();$a.create=(e,n)=>new z0(e,n);function IL(e,n,r){return Wt.hash(e),r===void 0&&(r=new Uint8Array(e.outputLen)),$a(e,mo(r),mo(n))}const Nu=new Uint8Array([0]),Rd=new Uint8Array;function BL(e,n,r,i=32){if(Wt.hash(e),Wt.number(i),i>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(i/e.outputLen);r===void 0&&(r=Rd);const s=new Uint8Array(o*e.outputLen),a=$a.create(e,n),u=a._cloneInto(),c=new Uint8Array(a.outputLen);for(let l=0;l<o;l++)Nu[0]=l+1,u.update(l===0?Rd:c).update(r).update(Nu).digestInto(c),s.set(c,e.outputLen*l),a._cloneInto(u);return a.destroy(),u.destroy(),c.fill(0),Nu.fill(0),s.slice(0,i)}var kL=Object.defineProperty,Ee=(e,n)=>{for(var r in n)kL(e,r,{get:n[r],enumerable:!0})},Qr=Symbol("verified"),OL=e=>e instanceof Object;function q0(e){if(!OL(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let n=0;n<e.tags.length;n++){let r=e.tags[n];if(!Array.isArray(r))return!1;for(let i=0;i<r.length;i++)if(typeof r[i]=="object")return!1}return!0}var UL={};Ee(UL,{Queue:()=>TL,QueueNode:()=>K0,binarySearch:()=>xf,insertEventIntoAscendingList:()=>RL,insertEventIntoDescendingList:()=>CL,normalizeURL:()=>_L,utf8Decoder:()=>wn,utf8Encoder:()=>Qt});var wn=new TextDecoder("utf-8"),Qt=new TextEncoder;function _L(e){e.indexOf("://")===-1&&(e="wss://"+e);let n=new URL(e);return n.pathname=n.pathname.replace(/\/+/g,"/"),n.pathname.endsWith("/")&&(n.pathname=n.pathname.slice(0,-1)),(n.port==="80"&&n.protocol==="ws:"||n.port==="443"&&n.protocol==="wss:")&&(n.port=""),n.searchParams.sort(),n.hash="",n.toString()}function CL(e,n){const[r,i]=xf(e,o=>n.id===o.id?0:n.created_at===o.created_at?-1:o.created_at-n.created_at);return i||e.splice(r,0,n),e}function RL(e,n){const[r,i]=xf(e,o=>n.id===o.id?0:n.created_at===o.created_at?-1:n.created_at-o.created_at);return i||e.splice(r,0,n),e}function xf(e,n){let r=0,i=e.length-1;for(;r<=i;){const o=Math.floor((r+i)/2),s=n(e[o]);if(s===0)return[o,!0];s<0?i=o-1:r=o+1}return[r,!1]}var K0=class{constructor(e){oo(this,"value"),oo(this,"next",null),oo(this,"prev",null),this.value=e}},TL=class{constructor(){oo(this,"first"),oo(this,"last"),this.first=null,this.last=null}enqueue(e){const n=new K0(e);return this.last?this.last===this.first?(this.last=n,this.last.prev=this.first,this.first.next=n):(n.prev=this.last,this.last.next=n,this.last=n):(this.first=n,this.last=n),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const n=this.first;return this.first=null,this.last=null,n.value}const e=this.first;return this.first=e.next,e.value}},PL=class{generateSecretKey(){return Ft.utils.randomPrivateKey()}getPublicKey(e){return Be(Ft.getPublicKey(e))}finalizeEvent(e,n){const r=e;return r.pubkey=Be(Ft.getPublicKey(n)),r.id=os(r),r.sig=Be(Ft.sign(os(r),n)),r[Qr]=!0,r}verifyEvent(e){if(typeof e[Qr]=="boolean")return e[Qr];const n=os(e);if(n!==e.id)return e[Qr]=!1,!1;try{const r=Ft.verify(e.sig,n,e.pubkey);return e[Qr]=r,r}catch{return e[Qr]=!1,!1}}};function NL(e){if(!q0(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function os(e){let n=yi(Qt.encode(NL(e)));return Be(n)}var Ia=new PL;Ia.generateSecretKey;Ia.getPublicKey;var br=Ia.finalizeEvent,Lf=Ia.verifyEvent,HL={};Ee(HL,{Application:()=>HA,BadgeAward:()=>WL,BadgeDefinition:()=>UA,BlockedRelaysList:()=>yA,BookmarkList:()=>dA,Bookmarksets:()=>BA,Calendar:()=>DA,CalendarEventRSVP:()=>VA,ChannelCreation:()=>Z0,ChannelHideMessage:()=>X0,ChannelMessage:()=>Y0,ChannelMetadata:()=>J0,ChannelMuteUser:()=>Q0,ClassifiedListing:()=>MA,ClientAuth:()=>ew,CommunitiesList:()=>pA,CommunityDefinition:()=>ZA,CommunityPostApproval:()=>nA,Contacts:()=>qL,CreateOrUpdateProduct:()=>RA,CreateOrUpdateStall:()=>CA,Curationsets:()=>kA,Date:()=>qA,DraftClassifiedListing:()=>zA,DraftLong:()=>PA,Emojisets:()=>NA,EncryptedDirectMessage:()=>KL,EncryptedDirectMessages:()=>DL,EventDeletion:()=>VL,FileMetadata:()=>JL,FileServerPreference:()=>vA,Followsets:()=>SA,GenericRepost:()=>GL,Genericlists:()=>$A,HTTPAuth:()=>$f,Handlerinformation:()=>GA,Handlerrecommendation:()=>WA,Highlights:()=>cA,InterestsList:()=>mA,Interestsets:()=>_A,JobFeedback:()=>oA,JobRequest:()=>rA,JobResult:()=>iA,Label:()=>tA,LightningPubRPC:()=>xA,LiveChatMessage:()=>YL,LiveEvent:()=>jA,LongFormArticle:()=>TA,Metadata:()=>FL,Mutelist:()=>lA,NWCWalletInfo:()=>EA,NWCWalletRequest:()=>tw,NWCWalletResponse:()=>LA,NostrConnect:()=>AA,OpenTimestamps:()=>ZL,Pinlist:()=>fA,ProblemTracker:()=>XL,ProfileBadges:()=>OA,PublicChatsList:()=>gA,Reaction:()=>Sf,RecommendRelay:()=>zL,RelayList:()=>hA,Relaysets:()=>IA,Report:()=>QL,Reporting:()=>eA,Repost:()=>Af,SearchRelaysList:()=>wA,ShortTextNote:()=>ML,Time:()=>KA,UserEmojiList:()=>bA,UserStatuses:()=>FA,Zap:()=>uA,ZapGoal:()=>sA,ZapRequest:()=>aA,classifyKind:()=>jL,isEphemeralKind:()=>W0,isParameterizedReplaceableKind:()=>G0,isRegularKind:()=>D0,isReplaceableKind:()=>V0});function D0(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function V0(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function W0(e){return 2e4<=e&&e<3e4}function G0(e){return 3e4<=e&&e<4e4}function jL(e){return D0(e)?"regular":V0(e)?"replaceable":W0(e)?"ephemeral":G0(e)?"parameterized":"unknown"}var FL=0,ML=1,zL=2,qL=3,KL=4,DL=4,VL=5,Af=6,Sf=7,WL=8,GL=16,Z0=40,J0=41,Y0=42,X0=43,Q0=44,ZL=1040,JL=1063,YL=1311,XL=1971,QL=1984,eA=1984,tA=1985,nA=4550,rA=5999,iA=6999,oA=7e3,sA=9041,aA=9734,uA=9735,cA=9802,lA=1e4,fA=10001,hA=10002,dA=10003,pA=10004,gA=10005,yA=10006,wA=10007,mA=10015,bA=10030,vA=10096,EA=13194,xA=21e3,ew=22242,tw=23194,LA=23195,AA=24133,$f=27235,SA=3e4,$A=30001,IA=30002,BA=30003,kA=30004,OA=30008,UA=30009,_A=30015,CA=30017,RA=30018,TA=30023,PA=30024,NA=30030,HA=30078,jA=30311,FA=30315,MA=30402,zA=30403,qA=31922,KA=31923,DA=31924,VA=31925,WA=31989,GA=31990,ZA=34550,JA={};Ee(JA,{getHex64:()=>If,getInt:()=>nw,getSubscriptionId:()=>YA,matchEventId:()=>XA,matchEventKind:()=>eS,matchEventPubkey:()=>QA});function If(e,n){let r=n.length+3,i=e.indexOf(`"${n}":`)+r,o=e.slice(i).indexOf('"')+i+1;return e.slice(o,o+64)}function nw(e,n){let r=n.length,i=e.indexOf(`"${n}":`)+r+3,o=e.slice(i),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function YA(e){let n=e.slice(0,22).indexOf('"EVENT"');if(n===-1)return null;let r=e.slice(n+7+1).indexOf('"');if(r===-1)return null;let i=n+7+1+r,o=e.slice(i+1,80).indexOf('"');if(o===-1)return null;let s=i+1+o;return e.slice(i+1,s)}function XA(e,n){return n===If(e,"id")}function QA(e,n){return n===If(e,"pubkey")}function eS(e,n){return n===nw(e,"kind")}var tS={};Ee(tS,{makeAuthEvent:()=>nS});function nS(e,n){return{kind:ew,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",n]],content:""}}var rS;try{rS=WebSocket}catch{}var iS={};Ee(iS,{BECH32_REGEX:()=>rw,Bech32MaxSize:()=>Bf,decode:()=>Ba,encodeBytes:()=>ka,naddrEncode:()=>fS,neventEncode:()=>lS,noteEncode:()=>uS,nprofileEncode:()=>cS,npubEncode:()=>aS,nrelayEncode:()=>hS,nsecEncode:()=>sS});var Bf=5e3,rw=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function oS(e){const n=new Uint8Array(4);return n[0]=e>>24&255,n[1]=e>>16&255,n[2]=e>>8&255,n[3]=e&255,n}function Ba(e){var n,r,i,o,s,a,u,c;let{prefix:l,words:f}=Ci.decode(e,Bf),h=new Uint8Array(Ci.fromWords(f));switch(l){case"nprofile":{let p=Ko(h);if(!((n=p[0])!=null&&n[0]))throw new Error("missing TLV 0 for nprofile");if(p[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Be(p[0][0]),relays:p[1]?p[1].map(b=>wn.decode(b)):[]}}}case"nevent":{let p=Ko(h);if(!((r=p[0])!=null&&r[0]))throw new Error("missing TLV 0 for nevent");if(p[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(p[2]&&p[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(p[3]&&p[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Be(p[0][0]),relays:p[1]?p[1].map(b=>wn.decode(b)):[],author:(i=p[2])!=null&&i[0]?Be(p[2][0]):void 0,kind:(o=p[3])!=null&&o[0]?parseInt(Be(p[3][0]),16):void 0}}}case"naddr":{let p=Ko(h);if(!((s=p[0])!=null&&s[0]))throw new Error("missing TLV 0 for naddr");if(!((a=p[2])!=null&&a[0]))throw new Error("missing TLV 2 for naddr");if(p[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((u=p[3])!=null&&u[0]))throw new Error("missing TLV 3 for naddr");if(p[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:wn.decode(p[0][0]),pubkey:Be(p[2][0]),kind:parseInt(Be(p[3][0]),16),relays:p[1]?p[1].map(b=>wn.decode(b)):[]}}}case"nrelay":{let p=Ko(h);if(!((c=p[0])!=null&&c[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:wn.decode(p[0][0])}}case"nsec":return{type:l,data:h};case"npub":case"note":return{type:l,data:Be(h)};default:throw new Error(`unknown prefix ${l}`)}}function Ko(e){let n={},r=e;for(;r.length>0;){let i=r[0],o=r[1],s=r.slice(2,2+o);if(r=r.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${i}`);n[i]=n[i]||[],n[i].push(s)}return n}function sS(e){return ka("nsec",e)}function aS(e){return ka("npub",_i(e))}function uS(e){return ka("note",_i(e))}function Io(e,n){let r=Ci.toWords(n);return Ci.encode(e,r,Bf)}function ka(e,n){return Io(e,n)}function cS(e){let n=Oa({0:[_i(e.pubkey)],1:(e.relays||[]).map(r=>Qt.encode(r))});return Io("nprofile",n)}function lS(e){let n;e.kind!==void 0&&(n=oS(e.kind));let r=Oa({0:[_i(e.id)],1:(e.relays||[]).map(i=>Qt.encode(i)),2:e.author?[_i(e.author)]:[],3:n?[new Uint8Array(n)]:[]});return Io("nevent",r)}function fS(e){let n=new ArrayBuffer(4);new DataView(n).setUint32(0,e.kind,!1);let r=Oa({0:[Qt.encode(e.identifier)],1:(e.relays||[]).map(i=>Qt.encode(i)),2:[_i(e.pubkey)],3:[new Uint8Array(n)]});return Io("naddr",r)}function hS(e){let n=Oa({0:[Qt.encode(e)]});return Io("nrelay",n)}function Oa(e){let n=[];return Object.entries(e).reverse().forEach(([r,i])=>{i.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(r)],0),s.set([o.length],1),s.set(o,2),n.push(s)})}),Rs(...n)}var jc={};Ee(jc,{decrypt:()=>dS,encrypt:()=>iw});async function iw(e,n,r){const i=e instanceof Uint8Array?Be(e):e,o=Di.getSharedSecret(i,"02"+n),s=ow(o);let a=Uint8Array.from($0(16)),u=Qt.encode(r),c=j0(s,a).encrypt(u),l=xn.encode(new Uint8Array(c)),f=xn.encode(new Uint8Array(a.buffer));return`${l}?iv=${f}`}async function dS(e,n,r){const i=e instanceof Uint8Array?Be(e):e;let[o,s]=r.split("?iv="),a=Di.getSharedSecret(i,"02"+n),u=ow(a),c=xn.decode(s),l=xn.decode(o),f=j0(u,c).decrypt(l);return wn.decode(f)}function ow(e){return e.slice(1,33)}var pS={};Ee(pS,{NIP05_REGEX:()=>sw,isValid:()=>wS,queryProfile:()=>aw,searchDomain:()=>yS,useFetchImplementation:()=>gS});var sw=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,Ua;try{Ua=fetch}catch{}function gS(e){Ua=e}async function yS(e,n=""){try{const r=`https://${e}/.well-known/nostr.json?name=${n}`;return(await(await Ua(r,{redirect:"error"})).json()).names}catch{return{}}}async function aw(e){var n;const r=e.match(sw);if(!r)return null;const[i,o="_",s]=r;try{const a=`https://${s}/.well-known/nostr.json?name=${o}`,u=await(await Ua(a,{redirect:"error"})).json();let c=u.names[o];return c?{pubkey:c,relays:(n=u.relays)==null?void 0:n[c]}:null}catch{return null}}async function wS(e,n){let r=await aw(n);return r?r.pubkey===e:!1}var mS={};Ee(mS,{parse:()=>bS});function bS(e){const n={reply:void 0,root:void 0,mentions:[],profiles:[]},r=[];for(const i of e.tags)i[0]==="e"&&i[1]&&r.push(i),i[0]==="p"&&i[1]&&n.profiles.push({pubkey:i[1],relays:i[2]?[i[2]]:[]});for(let i=0;i<r.length;i++){const o=r[i],[s,a,u,c]=o,l={id:a,relays:u?[u]:[]},f=i===0,h=i===r.length-1;if(c==="root"){n.root=l;continue}if(c==="reply"){n.reply=l;continue}if(c==="mention"){n.mentions.push(l);continue}if(f){n.root=l;continue}if(h){n.reply=l;continue}n.mentions.push(l)}return n}var vS={};Ee(vS,{fetchRelayInformation:()=>xS,useFetchImplementation:()=>ES});var uw;try{uw=fetch}catch{}function ES(e){uw=e}async function xS(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var LS={};Ee(LS,{getPow:()=>cw,minePow:()=>AS});function cw(e){let n=0;for(let r=0;r<e.length;r++){const i=parseInt(e[r],16);if(i===0)n+=4;else{n+=Math.clz32(i)-28;break}}return n}function AS(e,n){let r=0;const i=e,o=["nonce",r.toString(),n.toString()];for(i.tags.push(o);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==i.created_at&&(r=0,i.created_at=s),o[1]=(++r).toString(),i.id=os(i),cw(i.id)>=n)break}return i}var SS={};Ee(SS,{finishRepostEvent:()=>$S,getRepostedEvent:()=>IS,getRepostedEventPointer:()=>lw});function $S(e,n,r,i){return br({kind:Af,tags:[...e.tags??[],["e",n.id,r],["p",n.pubkey]],content:e.content===""?"":JSON.stringify(n),created_at:e.created_at},i)}function lw(e){if(e.kind!==Af)return;let n,r;for(let i=e.tags.length-1;i>=0&&(n===void 0||r===void 0);i--){const o=e.tags[i];o.length>=2&&(o[0]==="e"&&n===void 0?n=o:o[0]==="p"&&r===void 0&&(r=o))}if(n!==void 0)return{id:n[1],relays:[n[2],r==null?void 0:r[2]].filter(i=>typeof i=="string"),author:r==null?void 0:r[1]}}function IS(e,{skipVerification:n}={}){const r=lw(e);if(r===void 0||e.content==="")return;let i;try{i=JSON.parse(e.content)}catch{return}if(i.id===r.id&&!(!n&&!Lf(i)))return i}var BS={};Ee(BS,{NOSTR_URI_REGEX:()=>_a,parse:()=>OS,test:()=>kS});var _a=new RegExp(`nostr:(${rw.source})`);function kS(e){return typeof e=="string"&&new RegExp(`^${_a.source}$`).test(e)}function OS(e){const n=e.match(new RegExp(`^${_a.source}$`));if(!n)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:n[0],value:n[1],decoded:Ba(n[1])}}var US={};Ee(US,{finishReactionEvent:()=>_S,getReactedEventPointer:()=>CS});function _S(e,n,r){const i=n.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return br({...e,kind:Sf,tags:[...e.tags??[],...i,["e",n.id],["p",n.pubkey]],content:e.content??"+"},r)}function CS(e){if(e.kind!==Sf)return;let n,r;for(let i=e.tags.length-1;i>=0&&(n===void 0||r===void 0);i--){const o=e.tags[i];o.length>=2&&(o[0]==="e"&&n===void 0?n=o:o[0]==="p"&&r===void 0&&(r=o))}if(!(n===void 0||r===void 0))return{id:n[1],relays:[n[2],r[2]].filter(i=>i!==void 0),author:r[1]}}var RS={};Ee(RS,{matchAll:()=>TS,regex:()=>kf,replaceAll:()=>PS});var kf=()=>new RegExp(`\\b${_a.source}\\b`,"g");function*TS(e){const n=e.matchAll(kf());for(const r of n)try{const[i,o]=r;yield{uri:i,value:o,decoded:Ba(o),start:r.index,end:r.index+i.length}}catch{}}function PS(e,n){return e.replaceAll(kf(),(r,i)=>n({uri:r,value:i,decoded:Ba(i)}))}var NS={};Ee(NS,{channelCreateEvent:()=>HS,channelHideMessageEvent:()=>MS,channelMessageEvent:()=>FS,channelMetadataEvent:()=>jS,channelMuteUserEvent:()=>zS});var HS=(e,n)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return br({kind:Z0,tags:[...e.tags??[]],content:r,created_at:e.created_at},n)},jS=(e,n)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return br({kind:J0,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:r,created_at:e.created_at},n)},FS=(e,n)=>{const r=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&r.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),br({kind:Y0,tags:[...r,...e.tags??[]],content:e.content,created_at:e.created_at},n)},MS=(e,n)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return br({kind:X0,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:r,created_at:e.created_at},n)},zS=(e,n)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return br({kind:Q0,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:r,created_at:e.created_at},n)},qS={};Ee(qS,{EMOJI_SHORTCODE_REGEX:()=>fw,matchAll:()=>KS,regex:()=>Of,replaceAll:()=>DS});var fw=/:(\w+):/,Of=()=>new RegExp(`\\B${fw.source}\\B`,"g");function*KS(e){const n=e.matchAll(Of());for(const r of n)try{const[i,o]=r;yield{shortcode:i,name:o,start:r.index,end:r.index+i.length}}catch{}}function DS(e,n){return e.replaceAll(Of(),(r,i)=>n({shortcode:r,name:i}))}var VS={};Ee(VS,{useFetchImplementation:()=>WS,validateGithub:()=>GS});var Uf;try{Uf=fetch}catch{}function WS(e){Uf=e}async function GS(e,n,r){try{return await(await Uf(`https://gist.github.com/${n}/${r}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var ZS={};Ee(ZS,{default:()=>QS,v2:()=>hw});var JS=new TextDecoder,Fe={minPlaintextSize:1,maxPlaintextSize:65535,utf8Encode:L0,utf8Decode(e){return JS.decode(e)},getConversationKey(e,n){const r=Di.getSharedSecret(e,"02"+n).subarray(1,33);return IL(yi,r,"nip44-v2")},getMessageKeys(e,n){const r=BL(yi,e,n,76);return{chacha_key:r.subarray(0,32),chacha_nonce:r.subarray(32,44),hmac_key:r.subarray(44,76)}},calcPaddedLen(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const n=1<<Math.floor(Math.log2(e-1))+1,r=n<=256?32:n/8;return r*(Math.floor((e-1)/r)+1)},writeU16BE(e){if(!Number.isSafeInteger(e)||e<Fe.minPlaintextSize||e>Fe.maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const n=new Uint8Array(2);return new DataView(n.buffer).setUint16(0,e,!1),n},pad(e){const n=Fe.utf8Encode(e),r=n.length,i=Fe.writeU16BE(r),o=new Uint8Array(Fe.calcPaddedLen(r)-r);return Rs(i,n,o)},unpad(e){const n=new DataView(e.buffer).getUint16(0),r=e.subarray(2,2+n);if(n<Fe.minPlaintextSize||n>Fe.maxPlaintextSize||r.length!==n||e.length!==2+Fe.calcPaddedLen(n))throw new Error("invalid padding");return Fe.utf8Decode(r)},hmacAad(e,n,r){if(r.length!==32)throw new Error("AAD associated data must be 32 bytes");const i=Rs(r,n);return $a(yi,e,i)},decodePayload(e){if(typeof e!="string")throw new Error("payload must be a valid string");const n=e.length;if(n<132||n>87472)throw new Error("invalid payload length: "+n);if(e[0]==="#")throw new Error("unknown encryption version");let r;try{r=xn.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const i=r.length;if(i<99||i>65603)throw new Error("invalid data length: "+i);const o=r[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:r.subarray(1,33),ciphertext:r.subarray(33,-32),mac:r.subarray(-32)}}};function YS(e,n,r=$0(32)){const{chacha_key:i,chacha_nonce:o,hmac_key:s}=Fe.getMessageKeys(n,r),a=Fe.pad(e),u=M0(i,o,a),c=Fe.hmacAad(s,u,r);return xn.encode(Rs(new Uint8Array([2]),r,u,c))}function XS(e,n){const{nonce:r,ciphertext:i,mac:o}=Fe.decodePayload(e),{chacha_key:s,chacha_nonce:a,hmac_key:u}=Fe.getMessageKeys(n,r),c=Fe.hmacAad(u,i,r);if(!eL(c,o))throw new Error("invalid MAC");const l=M0(s,a,i);return Fe.unpad(l)}var hw={utils:Fe,encrypt:YS,decrypt:XS},QS={v2:hw},e$={};Ee(e$,{makeNwcRequestEvent:()=>n$,parseConnectionString:()=>t$});function t$(e){const{pathname:n,searchParams:r}=new URL(e),i=n,o=r.get("relay"),s=r.get("secret");if(!i||!o||!s)throw new Error("invalid connection string");return{pubkey:i,relay:o,secret:s}}async function n$(e,n,r){const i=await iw(n,e,JSON.stringify({method:"pay_invoice",params:{invoice:r}})),o={kind:tw,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e]]};return br(o,n)}var r$={};Ee(r$,{getZapEndpoint:()=>o$,makeZapReceipt:()=>u$,makeZapRequest:()=>s$,useFetchImplementation:()=>i$,validateZapRequest:()=>a$});var _f;try{_f=fetch}catch{}function i$(e){_f=e}async function o$(e){try{let n="",{lud06:r,lud16:i}=JSON.parse(e.content);if(r){let{words:s}=Ci.decode(r,1e3),a=Ci.fromWords(s);n=wn.decode(a)}else if(i){let[s,a]=i.split("@");n=new URL(`/.well-known/lnurlp/${s}`,`https://${a}`).toString()}else return null;let o=await(await _f(n)).json();if(o.allowsNostr&&o.nostrPubkey)return o.callback}catch{}return null}function s$({profile:e,event:n,amount:r,relays:i,comment:o=""}){if(!r)throw new Error("amount not given");if(!e)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e],["amount",r.toString()],["relays",...i]]};return n&&s.tags.push(["e",n]),s}function a$(e){let n;try{n=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!q0(n))return"Zap request is not a valid Nostr event.";if(!Lf(n))return"Invalid signature on zap request.";let r=n.tags.find(([o,s])=>o==="p"&&s);if(!r)return"Zap request doesn't have a 'p' tag.";if(!r[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let i=n.tags.find(([o,s])=>o==="e"&&s);return i&&!i[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":n.tags.find(([o,s])=>o==="relays"&&s)?null:"Zap request doesn't have a 'relays' tag."}function u$({zapRequest:e,preimage:n,bolt11:r,paidAt:i}){let o=JSON.parse(e),s=o.tags.filter(([u])=>u==="e"||u==="p"||u==="a"),a={kind:9735,created_at:Math.round(i.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",r],["description",e]]};return n&&a.tags.push(["preimage",n]),a}var c$={};Ee(c$,{getToken:()=>l$,hashPayload:()=>Cf,unpackEventFromToken:()=>pw,validateEvent:()=>vw,validateEventKind:()=>yw,validateEventMethodTag:()=>mw,validateEventPayloadTag:()=>bw,validateEventTimestamp:()=>gw,validateEventUrlTag:()=>ww,validateToken:()=>f$});var dw="Nostr ";async function l$(e,n,r,i=!1,o){const s={kind:$f,tags:[["u",e],["method",n]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",Cf(o)]);const a=await r(s);return(i?dw:"")+xn.encode(Qt.encode(JSON.stringify(a)))}async function f$(e,n,r){const i=await pw(e).catch(o=>{throw o});return await vw(i,n,r).catch(o=>{throw o})}async function pw(e){if(!e)throw new Error("Missing token");e=e.replace(dw,"");const n=wn.decode(xn.decode(e));if(!n||n.length===0||!n.startsWith("{"))throw new Error("Invalid token");return JSON.parse(n)}function gw(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function yw(e){return e.kind===$f}function ww(e,n){const r=e.tags.find(i=>i[0]==="u");return r?r.length>0&&r[1]===n:!1}function mw(e,n){const r=e.tags.find(i=>i[0]==="method");return r?r.length>0&&r[1].toLowerCase()===n.toLowerCase():!1}function Cf(e){const n=yi(Qt.encode(JSON.stringify(e)));return Be(n)}function bw(e,n){const r=e.tags.find(o=>o[0]==="payload");if(!r)return!1;const i=Cf(n);return r.length>0&&r[1]===i}async function vw(e,n,r,i){if(!Lf(e))throw new Error("Invalid nostr event, signature invalid");if(!yw(e))throw new Error("Invalid nostr event, kind invalid");if(!gw(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!ww(e,n))throw new Error("Invalid nostr event, url tag invalid");if(!mw(e,r))throw new Error("Invalid nostr event, method tag invalid");if(i&&typeof i=="object"&&Object.keys(i).length>0&&!bw(e,i))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var h$=Object.defineProperty,d$=(e,n,r)=>n in e?h$(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,ao=(e,n,r)=>(d$(e,typeof n!="symbol"?n+"":n,r),r);const Hu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Rf(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}const ju=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Tt=(e,n)=>e<<32-n|e>>>n,p$=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!p$)throw new Error("Non little-endian hardware is not supported");const g$=Array.from({length:256},(e,n)=>n.toString(16).padStart(2,"0"));function Tf(e){if(!Rf(e))throw new Error("Uint8Array expected");let n="";for(let r=0;r<e.length;r++)n+=g$[e[r]];return n}const an={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Td(e){if(e>=an._0&&e<=an._9)return e-an._0;if(e>=an._A&&e<=an._F)return e-(an._A-10);if(e>=an._a&&e<=an._f)return e-(an._a-10)}function Ps(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const n=e.length,r=n/2;if(n%2)throw new Error("padded hex string expected, got unpadded hex of length "+n);const i=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){const a=Td(e.charCodeAt(s)),u=Td(e.charCodeAt(s+1));if(a===void 0||u===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[o]=a*16+u}return i}function y$(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Pf(e){if(typeof e=="string"&&(e=y$(e)),!Rf(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function w$(...e){let n=0;for(let i=0;i<e.length;i++){const o=e[i];if(!Rf(o))throw new Error("Uint8Array expected");n+=o.length}const r=new Uint8Array(n);for(let i=0,o=0;i<e.length;i++){const s=e[i];r.set(s,o),o+=s.length}return r}let Ew=class{clone(){return this._cloneInto()}};function m$(e){const n=i=>e().update(Pf(i)).digest(),r=e();return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=()=>e(),n}function xw(e=32){if(Hu&&typeof Hu.getRandomValues=="function")return Hu.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Pd(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function b$(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function Lw(e,...n){if(!b$(e))throw new Error("Expected Uint8Array");if(n.length>0&&!n.includes(e.length))throw new Error(`Expected Uint8Array of length ${n}, not of length=${e.length}`)}function v$(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Pd(e.outputLen),Pd(e.blockLen)}function Ns(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function E$(e,n){Lw(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}function x$(e,n,r,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(n,r,i);const o=BigInt(32),s=BigInt(4294967295),a=Number(r>>o&s),u=Number(r&s),c=i?4:0,l=i?0:4;e.setUint32(n+c,a,i),e.setUint32(n+l,u,i)}let L$=class extends Ew{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ju(this.buffer)}update(e){Ns(this);const{view:n,buffer:r,blockLen:i}=this;e=Pf(e);const o=e.length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a===i){const u=ju(e);for(;i<=o-s;s+=i)this.process(u,s);continue}r.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ns(this),E$(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:o}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(r,0),s=0);for(let f=s;f<i;f++)n[f]=0;x$(r,i-8,BigInt(this.length*8),o),this.process(r,0);const a=ju(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,l[f],o)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%n&&e.buffer.set(r),e}};const A$=(e,n,r)=>e&n^~e&r,S$=(e,n,r)=>e&n^e&r^n&r,$$=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Kn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Dn=new Uint32Array(64);let I$=class extends L${constructor(){super(64,32,8,!1),this.A=Kn[0]|0,this.B=Kn[1]|0,this.C=Kn[2]|0,this.D=Kn[3]|0,this.E=Kn[4]|0,this.F=Kn[5]|0,this.G=Kn[6]|0,this.H=Kn[7]|0}get(){const{A:e,B:n,C:r,D:i,E:o,F:s,G:a,H:u}=this;return[e,n,r,i,o,s,a,u]}set(e,n,r,i,o,s,a,u){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,n){for(let f=0;f<16;f++,n+=4)Dn[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=Dn[f-15],p=Dn[f-2],b=Tt(h,7)^Tt(h,18)^h>>>3,y=Tt(p,17)^Tt(p,19)^p>>>10;Dn[f]=y+Dn[f-7]+b+Dn[f-16]|0}let{A:r,B:i,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let f=0;f<64;f++){const h=Tt(a,6)^Tt(a,11)^Tt(a,25),p=l+h+A$(a,u,c)+$$[f]+Dn[f]|0,b=(Tt(r,2)^Tt(r,13)^Tt(r,22))+S$(r,i,o)|0;l=c,c=u,u=a,a=s+p|0,s=o,o=i,i=r,r=p+b|0}r=r+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(r,i,o,s,a,u,c,l)}roundClean(){Dn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Fc=m$(()=>new I$);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Aw=BigInt(0),Ca=BigInt(1),B$=BigInt(2);function en(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}const k$=Array.from({length:256},(e,n)=>n.toString(16).padStart(2,"0"));function Ti(e){if(!en(e))throw new Error("Uint8Array expected");let n="";for(let r=0;r<e.length;r++)n+=k$[e[r]];return n}function Sw(e){const n=e.toString(16);return n.length&1?`0${n}`:n}function Nf(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}const un={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Nd(e){if(e>=un._0&&e<=un._9)return e-un._0;if(e>=un._A&&e<=un._F)return e-(un._A-10);if(e>=un._a&&e<=un._f)return e-(un._a-10)}function Pi(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const n=e.length,r=n/2;if(n%2)throw new Error("padded hex string expected, got unpadded hex of length "+n);const i=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){const a=Nd(e.charCodeAt(s)),u=Nd(e.charCodeAt(s+1));if(a===void 0||u===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[o]=a*16+u}return i}function at(e){return Nf(Ti(e))}function Hf(e){if(!en(e))throw new Error("Uint8Array expected");return Nf(Ti(Uint8Array.from(e).reverse()))}function lr(e,n){return Pi(e.toString(16).padStart(n*2,"0"))}function jf(e,n){return lr(e,n).reverse()}function O$(e){return Pi(Sw(e))}function Xe(e,n,r){let i;if(typeof n=="string")try{i=Pi(n)}catch(s){throw new Error(`${e} must be valid hex string, got "${n}". Cause: ${s}`)}else if(en(n))i=Uint8Array.from(n);else throw new Error(`${e} must be hex string or Uint8Array`);const o=i.length;if(typeof r=="number"&&o!==r)throw new Error(`${e} expected ${r} bytes, got ${o}`);return i}function Wr(...e){let n=0;for(let o=0;o<e.length;o++){const s=e[o];if(!en(s))throw new Error("Uint8Array expected");n+=s.length}let r=new Uint8Array(n),i=0;for(let o=0;o<e.length;o++){const s=e[o];r.set(s,i),i+=s.length}return r}function U$(e,n){if(e.length!==n.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^n[i];return r===0}function _$(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function C$(e){let n;for(n=0;e>Aw;e>>=Ca,n+=1);return n}function R$(e,n){return e>>BigInt(n)&Ca}const T$=(e,n,r)=>e|(r?Ca:Aw)<<BigInt(n),Ff=e=>(B$<<BigInt(e-1))-Ca,Fu=e=>new Uint8Array(e),Hd=e=>Uint8Array.from(e);function $w(e,n,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof n!="number"||n<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=Fu(e),o=Fu(e),s=0;const a=()=>{i.fill(1),o.fill(0),s=0},u=(...f)=>r(o,i,...f),c=(f=Fu())=>{o=u(Hd([0]),f),i=u(),f.length!==0&&(o=u(Hd([1]),f),i=u())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<n;){i=u();const p=i.slice();h.push(p),f+=i.length}return Wr(...h)};return(f,h)=>{a(),c(f);let p;for(;!(p=h(l()));)c();return a(),p}}const P$={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||en(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,n)=>n.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Bo(e,n,r={}){const i=(o,s,a)=>{const u=P$[s];if(typeof u!="function")throw new Error(`Invalid validator "${s}", expected function`);const c=e[o];if(!(a&&c===void 0)&&!u(c,e))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(const[o,s]of Object.entries(n))i(o,s,!1);for(const[o,s]of Object.entries(r))i(o,s,!0);return e}const N$=Object.freeze(Object.defineProperty({__proto__:null,bitGet:R$,bitLen:C$,bitMask:Ff,bitSet:T$,bytesToHex:Ti,bytesToNumberBE:at,bytesToNumberLE:Hf,concatBytes:Wr,createHmacDrbg:$w,ensureBytes:Xe,equalBytes:U$,hexToBytes:Pi,hexToNumber:Nf,isBytes:en,numberToBytesBE:lr,numberToBytesLE:jf,numberToHexUnpadded:Sw,numberToVarBytesBE:O$,utf8ToBytes:_$,validateObject:Bo},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ce=BigInt(0),ge=BigInt(1),Or=BigInt(2),H$=BigInt(3),Mc=BigInt(4),jd=BigInt(5),Fd=BigInt(8);BigInt(9);BigInt(16);function De(e,n){const r=e%n;return r>=Ce?r:n+r}function j$(e,n,r){if(r<=Ce||n<Ce)throw new Error("Expected power/modulo > 0");if(r===ge)return Ce;let i=ge;for(;n>Ce;)n&ge&&(i=i*e%r),e=e*e%r,n>>=ge;return i}function dt(e,n,r){let i=e;for(;n-- >Ce;)i*=i,i%=r;return i}function zc(e,n){if(e===Ce||n<=Ce)throw new Error(`invert: expected positive integers, got n=${e} mod=${n}`);let r=De(e,n),i=n,o=Ce,s=ge;for(;r!==Ce;){const a=i/r,u=i%r,c=o-s*a;i=r,r=u,o=s,s=c}if(i!==ge)throw new Error("invert: does not exist");return De(o,n)}function F$(e){const n=(e-ge)/Or;let r,i,o;for(r=e-ge,i=0;r%Or===Ce;r/=Or,i++);for(o=Or;o<e&&j$(o,n,e)!==e-ge;o++);if(i===1){const a=(e+ge)/Mc;return function(u,c){const l=u.pow(c,a);if(!u.eql(u.sqr(l),c))throw new Error("Cannot find square root");return l}}const s=(r+ge)/Or;return function(a,u){if(a.pow(u,n)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,l=a.pow(a.mul(a.ONE,o),r),f=a.pow(u,s),h=a.pow(u,r);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let p=1;for(let y=a.sqr(h);p<c&&!a.eql(y,a.ONE);p++)y=a.sqr(y);const b=a.pow(l,ge<<BigInt(c-p-1));l=a.sqr(b),f=a.mul(f,b),h=a.mul(h,l),c=p}return f}}function M$(e){if(e%Mc===H$){const n=(e+ge)/Mc;return function(r,i){const o=r.pow(i,n);if(!r.eql(r.sqr(o),i))throw new Error("Cannot find square root");return o}}if(e%Fd===jd){const n=(e-jd)/Fd;return function(r,i){const o=r.mul(i,Or),s=r.pow(o,n),a=r.mul(i,s),u=r.mul(r.mul(a,Or),s),c=r.mul(a,r.sub(u,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return F$(e)}const z$=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function q$(e){const n={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=z$.reduce((i,o)=>(i[o]="function",i),n);return Bo(e,r)}function K$(e,n,r){if(r<Ce)throw new Error("Expected power > 0");if(r===Ce)return e.ONE;if(r===ge)return n;let i=e.ONE,o=n;for(;r>Ce;)r&ge&&(i=e.mul(i,o)),o=e.sqr(o),r>>=ge;return i}function D$(e,n){const r=new Array(n.length),i=n.reduce((s,a,u)=>e.is0(a)?s:(r[u]=s,e.mul(s,a)),e.ONE),o=e.inv(i);return n.reduceRight((s,a,u)=>e.is0(a)?s:(r[u]=e.mul(s,r[u]),e.mul(s,a)),o),r}function Iw(e,n){const r=n!==void 0?n:e.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function V$(e,n,r=!1,i={}){if(e<=Ce)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:s}=Iw(e,n);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const a=M$(e),u=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:Ff(o),ZERO:Ce,ONE:ge,create:c=>De(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return Ce<=c&&c<e},is0:c=>c===Ce,isOdd:c=>(c&ge)===ge,neg:c=>De(-c,e),eql:(c,l)=>c===l,sqr:c=>De(c*c,e),add:(c,l)=>De(c+l,e),sub:(c,l)=>De(c-l,e),mul:(c,l)=>De(c*l,e),pow:(c,l)=>K$(u,c,l),div:(c,l)=>De(c*zc(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>zc(c,e),sqrt:i.sqrt||(c=>a(u,c)),invertBatch:c=>D$(u,c),cmov:(c,l,f)=>f?l:c,toBytes:c=>r?jf(c,s):lr(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return r?Hf(c):at(c)}});return Object.freeze(u)}function Bw(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const n=e.toString(2).length;return Math.ceil(n/8)}function kw(e){const n=Bw(e);return n+Math.ceil(n/2)}function W$(e,n,r=!1){const i=e.length,o=Bw(n),s=kw(n);if(i<16||i<s||i>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${i}`);const a=r?at(e):Hf(e),u=De(a,n-ge)+ge;return r?jf(u,o):lr(u,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const G$=BigInt(0),Mu=BigInt(1);function Z$(e,n){const r=(o,s)=>{const a=s.negate();return o?a:s},i=o=>{const s=Math.ceil(n/o)+1,a=2**(o-1);return{windows:s,windowSize:a}};return{constTimeNegate:r,unsafeLadder(o,s){let a=e.ZERO,u=o;for(;s>G$;)s&Mu&&(a=a.add(u)),u=u.double(),s>>=Mu;return a},precomputeWindow(o,s){const{windows:a,windowSize:u}=i(s),c=[];let l=o,f=l;for(let h=0;h<a;h++){f=l,c.push(f);for(let p=1;p<u;p++)f=f.add(l),c.push(f);l=f.double()}return c},wNAF(o,s,a){const{windows:u,windowSize:c}=i(o);let l=e.ZERO,f=e.BASE;const h=BigInt(2**o-1),p=2**o,b=BigInt(o);for(let y=0;y<u;y++){const d=y*c;let g=Number(a&h);a>>=b,g>c&&(g-=p,a+=Mu);const m=d,x=d+Math.abs(g)-1,S=y%2!==0,O=g<0;g===0?f=f.add(r(S,s[m])):l=l.add(r(O,s[x]))}return{p:l,f}},wNAFCached(o,s,a,u){const c=o._WINDOW_SIZE||1;let l=s.get(o);return l||(l=this.precomputeWindow(o,c),c!==1&&s.set(o,u(l))),this.wNAF(c,l,a)}}}function Ow(e){return q$(e.Fp),Bo(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Iw(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function J$(e){const n=Ow(e);Bo(n,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:i,a:o}=n;if(r){if(!i.eql(o,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...n})}const{bytesToNumberBE:Y$,hexToBytes:X$}=N$,Nr={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:n}=Nr;if(e.length<2||e[0]!==2)throw new n("Invalid signature integer tag");const r=e[1],i=e.subarray(2,r+2);if(!r||i.length!==r)throw new n("Invalid signature integer: wrong length");if(i[0]&128)throw new n("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new n("Invalid signature integer: unnecessary leading zero");return{d:Y$(i),l:e.subarray(r+2)}},toSig(e){const{Err:n}=Nr,r=typeof e=="string"?X$(e):e;if(!en(r))throw new Error("ui8a expected");let i=r.length;if(i<2||r[0]!=48)throw new n("Invalid signature tag");if(r[1]!==i-2)throw new n("Invalid signature: incorrect length");const{d:o,l:s}=Nr._parseInt(r.subarray(2)),{d:a,l:u}=Nr._parseInt(s);if(u.length)throw new n("Invalid signature: left bytes after parsing");return{r:o,s:a}},hexFromSig(e){const n=l=>Number.parseInt(l[0],16)&8?"00"+l:l,r=l=>{const f=l.toString(16);return f.length&1?`0${f}`:f},i=n(r(e.s)),o=n(r(e.r)),s=i.length/2,a=o.length/2,u=r(s),c=r(a);return`30${r(a+s+4)}02${c}${o}02${u}${i}`}},mn=BigInt(0),xt=BigInt(1);BigInt(2);const Md=BigInt(3);BigInt(4);function Q$(e){const n=J$(e),{Fp:r}=n,i=n.toBytes||((y,d,g)=>{const m=d.toAffine();return Wr(Uint8Array.from([4]),r.toBytes(m.x),r.toBytes(m.y))}),o=n.fromBytes||(y=>{const d=y.subarray(1),g=r.fromBytes(d.subarray(0,r.BYTES)),m=r.fromBytes(d.subarray(r.BYTES,2*r.BYTES));return{x:g,y:m}});function s(y){const{a:d,b:g}=n,m=r.sqr(y),x=r.mul(m,y);return r.add(r.add(x,r.mul(y,d)),g)}if(!r.eql(r.sqr(n.Gy),s(n.Gx)))throw new Error("bad generator point: equation left != right");function a(y){return typeof y=="bigint"&&mn<y&&y<n.n}function u(y){if(!a(y))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(y){const{allowedPrivateKeyLengths:d,nByteLength:g,wrapPrivateKey:m,n:x}=n;if(d&&typeof y!="bigint"){if(en(y)&&(y=Ti(y)),typeof y!="string"||!d.includes(y.length))throw new Error("Invalid key");y=y.padStart(g*2,"0")}let S;try{S=typeof y=="bigint"?y:at(Xe("private key",y,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof y}`)}return m&&(S=De(S,x)),u(S),S}const l=new Map;function f(y){if(!(y instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(d,g,m){if(this.px=d,this.py=g,this.pz=m,d==null||!r.isValid(d))throw new Error("x required");if(g==null||!r.isValid(g))throw new Error("y required");if(m==null||!r.isValid(m))throw new Error("z required")}static fromAffine(d){const{x:g,y:m}=d||{};if(!d||!r.isValid(g)||!r.isValid(m))throw new Error("invalid affine point");if(d instanceof h)throw new Error("projective point not allowed");const x=S=>r.eql(S,r.ZERO);return x(g)&&x(m)?h.ZERO:new h(g,m,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const g=r.invertBatch(d.map(m=>m.pz));return d.map((m,x)=>m.toAffine(g[x])).map(h.fromAffine)}static fromHex(d){const g=h.fromAffine(o(Xe("pointHex",d)));return g.assertValidity(),g}static fromPrivateKey(d){return h.BASE.multiply(c(d))}_setWindowSize(d){this._WINDOW_SIZE=d,l.delete(this)}assertValidity(){if(this.is0()){if(n.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:d,y:g}=this.toAffine();if(!r.isValid(d)||!r.isValid(g))throw new Error("bad point: x or y not FE");const m=r.sqr(g),x=s(d);if(!r.eql(m,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:d}=this.toAffine();if(r.isOdd)return!r.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){f(d);const{px:g,py:m,pz:x}=this,{px:S,py:O,pz:B}=d,E=r.eql(r.mul(g,B),r.mul(S,x)),L=r.eql(r.mul(m,B),r.mul(O,x));return E&&L}negate(){return new h(this.px,r.neg(this.py),this.pz)}double(){const{a:d,b:g}=n,m=r.mul(g,Md),{px:x,py:S,pz:O}=this;let B=r.ZERO,E=r.ZERO,L=r.ZERO,I=r.mul(x,x),R=r.mul(S,S),U=r.mul(O,O),k=r.mul(x,S);return k=r.add(k,k),L=r.mul(x,O),L=r.add(L,L),B=r.mul(d,L),E=r.mul(m,U),E=r.add(B,E),B=r.sub(R,E),E=r.add(R,E),E=r.mul(B,E),B=r.mul(k,B),L=r.mul(m,L),U=r.mul(d,U),k=r.sub(I,U),k=r.mul(d,k),k=r.add(k,L),L=r.add(I,I),I=r.add(L,I),I=r.add(I,U),I=r.mul(I,k),E=r.add(E,I),U=r.mul(S,O),U=r.add(U,U),I=r.mul(U,k),B=r.sub(B,I),L=r.mul(U,R),L=r.add(L,L),L=r.add(L,L),new h(B,E,L)}add(d){f(d);const{px:g,py:m,pz:x}=this,{px:S,py:O,pz:B}=d;let E=r.ZERO,L=r.ZERO,I=r.ZERO;const R=n.a,U=r.mul(n.b,Md);let k=r.mul(g,S),P=r.mul(m,O),T=r.mul(x,B),H=r.add(g,m),w=r.add(S,O);H=r.mul(H,w),w=r.add(k,P),H=r.sub(H,w),w=r.add(g,x);let v=r.add(S,B);return w=r.mul(w,v),v=r.add(k,T),w=r.sub(w,v),v=r.add(m,x),E=r.add(O,B),v=r.mul(v,E),E=r.add(P,T),v=r.sub(v,E),I=r.mul(R,w),E=r.mul(U,T),I=r.add(E,I),E=r.sub(P,I),I=r.add(P,I),L=r.mul(E,I),P=r.add(k,k),P=r.add(P,k),T=r.mul(R,T),w=r.mul(U,w),P=r.add(P,T),T=r.sub(k,T),T=r.mul(R,T),w=r.add(w,T),k=r.mul(P,w),L=r.add(L,k),k=r.mul(v,w),E=r.mul(H,E),E=r.sub(E,k),k=r.mul(H,P),I=r.mul(v,I),I=r.add(I,k),new h(E,L,I)}subtract(d){return this.add(d.negate())}is0(){return this.equals(h.ZERO)}wNAF(d){return b.wNAFCached(this,l,d,g=>{const m=r.invertBatch(g.map(x=>x.pz));return g.map((x,S)=>x.toAffine(m[S])).map(h.fromAffine)})}multiplyUnsafe(d){const g=h.ZERO;if(d===mn)return g;if(u(d),d===xt)return this;const{endo:m}=n;if(!m)return b.unsafeLadder(this,d);let{k1neg:x,k1:S,k2neg:O,k2:B}=m.splitScalar(d),E=g,L=g,I=this;for(;S>mn||B>mn;)S&xt&&(E=E.add(I)),B&xt&&(L=L.add(I)),I=I.double(),S>>=xt,B>>=xt;return x&&(E=E.negate()),O&&(L=L.negate()),L=new h(r.mul(L.px,m.beta),L.py,L.pz),E.add(L)}multiply(d){u(d);let g=d,m,x;const{endo:S}=n;if(S){const{k1neg:O,k1:B,k2neg:E,k2:L}=S.splitScalar(g);let{p:I,f:R}=this.wNAF(B),{p:U,f:k}=this.wNAF(L);I=b.constTimeNegate(O,I),U=b.constTimeNegate(E,U),U=new h(r.mul(U.px,S.beta),U.py,U.pz),m=I.add(U),x=R.add(k)}else{const{p:O,f:B}=this.wNAF(g);m=O,x=B}return h.normalizeZ([m,x])[0]}multiplyAndAddUnsafe(d,g,m){const x=h.BASE,S=(B,E)=>E===mn||E===xt||!B.equals(x)?B.multiplyUnsafe(E):B.multiply(E),O=S(this,g).add(S(d,m));return O.is0()?void 0:O}toAffine(d){const{px:g,py:m,pz:x}=this,S=this.is0();d==null&&(d=S?r.ONE:r.inv(x));const O=r.mul(g,d),B=r.mul(m,d),E=r.mul(x,d);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(E,r.ONE))throw new Error("invZ was invalid");return{x:O,y:B}}isTorsionFree(){const{h:d,isTorsionFree:g}=n;if(d===xt)return!0;if(g)return g(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:g}=n;return d===xt?this:g?g(h,this):this.multiplyUnsafe(n.h)}toRawBytes(d=!0){return this.assertValidity(),i(h,this,d)}toHex(d=!0){return Ti(this.toRawBytes(d))}}h.BASE=new h(n.Gx,n.Gy,r.ONE),h.ZERO=new h(r.ZERO,r.ONE,r.ZERO);const p=n.nBitLength,b=Z$(h,n.endo?Math.ceil(p/2):p);return{CURVE:n,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:a}}function e6(e){const n=Ow(e);return Bo(n,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...n})}function t6(e){const n=e6(e),{Fp:r,n:i}=n,o=r.BYTES+1,s=2*r.BYTES+1;function a(w){return mn<w&&w<r.ORDER}function u(w){return De(w,i)}function c(w){return zc(w,i)}const{ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:h,isWithinCurveOrder:p}=Q$({...n,toBytes(w,v,$){const _=v.toAffine(),A=r.toBytes(_.x),C=Wr;return $?C(Uint8Array.from([v.hasEvenY()?2:3]),A):C(Uint8Array.from([4]),A,r.toBytes(_.y))},fromBytes(w){const v=w.length,$=w[0],_=w.subarray(1);if(v===o&&($===2||$===3)){const A=at(_);if(!a(A))throw new Error("Point is not on curve");const C=h(A);let N=r.sqrt(C);const j=(N&xt)===xt;return($&1)===1!==j&&(N=r.neg(N)),{x:A,y:N}}else if(v===s&&$===4){const A=r.fromBytes(_.subarray(0,r.BYTES)),C=r.fromBytes(_.subarray(r.BYTES,2*r.BYTES));return{x:A,y:C}}else throw new Error(`Point of length ${v} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),b=w=>Ti(lr(w,n.nByteLength));function y(w){const v=i>>xt;return w>v}function d(w){return y(w)?u(-w):w}const g=(w,v,$)=>at(w.slice(v,$));class m{constructor(v,$,_){this.r=v,this.s=$,this.recovery=_,this.assertValidity()}static fromCompact(v){const $=n.nByteLength;return v=Xe("compactSignature",v,$*2),new m(g(v,0,$),g(v,$,2*$))}static fromDER(v){const{r:$,s:_}=Nr.toSig(Xe("DER",v));return new m($,_)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(v){return new m(this.r,this.s,v)}recoverPublicKey(v){const{r:$,s:_,recovery:A}=this,C=L(Xe("msgHash",v));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");const N=A===2||A===3?$+n.n:$;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const j=A&1?"03":"02",F=l.fromHex(j+b(N)),q=c(N),K=u(-C*q),G=u(_*q),D=l.BASE.multiplyAndAddUnsafe(F,K,G);if(!D)throw new Error("point at infinify");return D.assertValidity(),D}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,u(-this.s),this.recovery):this}toDERRawBytes(){return Pi(this.toDERHex())}toDERHex(){return Nr.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Pi(this.toCompactHex())}toCompactHex(){return b(this.r)+b(this.s)}}const x={isValidPrivateKey(w){try{return f(w),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const w=kw(n.n);return W$(n.randomBytes(w),n.n)},precompute(w=8,v=l.BASE){return v._setWindowSize(w),v.multiply(BigInt(3)),v}};function S(w,v=!0){return l.fromPrivateKey(w).toRawBytes(v)}function O(w){const v=en(w),$=typeof w=="string",_=(v||$)&&w.length;return v?_===o||_===s:$?_===2*o||_===2*s:w instanceof l}function B(w,v,$=!0){if(O(w))throw new Error("first arg must be private key");if(!O(v))throw new Error("second arg must be public key");return l.fromHex(v).multiply(f(w)).toRawBytes($)}const E=n.bits2int||function(w){const v=at(w),$=w.length*8-n.nBitLength;return $>0?v>>BigInt($):v},L=n.bits2int_modN||function(w){return u(E(w))},I=Ff(n.nBitLength);function R(w){if(typeof w!="bigint")throw new Error("bigint expected");if(!(mn<=w&&w<I))throw new Error(`bigint expected < 2^${n.nBitLength}`);return lr(w,n.nByteLength)}function U(w,v,$=k){if(["recovered","canonical"].some(V=>V in $))throw new Error("sign() legacy options not supported");const{hash:_,randomBytes:A}=n;let{lowS:C,prehash:N,extraEntropy:j}=$;C==null&&(C=!0),w=Xe("msgHash",w),N&&(w=Xe("prehashed msgHash",_(w)));const F=L(w),q=f(v),K=[R(q),R(F)];if(j!=null){const V=j===!0?A(r.BYTES):j;K.push(Xe("extraEntropy",V))}const G=Wr(...K),D=F;function Z(V){const ee=E(V);if(!p(ee))return;const ue=c(ee),W=l.BASE.multiply(ee).toAffine(),J=u(W.x);if(J===mn)return;const ce=u(ue*u(D+J*q));if(ce===mn)return;let tt=(W.x===J?0:2)|Number(W.y&xt),nt=ce;return C&&y(ce)&&(nt=d(ce),tt^=1),new m(J,nt,tt)}return{seed:G,k2sig:Z}}const k={lowS:n.lowS,prehash:!1},P={lowS:n.lowS,prehash:!1};function T(w,v,$=k){const{seed:_,k2sig:A}=U(w,v,$),C=n;return $w(C.hash.outputLen,C.nByteLength,C.hmac)(_,A)}l.BASE._setWindowSize(8);function H(w,v,$,_=P){var A;const C=w;if(v=Xe("msgHash",v),$=Xe("publicKey",$),"strict"in _)throw new Error("options.strict was renamed to lowS");const{lowS:N,prehash:j}=_;let F,q;try{if(typeof C=="string"||en(C))try{F=m.fromDER(C)}catch(W){if(!(W instanceof Nr.Err))throw W;F=m.fromCompact(C)}else if(typeof C=="object"&&typeof C.r=="bigint"&&typeof C.s=="bigint"){const{r:W,s:J}=C;F=new m(W,J)}else throw new Error("PARSE");q=l.fromHex($)}catch(W){if(W.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(N&&F.hasHighS())return!1;j&&(v=n.hash(v));const{r:K,s:G}=F,D=L(v),Z=c(G),V=u(D*Z),ee=u(K*Z),ue=(A=l.BASE.multiplyAndAddUnsafe(q,V,ee))==null?void 0:A.toAffine();return ue?u(ue.x)===K:!1}return{CURVE:n,getPublicKey:S,getSharedSecret:B,sign:T,verify:H,ProjectivePoint:l,Signature:m,utils:x}}let Uw=class extends Ew{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,v$(e);const r=Pf(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,o=new Uint8Array(i);o.set(r.length>i?e.create().update(r).digest():r);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=e.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),o.fill(0)}update(e){return Ns(this),this.iHash.update(e),this}digestInto(e){Ns(this),Lw(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:o,blockLen:s,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=o,e.blockLen=s,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const _w=(e,n,r)=>new Uw(e,n).update(r).digest();_w.create=(e,n)=>new Uw(e,n);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function n6(e){return{hash:e,hmac:(n,...r)=>_w(e,n,w$(...r)),randomBytes:xw}}function r6(e,n){const r=i=>t6({...e,...n6(i)});return Object.freeze({...r(n),create:r})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ra=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Hs=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Cw=BigInt(1),js=BigInt(2),zd=(e,n)=>(e+n/js)/n;function Rw(e){const n=Ra,r=BigInt(3),i=BigInt(6),o=BigInt(11),s=BigInt(22),a=BigInt(23),u=BigInt(44),c=BigInt(88),l=e*e*e%n,f=l*l*e%n,h=dt(f,r,n)*f%n,p=dt(h,r,n)*f%n,b=dt(p,js,n)*l%n,y=dt(b,o,n)*b%n,d=dt(y,s,n)*y%n,g=dt(d,u,n)*d%n,m=dt(g,c,n)*g%n,x=dt(m,u,n)*d%n,S=dt(x,r,n)*f%n,O=dt(S,a,n)*y%n,B=dt(O,i,n)*l%n,E=dt(B,js,n);if(!qc.eql(qc.sqr(E),e))throw new Error("Cannot find square root");return E}const qc=V$(Ra,void 0,void 0,{sqrt:Rw}),Mf=r6({a:BigInt(0),b:BigInt(7),Fp:qc,n:Hs,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const n=Hs,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Cw*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,a=BigInt("0x100000000000000000000000000000000"),u=zd(s*e,n),c=zd(-i*e,n);let l=De(e-u*r-c*o,n),f=De(-u*i-c*s,n);const h=l>a,p=f>a;if(h&&(l=n-l),p&&(f=n-f),l>a||f>a)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:p,k2:f}}}},Fc),Ta=BigInt(0),Tw=e=>typeof e=="bigint"&&Ta<e&&e<Ra,i6=e=>typeof e=="bigint"&&Ta<e&&e<Hs,qd={};function Fs(e,...n){let r=qd[e];if(r===void 0){const i=Fc(Uint8Array.from(e,o=>o.charCodeAt(0)));r=Wr(i,i),qd[e]=r}return Fc(Wr(r,...n))}const zf=e=>e.toRawBytes(!0).slice(1),Kc=e=>lr(e,32),zu=e=>De(e,Ra),bo=e=>De(e,Hs),qf=Mf.ProjectivePoint,o6=(e,n,r)=>qf.BASE.multiplyAndAddUnsafe(e,n,r);function Dc(e){let n=Mf.utils.normPrivateKeyToScalar(e),r=qf.fromPrivateKey(n);return{scalar:r.hasEvenY()?n:bo(-n),bytes:zf(r)}}function Pw(e){if(!Tw(e))throw new Error("bad x: need 0 < x < p");const n=zu(e*e),r=zu(n*e+BigInt(7));let i=Rw(r);i%js!==Ta&&(i=zu(-i));const o=new qf(e,i,Cw);return o.assertValidity(),o}function Nw(...e){return bo(at(Fs("BIP0340/challenge",...e)))}function s6(e){return Dc(e).bytes}function a6(e,n,r=xw(32)){const i=Xe("message",e),{bytes:o,scalar:s}=Dc(n),a=Xe("auxRand",r,32),u=Kc(s^at(Fs("BIP0340/aux",a))),c=Fs("BIP0340/nonce",u,o,i),l=bo(at(c));if(l===Ta)throw new Error("sign failed: k is zero");const{bytes:f,scalar:h}=Dc(l),p=Nw(f,o,i),b=new Uint8Array(64);if(b.set(f,0),b.set(Kc(bo(h+p*s)),32),!Hw(b,i,o))throw new Error("sign: Invalid signature produced");return b}function Hw(e,n,r){const i=Xe("signature",e,64),o=Xe("message",n),s=Xe("publicKey",r,32);try{const a=Pw(at(s)),u=at(i.subarray(0,32));if(!Tw(u))return!1;const c=at(i.subarray(32,64));if(!i6(c))return!1;const l=Nw(Kc(u),zf(a),o),f=o6(a,c,bo(-l));return!(!f||!f.hasEvenY()||f.toAffine().x!==u)}catch{return!1}}const jw={getPublicKey:s6,sign:a6,verify:Hw,utils:{randomPrivateKey:Mf.utils.randomPrivateKey,lift_x:Pw,pointToBytes:zf,numberToBytesBE:lr,bytesToNumberBE:at,taggedHash:Fs,mod:De}};function Kd(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Fw(e,...n){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(n.length>0&&!n.includes(e.length))throw new Error(`Expected Uint8Array of length ${n}, not of length=${e.length}`)}function u6(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Kd(e.outputLen),Kd(e.blockLen)}function Ms(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function c6(e,n){Fw(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const qu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Mw=e=>e instanceof Uint8Array,Ku=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Pt=(e,n)=>e<<32-n|e>>>n,l6=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!l6)throw new Error("Non little-endian hardware is not supported");function f6(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Kf(e){if(typeof e=="string"&&(e=f6(e)),!Mw(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function h6(...e){const n=new Uint8Array(e.reduce((i,o)=>i+o.length,0));let r=0;return e.forEach(i=>{if(!Mw(i))throw new Error("Uint8Array expected");n.set(i,r),r+=i.length}),n}let zw=class{clone(){return this._cloneInto()}};function d6(e){const n=i=>e().update(Kf(i)).digest(),r=e();return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=()=>e(),n}function qw(e=32){if(qu&&typeof qu.getRandomValues=="function")return qu.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function p6(e,n,r,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(n,r,i);const o=BigInt(32),s=BigInt(4294967295),a=Number(r>>o&s),u=Number(r&s),c=i?4:0,l=i?0:4;e.setUint32(n+c,a,i),e.setUint32(n+l,u,i)}let g6=class extends zw{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ku(this.buffer)}update(e){Ms(this);const{view:n,buffer:r,blockLen:i}=this;e=Kf(e);const o=e.length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a===i){const u=Ku(e);for(;i<=o-s;s+=i)this.process(u,s);continue}r.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ms(this),c6(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:o}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(r,0),s=0);for(let f=s;f<i;f++)n[f]=0;p6(r,i-8,BigInt(this.length*8),o),this.process(r,0);const a=Ku(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,l[f],o)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%n&&e.buffer.set(r),e}};const y6=(e,n,r)=>e&n^~e&r,w6=(e,n,r)=>e&n^e&r^n&r,m6=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Vn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Wn=new Uint32Array(64);let b6=class extends g6{constructor(){super(64,32,8,!1),this.A=Vn[0]|0,this.B=Vn[1]|0,this.C=Vn[2]|0,this.D=Vn[3]|0,this.E=Vn[4]|0,this.F=Vn[5]|0,this.G=Vn[6]|0,this.H=Vn[7]|0}get(){const{A:e,B:n,C:r,D:i,E:o,F:s,G:a,H:u}=this;return[e,n,r,i,o,s,a,u]}set(e,n,r,i,o,s,a,u){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,n){for(let f=0;f<16;f++,n+=4)Wn[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=Wn[f-15],p=Wn[f-2],b=Pt(h,7)^Pt(h,18)^h>>>3,y=Pt(p,17)^Pt(p,19)^p>>>10;Wn[f]=y+Wn[f-7]+b+Wn[f-16]|0}let{A:r,B:i,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let f=0;f<64;f++){const h=Pt(a,6)^Pt(a,11)^Pt(a,25),p=l+h+y6(a,u,c)+m6[f]+Wn[f]|0,b=(Pt(r,2)^Pt(r,13)^Pt(r,22))+w6(r,i,o)|0;l=c,c=u,u=a,a=s+p|0,s=o,o=i,i=r,r=p+b|0}r=r+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(r,i,o,s,a,u,c,l)}roundClean(){Wn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Vc=d6(()=>new b6);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Kw=BigInt(0),Pa=BigInt(1),v6=BigInt(2),Na=e=>e instanceof Uint8Array,E6=Array.from({length:256},(e,n)=>n.toString(16).padStart(2,"0"));function Ni(e){if(!Na(e))throw new Error("Uint8Array expected");let n="";for(let r=0;r<e.length;r++)n+=E6[e[r]];return n}function Dw(e){const n=e.toString(16);return n.length&1?`0${n}`:n}function Df(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Hi(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const n=e.length;if(n%2)throw new Error("padded hex string expected, got unpadded hex of length "+n);const r=new Uint8Array(n/2);for(let i=0;i<r.length;i++){const o=i*2,s=e.slice(o,o+2),a=Number.parseInt(s,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");r[i]=a}return r}function ut(e){return Df(Ni(e))}function Vf(e){if(!Na(e))throw new Error("Uint8Array expected");return Df(Ni(Uint8Array.from(e).reverse()))}function fr(e,n){return Hi(e.toString(16).padStart(n*2,"0"))}function Wf(e,n){return fr(e,n).reverse()}function x6(e){return Hi(Dw(e))}function Qe(e,n,r){let i;if(typeof n=="string")try{i=Hi(n)}catch(s){throw new Error(`${e} must be valid hex string, got "${n}". Cause: ${s}`)}else if(Na(n))i=Uint8Array.from(n);else throw new Error(`${e} must be hex string or Uint8Array`);const o=i.length;if(typeof r=="number"&&o!==r)throw new Error(`${e} expected ${r} bytes, got ${o}`);return i}function Gr(...e){const n=new Uint8Array(e.reduce((i,o)=>i+o.length,0));let r=0;return e.forEach(i=>{if(!Na(i))throw new Error("Uint8Array expected");n.set(i,r),r+=i.length}),n}function L6(e,n){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}function A6(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function S6(e){let n;for(n=0;e>Kw;e>>=Pa,n+=1);return n}function $6(e,n){return e>>BigInt(n)&Pa}const I6=(e,n,r)=>e|(r?Pa:Kw)<<BigInt(n),Gf=e=>(v6<<BigInt(e-1))-Pa,Du=e=>new Uint8Array(e),Dd=e=>Uint8Array.from(e);function Vw(e,n,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof n!="number"||n<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=Du(e),o=Du(e),s=0;const a=()=>{i.fill(1),o.fill(0),s=0},u=(...f)=>r(o,i,...f),c=(f=Du())=>{o=u(Dd([0]),f),i=u(),f.length!==0&&(o=u(Dd([1]),f),i=u())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<n;){i=u();const p=i.slice();h.push(p),f+=i.length}return Gr(...h)};return(f,h)=>{a(),c(f);let p;for(;!(p=h(l()));)c();return a(),p}}const B6={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,n)=>n.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function ko(e,n,r={}){const i=(o,s,a)=>{const u=B6[s];if(typeof u!="function")throw new Error(`Invalid validator "${s}", expected function`);const c=e[o];if(!(a&&c===void 0)&&!u(c,e))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(const[o,s]of Object.entries(n))i(o,s,!1);for(const[o,s]of Object.entries(r))i(o,s,!0);return e}const k6=Object.freeze(Object.defineProperty({__proto__:null,bitGet:$6,bitLen:S6,bitMask:Gf,bitSet:I6,bytesToHex:Ni,bytesToNumberBE:ut,bytesToNumberLE:Vf,concatBytes:Gr,createHmacDrbg:Vw,ensureBytes:Qe,equalBytes:L6,hexToBytes:Hi,hexToNumber:Df,numberToBytesBE:fr,numberToBytesLE:Wf,numberToHexUnpadded:Dw,numberToVarBytesBE:x6,utf8ToBytes:A6,validateObject:ko},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Re=BigInt(0),ye=BigInt(1),Ur=BigInt(2),O6=BigInt(3),Wc=BigInt(4),Vd=BigInt(5),Wd=BigInt(8);BigInt(9);BigInt(16);function Ve(e,n){const r=e%n;return r>=Re?r:n+r}function U6(e,n,r){if(r<=Re||n<Re)throw new Error("Expected power/modulo > 0");if(r===ye)return Re;let i=ye;for(;n>Re;)n&ye&&(i=i*e%r),e=e*e%r,n>>=ye;return i}function pt(e,n,r){let i=e;for(;n-- >Re;)i*=i,i%=r;return i}function Gc(e,n){if(e===Re||n<=Re)throw new Error(`invert: expected positive integers, got n=${e} mod=${n}`);let r=Ve(e,n),i=n,o=Re,s=ye;for(;r!==Re;){const a=i/r,u=i%r,c=o-s*a;i=r,r=u,o=s,s=c}if(i!==ye)throw new Error("invert: does not exist");return Ve(o,n)}function _6(e){const n=(e-ye)/Ur;let r,i,o;for(r=e-ye,i=0;r%Ur===Re;r/=Ur,i++);for(o=Ur;o<e&&U6(o,n,e)!==e-ye;o++);if(i===1){const a=(e+ye)/Wc;return function(u,c){const l=u.pow(c,a);if(!u.eql(u.sqr(l),c))throw new Error("Cannot find square root");return l}}const s=(r+ye)/Ur;return function(a,u){if(a.pow(u,n)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,l=a.pow(a.mul(a.ONE,o),r),f=a.pow(u,s),h=a.pow(u,r);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let p=1;for(let y=a.sqr(h);p<c&&!a.eql(y,a.ONE);p++)y=a.sqr(y);const b=a.pow(l,ye<<BigInt(c-p-1));l=a.sqr(b),f=a.mul(f,b),h=a.mul(h,l),c=p}return f}}function C6(e){if(e%Wc===O6){const n=(e+ye)/Wc;return function(r,i){const o=r.pow(i,n);if(!r.eql(r.sqr(o),i))throw new Error("Cannot find square root");return o}}if(e%Wd===Vd){const n=(e-Vd)/Wd;return function(r,i){const o=r.mul(i,Ur),s=r.pow(o,n),a=r.mul(i,s),u=r.mul(r.mul(a,Ur),s),c=r.mul(a,r.sub(u,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return _6(e)}const R6=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function T6(e){const n={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=R6.reduce((i,o)=>(i[o]="function",i),n);return ko(e,r)}function P6(e,n,r){if(r<Re)throw new Error("Expected power > 0");if(r===Re)return e.ONE;if(r===ye)return n;let i=e.ONE,o=n;for(;r>Re;)r&ye&&(i=e.mul(i,o)),o=e.sqr(o),r>>=ye;return i}function N6(e,n){const r=new Array(n.length),i=n.reduce((s,a,u)=>e.is0(a)?s:(r[u]=s,e.mul(s,a)),e.ONE),o=e.inv(i);return n.reduceRight((s,a,u)=>e.is0(a)?s:(r[u]=e.mul(s,r[u]),e.mul(s,a)),o),r}function Ww(e,n){const r=n!==void 0?n:e.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function H6(e,n,r=!1,i={}){if(e<=Re)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:s}=Ww(e,n);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const a=C6(e),u=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:Gf(o),ZERO:Re,ONE:ye,create:c=>Ve(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return Re<=c&&c<e},is0:c=>c===Re,isOdd:c=>(c&ye)===ye,neg:c=>Ve(-c,e),eql:(c,l)=>c===l,sqr:c=>Ve(c*c,e),add:(c,l)=>Ve(c+l,e),sub:(c,l)=>Ve(c-l,e),mul:(c,l)=>Ve(c*l,e),pow:(c,l)=>P6(u,c,l),div:(c,l)=>Ve(c*Gc(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Gc(c,e),sqrt:i.sqrt||(c=>a(u,c)),invertBatch:c=>N6(u,c),cmov:(c,l,f)=>f?l:c,toBytes:c=>r?Wf(c,s):fr(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return r?Vf(c):ut(c)}});return Object.freeze(u)}function Gw(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const n=e.toString(2).length;return Math.ceil(n/8)}function Zw(e){const n=Gw(e);return n+Math.ceil(n/2)}function j6(e,n,r=!1){const i=e.length,o=Gw(n),s=Zw(n);if(i<16||i<s||i>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${i}`);const a=r?ut(e):Vf(e),u=Ve(a,n-ye)+ye;return r?Wf(u,o):fr(u,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const F6=BigInt(0),Vu=BigInt(1);function M6(e,n){const r=(o,s)=>{const a=s.negate();return o?a:s},i=o=>{const s=Math.ceil(n/o)+1,a=2**(o-1);return{windows:s,windowSize:a}};return{constTimeNegate:r,unsafeLadder(o,s){let a=e.ZERO,u=o;for(;s>F6;)s&Vu&&(a=a.add(u)),u=u.double(),s>>=Vu;return a},precomputeWindow(o,s){const{windows:a,windowSize:u}=i(s),c=[];let l=o,f=l;for(let h=0;h<a;h++){f=l,c.push(f);for(let p=1;p<u;p++)f=f.add(l),c.push(f);l=f.double()}return c},wNAF(o,s,a){const{windows:u,windowSize:c}=i(o);let l=e.ZERO,f=e.BASE;const h=BigInt(2**o-1),p=2**o,b=BigInt(o);for(let y=0;y<u;y++){const d=y*c;let g=Number(a&h);a>>=b,g>c&&(g-=p,a+=Vu);const m=d,x=d+Math.abs(g)-1,S=y%2!==0,O=g<0;g===0?f=f.add(r(S,s[m])):l=l.add(r(O,s[x]))}return{p:l,f}},wNAFCached(o,s,a,u){const c=o._WINDOW_SIZE||1;let l=s.get(o);return l||(l=this.precomputeWindow(o,c),c!==1&&s.set(o,u(l))),this.wNAF(c,l,a)}}}function Jw(e){return T6(e.Fp),ko(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Ww(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function z6(e){const n=Jw(e);ko(n,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:i,a:o}=n;if(r){if(!i.eql(o,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...n})}const{bytesToNumberBE:q6,hexToBytes:K6}=k6,Hr={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:n}=Hr;if(e.length<2||e[0]!==2)throw new n("Invalid signature integer tag");const r=e[1],i=e.subarray(2,r+2);if(!r||i.length!==r)throw new n("Invalid signature integer: wrong length");if(i[0]&128)throw new n("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new n("Invalid signature integer: unnecessary leading zero");return{d:q6(i),l:e.subarray(r+2)}},toSig(e){const{Err:n}=Hr,r=typeof e=="string"?K6(e):e;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let i=r.length;if(i<2||r[0]!=48)throw new n("Invalid signature tag");if(r[1]!==i-2)throw new n("Invalid signature: incorrect length");const{d:o,l:s}=Hr._parseInt(r.subarray(2)),{d:a,l:u}=Hr._parseInt(s);if(u.length)throw new n("Invalid signature: left bytes after parsing");return{r:o,s:a}},hexFromSig(e){const n=l=>Number.parseInt(l[0],16)&8?"00"+l:l,r=l=>{const f=l.toString(16);return f.length&1?`0${f}`:f},i=n(r(e.s)),o=n(r(e.r)),s=i.length/2,a=o.length/2,u=r(s),c=r(a);return`30${r(a+s+4)}02${c}${o}02${u}${i}`}},bn=BigInt(0),Lt=BigInt(1);BigInt(2);const Gd=BigInt(3);BigInt(4);function D6(e){const n=z6(e),{Fp:r}=n,i=n.toBytes||((y,d,g)=>{const m=d.toAffine();return Gr(Uint8Array.from([4]),r.toBytes(m.x),r.toBytes(m.y))}),o=n.fromBytes||(y=>{const d=y.subarray(1),g=r.fromBytes(d.subarray(0,r.BYTES)),m=r.fromBytes(d.subarray(r.BYTES,2*r.BYTES));return{x:g,y:m}});function s(y){const{a:d,b:g}=n,m=r.sqr(y),x=r.mul(m,y);return r.add(r.add(x,r.mul(y,d)),g)}if(!r.eql(r.sqr(n.Gy),s(n.Gx)))throw new Error("bad generator point: equation left != right");function a(y){return typeof y=="bigint"&&bn<y&&y<n.n}function u(y){if(!a(y))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(y){const{allowedPrivateKeyLengths:d,nByteLength:g,wrapPrivateKey:m,n:x}=n;if(d&&typeof y!="bigint"){if(y instanceof Uint8Array&&(y=Ni(y)),typeof y!="string"||!d.includes(y.length))throw new Error("Invalid key");y=y.padStart(g*2,"0")}let S;try{S=typeof y=="bigint"?y:ut(Qe("private key",y,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof y}`)}return m&&(S=Ve(S,x)),u(S),S}const l=new Map;function f(y){if(!(y instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(d,g,m){if(this.px=d,this.py=g,this.pz=m,d==null||!r.isValid(d))throw new Error("x required");if(g==null||!r.isValid(g))throw new Error("y required");if(m==null||!r.isValid(m))throw new Error("z required")}static fromAffine(d){const{x:g,y:m}=d||{};if(!d||!r.isValid(g)||!r.isValid(m))throw new Error("invalid affine point");if(d instanceof h)throw new Error("projective point not allowed");const x=S=>r.eql(S,r.ZERO);return x(g)&&x(m)?h.ZERO:new h(g,m,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const g=r.invertBatch(d.map(m=>m.pz));return d.map((m,x)=>m.toAffine(g[x])).map(h.fromAffine)}static fromHex(d){const g=h.fromAffine(o(Qe("pointHex",d)));return g.assertValidity(),g}static fromPrivateKey(d){return h.BASE.multiply(c(d))}_setWindowSize(d){this._WINDOW_SIZE=d,l.delete(this)}assertValidity(){if(this.is0()){if(n.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:d,y:g}=this.toAffine();if(!r.isValid(d)||!r.isValid(g))throw new Error("bad point: x or y not FE");const m=r.sqr(g),x=s(d);if(!r.eql(m,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:d}=this.toAffine();if(r.isOdd)return!r.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){f(d);const{px:g,py:m,pz:x}=this,{px:S,py:O,pz:B}=d,E=r.eql(r.mul(g,B),r.mul(S,x)),L=r.eql(r.mul(m,B),r.mul(O,x));return E&&L}negate(){return new h(this.px,r.neg(this.py),this.pz)}double(){const{a:d,b:g}=n,m=r.mul(g,Gd),{px:x,py:S,pz:O}=this;let B=r.ZERO,E=r.ZERO,L=r.ZERO,I=r.mul(x,x),R=r.mul(S,S),U=r.mul(O,O),k=r.mul(x,S);return k=r.add(k,k),L=r.mul(x,O),L=r.add(L,L),B=r.mul(d,L),E=r.mul(m,U),E=r.add(B,E),B=r.sub(R,E),E=r.add(R,E),E=r.mul(B,E),B=r.mul(k,B),L=r.mul(m,L),U=r.mul(d,U),k=r.sub(I,U),k=r.mul(d,k),k=r.add(k,L),L=r.add(I,I),I=r.add(L,I),I=r.add(I,U),I=r.mul(I,k),E=r.add(E,I),U=r.mul(S,O),U=r.add(U,U),I=r.mul(U,k),B=r.sub(B,I),L=r.mul(U,R),L=r.add(L,L),L=r.add(L,L),new h(B,E,L)}add(d){f(d);const{px:g,py:m,pz:x}=this,{px:S,py:O,pz:B}=d;let E=r.ZERO,L=r.ZERO,I=r.ZERO;const R=n.a,U=r.mul(n.b,Gd);let k=r.mul(g,S),P=r.mul(m,O),T=r.mul(x,B),H=r.add(g,m),w=r.add(S,O);H=r.mul(H,w),w=r.add(k,P),H=r.sub(H,w),w=r.add(g,x);let v=r.add(S,B);return w=r.mul(w,v),v=r.add(k,T),w=r.sub(w,v),v=r.add(m,x),E=r.add(O,B),v=r.mul(v,E),E=r.add(P,T),v=r.sub(v,E),I=r.mul(R,w),E=r.mul(U,T),I=r.add(E,I),E=r.sub(P,I),I=r.add(P,I),L=r.mul(E,I),P=r.add(k,k),P=r.add(P,k),T=r.mul(R,T),w=r.mul(U,w),P=r.add(P,T),T=r.sub(k,T),T=r.mul(R,T),w=r.add(w,T),k=r.mul(P,w),L=r.add(L,k),k=r.mul(v,w),E=r.mul(H,E),E=r.sub(E,k),k=r.mul(H,P),I=r.mul(v,I),I=r.add(I,k),new h(E,L,I)}subtract(d){return this.add(d.negate())}is0(){return this.equals(h.ZERO)}wNAF(d){return b.wNAFCached(this,l,d,g=>{const m=r.invertBatch(g.map(x=>x.pz));return g.map((x,S)=>x.toAffine(m[S])).map(h.fromAffine)})}multiplyUnsafe(d){const g=h.ZERO;if(d===bn)return g;if(u(d),d===Lt)return this;const{endo:m}=n;if(!m)return b.unsafeLadder(this,d);let{k1neg:x,k1:S,k2neg:O,k2:B}=m.splitScalar(d),E=g,L=g,I=this;for(;S>bn||B>bn;)S&Lt&&(E=E.add(I)),B&Lt&&(L=L.add(I)),I=I.double(),S>>=Lt,B>>=Lt;return x&&(E=E.negate()),O&&(L=L.negate()),L=new h(r.mul(L.px,m.beta),L.py,L.pz),E.add(L)}multiply(d){u(d);let g=d,m,x;const{endo:S}=n;if(S){const{k1neg:O,k1:B,k2neg:E,k2:L}=S.splitScalar(g);let{p:I,f:R}=this.wNAF(B),{p:U,f:k}=this.wNAF(L);I=b.constTimeNegate(O,I),U=b.constTimeNegate(E,U),U=new h(r.mul(U.px,S.beta),U.py,U.pz),m=I.add(U),x=R.add(k)}else{const{p:O,f:B}=this.wNAF(g);m=O,x=B}return h.normalizeZ([m,x])[0]}multiplyAndAddUnsafe(d,g,m){const x=h.BASE,S=(B,E)=>E===bn||E===Lt||!B.equals(x)?B.multiplyUnsafe(E):B.multiply(E),O=S(this,g).add(S(d,m));return O.is0()?void 0:O}toAffine(d){const{px:g,py:m,pz:x}=this,S=this.is0();d==null&&(d=S?r.ONE:r.inv(x));const O=r.mul(g,d),B=r.mul(m,d),E=r.mul(x,d);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(E,r.ONE))throw new Error("invZ was invalid");return{x:O,y:B}}isTorsionFree(){const{h:d,isTorsionFree:g}=n;if(d===Lt)return!0;if(g)return g(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:g}=n;return d===Lt?this:g?g(h,this):this.multiplyUnsafe(n.h)}toRawBytes(d=!0){return this.assertValidity(),i(h,this,d)}toHex(d=!0){return Ni(this.toRawBytes(d))}}h.BASE=new h(n.Gx,n.Gy,r.ONE),h.ZERO=new h(r.ZERO,r.ONE,r.ZERO);const p=n.nBitLength,b=M6(h,n.endo?Math.ceil(p/2):p);return{CURVE:n,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:a}}function V6(e){const n=Jw(e);return ko(n,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...n})}function W6(e){const n=V6(e),{Fp:r,n:i}=n,o=r.BYTES+1,s=2*r.BYTES+1;function a(w){return bn<w&&w<r.ORDER}function u(w){return Ve(w,i)}function c(w){return Gc(w,i)}const{ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:h,isWithinCurveOrder:p}=D6({...n,toBytes(w,v,$){const _=v.toAffine(),A=r.toBytes(_.x),C=Gr;return $?C(Uint8Array.from([v.hasEvenY()?2:3]),A):C(Uint8Array.from([4]),A,r.toBytes(_.y))},fromBytes(w){const v=w.length,$=w[0],_=w.subarray(1);if(v===o&&($===2||$===3)){const A=ut(_);if(!a(A))throw new Error("Point is not on curve");const C=h(A);let N=r.sqrt(C);const j=(N&Lt)===Lt;return($&1)===1!==j&&(N=r.neg(N)),{x:A,y:N}}else if(v===s&&$===4){const A=r.fromBytes(_.subarray(0,r.BYTES)),C=r.fromBytes(_.subarray(r.BYTES,2*r.BYTES));return{x:A,y:C}}else throw new Error(`Point of length ${v} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),b=w=>Ni(fr(w,n.nByteLength));function y(w){const v=i>>Lt;return w>v}function d(w){return y(w)?u(-w):w}const g=(w,v,$)=>ut(w.slice(v,$));class m{constructor(v,$,_){this.r=v,this.s=$,this.recovery=_,this.assertValidity()}static fromCompact(v){const $=n.nByteLength;return v=Qe("compactSignature",v,$*2),new m(g(v,0,$),g(v,$,2*$))}static fromDER(v){const{r:$,s:_}=Hr.toSig(Qe("DER",v));return new m($,_)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(v){return new m(this.r,this.s,v)}recoverPublicKey(v){const{r:$,s:_,recovery:A}=this,C=L(Qe("msgHash",v));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");const N=A===2||A===3?$+n.n:$;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const j=A&1?"03":"02",F=l.fromHex(j+b(N)),q=c(N),K=u(-C*q),G=u(_*q),D=l.BASE.multiplyAndAddUnsafe(F,K,G);if(!D)throw new Error("point at infinify");return D.assertValidity(),D}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,u(-this.s),this.recovery):this}toDERRawBytes(){return Hi(this.toDERHex())}toDERHex(){return Hr.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Hi(this.toCompactHex())}toCompactHex(){return b(this.r)+b(this.s)}}const x={isValidPrivateKey(w){try{return f(w),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const w=Zw(n.n);return j6(n.randomBytes(w),n.n)},precompute(w=8,v=l.BASE){return v._setWindowSize(w),v.multiply(BigInt(3)),v}};function S(w,v=!0){return l.fromPrivateKey(w).toRawBytes(v)}function O(w){const v=w instanceof Uint8Array,$=typeof w=="string",_=(v||$)&&w.length;return v?_===o||_===s:$?_===2*o||_===2*s:w instanceof l}function B(w,v,$=!0){if(O(w))throw new Error("first arg must be private key");if(!O(v))throw new Error("second arg must be public key");return l.fromHex(v).multiply(f(w)).toRawBytes($)}const E=n.bits2int||function(w){const v=ut(w),$=w.length*8-n.nBitLength;return $>0?v>>BigInt($):v},L=n.bits2int_modN||function(w){return u(E(w))},I=Gf(n.nBitLength);function R(w){if(typeof w!="bigint")throw new Error("bigint expected");if(!(bn<=w&&w<I))throw new Error(`bigint expected < 2^${n.nBitLength}`);return fr(w,n.nByteLength)}function U(w,v,$=k){if(["recovered","canonical"].some(V=>V in $))throw new Error("sign() legacy options not supported");const{hash:_,randomBytes:A}=n;let{lowS:C,prehash:N,extraEntropy:j}=$;C==null&&(C=!0),w=Qe("msgHash",w),N&&(w=Qe("prehashed msgHash",_(w)));const F=L(w),q=f(v),K=[R(q),R(F)];if(j!=null){const V=j===!0?A(r.BYTES):j;K.push(Qe("extraEntropy",V))}const G=Gr(...K),D=F;function Z(V){const ee=E(V);if(!p(ee))return;const ue=c(ee),W=l.BASE.multiply(ee).toAffine(),J=u(W.x);if(J===bn)return;const ce=u(ue*u(D+J*q));if(ce===bn)return;let tt=(W.x===J?0:2)|Number(W.y&Lt),nt=ce;return C&&y(ce)&&(nt=d(ce),tt^=1),new m(J,nt,tt)}return{seed:G,k2sig:Z}}const k={lowS:n.lowS,prehash:!1},P={lowS:n.lowS,prehash:!1};function T(w,v,$=k){const{seed:_,k2sig:A}=U(w,v,$),C=n;return Vw(C.hash.outputLen,C.nByteLength,C.hmac)(_,A)}l.BASE._setWindowSize(8);function H(w,v,$,_=P){var A;const C=w;if(v=Qe("msgHash",v),$=Qe("publicKey",$),"strict"in _)throw new Error("options.strict was renamed to lowS");const{lowS:N,prehash:j}=_;let F,q;try{if(typeof C=="string"||C instanceof Uint8Array)try{F=m.fromDER(C)}catch(W){if(!(W instanceof Hr.Err))throw W;F=m.fromCompact(C)}else if(typeof C=="object"&&typeof C.r=="bigint"&&typeof C.s=="bigint"){const{r:W,s:J}=C;F=new m(W,J)}else throw new Error("PARSE");q=l.fromHex($)}catch(W){if(W.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(N&&F.hasHighS())return!1;j&&(v=n.hash(v));const{r:K,s:G}=F,D=L(v),Z=c(G),V=u(D*Z),ee=u(K*Z),ue=(A=l.BASE.multiplyAndAddUnsafe(q,V,ee))==null?void 0:A.toAffine();return ue?u(ue.x)===K:!1}return{CURVE:n,getPublicKey:S,getSharedSecret:B,sign:T,verify:H,ProjectivePoint:l,Signature:m,utils:x}}let Yw=class extends zw{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,u6(e);const r=Kf(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,o=new Uint8Array(i);o.set(r.length>i?e.create().update(r).digest():r);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=e.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),o.fill(0)}update(e){return Ms(this),this.iHash.update(e),this}digestInto(e){Ms(this),Fw(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:o,blockLen:s,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=o,e.blockLen=s,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Xw=(e,n,r)=>new Yw(e,n).update(r).digest();Xw.create=(e,n)=>new Yw(e,n);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function G6(e){return{hash:e,hmac:(n,...r)=>Xw(e,n,h6(...r)),randomBytes:qw}}function Z6(e,n){const r=i=>W6({...e,...G6(i)});return Object.freeze({...r(n),create:r})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ha=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),zs=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Qw=BigInt(1),qs=BigInt(2),Zd=(e,n)=>(e+n/qs)/n;function e1(e){const n=Ha,r=BigInt(3),i=BigInt(6),o=BigInt(11),s=BigInt(22),a=BigInt(23),u=BigInt(44),c=BigInt(88),l=e*e*e%n,f=l*l*e%n,h=pt(f,r,n)*f%n,p=pt(h,r,n)*f%n,b=pt(p,qs,n)*l%n,y=pt(b,o,n)*b%n,d=pt(y,s,n)*y%n,g=pt(d,u,n)*d%n,m=pt(g,c,n)*g%n,x=pt(m,u,n)*d%n,S=pt(x,r,n)*f%n,O=pt(S,a,n)*y%n,B=pt(O,i,n)*l%n,E=pt(B,qs,n);if(!Zc.eql(Zc.sqr(E),e))throw new Error("Cannot find square root");return E}const Zc=H6(Ha,void 0,void 0,{sqrt:e1}),Wi=Z6({a:BigInt(0),b:BigInt(7),Fp:Zc,n:zs,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const n=zs,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Qw*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,a=BigInt("0x100000000000000000000000000000000"),u=Zd(s*e,n),c=Zd(-i*e,n);let l=Ve(e-u*r-c*o,n),f=Ve(-u*i-c*s,n);const h=l>a,p=f>a;if(h&&(l=n-l),p&&(f=n-f),l>a||f>a)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:p,k2:f}}}},Vc),ja=BigInt(0),t1=e=>typeof e=="bigint"&&ja<e&&e<Ha,J6=e=>typeof e=="bigint"&&ja<e&&e<zs,Jd={};function Ks(e,...n){let r=Jd[e];if(r===void 0){const i=Vc(Uint8Array.from(e,o=>o.charCodeAt(0)));r=Gr(i,i),Jd[e]=r}return Vc(Gr(r,...n))}const Zf=e=>e.toRawBytes(!0).slice(1),Jc=e=>fr(e,32),Wu=e=>Ve(e,Ha),vo=e=>Ve(e,zs),Jf=Wi.ProjectivePoint,Y6=(e,n,r)=>Jf.BASE.multiplyAndAddUnsafe(e,n,r);function Yc(e){let n=Wi.utils.normPrivateKeyToScalar(e),r=Jf.fromPrivateKey(n);return{scalar:r.hasEvenY()?n:vo(-n),bytes:Zf(r)}}function n1(e){if(!t1(e))throw new Error("bad x: need 0 < x < p");const n=Wu(e*e),r=Wu(n*e+BigInt(7));let i=e1(r);i%qs!==ja&&(i=Wu(-i));const o=new Jf(e,i,Qw);return o.assertValidity(),o}function r1(...e){return vo(ut(Ks("BIP0340/challenge",...e)))}function X6(e){return Yc(e).bytes}function Q6(e,n,r=qw(32)){const i=Qe("message",e),{bytes:o,scalar:s}=Yc(n),a=Qe("auxRand",r,32),u=Jc(s^ut(Ks("BIP0340/aux",a))),c=Ks("BIP0340/nonce",u,o,i),l=vo(ut(c));if(l===ja)throw new Error("sign failed: k is zero");const{bytes:f,scalar:h}=Yc(l),p=r1(f,o,i),b=new Uint8Array(64);if(b.set(f,0),b.set(Jc(vo(h+p*s)),32),!i1(b,i,o))throw new Error("sign: Invalid signature produced");return b}function i1(e,n,r){const i=Qe("signature",e,64),o=Qe("message",n),s=Qe("publicKey",r,32);try{const a=n1(ut(s)),u=ut(i.subarray(0,32));if(!t1(u))return!1;const c=ut(i.subarray(32,64));if(!J6(c))return!1;const l=r1(Jc(u),Zf(a),o),f=Y6(a,c,vo(-l));return!(!f||!f.hasEvenY()||f.toAffine().x!==u)}catch{return!1}}const zt={getPublicKey:X6,sign:Q6,verify:i1,utils:{randomPrivateKey:Wi.utils.randomPrivateKey,lift_x:n1,pointToBytes:Zf,numberToBytesBE:fr,bytesToNumberBE:ut,taggedHash:Ks,mod:Ve}},Gu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Yf=e=>e instanceof Uint8Array,Zu=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Nt=(e,n)=>e<<32-n|e>>>n,eI=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!eI)throw new Error("Non little-endian hardware is not supported");const tI=Array.from({length:256},(e,n)=>n.toString(16).padStart(2,"0"));function ke(e){if(!Yf(e))throw new Error("Uint8Array expected");let n="";for(let r=0;r<e.length;r++)n+=tI[e[r]];return n}function ji(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const n=e.length;if(n%2)throw new Error("padded hex string expected, got unpadded hex of length "+n);const r=new Uint8Array(n/2);for(let i=0;i<r.length;i++){const o=i*2,s=e.slice(o,o+2),a=Number.parseInt(s,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");r[i]=a}return r}function o1(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Eo(e){if(typeof e=="string"&&(e=o1(e)),!Yf(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Ds(...e){const n=new Uint8Array(e.reduce((i,o)=>i+o.length,0));let r=0;return e.forEach(i=>{if(!Yf(i))throw new Error("Uint8Array expected");n.set(i,r),r+=i.length}),n}class s1{clone(){return this._cloneInto()}}function a1(e){const n=i=>e().update(Eo(i)).digest(),r=e();return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=()=>e(),n}function u1(e=32){if(Gu&&typeof Gu.getRandomValues=="function")return Gu.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Xc(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function nI(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function c1(e,...n){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(n.length>0&&!n.includes(e.length))throw new Error(`Expected Uint8Array of length ${n}, not of length=${e.length}`)}function rI(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Xc(e.outputLen),Xc(e.blockLen)}function iI(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function oI(e,n){c1(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const Zt={number:Xc,bool:nI,bytes:c1,hash:rI,exists:iI,output:oI};function sI(e,n,r,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(n,r,i);const o=BigInt(32),s=BigInt(4294967295),a=Number(r>>o&s),u=Number(r&s),c=i?4:0,l=i?0:4;e.setUint32(n+c,a,i),e.setUint32(n+l,u,i)}class aI extends s1{constructor(n,r,i,o){super(),this.blockLen=n,this.outputLen=r,this.padOffset=i,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(n),this.view=Zu(this.buffer)}update(n){Zt.exists(this);const{view:r,buffer:i,blockLen:o}=this;n=Eo(n);const s=n.length;for(let a=0;a<s;){const u=Math.min(o-this.pos,s-a);if(u===o){const c=Zu(n);for(;o<=s-a;a+=o)this.process(c,a);continue}i.set(n.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=n.length,this.roundClean(),this}digestInto(n){Zt.exists(this),Zt.output(n,this),this.finished=!0;const{buffer:r,view:i,blockLen:o,isLE:s}=this;let{pos:a}=this;r[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(i,0),a=0);for(let h=a;h<o;h++)r[h]=0;sI(i,o-8,BigInt(this.length*8),s),this.process(i,0);const u=Zu(n),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)u.setUint32(4*h,f[h],s)}digest(){const{buffer:n,outputLen:r}=this;this.digestInto(n);const i=n.slice(0,r);return this.destroy(),i}_cloneInto(n){n||(n=new this.constructor),n.set(...this.get());const{blockLen:r,buffer:i,length:o,finished:s,destroyed:a,pos:u}=this;return n.length=o,n.pos=u,n.finished=s,n.destroyed=a,o%r&&n.buffer.set(i),n}}const uI=(e,n,r)=>e&n^~e&r,cI=(e,n,r)=>e&n^e&r^n&r,lI=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Gn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Zn=new Uint32Array(64);class l1 extends aI{constructor(){super(64,32,8,!1),this.A=Gn[0]|0,this.B=Gn[1]|0,this.C=Gn[2]|0,this.D=Gn[3]|0,this.E=Gn[4]|0,this.F=Gn[5]|0,this.G=Gn[6]|0,this.H=Gn[7]|0}get(){const{A:n,B:r,C:i,D:o,E:s,F:a,G:u,H:c}=this;return[n,r,i,o,s,a,u,c]}set(n,r,i,o,s,a,u,c){this.A=n|0,this.B=r|0,this.C=i|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=u|0,this.H=c|0}process(n,r){for(let h=0;h<16;h++,r+=4)Zn[h]=n.getUint32(r,!1);for(let h=16;h<64;h++){const p=Zn[h-15],b=Zn[h-2],y=Nt(p,7)^Nt(p,18)^p>>>3,d=Nt(b,17)^Nt(b,19)^b>>>10;Zn[h]=d+Zn[h-7]+y+Zn[h-16]|0}let{A:i,B:o,C:s,D:a,E:u,F:c,G:l,H:f}=this;for(let h=0;h<64;h++){const p=Nt(u,6)^Nt(u,11)^Nt(u,25),b=f+p+uI(u,c,l)+lI[h]+Zn[h]|0,y=(Nt(i,2)^Nt(i,13)^Nt(i,22))+cI(i,o,s)|0;f=l,l=c,c=u,u=a+b|0,a=s,s=o,o=i,i=b+y|0}i=i+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,u=u+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(i,o,s,a,u,c,l,f)}roundClean(){Zn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class fI extends l1{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const wi=a1(()=>new l1);a1(()=>new fI);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Gi(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function On(...e){const n=(o,s)=>a=>o(s(a)),r=Array.from(e).reverse().reduce((o,s)=>o?n(o,s.encode):s.encode,void 0),i=e.reduce((o,s)=>o?n(o,s.decode):s.decode,void 0);return{encode:r,decode:i}}function Un(e){return{encode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return n.map(r=>{if(Gi(r),r<0||r>=e.length)throw new Error(`Digit index outside alphabet: ${r} (alphabet: ${e.length})`);return e[r]})},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("alphabet.decode input should be array of strings");return n.map(r=>{if(typeof r!="string")throw new Error(`alphabet.decode: not string element=${r}`);const i=e.indexOf(r);if(i===-1)throw new Error(`Unknown letter: "${r}". Allowed: ${e}`);return i})}}}function _n(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("join.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`join.encode: non-string input=${r}`);return n.join(e)},decode:n=>{if(typeof n!="string")throw new Error("join.decode input should be string");return n.split(e)}}}function Fa(e,n="="){if(Gi(e),typeof n!="string")throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of r)if(typeof i!="string")throw new Error(`padding.encode: non-string input=${i}`);for(;r.length*e%8;)r.push(n);return r},decode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of r)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let i=r.length;if(i*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;i>0&&r[i-1]===n;i--)if(!((i-1)*e%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,i)}}}function f1(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:n=>n,decode:n=>e(n)}}function Yd(e,n,r){if(n<2)throw new Error(`convertRadix: wrong from=${n}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let i=0;const o=[],s=Array.from(e);for(s.forEach(a=>{if(Gi(a),a<0||a>=n)throw new Error(`Wrong integer: ${a}`)});;){let a=0,u=!0;for(let c=i;c<s.length;c++){const l=s[c],f=n*a+l;if(!Number.isSafeInteger(f)||n*a/n!==a||f-l!==n*a)throw new Error("convertRadix: carry overflow");if(a=f%r,s[c]=Math.floor(f/r),!Number.isSafeInteger(s[c])||s[c]*r+a!==f)throw new Error("convertRadix: carry overflow");if(u)s[c]?u=!1:i=c;else continue}if(o.push(a),u)break}for(let a=0;a<e.length-1&&e[a]===0;a++)o.push(0);return o.reverse()}const h1=(e,n)=>n?h1(n,e%n):e,Vs=(e,n)=>e+(n-h1(e,n));function Qc(e,n,r,i){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(n<=0||n>32)throw new Error(`convertRadix2: wrong from=${n}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Vs(n,r)>32)throw new Error(`convertRadix2: carry overflow from=${n} to=${r} carryBits=${Vs(n,r)}`);let o=0,s=0;const a=2**r-1,u=[];for(const c of e){if(Gi(c),c>=2**n)throw new Error(`convertRadix2: invalid data word=${c} from=${n}`);if(o=o<<n|c,s+n>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${n}`);for(s+=n;s>=r;s-=r)u.push((o>>s-r&a)>>>0);o&=2**s-1}if(o=o<<r-s&a,!i&&s>=n)throw new Error("Excess padding");if(!i&&o)throw new Error(`Non-zero padding: ${o}`);return i&&s>0&&u.push(o>>>0),u}function hI(e){return Gi(e),{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Yd(Array.from(n),2**8,e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Yd(n,e,2**8))}}}function vr(e,n=!1){if(Gi(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Vs(8,e)>32||Vs(e,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Qc(Array.from(r),8,e,!n)},decode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Qc(r,e,8,n))}}}function Xd(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...n){try{return e.apply(null,n)}catch{}}}const dI=On(vr(4),Un("0123456789ABCDEF"),_n("")),pI=On(vr(5),Un("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Fa(5),_n(""));On(vr(5),Un("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Fa(5),_n(""));On(vr(5),Un("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),_n(""),f1(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Ln=On(vr(6),Un("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Fa(6),_n("")),gI=On(vr(6),Un("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Fa(6),_n("")),Xf=e=>On(hI(58),Un(e),_n("")),el=Xf("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Xf("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");Xf("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Qd=[0,2,3,5,6,7,9,10,11],yI={encode(e){let n="";for(let r=0;r<e.length;r+=8){const i=e.subarray(r,r+8);n+=el.encode(i).padStart(Qd[i.length],"1")}return n},decode(e){let n=[];for(let r=0;r<e.length;r+=11){const i=e.slice(r,r+11),o=Qd.indexOf(i.length),s=el.decode(i);for(let a=0;a<s.length-o;a++)if(s[a]!==0)throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(n)}},tl=On(Un("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),_n("")),ep=[996825010,642813549,513874426,1027748829,705979059];function eo(e){const n=e>>25;let r=(e&33554431)<<5;for(let i=0;i<ep.length;i++)(n>>i&1)===1&&(r^=ep[i]);return r}function tp(e,n,r=1){const i=e.length;let o=1;for(let s=0;s<i;s++){const a=e.charCodeAt(s);if(a<33||a>126)throw new Error(`Invalid prefix (${e})`);o=eo(o)^a>>5}o=eo(o);for(let s=0;s<i;s++)o=eo(o)^e.charCodeAt(s)&31;for(let s of n)o=eo(o)^s;for(let s=0;s<6;s++)o=eo(o);return o^=r,tl.encode(Qc([o%2**30],30,5,!1))}function d1(e){const n=e==="bech32"?1:734539939,r=vr(5),i=r.decode,o=r.encode,s=Xd(i);function a(f,h,p=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(h)||h.length&&typeof h[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof h}`);const b=f.length+7+h.length;if(p!==!1&&b>p)throw new TypeError(`Length ${b} exceeds limit ${p}`);return f=f.toLowerCase(),`${f}1${tl.encode(h)}${tp(f,h,n)}`}function u(f,h=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||h!==!1&&f.length>h)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${h})`);const p=f.toLowerCase();if(f!==p&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=p;const b=f.lastIndexOf("1");if(b===0||b===-1)throw new Error('Letter "1" must be present between prefix and data only');const y=f.slice(0,b),d=f.slice(b+1);if(d.length<6)throw new Error("Data must be at least 6 characters long");const g=tl.decode(d).slice(0,-6),m=tp(y,g,n);if(!d.endsWith(m))throw new Error(`Invalid checksum in ${f}: expected "${m}"`);return{prefix:y,words:g}}const c=Xd(u);function l(f){const{prefix:h,words:p}=u(f,!1);return{prefix:h,words:p,bytes:i(p)}}return{encode:a,decode:u,decodeToBytes:l,decodeUnsafe:c,fromWords:i,fromWordsUnsafe:s,toWords:o}}const Fi=d1("bech32");d1("bech32m");const wI={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},mI=On(vr(4),Un("0123456789abcdef"),_n(""),f1(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),bI={utf8:wI,hex:mI,base16:dI,base32:pI,base64:Ln,base64url:gI,base58:el,base58xmr:yI};`${Object.keys(bI).join(", ")}`;function Ju(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function np(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function p1(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function It(e,...n){if(!p1(e))throw new Error("Uint8Array expected");if(n.length>0&&!n.includes(e.length))throw new Error(`Uint8Array expected of length ${n}, not of length=${e.length}`)}function Mi(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function Qf(e,n){It(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const be=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),vI=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),EI=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!EI)throw new Error("Non little-endian hardware is not supported");function eh(e){if(typeof e!="string")throw new Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function hr(e){if(typeof e=="string")e=eh(e);else if(p1(e))e=e.slice();else throw new Error(`Uint8Array expected, got ${typeof e}`);return e}function xI(e,n){if(n==null||typeof n!="object")throw new Error("options must be defined");return Object.assign(e,n)}function LI(e,n){if(e.length!==n.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^n[i];return r===0}const AI=(e,n)=>(Object.assign(n,e),n),hn=16,th=new Uint8Array(16),qt=be(th),SI=225,$I=(e,n,r,i)=>{const o=i&1;return{s3:r<<31|i>>>1,s2:n<<31|r>>>1,s1:e<<31|n>>>1,s0:e>>>1^SI<<24&-(o&1)}},At=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255|0;function II(e){e.reverse();const n=e[15]&1;let r=0;for(let i=0;i<e.length;i++){const o=e[i];e[i]=o>>>1|r,r=(o&1)<<7}return e[0]^=-n&225,e}const BI=e=>e>64*1024?8:e>1024?4:2;class g1{constructor(n,r){this.blockLen=hn,this.outputLen=hn,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,n=hr(n),It(n,16);const i=vI(n);let o=i.getUint32(0,!1),s=i.getUint32(4,!1),a=i.getUint32(8,!1),u=i.getUint32(12,!1);const c=[];for(let b=0;b<128;b++)c.push({s0:At(o),s1:At(s),s2:At(a),s3:At(u)}),{s0:o,s1:s,s2:a,s3:u}=$I(o,s,a,u);const l=BI(r||1024);if(![1,2,4,8].includes(l))throw new Error(`ghash: wrong window size=${l}, should be 2, 4 or 8`);this.W=l;const f=128/l,h=this.windowSize=2**l,p=[];for(let b=0;b<f;b++)for(let y=0;y<h;y++){let d=0,g=0,m=0,x=0;for(let S=0;S<l;S++){if(!(y>>>l-S-1&1))continue;const{s0:O,s1:B,s2:E,s3:L}=c[l*b+S];d^=O,g^=B,m^=E,x^=L}p.push({s0:d,s1:g,s2:m,s3:x})}this.t=p}_updateBlock(n,r,i,o){n^=this.s0,r^=this.s1,i^=this.s2,o^=this.s3;const{W:s,t:a,windowSize:u}=this;let c=0,l=0,f=0,h=0;const p=(1<<s)-1;let b=0;for(const y of[n,r,i,o])for(let d=0;d<4;d++){const g=y>>>8*d&255;for(let m=8/s-1;m>=0;m--){const x=g>>>s*m&p,{s0:S,s1:O,s2:B,s3:E}=a[b*u+x];c^=S,l^=O,f^=B,h^=E,b+=1}}this.s0=c,this.s1=l,this.s2=f,this.s3=h}update(n){n=hr(n),Mi(this);const r=be(n),i=Math.floor(n.length/hn),o=n.length%hn;for(let s=0;s<i;s++)this._updateBlock(r[s*4+0],r[s*4+1],r[s*4+2],r[s*4+3]);return o&&(th.set(n.subarray(i*hn)),this._updateBlock(qt[0],qt[1],qt[2],qt[3]),qt.fill(0)),this}destroy(){const{t:n}=this;for(const r of n)r.s0=0,r.s1=0,r.s2=0,r.s3=0}digestInto(n){Mi(this),Qf(n,this),this.finished=!0;const{s0:r,s1:i,s2:o,s3:s}=this,a=be(n);return a[0]=r,a[1]=i,a[2]=o,a[3]=s,n}digest(){const n=new Uint8Array(hn);return this.digestInto(n),this.destroy(),n}}class kI extends g1{constructor(n,r){n=hr(n);const i=II(n.slice());super(i,r),i.fill(0)}update(n){n=hr(n),Mi(this);const r=be(n),i=n.length%hn,o=Math.floor(n.length/hn);for(let s=0;s<o;s++)this._updateBlock(At(r[s*4+3]),At(r[s*4+2]),At(r[s*4+1]),At(r[s*4+0]));return i&&(th.set(n.subarray(o*hn)),this._updateBlock(At(qt[3]),At(qt[2]),At(qt[1]),At(qt[0])),qt.fill(0)),this}digestInto(n){Mi(this),Qf(n,this),this.finished=!0;const{s0:r,s1:i,s2:o,s3:s}=this,a=be(n);return a[0]=r,a[1]=i,a[2]=o,a[3]=s,n.reverse()}}function y1(e){const n=(i,o)=>e(o,i.length).update(hr(i)).digest(),r=e(new Uint8Array(16),0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=(i,o)=>e(i,o),n}y1((e,n)=>new g1(e,n));y1((e,n)=>new kI(e,n));const ir=16,OI=283;function nh(e){return e<<1^OI&-(e>>7)}function ci(e,n){let r=0;for(;n>0;n>>=1)r^=e&-(n&1),e=nh(e);return r}const nl=(()=>{let e=new Uint8Array(256);for(let r=0,i=1;r<256;r++,i^=nh(i))e[r]=i;const n=new Uint8Array(256);n[0]=99;for(let r=0;r<255;r++){let i=e[255-r];i|=i<<8,n[e[r]]=(i^i>>4^i>>5^i>>6^i>>7^99)&255}return n})(),UI=nl.map((e,n)=>nl.indexOf(n)),_I=e=>e<<24|e>>>8,Yu=e=>e<<8|e>>>24;function w1(e,n){if(e.length!==256)throw new Error("Wrong sbox length");const r=new Uint32Array(256).map((l,f)=>n(e[f])),i=r.map(Yu),o=i.map(Yu),s=o.map(Yu),a=new Uint32Array(256*256),u=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let l=0;l<256;l++)for(let f=0;f<256;f++){const h=l*256+f;a[h]=r[l]^i[f],u[h]=o[l]^s[f],c[h]=e[l]<<8|e[f]}return{sbox:e,sbox2:c,T0:r,T1:i,T2:o,T3:s,T01:a,T23:u}}const rh=w1(nl,e=>ci(e,3)<<24|e<<16|e<<8|ci(e,2)),m1=w1(UI,e=>ci(e,11)<<24|ci(e,13)<<16|ci(e,9)<<8|ci(e,14)),CI=(()=>{const e=new Uint8Array(16);for(let n=0,r=1;n<16;n++,r=nh(r))e[n]=r;return e})();function b1(e){It(e);const n=e.length;if(![16,24,32].includes(n))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${n}`);const{sbox2:r}=rh,i=be(e),o=i.length,s=u=>Jt(r,u,u,u,u),a=new Uint32Array(n+28);a.set(i);for(let u=o;u<a.length;u++){let c=a[u-1];u%o===0?c=s(_I(c))^CI[u/o-1]:o>6&&u%o===4&&(c=s(c)),a[u]=a[u-o]^c}return a}function RI(e){const n=b1(e),r=n.slice(),i=n.length,{sbox2:o}=rh,{T0:s,T1:a,T2:u,T3:c}=m1;for(let l=0;l<i;l+=4)for(let f=0;f<4;f++)r[l+f]=n[i-l-4+f];n.fill(0);for(let l=4;l<i-4;l++){const f=r[l],h=Jt(o,f,f,f,f);r[l]=s[h&255]^a[h>>>8&255]^u[h>>>16&255]^c[h>>>24]}return r}function tr(e,n,r,i,o,s){return e[r<<8&65280|i>>>8&255]^n[o>>>8&65280|s>>>24&255]}function Jt(e,n,r,i,o){return e[n&255|r&65280]|e[i>>>16&255|o>>>16&65280]<<16}function rp(e,n,r,i,o){const{sbox2:s,T01:a,T23:u}=rh;let c=0;n^=e[c++],r^=e[c++],i^=e[c++],o^=e[c++];const l=e.length/4-2;for(let y=0;y<l;y++){const d=e[c++]^tr(a,u,n,r,i,o),g=e[c++]^tr(a,u,r,i,o,n),m=e[c++]^tr(a,u,i,o,n,r),x=e[c++]^tr(a,u,o,n,r,i);n=d,r=g,i=m,o=x}const f=e[c++]^Jt(s,n,r,i,o),h=e[c++]^Jt(s,r,i,o,n),p=e[c++]^Jt(s,i,o,n,r),b=e[c++]^Jt(s,o,n,r,i);return{s0:f,s1:h,s2:p,s3:b}}function TI(e,n,r,i,o){const{sbox2:s,T01:a,T23:u}=m1;let c=0;n^=e[c++],r^=e[c++],i^=e[c++],o^=e[c++];const l=e.length/4-2;for(let y=0;y<l;y++){const d=e[c++]^tr(a,u,n,o,i,r),g=e[c++]^tr(a,u,r,n,o,i),m=e[c++]^tr(a,u,i,r,n,o),x=e[c++]^tr(a,u,o,i,r,n);n=d,r=g,i=m,o=x}const f=e[c++]^Jt(s,n,o,i,r),h=e[c++]^Jt(s,r,n,o,i),p=e[c++]^Jt(s,i,r,n,o),b=e[c++]^Jt(s,o,i,r,n);return{s0:f,s1:h,s2:p,s3:b}}function v1(e,n){if(!n)return new Uint8Array(e);if(It(n),n.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${n.length}`);return n}function PI(e){if(It(e),e.length%ir!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${ir}`)}function NI(e,n,r){let i=e.length;const o=i%ir;if(!n&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=be(e);if(n){let c=ir-o;c||(c=ir),i=i+c}const a=v1(i,r),u=be(a);return{b:s,o:u,out:a}}function HI(e,n){if(!n)return e;const r=e.length;if(!r)throw new Error("aes/pcks5: empty ciphertext not allowed");const i=e[r-1];if(i<=0||i>16)throw new Error(`aes/pcks5: wrong padding byte: ${i}`);const o=e.subarray(0,-i);for(let s=0;s<i;s++)if(e[r-s-1]!==i)throw new Error("aes/pcks5: wrong padding");return o}function jI(e){const n=new Uint8Array(16),r=be(n);n.set(e);const i=ir-e.length;for(let o=ir-i;o<ir;o++)n[o]=i;return r}const E1=AI({blockSize:16,nonceLength:16},function(e,n,r={}){It(e),It(n,16);const i=!r.disablePadding;return{encrypt:(o,s)=>{const a=b1(e),{b:u,o:c,out:l}=NI(o,i,s),f=be(n);let h=f[0],p=f[1],b=f[2],y=f[3],d=0;for(;d+4<=u.length;)h^=u[d+0],p^=u[d+1],b^=u[d+2],y^=u[d+3],{s0:h,s1:p,s2:b,s3:y}=rp(a,h,p,b,y),c[d++]=h,c[d++]=p,c[d++]=b,c[d++]=y;if(i){const g=jI(o.subarray(d*4));h^=g[0],p^=g[1],b^=g[2],y^=g[3],{s0:h,s1:p,s2:b,s3:y}=rp(a,h,p,b,y),c[d++]=h,c[d++]=p,c[d++]=b,c[d++]=y}return a.fill(0),l},decrypt:(o,s)=>{PI(o);const a=RI(e),u=be(n),c=v1(o.length,s),l=be(o),f=be(c);let h=u[0],p=u[1],b=u[2],y=u[3];for(let d=0;d+4<=l.length;){const g=h,m=p,x=b,S=y;h=l[d+0],p=l[d+1],b=l[d+2],y=l[d+3];const{s0:O,s1:B,s2:E,s3:L}=TI(a,h,p,b,y);f[d++]=O^g,f[d++]=B^m,f[d++]=E^x,f[d++]=L^S}return a.fill(0),HI(c,i)}}}),Ne=(e,n)=>e[n++]&255|(e[n++]&255)<<8;class FI{constructor(n){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,n=hr(n),It(n,32);const r=Ne(n,0),i=Ne(n,2),o=Ne(n,4),s=Ne(n,6),a=Ne(n,8),u=Ne(n,10),c=Ne(n,12),l=Ne(n,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|a<<12)&255,this.r[5]=a>>>1&8190,this.r[6]=(a>>>14|u<<2)&8191,this.r[7]=(u>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let f=0;f<8;f++)this.pad[f]=Ne(n,16+2*f)}process(n,r,i=!1){const o=i?0:2048,{h:s,r:a}=this,u=a[0],c=a[1],l=a[2],f=a[3],h=a[4],p=a[5],b=a[6],y=a[7],d=a[8],g=a[9],m=Ne(n,r+0),x=Ne(n,r+2),S=Ne(n,r+4),O=Ne(n,r+6),B=Ne(n,r+8),E=Ne(n,r+10),L=Ne(n,r+12),I=Ne(n,r+14);let R=s[0]+(m&8191),U=s[1]+((m>>>13|x<<3)&8191),k=s[2]+((x>>>10|S<<6)&8191),P=s[3]+((S>>>7|O<<9)&8191),T=s[4]+((O>>>4|B<<12)&8191),H=s[5]+(B>>>1&8191),w=s[6]+((B>>>14|E<<2)&8191),v=s[7]+((E>>>11|L<<5)&8191),$=s[8]+((L>>>8|I<<8)&8191),_=s[9]+(I>>>5|o),A=0,C=A+R*u+U*(5*g)+k*(5*d)+P*(5*y)+T*(5*b);A=C>>>13,C&=8191,C+=H*(5*p)+w*(5*h)+v*(5*f)+$*(5*l)+_*(5*c),A+=C>>>13,C&=8191;let N=A+R*c+U*u+k*(5*g)+P*(5*d)+T*(5*y);A=N>>>13,N&=8191,N+=H*(5*b)+w*(5*p)+v*(5*h)+$*(5*f)+_*(5*l),A+=N>>>13,N&=8191;let j=A+R*l+U*c+k*u+P*(5*g)+T*(5*d);A=j>>>13,j&=8191,j+=H*(5*y)+w*(5*b)+v*(5*p)+$*(5*h)+_*(5*f),A+=j>>>13,j&=8191;let F=A+R*f+U*l+k*c+P*u+T*(5*g);A=F>>>13,F&=8191,F+=H*(5*d)+w*(5*y)+v*(5*b)+$*(5*p)+_*(5*h),A+=F>>>13,F&=8191;let q=A+R*h+U*f+k*l+P*c+T*u;A=q>>>13,q&=8191,q+=H*(5*g)+w*(5*d)+v*(5*y)+$*(5*b)+_*(5*p),A+=q>>>13,q&=8191;let K=A+R*p+U*h+k*f+P*l+T*c;A=K>>>13,K&=8191,K+=H*u+w*(5*g)+v*(5*d)+$*(5*y)+_*(5*b),A+=K>>>13,K&=8191;let G=A+R*b+U*p+k*h+P*f+T*l;A=G>>>13,G&=8191,G+=H*c+w*u+v*(5*g)+$*(5*d)+_*(5*y),A+=G>>>13,G&=8191;let D=A+R*y+U*b+k*p+P*h+T*f;A=D>>>13,D&=8191,D+=H*l+w*c+v*u+$*(5*g)+_*(5*d),A+=D>>>13,D&=8191;let Z=A+R*d+U*y+k*b+P*p+T*h;A=Z>>>13,Z&=8191,Z+=H*f+w*l+v*c+$*u+_*(5*g),A+=Z>>>13,Z&=8191;let V=A+R*g+U*d+k*y+P*b+T*p;A=V>>>13,V&=8191,V+=H*h+w*f+v*l+$*c+_*u,A+=V>>>13,V&=8191,A=(A<<2)+A|0,A=A+C|0,C=A&8191,A=A>>>13,N+=A,s[0]=C,s[1]=N,s[2]=j,s[3]=F,s[4]=q,s[5]=K,s[6]=G,s[7]=D,s[8]=Z,s[9]=V}finalize(){const{h:n,pad:r}=this,i=new Uint16Array(10);let o=n[1]>>>13;n[1]&=8191;for(let u=2;u<10;u++)n[u]+=o,o=n[u]>>>13,n[u]&=8191;n[0]+=o*5,o=n[0]>>>13,n[0]&=8191,n[1]+=o,o=n[1]>>>13,n[1]&=8191,n[2]+=o,i[0]=n[0]+5,o=i[0]>>>13,i[0]&=8191;for(let u=1;u<10;u++)i[u]=n[u]+o,o=i[u]>>>13,i[u]&=8191;i[9]-=8192;let s=(o^1)-1;for(let u=0;u<10;u++)i[u]&=s;s=~s;for(let u=0;u<10;u++)n[u]=n[u]&s|i[u];n[0]=(n[0]|n[1]<<13)&65535,n[1]=(n[1]>>>3|n[2]<<10)&65535,n[2]=(n[2]>>>6|n[3]<<7)&65535,n[3]=(n[3]>>>9|n[4]<<4)&65535,n[4]=(n[4]>>>12|n[5]<<1|n[6]<<14)&65535,n[5]=(n[6]>>>2|n[7]<<11)&65535,n[6]=(n[7]>>>5|n[8]<<8)&65535,n[7]=(n[8]>>>8|n[9]<<5)&65535;let a=n[0]+r[0];n[0]=a&65535;for(let u=1;u<8;u++)a=(n[u]+r[u]|0)+(a>>>16)|0,n[u]=a&65535}update(n){Mi(this);const{buffer:r,blockLen:i}=this;n=hr(n);const o=n.length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a===i){for(;i<=o-s;s+=i)this.process(n,s);continue}r.set(n.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(n){Mi(this),Qf(n,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:o}=this;if(o){for(r[o++]=1;o<16;o++)r[o]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let a=0;a<8;a++)n[s++]=i[a]>>>0,n[s++]=i[a]>>>8;return n}digest(){const{buffer:n,outputLen:r}=this;this.digestInto(n);const i=n.slice(0,r);return this.destroy(),i}}function MI(e){const n=(i,o)=>e(o).update(hr(i)).digest(),r=e(new Uint8Array(32));return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=i=>e(i),n}MI(e=>new FI(e));const zI=eh("expand 16-byte k"),qI=eh("expand 32-byte k"),KI=be(zI),DI=be(qI);function Q(e,n){return e<<n|e>>>32-n}function rl(e){return e.byteOffset%4===0}const Do=64,VI=16,x1=2**32-1,ip=new Uint32Array;function WI(e,n,r,i,o,s,a,u){const c=o.length,l=new Uint8Array(Do),f=be(l),h=rl(o)&&rl(s),p=h?be(o):ip,b=h?be(s):ip;for(let y=0;y<c;a++){if(e(n,r,i,f,a,u),a>=x1)throw new Error("arx: counter overflow");const d=Math.min(Do,c-y);if(h&&d===Do){const g=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let m=0,x;m<VI;m++)x=g+m,b[x]=p[x]^f[m];y+=Do;continue}for(let g=0,m;g<d;g++)m=y+g,s[m]=o[m]^l[g];y+=d}}function GI(e,n){const{allowShortKeys:r,extendNonceFn:i,counterLength:o,counterRight:s,rounds:a}=xI({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},n);if(typeof e!="function")throw new Error("core must be a function");return Ju(o),Ju(a),np(s),np(r),(u,c,l,f,h=0)=>{It(u),It(c),It(l);const p=l.length;if(f||(f=new Uint8Array(p)),It(f),Ju(h),h<0||h>=x1)throw new Error("arx: counter overflow");if(f.length<p)throw new Error(`arx: output (${f.length}) is shorter than data (${p})`);const b=[];let y=u.length,d,g;if(y===32)d=u.slice(),b.push(d),g=DI;else if(y===16&&r)d=new Uint8Array(32),d.set(u),d.set(u,16),g=KI,b.push(d);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);rl(c)||(c=c.slice(),b.push(c));const m=be(d);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(g,m,be(c.subarray(0,16)),m),c=c.subarray(16)}const x=16-o;if(x!==c.length)throw new Error(`arx: nonce must be ${x} or 16 bytes`);if(x!==12){const O=new Uint8Array(12);O.set(c,s?0:12-c.length),c=O,b.push(c)}const S=be(c);for(WI(e,g,m,S,l,f,h,a);b.length>0;)b.pop().fill(0);return f}}function ZI(e,n,r,i,o,s=20){let a=e[0],u=e[1],c=e[2],l=e[3],f=n[0],h=n[1],p=n[2],b=n[3],y=n[4],d=n[5],g=n[6],m=n[7],x=o,S=r[0],O=r[1],B=r[2],E=a,L=u,I=c,R=l,U=f,k=h,P=p,T=b,H=y,w=d,v=g,$=m,_=x,A=S,C=O,N=B;for(let F=0;F<s;F+=2)E=E+U|0,_=Q(_^E,16),H=H+_|0,U=Q(U^H,12),E=E+U|0,_=Q(_^E,8),H=H+_|0,U=Q(U^H,7),L=L+k|0,A=Q(A^L,16),w=w+A|0,k=Q(k^w,12),L=L+k|0,A=Q(A^L,8),w=w+A|0,k=Q(k^w,7),I=I+P|0,C=Q(C^I,16),v=v+C|0,P=Q(P^v,12),I=I+P|0,C=Q(C^I,8),v=v+C|0,P=Q(P^v,7),R=R+T|0,N=Q(N^R,16),$=$+N|0,T=Q(T^$,12),R=R+T|0,N=Q(N^R,8),$=$+N|0,T=Q(T^$,7),E=E+k|0,N=Q(N^E,16),v=v+N|0,k=Q(k^v,12),E=E+k|0,N=Q(N^E,8),v=v+N|0,k=Q(k^v,7),L=L+P|0,_=Q(_^L,16),$=$+_|0,P=Q(P^$,12),L=L+P|0,_=Q(_^L,8),$=$+_|0,P=Q(P^$,7),I=I+T|0,A=Q(A^I,16),H=H+A|0,T=Q(T^H,12),I=I+T|0,A=Q(A^I,8),H=H+A|0,T=Q(T^H,7),R=R+U|0,C=Q(C^R,16),w=w+C|0,U=Q(U^w,12),R=R+U|0,C=Q(C^R,8),w=w+C|0,U=Q(U^w,7);let j=0;i[j++]=a+E|0,i[j++]=u+L|0,i[j++]=c+I|0,i[j++]=l+R|0,i[j++]=f+U|0,i[j++]=h+k|0,i[j++]=p+P|0,i[j++]=b+T|0,i[j++]=y+H|0,i[j++]=d+w|0,i[j++]=g+v|0,i[j++]=m+$|0,i[j++]=x+_|0,i[j++]=S+A|0,i[j++]=O+C|0,i[j++]=B+N|0}const L1=GI(ZI,{counterRight:!1,counterLength:4,allowShortKeys:!1});class A1 extends s1{constructor(n,r){super(),this.finished=!1,this.destroyed=!1,Zt.hash(n);const i=Eo(r);if(this.iHash=n.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?n.create().update(i).digest():i);for(let a=0;a<s.length;a++)s[a]^=54;this.iHash.update(s),this.oHash=n.create();for(let a=0;a<s.length;a++)s[a]^=106;this.oHash.update(s),s.fill(0)}update(n){return Zt.exists(this),this.iHash.update(n),this}digestInto(n){Zt.exists(this),Zt.bytes(n,this.outputLen),this.finished=!0,this.iHash.digestInto(n),this.oHash.update(n),this.oHash.digestInto(n),this.destroy()}digest(){const n=new Uint8Array(this.oHash.outputLen);return this.digestInto(n),n}_cloneInto(n){n||(n=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:o,destroyed:s,blockLen:a,outputLen:u}=this;return n=n,n.finished=o,n.destroyed=s,n.blockLen=a,n.outputLen=u,n.oHash=r._cloneInto(n.oHash),n.iHash=i._cloneInto(n.iHash),n}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Ma=(e,n,r)=>new A1(e,n).update(r).digest();Ma.create=(e,n)=>new A1(e,n);function JI(e,n,r){return Zt.hash(e),r===void 0&&(r=new Uint8Array(e.outputLen)),Ma(e,Eo(r),Eo(n))}const Xu=new Uint8Array([0]),op=new Uint8Array;function YI(e,n,r,i=32){if(Zt.hash(e),Zt.number(i),i>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(i/e.outputLen);r===void 0&&(r=op);const s=new Uint8Array(o*e.outputLen),a=Ma.create(e,n),u=a._cloneInto(),c=new Uint8Array(a.outputLen);for(let l=0;l<o;l++)Xu[0]=l+1,u.update(l===0?op:c).update(r).update(Xu).digestInto(c),s.set(c,e.outputLen*l),a._cloneInto(u);return a.destroy(),u.destroy(),c.fill(0),Xu.fill(0),s.slice(0,i)}var XI=Object.defineProperty,xe=(e,n)=>{for(var r in n)XI(e,r,{get:n[r],enumerable:!0})},Ar=Symbol("verified"),QI=e=>e instanceof Object;function S1(e){if(!QI(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let n=0;n<e.tags.length;n++){let r=e.tags[n];if(!Array.isArray(r))return!1;for(let i=0;i<r.length;i++)if(typeof r[i]=="object")return!1}return!0}var eB={};xe(eB,{Queue:()=>iB,QueueNode:()=>$1,binarySearch:()=>ih,insertEventIntoAscendingList:()=>rB,insertEventIntoDescendingList:()=>nB,normalizeURL:()=>tB,utf8Decoder:()=>vn,utf8Encoder:()=>tn});var vn=new TextDecoder("utf-8"),tn=new TextEncoder;function tB(e){e.indexOf("://")===-1&&(e="wss://"+e);let n=new URL(e);return n.pathname=n.pathname.replace(/\/+/g,"/"),n.pathname.endsWith("/")&&(n.pathname=n.pathname.slice(0,-1)),(n.port==="80"&&n.protocol==="ws:"||n.port==="443"&&n.protocol==="wss:")&&(n.port=""),n.searchParams.sort(),n.hash="",n.toString()}function nB(e,n){const[r,i]=ih(e,o=>n.id===o.id?0:n.created_at===o.created_at?-1:o.created_at-n.created_at);return i||e.splice(r,0,n),e}function rB(e,n){const[r,i]=ih(e,o=>n.id===o.id?0:n.created_at===o.created_at?-1:n.created_at-o.created_at);return i||e.splice(r,0,n),e}function ih(e,n){let r=0,i=e.length-1;for(;r<=i;){const o=Math.floor((r+i)/2),s=n(e[o]);if(s===0)return[o,!0];s<0?i=o-1:r=o+1}return[r,!1]}var $1=class{constructor(e){ao(this,"value"),ao(this,"next",null),ao(this,"prev",null),this.value=e}},iB=class{constructor(){ao(this,"first"),ao(this,"last"),this.first=null,this.last=null}enqueue(e){const n=new $1(e);return this.last?this.last===this.first?(this.last=n,this.last.prev=this.first,this.first.next=n):(n.prev=this.last,this.last.next=n,this.last=n):(this.first=n,this.last=n),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const n=this.first;return this.first=null,this.last=null,n.value}const e=this.first;return this.first=e.next,e.value}},oB=class{generateSecretKey(){return zt.utils.randomPrivateKey()}getPublicKey(e){return ke(zt.getPublicKey(e))}finalizeEvent(e,n){const r=e;return r.pubkey=ke(zt.getPublicKey(n)),r.id=mi(r),r.sig=ke(zt.sign(mi(r),n)),r[Ar]=!0,r}verifyEvent(e){if(typeof e[Ar]=="boolean")return e[Ar];const n=mi(e);if(n!==e.id)return e[Ar]=!1,!1;try{const r=zt.verify(e.sig,n,e.pubkey);return e[Ar]=r,r}catch{return e[Ar]=!1,!1}}};function sB(e){if(!S1(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function mi(e){let n=wi(tn.encode(sB(e)));return ke(n)}var za=new oB;za.generateSecretKey;za.getPublicKey;var Er=za.finalizeEvent,oh=za.verifyEvent,aB={};xe(aB,{Application:()=>a9,BadgeAward:()=>yB,BadgeDefinition:()=>e9,BlockedRelaysList:()=>jB,BookmarkList:()=>PB,Bookmarksets:()=>YB,Calendar:()=>p9,CalendarEventRSVP:()=>g9,ChannelCreation:()=>U1,ChannelHideMessage:()=>R1,ChannelMessage:()=>C1,ChannelMetadata:()=>_1,ChannelMuteUser:()=>T1,ClassifiedListing:()=>l9,ClientAuth:()=>P1,CommunitiesList:()=>NB,CommunityDefinition:()=>m9,CommunityPostApproval:()=>SB,Contacts:()=>hB,CreateOrUpdateProduct:()=>r9,CreateOrUpdateStall:()=>n9,Curationsets:()=>XB,Date:()=>h9,DraftClassifiedListing:()=>f9,DraftLong:()=>o9,Emojisets:()=>s9,EncryptedDirectMessage:()=>dB,EncryptedDirectMessages:()=>pB,EventDeletion:()=>gB,FileMetadata:()=>bB,FileServerPreference:()=>qB,Followsets:()=>GB,GenericRepost:()=>wB,Genericlists:()=>ZB,HTTPAuth:()=>uh,Handlerinformation:()=>w9,Handlerrecommendation:()=>y9,Highlights:()=>_B,InterestsList:()=>MB,Interestsets:()=>t9,JobFeedback:()=>BB,JobRequest:()=>$B,JobResult:()=>IB,Label:()=>AB,LightningPubRPC:()=>DB,LiveChatMessage:()=>vB,LiveEvent:()=>u9,LongFormArticle:()=>i9,Metadata:()=>cB,Mutelist:()=>CB,NWCWalletInfo:()=>KB,NWCWalletRequest:()=>N1,NWCWalletResponse:()=>VB,NostrConnect:()=>WB,OpenTimestamps:()=>mB,Pinlist:()=>RB,ProblemTracker:()=>EB,ProfileBadges:()=>QB,PublicChatsList:()=>HB,Reaction:()=>ah,RecommendRelay:()=>fB,RelayList:()=>TB,Relaysets:()=>JB,Report:()=>xB,Reporting:()=>LB,Repost:()=>sh,SearchRelaysList:()=>FB,ShortTextNote:()=>lB,Time:()=>d9,UserEmojiList:()=>zB,UserStatuses:()=>c9,Zap:()=>UB,ZapGoal:()=>kB,ZapRequest:()=>OB,classifyKind:()=>uB,isEphemeralKind:()=>k1,isParameterizedReplaceableKind:()=>O1,isRegularKind:()=>I1,isReplaceableKind:()=>B1});function I1(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function B1(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function k1(e){return 2e4<=e&&e<3e4}function O1(e){return 3e4<=e&&e<4e4}function uB(e){return I1(e)?"regular":B1(e)?"replaceable":k1(e)?"ephemeral":O1(e)?"parameterized":"unknown"}var cB=0,lB=1,fB=2,hB=3,dB=4,pB=4,gB=5,sh=6,ah=7,yB=8,wB=16,U1=40,_1=41,C1=42,R1=43,T1=44,mB=1040,bB=1063,vB=1311,EB=1971,xB=1984,LB=1984,AB=1985,SB=4550,$B=5999,IB=6999,BB=7e3,kB=9041,OB=9734,UB=9735,_B=9802,CB=1e4,RB=10001,TB=10002,PB=10003,NB=10004,HB=10005,jB=10006,FB=10007,MB=10015,zB=10030,qB=10096,KB=13194,DB=21e3,P1=22242,N1=23194,VB=23195,WB=24133,uh=27235,GB=3e4,ZB=30001,JB=30002,YB=30003,XB=30004,QB=30008,e9=30009,t9=30015,n9=30017,r9=30018,i9=30023,o9=30024,s9=30030,a9=30078,u9=30311,c9=30315,l9=30402,f9=30403,h9=31922,d9=31923,p9=31924,g9=31925,y9=31989,w9=31990,m9=34550,b9={};xe(b9,{getHex64:()=>ch,getInt:()=>H1,getSubscriptionId:()=>v9,matchEventId:()=>E9,matchEventKind:()=>L9,matchEventPubkey:()=>x9});function ch(e,n){let r=n.length+3,i=e.indexOf(`"${n}":`)+r,o=e.slice(i).indexOf('"')+i+1;return e.slice(o,o+64)}function H1(e,n){let r=n.length,i=e.indexOf(`"${n}":`)+r+3,o=e.slice(i),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function v9(e){let n=e.slice(0,22).indexOf('"EVENT"');if(n===-1)return null;let r=e.slice(n+7+1).indexOf('"');if(r===-1)return null;let i=n+7+1+r,o=e.slice(i+1,80).indexOf('"');if(o===-1)return null;let s=i+1+o;return e.slice(i+1,s)}function E9(e,n){return n===ch(e,"id")}function x9(e,n){return n===ch(e,"pubkey")}function L9(e,n){return n===H1(e,"kind")}var A9={};xe(A9,{makeAuthEvent:()=>S9});function S9(e,n){return{kind:P1,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",n]],content:""}}var $9;try{$9=WebSocket}catch{}var dr={};xe(dr,{BECH32_REGEX:()=>j1,Bech32MaxSize:()=>lh,decode:()=>qa,encodeBytes:()=>Ka,naddrEncode:()=>C9,neventEncode:()=>_9,noteEncode:()=>O9,nprofileEncode:()=>U9,npubEncode:()=>k9,nrelayEncode:()=>R9,nsecEncode:()=>B9});var lh=5e3,j1=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function I9(e){const n=new Uint8Array(4);return n[0]=e>>24&255,n[1]=e>>16&255,n[2]=e>>8&255,n[3]=e&255,n}function qa(e){var n,r,i,o,s,a,u,c;let{prefix:l,words:f}=Fi.decode(e,lh),h=new Uint8Array(Fi.fromWords(f));switch(l){case"nprofile":{let p=Vo(h);if(!((n=p[0])!=null&&n[0]))throw new Error("missing TLV 0 for nprofile");if(p[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:ke(p[0][0]),relays:p[1]?p[1].map(b=>vn.decode(b)):[]}}}case"nevent":{let p=Vo(h);if(!((r=p[0])!=null&&r[0]))throw new Error("missing TLV 0 for nevent");if(p[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(p[2]&&p[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(p[3]&&p[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:ke(p[0][0]),relays:p[1]?p[1].map(b=>vn.decode(b)):[],author:(i=p[2])!=null&&i[0]?ke(p[2][0]):void 0,kind:(o=p[3])!=null&&o[0]?parseInt(ke(p[3][0]),16):void 0}}}case"naddr":{let p=Vo(h);if(!((s=p[0])!=null&&s[0]))throw new Error("missing TLV 0 for naddr");if(!((a=p[2])!=null&&a[0]))throw new Error("missing TLV 2 for naddr");if(p[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((u=p[3])!=null&&u[0]))throw new Error("missing TLV 3 for naddr");if(p[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:vn.decode(p[0][0]),pubkey:ke(p[2][0]),kind:parseInt(ke(p[3][0]),16),relays:p[1]?p[1].map(b=>vn.decode(b)):[]}}}case"nrelay":{let p=Vo(h);if(!((c=p[0])!=null&&c[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:vn.decode(p[0][0])}}case"nsec":return{type:l,data:h};case"npub":case"note":return{type:l,data:ke(h)};default:throw new Error(`unknown prefix ${l}`)}}function Vo(e){let n={},r=e;for(;r.length>0;){let i=r[0],o=r[1],s=r.slice(2,2+o);if(r=r.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${i}`);n[i]=n[i]||[],n[i].push(s)}return n}function B9(e){return Ka("nsec",e)}function k9(e){return Ka("npub",ji(e))}function O9(e){return Ka("note",ji(e))}function Oo(e,n){let r=Fi.toWords(n);return Fi.encode(e,r,lh)}function Ka(e,n){return Oo(e,n)}function U9(e){let n=Da({0:[ji(e.pubkey)],1:(e.relays||[]).map(r=>tn.encode(r))});return Oo("nprofile",n)}function _9(e){let n;e.kind!==void 0&&(n=I9(e.kind));let r=Da({0:[ji(e.id)],1:(e.relays||[]).map(i=>tn.encode(i)),2:e.author?[ji(e.author)]:[],3:n?[new Uint8Array(n)]:[]});return Oo("nevent",r)}function C9(e){let n=new ArrayBuffer(4);new DataView(n).setUint32(0,e.kind,!1);let r=Da({0:[tn.encode(e.identifier)],1:(e.relays||[]).map(i=>tn.encode(i)),2:[ji(e.pubkey)],3:[new Uint8Array(n)]});return Oo("naddr",r)}function R9(e){let n=Da({0:[tn.encode(e)]});return Oo("nrelay",n)}function Da(e){let n=[];return Object.entries(e).reverse().forEach(([r,i])=>{i.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(r)],0),s.set([o.length],1),s.set(o,2),n.push(s)})}),Ds(...n)}var T9={};xe(T9,{decrypt:()=>P9,encrypt:()=>F1});async function F1(e,n,r){const i=e instanceof Uint8Array?ke(e):e,o=Wi.getSharedSecret(i,"02"+n),s=M1(o);let a=Uint8Array.from(u1(16)),u=tn.encode(r),c=E1(s,a).encrypt(u),l=Ln.encode(new Uint8Array(c)),f=Ln.encode(new Uint8Array(a.buffer));return`${l}?iv=${f}`}async function P9(e,n,r){const i=e instanceof Uint8Array?ke(e):e;let[o,s]=r.split("?iv="),a=Wi.getSharedSecret(i,"02"+n),u=M1(a),c=Ln.decode(s),l=Ln.decode(o),f=E1(u,c).decrypt(l);return vn.decode(f)}function M1(e){return e.slice(1,33)}var N9={};xe(N9,{NIP05_REGEX:()=>z1,isValid:()=>F9,queryProfile:()=>q1,searchDomain:()=>j9,useFetchImplementation:()=>H9});var z1=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,Va;try{Va=fetch}catch{}function H9(e){Va=e}async function j9(e,n=""){try{const r=`https://${e}/.well-known/nostr.json?name=${n}`;return(await(await Va(r,{redirect:"error"})).json()).names}catch{return{}}}async function q1(e){var n;const r=e.match(z1);if(!r)return null;const[i,o="_",s]=r;try{const a=`https://${s}/.well-known/nostr.json?name=${o}`,u=await(await Va(a,{redirect:"error"})).json();let c=u.names[o];return c?{pubkey:c,relays:(n=u.relays)==null?void 0:n[c]}:null}catch{return null}}async function F9(e,n){let r=await q1(n);return r?r.pubkey===e:!1}var M9={};xe(M9,{parse:()=>z9});function z9(e){const n={reply:void 0,root:void 0,mentions:[],profiles:[]},r=[];for(const i of e.tags)i[0]==="e"&&i[1]&&r.push(i),i[0]==="p"&&i[1]&&n.profiles.push({pubkey:i[1],relays:i[2]?[i[2]]:[]});for(let i=0;i<r.length;i++){const o=r[i],[s,a,u,c]=o,l={id:a,relays:u?[u]:[]},f=i===0,h=i===r.length-1;if(c==="root"){n.root=l;continue}if(c==="reply"){n.reply=l;continue}if(c==="mention"){n.mentions.push(l);continue}if(f){n.root=l;continue}if(h){n.reply=l;continue}n.mentions.push(l)}return n}var q9={};xe(q9,{fetchRelayInformation:()=>D9,useFetchImplementation:()=>K9});var K1;try{K1=fetch}catch{}function K9(e){K1=e}async function D9(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var V9={};xe(V9,{getPow:()=>D1,minePow:()=>W9});function D1(e){let n=0;for(let r=0;r<e.length;r++){const i=parseInt(e[r],16);if(i===0)n+=4;else{n+=Math.clz32(i)-28;break}}return n}function W9(e,n){let r=0;const i=e,o=["nonce",r.toString(),n.toString()];for(i.tags.push(o);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==i.created_at&&(r=0,i.created_at=s),o[1]=(++r).toString(),i.id=mi(i),D1(i.id)>=n)break}return i}var G9={};xe(G9,{finishRepostEvent:()=>Z9,getRepostedEvent:()=>J9,getRepostedEventPointer:()=>V1});function Z9(e,n,r,i){return Er({kind:sh,tags:[...e.tags??[],["e",n.id,r],["p",n.pubkey]],content:e.content===""?"":JSON.stringify(n),created_at:e.created_at},i)}function V1(e){if(e.kind!==sh)return;let n,r;for(let i=e.tags.length-1;i>=0&&(n===void 0||r===void 0);i--){const o=e.tags[i];o.length>=2&&(o[0]==="e"&&n===void 0?n=o:o[0]==="p"&&r===void 0&&(r=o))}if(n!==void 0)return{id:n[1],relays:[n[2],r==null?void 0:r[2]].filter(i=>typeof i=="string"),author:r==null?void 0:r[1]}}function J9(e,{skipVerification:n}={}){const r=V1(e);if(r===void 0||e.content==="")return;let i;try{i=JSON.parse(e.content)}catch{return}if(i.id===r.id&&!(!n&&!oh(i)))return i}var Y9={};xe(Y9,{NOSTR_URI_REGEX:()=>Wa,parse:()=>Q9,test:()=>X9});var Wa=new RegExp(`nostr:(${j1.source})`);function X9(e){return typeof e=="string"&&new RegExp(`^${Wa.source}$`).test(e)}function Q9(e){const n=e.match(new RegExp(`^${Wa.source}$`));if(!n)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:n[0],value:n[1],decoded:qa(n[1])}}var ek={};xe(ek,{finishReactionEvent:()=>tk,getReactedEventPointer:()=>nk});function tk(e,n,r){const i=n.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return Er({...e,kind:ah,tags:[...e.tags??[],...i,["e",n.id],["p",n.pubkey]],content:e.content??"+"},r)}function nk(e){if(e.kind!==ah)return;let n,r;for(let i=e.tags.length-1;i>=0&&(n===void 0||r===void 0);i--){const o=e.tags[i];o.length>=2&&(o[0]==="e"&&n===void 0?n=o:o[0]==="p"&&r===void 0&&(r=o))}if(!(n===void 0||r===void 0))return{id:n[1],relays:[n[2],r[2]].filter(i=>i!==void 0),author:r[1]}}var rk={};xe(rk,{matchAll:()=>ik,regex:()=>fh,replaceAll:()=>ok});var fh=()=>new RegExp(`\\b${Wa.source}\\b`,"g");function*ik(e){const n=e.matchAll(fh());for(const r of n)try{const[i,o]=r;yield{uri:i,value:o,decoded:qa(o),start:r.index,end:r.index+i.length}}catch{}}function ok(e,n){return e.replaceAll(fh(),(r,i)=>n({uri:r,value:i,decoded:qa(i)}))}var sk={};xe(sk,{channelCreateEvent:()=>ak,channelHideMessageEvent:()=>lk,channelMessageEvent:()=>ck,channelMetadataEvent:()=>uk,channelMuteUserEvent:()=>fk});var ak=(e,n)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return Er({kind:U1,tags:[...e.tags??[]],content:r,created_at:e.created_at},n)},uk=(e,n)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return Er({kind:_1,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:r,created_at:e.created_at},n)},ck=(e,n)=>{const r=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&r.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),Er({kind:C1,tags:[...r,...e.tags??[]],content:e.content,created_at:e.created_at},n)},lk=(e,n)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return Er({kind:R1,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:r,created_at:e.created_at},n)},fk=(e,n)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return Er({kind:T1,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:r,created_at:e.created_at},n)},hk={};xe(hk,{EMOJI_SHORTCODE_REGEX:()=>W1,matchAll:()=>dk,regex:()=>hh,replaceAll:()=>pk});var W1=/:(\w+):/,hh=()=>new RegExp(`\\B${W1.source}\\B`,"g");function*dk(e){const n=e.matchAll(hh());for(const r of n)try{const[i,o]=r;yield{shortcode:i,name:o,start:r.index,end:r.index+i.length}}catch{}}function pk(e,n){return e.replaceAll(hh(),(r,i)=>n({shortcode:r,name:i}))}var gk={};xe(gk,{useFetchImplementation:()=>yk,validateGithub:()=>wk});var dh;try{dh=fetch}catch{}function yk(e){dh=e}async function wk(e,n,r){try{return await(await dh(`https://gist.github.com/${n}/${r}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var mk={};xe(mk,{default:()=>xk,v2:()=>G1});var bk=new TextDecoder,Me={minPlaintextSize:1,maxPlaintextSize:65535,utf8Encode:o1,utf8Decode(e){return bk.decode(e)},getConversationKey(e,n){const r=Wi.getSharedSecret(e,"02"+n).subarray(1,33);return JI(wi,r,"nip44-v2")},getMessageKeys(e,n){const r=YI(wi,e,n,76);return{chacha_key:r.subarray(0,32),chacha_nonce:r.subarray(32,44),hmac_key:r.subarray(44,76)}},calcPaddedLen(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const n=1<<Math.floor(Math.log2(e-1))+1,r=n<=256?32:n/8;return r*(Math.floor((e-1)/r)+1)},writeU16BE(e){if(!Number.isSafeInteger(e)||e<Me.minPlaintextSize||e>Me.maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const n=new Uint8Array(2);return new DataView(n.buffer).setUint16(0,e,!1),n},pad(e){const n=Me.utf8Encode(e),r=n.length,i=Me.writeU16BE(r),o=new Uint8Array(Me.calcPaddedLen(r)-r);return Ds(i,n,o)},unpad(e){const n=new DataView(e.buffer).getUint16(0),r=e.subarray(2,2+n);if(n<Me.minPlaintextSize||n>Me.maxPlaintextSize||r.length!==n||e.length!==2+Me.calcPaddedLen(n))throw new Error("invalid padding");return Me.utf8Decode(r)},hmacAad(e,n,r){if(r.length!==32)throw new Error("AAD associated data must be 32 bytes");const i=Ds(r,n);return Ma(wi,e,i)},decodePayload(e){if(typeof e!="string")throw new Error("payload must be a valid string");const n=e.length;if(n<132||n>87472)throw new Error("invalid payload length: "+n);if(e[0]==="#")throw new Error("unknown encryption version");let r;try{r=Ln.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const i=r.length;if(i<99||i>65603)throw new Error("invalid data length: "+i);const o=r[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:r.subarray(1,33),ciphertext:r.subarray(33,-32),mac:r.subarray(-32)}}};function vk(e,n,r=u1(32)){const{chacha_key:i,chacha_nonce:o,hmac_key:s}=Me.getMessageKeys(n,r),a=Me.pad(e),u=L1(i,o,a),c=Me.hmacAad(s,u,r);return Ln.encode(Ds(new Uint8Array([2]),r,u,c))}function Ek(e,n){const{nonce:r,ciphertext:i,mac:o}=Me.decodePayload(e),{chacha_key:s,chacha_nonce:a,hmac_key:u}=Me.getMessageKeys(n,r),c=Me.hmacAad(u,i,r);if(!LI(c,o))throw new Error("invalid MAC");const l=L1(s,a,i);return Me.unpad(l)}var G1={utils:Me,encrypt:vk,decrypt:Ek},xk={v2:G1},Lk={};xe(Lk,{makeNwcRequestEvent:()=>Sk,parseConnectionString:()=>Ak});function Ak(e){const{pathname:n,searchParams:r}=new URL(e),i=n,o=r.get("relay"),s=r.get("secret");if(!i||!o||!s)throw new Error("invalid connection string");return{pubkey:i,relay:o,secret:s}}async function Sk(e,n,r){const i=await F1(n,e,JSON.stringify({method:"pay_invoice",params:{invoice:r}})),o={kind:N1,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e]]};return Er(o,n)}var $k={};xe($k,{getZapEndpoint:()=>Bk,makeZapReceipt:()=>Uk,makeZapRequest:()=>kk,useFetchImplementation:()=>Ik,validateZapRequest:()=>Ok});var ph;try{ph=fetch}catch{}function Ik(e){ph=e}async function Bk(e){try{let n="",{lud06:r,lud16:i}=JSON.parse(e.content);if(r){let{words:s}=Fi.decode(r,1e3),a=Fi.fromWords(s);n=vn.decode(a)}else if(i){let[s,a]=i.split("@");n=new URL(`/.well-known/lnurlp/${s}`,`https://${a}`).toString()}else return null;let o=await(await ph(n)).json();if(o.allowsNostr&&o.nostrPubkey)return o.callback}catch{}return null}function kk({profile:e,event:n,amount:r,relays:i,comment:o=""}){if(!r)throw new Error("amount not given");if(!e)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e],["amount",r.toString()],["relays",...i]]};return n&&s.tags.push(["e",n]),s}function Ok(e){let n;try{n=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!S1(n))return"Zap request is not a valid Nostr event.";if(!oh(n))return"Invalid signature on zap request.";let r=n.tags.find(([o,s])=>o==="p"&&s);if(!r)return"Zap request doesn't have a 'p' tag.";if(!r[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let i=n.tags.find(([o,s])=>o==="e"&&s);return i&&!i[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":n.tags.find(([o,s])=>o==="relays"&&s)?null:"Zap request doesn't have a 'relays' tag."}function Uk({zapRequest:e,preimage:n,bolt11:r,paidAt:i}){let o=JSON.parse(e),s=o.tags.filter(([u])=>u==="e"||u==="p"||u==="a"),a={kind:9735,created_at:Math.round(i.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",r],["description",e]]};return n&&a.tags.push(["preimage",n]),a}var _k={};xe(_k,{getToken:()=>Ck,hashPayload:()=>gh,unpackEventFromToken:()=>J1,validateEvent:()=>nm,validateEventKind:()=>X1,validateEventMethodTag:()=>em,validateEventPayloadTag:()=>tm,validateEventTimestamp:()=>Y1,validateEventUrlTag:()=>Q1,validateToken:()=>Rk});var Z1="Nostr ";async function Ck(e,n,r,i=!1,o){const s={kind:uh,tags:[["u",e],["method",n]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",gh(o)]);const a=await r(s);return(i?Z1:"")+Ln.encode(tn.encode(JSON.stringify(a)))}async function Rk(e,n,r){const i=await J1(e).catch(o=>{throw o});return await nm(i,n,r).catch(o=>{throw o})}async function J1(e){if(!e)throw new Error("Missing token");e=e.replace(Z1,"");const n=vn.decode(Ln.decode(e));if(!n||n.length===0||!n.startsWith("{"))throw new Error("Invalid token");return JSON.parse(n)}function Y1(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function X1(e){return e.kind===uh}function Q1(e,n){const r=e.tags.find(i=>i[0]==="u");return r?r.length>0&&r[1]===n:!1}function em(e,n){const r=e.tags.find(i=>i[0]==="method");return r?r.length>0&&r[1].toLowerCase()===n.toLowerCase():!1}function gh(e){const n=wi(tn.encode(JSON.stringify(e)));return ke(n)}function tm(e,n){const r=e.tags.find(o=>o[0]==="payload");if(!r)return!1;const i=gh(n);return r.length>0&&r[1]===i}async function nm(e,n,r,i){if(!oh(e))throw new Error("Invalid nostr event, signature invalid");if(!X1(e))throw new Error("Invalid nostr event, kind invalid");if(!Y1(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Q1(e,n))throw new Error("Invalid nostr event, url tag invalid");if(!em(e,r))throw new Error("Invalid nostr event, method tag invalid");if(i&&typeof i=="object"&&Object.keys(i).length>0&&!tm(e,i))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var ei=Symbol("verified"),Tk=e=>e instanceof Object;function Pk(e){if(!Tk(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let n=0;n<e.tags.length;n++){let r=e.tags[n];if(!Array.isArray(r))return!1;for(let i=0;i<r.length;i++)if(typeof r[i]=="object")return!1}return!0}new TextDecoder("utf-8");var Nk=new TextEncoder,Hk=class{generateSecretKey(){return zt.utils.randomPrivateKey()}getPublicKey(e){return ke(zt.getPublicKey(e))}finalizeEvent(e,n){const r=e;return r.pubkey=ke(zt.getPublicKey(n)),r.id=Qu(r),r.sig=ke(zt.sign(Qu(r),n)),r[ei]=!0,r}verifyEvent(e){if(typeof e[ei]=="boolean")return e[ei];const n=Qu(e);if(n!==e.id)return e[ei]=!1,!1;try{const r=zt.verify(e.sig,n,e.pubkey);return e[ei]=r,r}catch{return e[ei]=!1,!1}}};function jk(e){if(!Pk(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Qu(e){let n=wi(Nk.encode(jk(e)));return ke(n)}var Ga=new Hk,rm=Ga.generateSecretKey,Fk=Ga.getPublicKey;Ga.finalizeEvent;Ga.verifyEvent;(()=>{try{if(window.WeakMap)return()=>new WeakMap}catch{}return()=>new Map})();function yh(e){const n=Mk(e,"|",15,36);if(n===-1)throw new Error("CacheString:Expecting a '|'");const[r,i]=e.slice(0,n).split(","),o=e.slice(n+1),s=parseInt(r),a=parseInt(i),u=JSON.parse(o);return{updateTime:s,duration:a,value:u}}function Mk(e,n,r,i){e.length-1<i&&(i=e.length-1);for(let o=r;o<=i;o++)if(e[o]===n)return o;return-1}class zk{constructor(n){this.LIST_KEY=n,this.init()}init(){const n=localStorage.getItem(this.LIST_KEY);if(!n){this.keyList=new Set;return}const r=JSON.parse(n);if(!Array.isArray(r)){this.keyList=new Set;return}this.keyList=new Set(r)}add(n){this.keyList.add(n),this.updateKeyList()}delete(n){this.keyList.delete(n),this.updateKeyList()}getKeys(){return this.keyList}updateKeyList(){const n=JSON.stringify(Array.from(this.keyList));localStorage.setItem(this.LIST_KEY,n)}clear(){localStorage.removeItem(this.LIST_KEY)}}const im=new zk("__cache_key_list_");setTimeout(()=>{qk()});function qk(){const e=window.localStorage,n=im.getKeys();for(const r of n)try{const i=e.getItem(r);if(!i)continue;const o=yh(i);if(!wh(o))continue;Yk(o)}catch{e.removeItem(r)}}window.clearCache=Kk;function Kk(){const e=window.localStorage,n=im.getKeys();for(const r of n)try{const i=e.getItem(r);if(!i)continue;const o=yh(i);if(!wh(o))continue;e.removeItem(r)}catch{}}window.clearCacheAll=Dk;function Dk(){const e=window.localStorage,n=e.length;for(let r=0;r<n;r++){const i=e.key(r);if(!i)continue;const o=e.getItem(i);if(o)try{const s=yh(o);if(!wh(s))continue;e.removeItem(i)}catch{continue}}}var bi=typeof Reflect=="object"?Reflect:null,sp=bi&&typeof bi.apply=="function"?bi.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},ss;bi&&typeof bi.ownKeys=="function"?ss=bi.ownKeys:Object.getOwnPropertySymbols?ss=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ss=function(e){return Object.getOwnPropertyNames(e)};function Vk(e){console&&console.warn&&console.warn(e)}var om=Number.isNaN||function(e){return e!==e};function ie(){ie.init.call(this)}ie.EventEmitter=ie;ie.prototype._events=void 0;ie.prototype._eventsCount=0;ie.prototype._maxListeners=void 0;var ap=10;function Za(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(ie,"defaultMaxListeners",{enumerable:!0,get:function(){return ap},set:function(e){if(typeof e!="number"||e<0||om(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");ap=e}});ie.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ie.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||om(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function sm(e){return e._maxListeners===void 0?ie.defaultMaxListeners:e._maxListeners}ie.prototype.getMaxListeners=function(){return sm(this)};ie.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")sp(u,this,n);else for(var c=u.length,l=fm(u,c),r=0;r<c;++r)sp(l[r],this,n);return!0};function am(e,n,r,i){var o,s,a;if(Za(r),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",n,r.listener?r.listener:r),s=e._events),a=s[n]),a===void 0)a=s[n]=r,++e._eventsCount;else if(typeof a=="function"?a=s[n]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),o=sm(e),o>0&&a.length>o&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=n,u.count=a.length,Vk(u)}return e}ie.prototype.addListener=function(e,n){return am(this,e,n,!1)};ie.prototype.on=ie.prototype.addListener;ie.prototype.prependListener=function(e,n){return am(this,e,n,!0)};function Wk(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function um(e,n,r){var i={fired:!1,wrapFn:void 0,target:e,type:n,listener:r},o=Wk.bind(i);return o.listener=r,i.wrapFn=o,o}ie.prototype.once=function(e,n){return Za(n),this.on(e,um(this,e,n)),this};ie.prototype.prependOnceListener=function(e,n){return Za(n),this.prependListener(e,um(this,e,n)),this};ie.prototype.removeListener=function(e,n){var r,i,o,s,a;if(Za(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){a=r[s].listener,o=s;break}if(o<0)return this;o===0?r.shift():Gk(r,o),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};ie.prototype.off=ie.prototype.removeListener;ie.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function cm(e,n,r){var i=e._events;if(i===void 0)return[];var o=i[n];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?Zk(o):fm(o,o.length)}ie.prototype.listeners=function(e){return cm(this,e,!0)};ie.prototype.rawListeners=function(e){return cm(this,e,!1)};ie.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):lm.call(e,n)};ie.prototype.listenerCount=lm;function lm(e){var n=this._events;if(n!==void 0){var r=n[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}ie.prototype.eventNames=function(){return this._eventsCount>0?ss(this._events):[]};function fm(e,n){for(var r=new Array(n),i=0;i<n;++i)r[i]=e[i];return r}function Gk(e,n){for(;n+1<e.length;n++)e[n]=e[n+1];e.pop()}function Zk(e){for(var n=new Array(e.length),r=0;r<n.length;++r)n[r]=e[r].listener||e[r];return n}const Jk=new ie;Jk.setMaxListeners(1e3);const ec=Symbol("noCache");function Yk(e){if(!e)throw ec;const n=Date.now(),r=e.updateTime,i=e.duration;try{if(!(n-r<i))throw ec}catch{throw ec}}function wh(e){return!(!e||typeof e!="object"||typeof e.updateTime!="number"||typeof e.duration!="number")}function as(e,n){let r=new Set(n);return e.filter(i=>r.has(i[0]))}function mh(e,n){for(const r of n)if(r[0]===e)return r;return null}function Xk(e){return Object.entries(e).map(([n,{read:r,write:i}])=>{let o=["r",n];if(r){if(i)return o;o.push("read")}else o.push("write");return o})}function up(e){const n=new Set,r=new Set,i={};if(e)for(const o of e)o[0]==="r"&&(o[2]==="read"?(n.add(o[1]),i[o[1]]={read:!0,write:!1}):o[2]==="write"?(r.add(o[1]),i[o[1]]={read:!1,write:!0}):(n.add(o[1]),r.add(o[1]),i[o[1]]={read:!0,write:!0}));return{read:n,write:r,config:i}}function hm(e){const{read:n,write:r}=dm(e),i={read:n,write:r,config:{}};for(const o of n)(i.config[o]??(i.config[o]={read:!1,write:!1})).read=!0;for(const o of r)(i.config[o]??(i.config[o]={read:!1,write:!1})).write=!0;return{relayConfiguration:i,readUrl:n,writeUrl:r}}function dm(e){const n=new Set,r=new Set,i=new Set;if(e)for(const o of e)o[0]==="r"&&(i.add(o[1]),o[2]==="read"?n.add(o[1]):(o[2]==="write"||n.add(o[1]),r.add(o[1])));return{read:n,write:r,urls:i}}function pm(e){try{const o=dr.decode(e);if(o.type==="naddr")return o.data}catch{}const[n,r,i]=e.split(":");if(n&&r&&i)try{return{kind:parseInt(n),identifier:i,pubkey:r}}catch{}return null}function Qk(e){if(!e)return null;if(e7(e))return pr.fromHex(e);try{const n=dr.decode(e);return n.type==="nsec"?pr.fromHex(n.data):null}catch{return null}}function e7(e){try{const n=dr.nsecEncode(pr.fromHex(e));return pr.fromUint8Array(dr.decode(n).data).toHex()===e}catch{return!1}}function t7(){return Tf(rm())}function gm(e){return new We(jw.getPublicKey(e))}let ym=class il extends Uint8Array{constructor(n){super(typeof n=="string"?Ps(n):n),this._hex=null}static fromHex(n){return new il(Ps(n))}static fromUint8Array(n){return new il(n)}toHex(){return this._hex||(this._hex=Tf(this))}toString(){return this.toHex()}},pr=class us extends ym{constructor(){super(...arguments),this._pubkey=null}static create(){return new us(rm())}static fromHex(n){return new us(Ps(n))}static fromString(n){return Qk(n)}static fromUint8Array(n){return new us(n)}getPubkey(){return this._pubkey||(this._pubkey=We.fromHex(Fk(this)))}getNsec(){return dr.nsecEncode(this)}},We=class cs extends ym{constructor(){super(...arguments),this.relays=[]}static fromPrikey(n){return n.getPubkey()}static fromHex(n){return new cs(Ps(n))}static fromUint8Array(n){return new cs(n)}static fromMaybeHex(n){return typeof n=="string"?cs.fromHex(n):n}getNpub(){return dr.npubEncode(this.toHex())}toNpub(){return this.getNpub()}toNprofile(n){dr.nprofileEncode({pubkey:this.toHex(),relays:n&&this.relays})}};function n7(e,n){return jw.sign(mi(e),n)}function r7(e,n){const r=e;return r.pubkey=gm(n).toString(),r.id=mi(r),r.sig=Tf(n7(r,n)),r[Ar]=!0,r}function cp(e){console.log("e.content",e),console.log("e.content",e.content);try{return JSON.parse(e.content)}catch{return{}}}const i7={type:"emoji",handle(e){return{type:"emoji",shortcode:e[1],imageUrl:e[2]}},toTagArray(e){return[e.type,e.shortcode,e.imageUrl]},isEq(e,n){return["type","shortcode","imageUrl"].every(r=>e[r]===n[r])}},o7={type:"relay",handle(e){return{type:"relay",relay:e[1]}},toTagArray(e){return[e.type,e.relay]},isEq(e,n){return e.type===n.type&&e.relay===n.relay}},s7={type:"a",handle(e){const n=pm(e[1]);return{type:"a",relayUrl:e[2],identifier:(n==null?void 0:n.identifier)??"",pubkey:(n==null?void 0:n.pubkey)??"",kind:(n==null?void 0:n.kind)??0}},toTagArray(e){let n=[e.type,`${e.kind}:${e.pubkey}:${e.identifier}`];return e.relayUrl&&n.push(e.relayUrl),n},isEq(e,n){return["type","kind","pubkey","identifier"].every(r=>e[r]===n[r])}},a7={type:"r",handle(e){return{type:"r",urls:e[1],petname:e[2]}},toTagArray(e){let n=[e.type,e.urls];return e.petname&&n.push(e.petname),n},isEq(e,n){return e.type===n.type&&e.urls===n.urls}},u7={type:"word",handle(e){return{type:"word",value:e[1]}},toTagArray(e){return[e.type,e.value]},isEq(e,n){return e.type===n.type&&e.value===n.value}},c7={type:"t",handle(e){return{type:"t",name:e[1]}},toTagArray(e){return[e.type,e.name]},isEq(e,n){return e.type===n.type&&e.name===n.name}},l7={type:"p",handle(e){return{type:"p",pubkey:e[1],relay:e[2]}},toTagArray(e){let n=[e.type,e.pubkey];return e.relay&&n.push(e.relay),n},isEq(e,n){return e.type===n.type&&e.pubkey===n.pubkey}},f7={type:"e",handle(e){return{type:"e",id:e[1],relay:e[2]}},toTagArray(e){return[e.type,e.id,...e.relay?[e.relay]:[]]},isEq(e,n){return e.type===n.type&&e.id===n.id}},h7={type:"i",handle(e){return{type:"i",value:e[1]}},toTagArray(e){return[e.type,e.value]},isEq(e,n){return e.type===n.type&&e.value===n.value}},d7={type:"version",handle(e){return{type:"version",value:e[1]}},toTagArray(e){return[e.type,e.value]},isEq(e,n){return e.type===n.type&&e.value===n.value}},p7={type:"p",handle(e){return{type:"p",pubkey:e[1],relay:e[2],petname:e[3]}},toTagArray(e){let n=[e.type,e.pubkey];return e.relay&&n.push(e.relay),n},isEq(e,n){return e.pubkey===n.pubkey}},g7=Object.freeze(Object.defineProperty({__proto__:null,a:s7,e:f7,emoji:i7,follow:p7,i:h7,p:l7,r:a7,relay:o7,t:c7,version:d7,word:u7},Symbol.toStringTag,{value:"Module"}));class wm{constructor(n){this.handleMap={};for(const r of n)this.add(r)}add(n){return this.handleMap[n.type]=n,this}tagIsEq(n,r){if(n.type!==r.type)return!1;const i=n.type;let o=this.getHandle(i);return o?o.isEq(n,r):JSON.stringify(n)===JSON.stringify(r)}getHandle(n){return this.handleMap[n]}handleOne(n){let r=n[0];if(!r)return;let i=this.getHandle(r);if(i)return i.handle(n)}handle(n){let r=[];for(const i of n){let o=this.handleOne(i);o&&r.push(o)}return r}toTagArray(n){let r=this.getHandle(n.type);if(r)return r.toTagArray(n)}toTagArrayList(n){const r=[];for(const i of n){let o=this.toTagArray(i);o&&r.push(o)}return r}}class Uo extends ba{constructor(n){super(),n?(this.nostrApiProvide.resolve({async encrypt(r,i){return await jc.encrypt(n,r.toHex(),i)},async decrypt(r,i){return await jc.decrypt(n,r.toHex(),i)},async signEvent(r){const i=r7(Object.assign({kind:1,pubkey:n.getPubkey(),created_at:Math.floor(Date.now()/1e3),tags:[],content:""},r),n);return Promise.resolve(i)},async getPublicKey(){return n.getPubkey()}}),this.getPrikey=()=>n):this.nostrApiProvide.resolve(new af)}}class mm extends ba{constructor(){super(),this.provide()}provide(){G4(async()=>{if(window.nostr){this.nostrApiProvide.resolve(this.windowNostrToNostrApi(window.nostr));return}else this.nostrApiProvide.reject(new Ky("WebNostrApi"))})}windowNostrToNostrApi(n){let r={};n.getRelays&&(r.getRelays=n.getRelays.bind(n)),n.signEvent&&(r.signEvent=n.signEvent.bind(n)),n.getPublicKey&&(r.getPublicKey=async()=>We.fromHex(await n.getPublicKey()));let i=n.nip04;if(i){if(i.decrypt){let o=i.decrypt.bind(i);r.decrypt=(s,a)=>(i.decrypt??o)(s.toHex(),a)}if(i.encrypt){let o=i.encrypt.bind(i);r.encrypt=(s,a)=>(i.encrypt??o)(s.toHex(),a)}}return r}}const bh=z("now-create-at",e=>e.assignFn({nowCreateAt(){return Math.floor(Date.now()/1e3)}})),vh=z("nostr-api",({mod:e,line:n})=>e.assignFeat({nostrApi:new af,getNostrApi(){return this.nostrApi},setNostrApi(r){this.nostrApi=r}})),bm="prikey",Ja=z(()=>[bh,vh],"login",({mod:e,line:n})=>e.assignFn({logout(){this.nostrApi=oi()}}).inLine(r=>r.setNostrApi(y7(r))).assignFn({testAndVerifyNewUser(){const r=localStorage.getItem("newUserFlag"),i=localStorage.getItem("prikey"),o=i&&gm(pr.fromHex(i));return!!(go()===kt.PrivateKey&&r&&r===o)},getNostrApiMode:go,setNostrApiMode:so,loginPrikey(r){localStorage.setItem(bm,r.toHex()),so(kt.PrivateKey);const i=new Uo(r);this.setNostrApi(i)},windowNostrLogin(){let r=new mm;this.loginApi(kt.WindowNostr,r)},loginApi(r,i){so(r),this.setNostrApi(i)},registerPrikey(r=pr.create()){this.loginPrikey(r);const i=r.getPubkey();return localStorage.setItem("newUserFlag",i.toHex()),r},clearNewUserFlag(){localStorage.removeItem("newUserFlag")}}));function y7(e){switch(go()){case kt.NotLogin:return oi();case kt.WindowNostr:return new mm;case kt.PrivateKey:const n=localStorage.getItem(bm);return n?new Uo(pr.fromHex(n)):oi();case kt.NostrConnect:const r=localStorage.getItem("bunker");if(!r)return oi();try{const i=Uh.fromBunker(e,r);return i.connect(),i}catch{return oi()}default:return oi()}}function oi(){return so(kt.NotLogin),new af}const Zi=z(()=>[vh],({mod:e,line:n})=>e.assignFn({async getPrikeyOrNull(){if(go()!==kt.PrivateKey)return null;let r=this.getNostrApi();if(!(r instanceof Uo))return null;if(r.getPrikey){try{return r.getPrikey()}catch{}return null}},async getPubkeyOrNull(r){try{return await this.getNostrApi().getPublicKey()}catch{return null}},async isLogin(){return!!this.getPubkeyOrNull()}})),_o=z(()=>[n0("pool-staff")],e=>e.assignFeat({publish(n,r,i={}){this.relayPool.getLine().onOK((o,s)=>{var a;(a=i.onOK)==null||a.call(i,o,s)},{eventId:r.id}),this.relayPool.getLine().emit("publish",n,r)},publishes(n,r,i={}){for(const o of n)this.publish(o,r,i)},publishEvents(n,r,i={}){for(const o of r)this.publish(n,o,i)},publishesEvents(n,r,i={}){for(const o of r)this.publishes(n,o,i)}})),vm=z("create-id",e=>e.defineFeat("createId",ky)),Ya=z(e=>e.defineEmit().assignChain({emitEose(n,r){this.emit({once:!0,type:`eose:${n}`,noPause:!0},n,r),this.emit({type:"eose",noPause:!0},n,r)},onEose(n,r){r!=null&&r.subId?this.on(`eose:${r.subId}`,n,Object.assign({once:!0},r)):this.on("eose",n,r)}}));let w7=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/sub/SubStaff.ts");const Co=z(()=>[vm,n0("pool-staff"),rn,Ya],e=>e.assignFn({sub(n,r,{onEvent:i,onEose:o,subId:s,eoseAutoDesub:a}={}){w7.silly("sub",n,r);let u=s||this.createId();this.relayPool.getLine().onEvent((...c)=>{this.emitEvent(...c)},{subId:u}),this.relayPool.getLine().onEose((c,l)=>{a&&this.relayPool.getLine().emit("desub",c,l),this.emitEose(c,l)},{subId:u}),this.relayPool.getLine().emit("sub",n,r,u)},subs(n,r,i){for(const o of n)this.sub(o,r,i)}})),Ro=z(e=>e.defineEmit().assignOwnFeat(()=>({urlList:new Set})).assignFeat({getUrls(){this.urlList}}).assignChain({addUrl(n){this.addUrls(new Set([n]))},addUrls(n){if(n.size===0)return;let r=new Set;for(const i of n)this.urlList.has(i)||(this.urlList.add(i),r.add(i));r.size>0&&this.emit("add-urls",r)}}).assignFeat({async addUrlsOrNull(n,r){if(!(!n||n.size===0))return this.addUrls(n),await(r==null?void 0:r())},async addUrlsWithTimeout(n,r=1e3){return await this.addUrlsOrNull(n,()=>rt(r))}})),Em=z(({mod:e,line:n})=>e.assignOwnFeat(()=>({filterList:new Array}))),Zr=z(()=>[Ro,wr,_o,Co,Em],"add-filter-staff",e=>{let n=e.defineEmit().assignOwnFeat(()=>({filterMap:new Map,subOpts:void 0})).assignFeat({getFilters(){return this.filterList}}).assignChain({setSubOpt(r){this.subOpts=r},addFilter(r){this.addFilters([r])},addFiltersByOptions(r){r.filters&&this.addFilters(r.filters),r.filter&&this.addFilter(r.filter)},addFilters(r){if(r.length===0)return;let i=[];for(const o of r){let s=JSON.stringify(o);this.filterMap.has(s)||(this.filterMap.set(s,o),this.filterList.push(o),i.push(o))}i.length>0&&this.emit("add-filters",i)}});return n.line.onCreateChildDep(r=>{console.log("onCreateChildDep"),r.on("add-urls",i=>{r.subs(i,r.filterList,r.subOpts),r.on("add-filters",o=>{r.subs(i,o,r.subOpts)})})}),n}),To=z(()=>[Ro,wr,_o],"AddPublishStaff",({mod:e,line:n})=>{let r=e.defineEmit().assignOwnFeat(()=>({publishedEventIds:new Set,publishedEventList:[]})).assignChain({addPublish(i,o){this.publishedEventIds.has(i.id)||(this.emit("add-publish",i,o),this.publishedEventIds.add(i.id),this.publishedEventList.push(o?[i,o]:[i]))},addPublishes(i,o){for(const s of i)this.addPublish(s,o)}});return r.line.onCreateChildDep(i=>{i.on("add-urls",o=>{i.publishedEventList.map(([s,a])=>{i.publishes(o,s,a)}),i.on("add-publish",(s,a)=>{i.publishes(o,s,a)})})}),r}),m7=z(()=>[ru,To,iu,No],({mod:e,line:n})=>e.assignFn({async deleteEvent(r){console.log("deleteEvent",r);const i=this.createChild(),o=[];r.eventId&&o.push(["e",r.eventId]),r.a&&o.push(["a",r.a]),i.addPublish(await n.createEvent({kind:5,tags:o,content:""}),r.publishOpts),i.addUrlsByCubChain(r),i.asyncCall(async function(){this.addUrls(await this.relayConfigurator.initedGetWriteList())})}})),b7=z(()=>[Po,Oh,Zi,Zr,ru,To,iu,m7,Jr,No],({mod:e,line:n})=>e.assignFeat({reactionCache:n.reactive(new Ql("reaction-cache")),reactionsKeyList:n.reactive(new Xl("__reactionsKeyList"))}).assignFn({getLikeByPubkey(r,i){return r=typeof r=="string"?We.fromHex(r):r,this.commonEventList({...i,pubkey:r,filters:[{authors:[r.toHex()],kinds:[7],limit:20}]})},async sendReactions(r,i,o){if(this.hasReactions(r,i.id))return;let s=as(i.tags,["e","p"]);s.push(["e",i.id]),s.push(["p",i.pubkey]),s.push(["k",i.kind.toString()]);const a=this.createChild(),u=await this.createEvent({content:r,kind:7,tags:s});a.addPublish(u,o),a.addUrlsByCub({...o,autoAdd10002Options:{read:!0},pubkeys:[i.pubkey],tags:i.tags}),a.addUrls(await this.relayConfigurator.initedGetWriteList()),this.reactionCache.set(this.createReactionsKey(r,i.id),u.id)},async sendLike(r,i){await this.sendReactions("+",r,i)},async sendDislike(r,i){await this.sendReactions("-",r,i)},async deleteReactions(r,i){if(i.eventId){const o=this.createReactionsKey(r,i.eventId);let s=this.reactionCache.get(o);s&&this.deleteEvent({eventId:s,publishOpts:i.onOK?{onOK:i.onOK}:void 0,autoAdd10002Options:{read:!0},...i.cue})}else i.likeId&&this.deleteEvent({eventId:i.likeId,publishOpts:i.onOK?{onOK:i.onOK}:void 0,autoAdd10002Options:{read:!0},...i.cue})},deleteLike(r){this.deleteReactions("+",r)},deleteDislike(r){this.deleteReactions("-",r)},hasReactions(r,i){const o=this.createReactionsKey(r,i);return!!this.reactionCache.get(o)},hasLike(r){return this.hasReactions("+",r)},hasDislike(r){return this.hasReactions("-",r)},createReactionsKey(r,i){return`reaction:${r}:${i}`},getReactionByEventId(r,i){return this.cacheByOptions(i,()=>this.createChild().add(yo).add(Cn).add(Wm).add(v7).provideReactionMap().addFilters([{"#e":[r],kinds:[7],limit:20}]).onEvent((o,s)=>{this.reactionsKeyList.add(s.content)}).chainCall(()=>this.addUrlsByCub(i)))},getReactionByEvent(r,i){return this.getReactionByEventId(r.id,{...i,pubkeys:[r.pubkey],autoAdd10002Options:{write:!0}})}})),v7=z(()=>[Jr,rn],({mod:e,line:n})=>e.provide("ReactionMap",function(){let r=n.reactive({});return this.onEvent((i,o)=>{r[o.content]??(r[o.content]=[]).push(o)}),r}).assignFn({getReactiveMap(){return this.injectReactionMap()}}));class Xa{constructor(n){return n.add(b7).reactive(this)}}var E7=Object.defineProperty,x7=(e,n,r)=>n in e?E7(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,Se=(e,n,r)=>(x7(e,typeof n!="symbol"?n+"":n,r),r),Eh=(e,n,r)=>{if(!n.has(e))throw TypeError("Cannot "+r)},M=(e,n,r)=>(Eh(e,n,"read from private field"),r?r.call(e):n.get(e)),et=(e,n,r)=>{if(n.has(e))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(e):n.set(e,r)},Le=(e,n,r,i)=>(Eh(e,n,"write to private field"),i?i.call(e,r):n.set(e,r),r),_r=(e,n,r)=>(Eh(e,n,"access private method"),r),ae=(e=>(e[e.Error=0]="Error",e[e.Warn=1]="Warn",e[e.Info=2]="Info",e[e.Http=3]="Http",e[e.Verbose=4]="Verbose",e[e.Debug=5]="Debug",e[e.Silly=6]="Silly",e))(ae||{});function L7(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var xh={exports:{}},vi=typeof Reflect=="object"?Reflect:null,lp=vi&&typeof vi.apply=="function"?vi.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},ls;vi&&typeof vi.ownKeys=="function"?ls=vi.ownKeys:Object.getOwnPropertySymbols?ls=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ls=function(e){return Object.getOwnPropertyNames(e)};function A7(e){console&&console.warn&&console.warn(e)}var xm=Number.isNaN||function(e){return e!==e};function oe(){oe.init.call(this)}xh.exports=oe;xh.exports.once=B7;oe.EventEmitter=oe;oe.prototype._events=void 0;oe.prototype._eventsCount=0;oe.prototype._maxListeners=void 0;var fp=10;function Qa(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(oe,"defaultMaxListeners",{enumerable:!0,get:function(){return fp},set:function(e){if(typeof e!="number"||e<0||xm(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");fp=e}});oe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};oe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||xm(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Lm(e){return e._maxListeners===void 0?oe.defaultMaxListeners:e._maxListeners}oe.prototype.getMaxListeners=function(){return Lm(this)};oe.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")lp(u,this,n);else for(var c=u.length,l=Bm(u,c),r=0;r<c;++r)lp(l[r],this,n);return!0};function Am(e,n,r,i){var o,s,a;if(Qa(r),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",n,r.listener?r.listener:r),s=e._events),a=s[n]),a===void 0)a=s[n]=r,++e._eventsCount;else if(typeof a=="function"?a=s[n]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),o=Lm(e),o>0&&a.length>o&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=n,u.count=a.length,A7(u)}return e}oe.prototype.addListener=function(e,n){return Am(this,e,n,!1)};oe.prototype.on=oe.prototype.addListener;oe.prototype.prependListener=function(e,n){return Am(this,e,n,!0)};function S7(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Sm(e,n,r){var i={fired:!1,wrapFn:void 0,target:e,type:n,listener:r},o=S7.bind(i);return o.listener=r,i.wrapFn=o,o}oe.prototype.once=function(e,n){return Qa(n),this.on(e,Sm(this,e,n)),this};oe.prototype.prependOnceListener=function(e,n){return Qa(n),this.prependListener(e,Sm(this,e,n)),this};oe.prototype.removeListener=function(e,n){var r,i,o,s,a;if(Qa(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){a=r[s].listener,o=s;break}if(o<0)return this;o===0?r.shift():$7(r,o),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};oe.prototype.off=oe.prototype.removeListener;oe.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function $m(e,n,r){var i=e._events;if(i===void 0)return[];var o=i[n];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?I7(o):Bm(o,o.length)}oe.prototype.listeners=function(e){return $m(this,e,!0)};oe.prototype.rawListeners=function(e){return $m(this,e,!1)};oe.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):Im.call(e,n)};oe.prototype.listenerCount=Im;function Im(e){var n=this._events;if(n!==void 0){var r=n[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}oe.prototype.eventNames=function(){return this._eventsCount>0?ls(this._events):[]};function Bm(e,n){for(var r=new Array(n),i=0;i<n;++i)r[i]=e[i];return r}function $7(e,n){for(;n+1<e.length;n++)e[n]=e[n+1];e.pop()}function I7(e){for(var n=new Array(e.length),r=0;r<n.length;++r)n[r]=e[r].listener||e[r];return n}function B7(e,n){return new Promise(function(r,i){function o(a){e.removeListener(n,s),i(a)}function s(){typeof e.removeListener=="function"&&e.removeListener("error",o),r([].slice.call(arguments))}km(e,n,s,{once:!0}),n!=="error"&&k7(e,o,{once:!0})})}function k7(e,n,r){typeof e.on=="function"&&km(e,"error",n,r)}function km(e,n,r,i){if(typeof e.on=="function")i.once?e.once(n,r):e.on(n,r);else if(typeof e.addEventListener=="function")e.addEventListener(n,function o(s){i.once&&e.removeEventListener(n,o),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var O7=xh.exports;class U7{constructor(n,r,i,o){this.factory=i,this.config={},this.filters=[],this.contexts=[],this.emitter=new O7.EventEmitter,this.config=r,this.path=n;let s=o.reduce((a,u)=>u(a,i)??a,this);return this.emitter.emit("created"),s}setConfig(n){return this.config=n,this}getConfig(){return this.config}assignConfig(n,r=!0){return this.setConfig(r?Object.assign({},this.config,n):Object.assign(this.config,n)),this}addContext(n){this.contexts.push(n)}addFilter(n){this.filters.push(n)}_log(n,r){this.filter(n)&&this.context(n,r)}filter(n){return this.filters.every(r=>r(this,n))}context(n,r){for(const i of this.contexts)i({level:n},r)}log(n,...r){return this._log(n,r),this}silly(...n){return this._log(ae.Silly,n),this}debug(...n){return this._log(ae.Debug,n),this}verbose(...n){return this._log(ae.Verbose,n),this}http(...n){return this._log(ae.Http,n),this}info(...n){return this._log(ae.Info,n),this}warn(...n){return this._log(ae.Warn,n),this}error(...n){return this._log(ae.Error,n),this}}class _7{constructor(){this.plugins=[],this.config={}}addPlugin(n){return this.plugins.push(n),this}assignConfig(n){return Object.assign(this.config,n),this}create(n,r){return new U7(n,Object.assign({},this.config,r),this,this.plugins)}provideFactoryGlobal(n="__loggerFactory"){return window[n]=this,this}provideRootGlobal(n="logger"){return window[n]=this.getGlobal(),this}getGlobal(){return this.global??(this.global=this.create("global"))}}const hp={[ae.Error]:"error",[ae.Warn]:"warn",[ae.Info]:"info",[ae.Http]:"debug",[ae.Verbose]:"debug",[ae.Debug]:"debug",[ae.Silly]:"debug"},C7={[ae.Info]:"color: green;",[ae.Warn]:"color: orange;",[ae.Error]:"color: red;",[ae.Http]:"color: #4bcffa",[ae.Verbose]:"color: #ccae62",[ae.Debug]:"color: #7158e2",[ae.Silly]:"color: #3d3d3d"};function R7(){return(e,n)=>{const r=e;return e.addContext(({level:i},o)=>{let s=[`[${ae[i]}] %c${e.path}`,C7[i],o.length>0?`
`:"",...o];if(i===ae.Error){let a=Error(s.join(" "));if(s[0]===!1)console[hp[i]](a.message);else throw a}else console[hp[i]](...s)}),r}}function T7(){return(e,n)=>{const r=e;return r.addFilter(()=>{var i;return!((i=r.getConfig())!=null&&i.disabled)}),r.emitter.on("created",()=>{var i,o;(i=r.getConfig())!=null&&i.disabled&&((o=r.factory.global)==null||o.info("disabled:",r.path))}),r}}var P7=Om;function Om(e,n,r){e instanceof RegExp&&(e=dp(e,r)),n instanceof RegExp&&(n=dp(n,r));var i=Um(e,n,r);return i&&{start:i[0],end:i[1],pre:r.slice(0,i[0]),body:r.slice(i[0]+e.length,i[1]),post:r.slice(i[1]+n.length)}}function dp(e,n){var r=n.match(e);return r?r[0]:null}Om.range=Um;function Um(e,n,r){var i,o,s,a,u,c=r.indexOf(e),l=r.indexOf(n,c+1),f=c;if(c>=0&&l>0){if(e===n)return[c,l];for(i=[],s=r.length;f>=0&&!u;)f==c?(i.push(f),c=r.indexOf(e,f+1)):i.length==1?u=[i.pop(),l]:(o=i.pop(),o<s&&(s=o,a=l),l=r.indexOf(n,f+1)),f=c<l&&c>=0?c:l;i.length&&(u=[s,a])}return u}var _m=P7,N7=F7,Cm="\0SLASH"+Math.random()+"\0",Rm="\0OPEN"+Math.random()+"\0",Lh="\0CLOSE"+Math.random()+"\0",Tm="\0COMMA"+Math.random()+"\0",Pm="\0PERIOD"+Math.random()+"\0";function tc(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function H7(e){return e.split("\\\\").join(Cm).split("\\{").join(Rm).split("\\}").join(Lh).split("\\,").join(Tm).split("\\.").join(Pm)}function j7(e){return e.split(Cm).join("\\").split(Rm).join("{").split(Lh).join("}").split(Tm).join(",").split(Pm).join(".")}function Nm(e){if(!e)return[""];var n=[],r=_m("{","}",e);if(!r)return e.split(",");var i=r.pre,o=r.body,s=r.post,a=i.split(",");a[a.length-1]+="{"+o+"}";var u=Nm(s);return s.length&&(a[a.length-1]+=u.shift(),a.push.apply(a,u)),n.push.apply(n,a),n}function F7(e){return e?(e.substr(0,2)==="{}"&&(e="\\{\\}"+e.substr(2)),no(H7(e),!0).map(j7)):[]}function M7(e){return"{"+e+"}"}function z7(e){return/^-?0\d/.test(e)}function q7(e,n){return e<=n}function K7(e,n){return e>=n}function no(e,n){var r=[],i=_m("{","}",e);if(!i)return[e];var o=i.pre,s=i.post.length?no(i.post,!1):[""];if(/\$$/.test(i.pre))for(var a=0;a<s.length;a++){var u=o+"{"+i.body+"}"+s[a];r.push(u)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),l=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),f=c||l,h=i.body.indexOf(",")>=0;if(!f&&!h)return i.post.match(/,.*\}/)?(e=i.pre+"{"+i.body+Lh+i.post,no(e)):[e];var p;if(f)p=i.body.split(/\.\./);else if(p=Nm(i.body),p.length===1&&(p=no(p[0],!1).map(M7),p.length===1))return s.map(function(U){return i.pre+p[0]+U});var b;if(f){var y=tc(p[0]),d=tc(p[1]),g=Math.max(p[0].length,p[1].length),m=p.length==3?Math.abs(tc(p[2])):1,x=q7,S=d<y;S&&(m*=-1,x=K7);var O=p.some(z7);b=[];for(var B=y;x(B,d);B+=m){var E;if(l)E=String.fromCharCode(B),E==="\\"&&(E="");else if(E=String(B),O){var L=g-E.length;if(L>0){var I=new Array(L+1).join("0");B<0?E="-"+I+E.slice(1):E=I+E}}b.push(E)}}else{b=[];for(var R=0;R<p.length;R++)b.push.apply(b,no(p[R],!1))}for(var R=0;R<b.length;R++)for(var a=0;a<s.length;a++){var u=o+b[R]+s[a];(!n||f||u)&&r.push(u)}}return r}const D7=L7(N7),V7=1024*64,Ws=e=>{if(typeof e!="string")throw new TypeError("invalid pattern");if(e.length>V7)throw new TypeError("pattern is too long")},W7={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},to=e=>e.replace(/[[\]\\-]/g,"\\$&"),G7=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),pp=e=>e.join(""),Z7=(e,n)=>{const r=n;if(e.charAt(r)!=="[")throw new Error("not in a brace expression");const i=[],o=[];let s=r+1,a=!1,u=!1,c=!1,l=!1,f=r,h="";e:for(;s<e.length;){const y=e.charAt(s);if((y==="!"||y==="^")&&s===r+1){l=!0,s++;continue}if(y==="]"&&a&&!c){f=s+1;break}if(a=!0,y==="\\"&&!c){c=!0,s++;continue}if(y==="["&&!c){for(const[d,[g,m,x]]of Object.entries(W7))if(e.startsWith(d,s)){if(h)return["$.",!1,e.length-r,!0];s+=d.length,x?o.push(g):i.push(g),u=u||m;continue e}}if(c=!1,h){y>h?i.push(to(h)+"-"+to(y)):y===h&&i.push(to(y)),h="",s++;continue}if(e.startsWith("-]",s+1)){i.push(to(y+"-")),s+=2;continue}if(e.startsWith("-",s+1)){h=y,s+=2;continue}i.push(to(y)),s++}if(f<s)return["",!1,0,!1];if(!i.length&&!o.length)return["$.",!1,e.length-r,!0];if(o.length===0&&i.length===1&&/^\\?.$/.test(i[0])&&!l){const y=i[0].length===2?i[0].slice(-1):i[0];return[G7(y),!1,f-r,!1]}const p="["+(l?"^":"")+pp(i)+"]",b="["+(l?"":"^")+pp(o)+"]";return[i.length&&o.length?"("+p+"|"+b+")":i.length?p:b,u,f-r,!0]},uo=(e,{windowsPathsNoEscape:n=!1}={})=>n?e.replace(/\[([^\/\\])\]/g,"$1"):e.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),J7=new Set(["!","?","+","*","@"]),gp=e=>J7.has(e),Y7="(?!(?:^|/)\\.\\.?(?:$|/))",Wo="(?!\\.)",X7=new Set(["[","."]),Q7=new Set(["..","."]),eO=new Set("().*{}+?[]^$\\!"),tO=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Ah="[^/]",Hm=Ah+"*?",jm=Ah+"+?";var $e,He,Xn,fe,Ae,Cr,li,jr,Jn,si,Gs,ol,Fm,ro,fs,hs,sl,al,Mm;const cn=class Sr{constructor(n,r,i={}){et(this,ol),et(this,hs),Se(this,"type"),et(this,$e,void 0),et(this,He,void 0),et(this,Xn,!1),et(this,fe,[]),et(this,Ae,void 0),et(this,Cr,void 0),et(this,li,void 0),et(this,jr,!1),et(this,Jn,void 0),et(this,si,void 0),et(this,Gs,!1),this.type=n,n&&Le(this,He,!0),Le(this,Ae,r),Le(this,$e,M(this,Ae)?M(M(this,Ae),$e):this),Le(this,Jn,M(this,$e)===this?i:M(M(this,$e),Jn)),Le(this,li,M(this,$e)===this?[]:M(M(this,$e),li)),n==="!"&&!M(M(this,$e),jr)&&M(this,li).push(this),Le(this,Cr,M(this,Ae)?M(M(this,Ae),fe).length:0)}get hasMagic(){if(M(this,He)!==void 0)return M(this,He);for(const n of M(this,fe))if(typeof n!="string"&&(n.type||n.hasMagic))return Le(this,He,!0);return M(this,He)}toString(){return M(this,si)!==void 0?M(this,si):this.type?Le(this,si,this.type+"("+M(this,fe).map(n=>String(n)).join("|")+")"):Le(this,si,M(this,fe).map(n=>String(n)).join(""))}push(...n){for(const r of n)if(r!==""){if(typeof r!="string"&&!(r instanceof Sr&&M(r,Ae)===this))throw new Error("invalid part: "+r);M(this,fe).push(r)}}toJSON(){var n;const r=this.type===null?M(this,fe).slice().map(i=>typeof i=="string"?i:i.toJSON()):[this.type,...M(this,fe).map(i=>i.toJSON())];return this.isStart()&&!this.type&&r.unshift([]),this.isEnd()&&(this===M(this,$e)||M(M(this,$e),jr)&&((n=M(this,Ae))==null?void 0:n.type)==="!")&&r.push({}),r}isStart(){var n;if(M(this,$e)===this)return!0;if(!((n=M(this,Ae))!=null&&n.isStart()))return!1;if(M(this,Cr)===0)return!0;const r=M(this,Ae);for(let i=0;i<M(this,Cr);i++){const o=M(r,fe)[i];if(!(o instanceof Sr&&o.type==="!"))return!1}return!0}isEnd(){var n,r,i;if(M(this,$e)===this||((n=M(this,Ae))==null?void 0:n.type)==="!")return!0;if(!((r=M(this,Ae))!=null&&r.isEnd()))return!1;if(!this.type)return(i=M(this,Ae))==null?void 0:i.isEnd();const o=M(this,Ae)?M(M(this,Ae),fe).length:0;return M(this,Cr)===o-1}copyIn(n){typeof n=="string"?this.push(n):this.push(n.clone(this))}clone(n){const r=new Sr(this.type,n);for(const i of M(this,fe))r.copyIn(i);return r}static fromGlob(n,r={}){var i;const o=new Sr(null,void 0,r);return _r(i=Sr,ro,fs).call(i,n,o,0,r),o}toMMPattern(){if(this!==M(this,$e))return M(this,$e).toMMPattern();const n=this.toString(),[r,i,o,s]=this.toRegExpSource();if(!(o||M(this,He)||M(this,Jn).nocase&&!M(this,Jn).nocaseMagicOnly&&n.toUpperCase()!==n.toLowerCase()))return i;const a=(M(this,Jn).nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${r}$`,a),{_src:r,_glob:n})}toRegExpSource(n){var r;const i=n??!!M(this,Jn).dot;if(M(this,$e)===this&&_r(this,ol,Fm).call(this),!this.type){const l=this.isStart()&&this.isEnd(),f=M(this,fe).map(b=>{var y;const[d,g,m,x]=typeof b=="string"?_r(y=Sr,al,Mm).call(y,b,M(this,He),l):b.toRegExpSource(n);return Le(this,He,M(this,He)||m),Le(this,Xn,M(this,Xn)||x),d}).join("");let h="";if(this.isStart()&&typeof M(this,fe)[0]=="string"&&!(M(this,fe).length===1&&Q7.has(M(this,fe)[0]))){const b=X7,y=i&&b.has(f.charAt(0))||f.startsWith("\\.")&&b.has(f.charAt(2))||f.startsWith("\\.\\.")&&b.has(f.charAt(4)),d=!i&&!n&&b.has(f.charAt(0));h=y?Y7:d?Wo:""}let p="";return this.isEnd()&&M(M(this,$e),jr)&&((r=M(this,Ae))==null?void 0:r.type)==="!"&&(p="(?:$|\\/)"),[h+f+p,uo(f),Le(this,He,!!M(this,He)),M(this,Xn)]}const o=this.type==="*"||this.type==="+",s=this.type==="!"?"(?:(?!(?:":"(?:";let a=_r(this,hs,sl).call(this,i);if(this.isStart()&&this.isEnd()&&!a&&this.type!=="!"){const l=this.toString();return Le(this,fe,[l]),this.type=null,Le(this,He,void 0),[l,uo(this.toString()),!1,!1]}let u=!o||n||i||!Wo?"":_r(this,hs,sl).call(this,!0);u===a&&(u=""),u&&(a=`(?:${a})(?:${u})*?`);let c="";if(this.type==="!"&&M(this,Gs))c=(this.isStart()&&!i?Wo:"")+jm;else{const l=this.type==="!"?"))"+(this.isStart()&&!i&&!n?Wo:"")+Hm+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&u?")":this.type==="*"&&u?")?":`)${this.type}`;c=s+a+l}return[c,uo(a),Le(this,He,!!M(this,He)),M(this,Xn)]}};$e=new WeakMap,He=new WeakMap,Xn=new WeakMap,fe=new WeakMap,Ae=new WeakMap,Cr=new WeakMap,li=new WeakMap,jr=new WeakMap,Jn=new WeakMap,si=new WeakMap,Gs=new WeakMap,ol=new WeakSet,Fm=function(){if(this!==M(this,$e))throw new Error("should only call on root");if(M(this,jr))return this;this.toString(),Le(this,jr,!0);let e;for(;e=M(this,li).pop();){if(e.type!=="!")continue;let n=e,r=M(n,Ae);for(;r;){for(let i=M(n,Cr)+1;!r.type&&i<M(r,fe).length;i++)for(const o of M(e,fe)){if(typeof o=="string")throw new Error("string part in extglob AST??");o.copyIn(M(r,fe)[i])}n=r,r=M(n,Ae)}}return this},ro=new WeakSet,fs=function(e,n,r,i){var o,s;let a=!1,u=!1,c=-1,l=!1;if(n.type===null){let y=r,d="";for(;y<e.length;){const g=e.charAt(y++);if(a||g==="\\"){a=!a,d+=g;continue}if(u){y===c+1?(g==="^"||g==="!")&&(l=!0):g==="]"&&!(y===c+2&&l)&&(u=!1),d+=g;continue}else if(g==="["){u=!0,c=y,l=!1,d+=g;continue}if(!i.noext&&gp(g)&&e.charAt(y)==="("){n.push(d),d="";const m=new cn(g,n);y=_r(o=cn,ro,fs).call(o,e,m,y,i),n.push(m);continue}d+=g}return n.push(d),y}let f=r+1,h=new cn(null,n);const p=[];let b="";for(;f<e.length;){const y=e.charAt(f++);if(a||y==="\\"){a=!a,b+=y;continue}if(u){f===c+1?(y==="^"||y==="!")&&(l=!0):y==="]"&&!(f===c+2&&l)&&(u=!1),b+=y;continue}else if(y==="["){u=!0,c=f,l=!1,b+=y;continue}if(gp(y)&&e.charAt(f)==="("){h.push(b),b="";const d=new cn(y,h);h.push(d),f=_r(s=cn,ro,fs).call(s,e,d,f,i);continue}if(y==="|"){h.push(b),b="",p.push(h),h=new cn(null,n);continue}if(y===")")return b===""&&M(n,fe).length===0&&Le(n,Gs,!0),h.push(b),b="",n.push(...p,h),f;b+=y}return n.type=null,Le(n,He,void 0),Le(n,fe,[e.substring(r-1)]),f},hs=new WeakSet,sl=function(e){return M(this,fe).map(n=>{if(typeof n=="string")throw new Error("string type in extglob ast??");const[r,i,o,s]=n.toRegExpSource(e);return Le(this,Xn,M(this,Xn)||s),r}).filter(n=>!(this.isStart()&&this.isEnd())||!!n).join("|")},al=new WeakSet,Mm=function(e,n,r=!1){let i=!1,o="",s=!1;for(let a=0;a<e.length;a++){const u=e.charAt(a);if(i){i=!1,o+=(eO.has(u)?"\\":"")+u;continue}if(u==="\\"){a===e.length-1?o+="\\\\":i=!0;continue}if(u==="["){const[c,l,f,h]=Z7(e,a);if(f){o+=c,s=s||l,a+=f-1,n=n||h;continue}}if(u==="*"){r&&e==="*"?o+=jm:o+=Hm,n=!0;continue}if(u==="?"){o+=Ah,n=!0;continue}o+=tO(u)}return[o,uo(e),!!n,s]},et(cn,ro),et(cn,al);let zm=cn;const nO=(e,{windowsPathsNoEscape:n=!1}={})=>n?e.replace(/[?*()[\]]/g,"[$&]"):e.replace(/[?*()[\]\\]/g,"\\$&"),Ge=(e,n,r={})=>(Ws(n),!r.nocomment&&n.charAt(0)==="#"?!1:new eu(n,r).match(e)),rO=/^\*+([^+@!?\*\[\(]*)$/,iO=e=>n=>!n.startsWith(".")&&n.endsWith(e),oO=e=>n=>n.endsWith(e),sO=e=>(e=e.toLowerCase(),n=>!n.startsWith(".")&&n.toLowerCase().endsWith(e)),aO=e=>(e=e.toLowerCase(),n=>n.toLowerCase().endsWith(e)),uO=/^\*+\.\*+$/,cO=e=>!e.startsWith(".")&&e.includes("."),lO=e=>e!=="."&&e!==".."&&e.includes("."),fO=/^\.\*+$/,hO=e=>e!=="."&&e!==".."&&e.startsWith("."),dO=/^\*+$/,pO=e=>e.length!==0&&!e.startsWith("."),gO=e=>e.length!==0&&e!=="."&&e!=="..",yO=/^\?+([^+@!?\*\[\(]*)?$/,wO=([e,n=""])=>{const r=qm([e]);return n?(n=n.toLowerCase(),i=>r(i)&&i.toLowerCase().endsWith(n)):r},mO=([e,n=""])=>{const r=Km([e]);return n?(n=n.toLowerCase(),i=>r(i)&&i.toLowerCase().endsWith(n)):r},bO=([e,n=""])=>{const r=Km([e]);return n?i=>r(i)&&i.endsWith(n):r},vO=([e,n=""])=>{const r=qm([e]);return n?i=>r(i)&&i.endsWith(n):r},qm=([e])=>{const n=e.length;return r=>r.length===n&&!r.startsWith(".")},Km=([e])=>{const n=e.length;return r=>r.length===n&&r!=="."&&r!==".."},Dm=typeof process=="object"&&process?typeof Su=="object"&&Su&&Su.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",yp={win32:{sep:"\\"},posix:{sep:"/"}},EO=Dm==="win32"?yp.win32.sep:yp.posix.sep;Ge.sep=EO;const yt=Symbol("globstar **");Ge.GLOBSTAR=yt;const xO="[^/]",LO=xO+"*?",AO="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",SO="(?:(?!(?:\\/|^)\\.).)*?",$O=(e,n={})=>r=>Ge(r,e,n);Ge.filter=$O;const gt=(e,n={})=>Object.assign({},e,n),IO=e=>{if(!e||typeof e!="object"||!Object.keys(e).length)return Ge;const n=Ge;return Object.assign((r,i,o={})=>n(r,i,gt(e,o)),{Minimatch:class extends n.Minimatch{constructor(r,i={}){super(r,gt(e,i))}static defaults(r){return n.defaults(gt(e,r)).Minimatch}},AST:class extends n.AST{constructor(r,i,o={}){super(r,i,gt(e,o))}static fromGlob(r,i={}){return n.AST.fromGlob(r,gt(e,i))}},unescape:(r,i={})=>n.unescape(r,gt(e,i)),escape:(r,i={})=>n.escape(r,gt(e,i)),filter:(r,i={})=>n.filter(r,gt(e,i)),defaults:r=>n.defaults(gt(e,r)),makeRe:(r,i={})=>n.makeRe(r,gt(e,i)),braceExpand:(r,i={})=>n.braceExpand(r,gt(e,i)),match:(r,i,o={})=>n.match(r,i,gt(e,o)),sep:n.sep,GLOBSTAR:yt})};Ge.defaults=IO;const Vm=(e,n={})=>(Ws(e),n.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:D7(e));Ge.braceExpand=Vm;const BO=(e,n={})=>new eu(e,n).makeRe();Ge.makeRe=BO;const kO=(e,n,r={})=>{const i=new eu(n,r);return e=e.filter(o=>i.match(o)),i.options.nonull&&!e.length&&e.push(n),e};Ge.match=kO;const wp=/[?*]|[+@!]\(.*?\)|\[|\]/,OO=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class eu{constructor(n,r={}){Se(this,"options"),Se(this,"set"),Se(this,"pattern"),Se(this,"windowsPathsNoEscape"),Se(this,"nonegate"),Se(this,"negate"),Se(this,"comment"),Se(this,"empty"),Se(this,"preserveMultipleSlashes"),Se(this,"partial"),Se(this,"globSet"),Se(this,"globParts"),Se(this,"nocase"),Se(this,"isWindows"),Se(this,"platform"),Se(this,"windowsNoMagicRoot"),Se(this,"regexp"),Ws(n),r=r||{},this.options=r,this.pattern=n,this.platform=r.platform||Dm,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!r.windowsPathsNoEscape||r.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!r.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!r.nonegate,this.comment=!1,this.empty=!1,this.partial=!!r.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=r.windowsNoMagicRoot!==void 0?r.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const n of this.set)for(const r of n)if(typeof r!="string")return!0;return!1}debug(...n){}make(){const n=this.pattern,r=this.options;if(!r.nocomment&&n.charAt(0)==="#"){this.comment=!0;return}if(!n){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],r.debug&&(this.debug=(...s)=>console.error(...s)),this.debug(this.pattern,this.globSet);const i=this.globSet.map(s=>this.slashSplit(s));this.globParts=this.preprocess(i),this.debug(this.pattern,this.globParts);let o=this.globParts.map((s,a,u)=>{if(this.isWindows&&this.windowsNoMagicRoot){const c=s[0]===""&&s[1]===""&&(s[2]==="?"||!wp.test(s[2]))&&!wp.test(s[3]),l=/^[a-z]:/i.test(s[0]);if(c)return[...s.slice(0,4),...s.slice(4).map(f=>this.parse(f))];if(l)return[s[0],...s.slice(1).map(f=>this.parse(f))]}return s.map(c=>this.parse(c))});if(this.debug(this.pattern,o),this.set=o.filter(s=>s.indexOf(!1)===-1),this.isWindows)for(let s=0;s<this.set.length;s++){const a=this.set[s];a[0]===""&&a[1]===""&&this.globParts[s][2]==="?"&&typeof a[3]=="string"&&/^[a-z]:$/i.test(a[3])&&(a[2]="?")}this.debug(this.pattern,this.set)}preprocess(n){if(this.options.noglobstar)for(let i=0;i<n.length;i++)for(let o=0;o<n[i].length;o++)n[i][o]==="**"&&(n[i][o]="*");const{optimizationLevel:r=1}=this.options;return r>=2?(n=this.firstPhasePreProcess(n),n=this.secondPhasePreProcess(n)):r>=1?n=this.levelOneOptimize(n):n=this.adjascentGlobstarOptimize(n),n}adjascentGlobstarOptimize(n){return n.map(r=>{let i=-1;for(;(i=r.indexOf("**",i+1))!==-1;){let o=i;for(;r[o+1]==="**";)o++;o!==i&&r.splice(i,o-i)}return r})}levelOneOptimize(n){return n.map(r=>(r=r.reduce((i,o)=>{const s=i[i.length-1];return o==="**"&&s==="**"?i:o===".."&&s&&s!==".."&&s!=="."&&s!=="**"?(i.pop(),i):(i.push(o),i)},[]),r.length===0?[""]:r))}levelTwoFileOptimize(n){Array.isArray(n)||(n=this.slashSplit(n));let r=!1;do{if(r=!1,!this.preserveMultipleSlashes){for(let o=1;o<n.length-1;o++){const s=n[o];o===1&&s===""&&n[0]===""||(s==="."||s==="")&&(r=!0,n.splice(o,1),o--)}n[0]==="."&&n.length===2&&(n[1]==="."||n[1]==="")&&(r=!0,n.pop())}let i=0;for(;(i=n.indexOf("..",i+1))!==-1;){const o=n[i-1];o&&o!=="."&&o!==".."&&o!=="**"&&(r=!0,n.splice(i-1,2),i-=2)}}while(r);return n.length===0?[""]:n}firstPhasePreProcess(n){let r=!1;do{r=!1;for(let i of n){let o=-1;for(;(o=i.indexOf("**",o+1))!==-1;){let a=o;for(;i[a+1]==="**";)a++;a>o&&i.splice(o+1,a-o);let u=i[o+1];const c=i[o+2],l=i[o+3];if(u!==".."||!c||c==="."||c===".."||!l||l==="."||l==="..")continue;r=!0,i.splice(o,1);const f=i.slice(0);f[o]="**",n.push(f),o--}if(!this.preserveMultipleSlashes){for(let a=1;a<i.length-1;a++){const u=i[a];a===1&&u===""&&i[0]===""||(u==="."||u==="")&&(r=!0,i.splice(a,1),a--)}i[0]==="."&&i.length===2&&(i[1]==="."||i[1]==="")&&(r=!0,i.pop())}let s=0;for(;(s=i.indexOf("..",s+1))!==-1;){const a=i[s-1];if(a&&a!=="."&&a!==".."&&a!=="**"){r=!0;const u=s===1&&i[s+1]==="**"?["."]:[];i.splice(s-1,2,...u),i.length===0&&i.push(""),s-=2}}}}while(r);return n}secondPhasePreProcess(n){for(let r=0;r<n.length-1;r++)for(let i=r+1;i<n.length;i++){const o=this.partsMatch(n[r],n[i],!this.preserveMultipleSlashes);o&&(n[r]=o,n[i]=[])}return n.filter(r=>r.length)}partsMatch(n,r,i=!1){let o=0,s=0,a=[],u="";for(;o<n.length&&s<r.length;)if(n[o]===r[s])a.push(u==="b"?r[s]:n[o]),o++,s++;else if(i&&n[o]==="**"&&r[s]===n[o+1])a.push(n[o]),o++;else if(i&&r[s]==="**"&&n[o]===r[s+1])a.push(r[s]),s++;else if(n[o]==="*"&&r[s]&&(this.options.dot||!r[s].startsWith("."))&&r[s]!=="**"){if(u==="b")return!1;u="a",a.push(n[o]),o++,s++}else if(r[s]==="*"&&n[o]&&(this.options.dot||!n[o].startsWith("."))&&n[o]!=="**"){if(u==="a")return!1;u="b",a.push(r[s]),o++,s++}else return!1;return n.length===r.length&&a}parseNegate(){if(this.nonegate)return;const n=this.pattern;let r=!1,i=0;for(let o=0;o<n.length&&n.charAt(o)==="!";o++)r=!r,i++;i&&(this.pattern=n.slice(i)),this.negate=r}matchOne(n,r,i=!1){const o=this.options;if(this.isWindows){const d=typeof n[0]=="string"&&/^[a-z]:$/i.test(n[0]),g=!d&&n[0]===""&&n[1]===""&&n[2]==="?"&&/^[a-z]:$/i.test(n[3]),m=typeof r[0]=="string"&&/^[a-z]:$/i.test(r[0]),x=!m&&r[0]===""&&r[1]===""&&r[2]==="?"&&typeof r[3]=="string"&&/^[a-z]:$/i.test(r[3]),S=g?3:d?0:void 0,O=x?3:m?0:void 0;if(typeof S=="number"&&typeof O=="number"){const[B,E]=[n[S],r[O]];B.toLowerCase()===E.toLowerCase()&&(r[O]=B,O>S?r=r.slice(O):S>O&&(n=n.slice(S)))}}const{optimizationLevel:s=1}=this.options;s>=2&&(n=this.levelTwoFileOptimize(n)),this.debug("matchOne",this,{file:n,pattern:r}),this.debug("matchOne",n.length,r.length);for(var a=0,u=0,c=n.length,l=r.length;a<c&&u<l;a++,u++){this.debug("matchOne loop");var f=r[u],h=n[a];if(this.debug(r,f,h),f===!1)return!1;if(f===yt){this.debug("GLOBSTAR",[r,f,h]);var p=a,b=u+1;if(b===l){for(this.debug("** at the end");a<c;a++)if(n[a]==="."||n[a]===".."||!o.dot&&n[a].charAt(0)===".")return!1;return!0}for(;p<c;){var y=n[p];if(this.debug(`
globstar while`,n,p,r,b,y),this.matchOne(n.slice(p),r.slice(b),i))return this.debug("globstar found match!",p,c,y),!0;if(y==="."||y===".."||!o.dot&&y.charAt(0)==="."){this.debug("dot detected!",n,p,r,b);break}this.debug("globstar swallow a segment, and continue"),p++}return!!(i&&(this.debug(`
>>> no match, partial?`,n,p,r,b),p===c))}let d;if(typeof f=="string"?(d=h===f,this.debug("string match",f,h,d)):(d=f.test(h),this.debug("pattern match",f,h,d)),!d)return!1}if(a===c&&u===l)return!0;if(a===c)return i;if(u===l)return a===c-1&&n[a]==="";throw new Error("wtf?")}braceExpand(){return Vm(this.pattern,this.options)}parse(n){Ws(n);const r=this.options;if(n==="**")return yt;if(n==="")return"";let i,o=null;(i=n.match(dO))?o=r.dot?gO:pO:(i=n.match(rO))?o=(r.nocase?r.dot?aO:sO:r.dot?oO:iO)(i[1]):(i=n.match(yO))?o=(r.nocase?r.dot?mO:wO:r.dot?bO:vO)(i):(i=n.match(uO))?o=r.dot?lO:cO:(i=n.match(fO))&&(o=hO);const s=zm.fromGlob(n,this.options).toMMPattern();return o?Object.assign(s,{test:o}):s}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const n=this.set;if(!n.length)return this.regexp=!1,this.regexp;const r=this.options,i=r.noglobstar?LO:r.dot?AO:SO,o=new Set(r.nocase?["i"]:[]);let s=n.map(c=>{const l=c.map(f=>{if(f instanceof RegExp)for(const h of f.flags.split(""))o.add(h);return typeof f=="string"?OO(f):f===yt?yt:f._src});return l.forEach((f,h)=>{const p=l[h+1],b=l[h-1];f!==yt||b===yt||(b===void 0?p!==void 0&&p!==yt?l[h+1]="(?:\\/|"+i+"\\/)?"+p:l[h]=i:p===void 0?l[h-1]=b+"(?:\\/|"+i+")?":p!==yt&&(l[h-1]=b+"(?:\\/|\\/"+i+"\\/)"+p,l[h+1]=yt))}),l.filter(f=>f!==yt).join("/")}).join("|");const[a,u]=n.length>1?["(?:",")"]:["",""];s="^"+a+s+u+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...o].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(n){return this.preserveMultipleSlashes?n.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(n)?["",...n.split(/\/+/)]:n.split(/\/+/)}match(n,r=this.partial){if(this.debug("match",n,this.pattern),this.comment)return!1;if(this.empty)return n==="";if(n==="/"&&r)return!0;const i=this.options;this.isWindows&&(n=n.split("\\").join("/"));const o=this.slashSplit(n);this.debug(this.pattern,"split",o);const s=this.set;this.debug(this.pattern,"set",s);let a=o[o.length-1];if(!a)for(let u=o.length-2;!a&&u>=0;u--)a=o[u];for(let u=0;u<s.length;u++){const c=s[u];let l=o;if(i.matchBase&&c.length===1&&(l=[a]),this.matchOne(l,c,r))return i.flipNegate?!0:!this.negate}return i.flipNegate?!1:this.negate}static defaults(n){return Ge.defaults(n).Minimatch}}Ge.AST=zm;Ge.Minimatch=eu;Ge.escape=nO;Ge.unescape=uo;function nc(e,n){return n?!n.some(r=>Ge(e,r)):!0}function UO(e=!0){return(n,r)=>{const i=n,o=i.getConfig().exclude;if(e){const s=nc(n.path,o);i.emitter.on("created",()=>{var a;!s&&((a=i.factory.global)==null||a.info("exclude:",i.path))}),i.addFilter(()=>s)}else i.emitter.on("created",()=>{var s;!nc(n.path,o)&&((s=i.factory.global)==null||s.info("exclude:",i.path))}),i.addFilter(()=>nc(n.path,o));return i}}function _O(e=!0){return(n,r)=>{const i=n,o=s=>s.some(a=>Ge(n.path,a));if(e){const s=i.getConfig().include??["**/*"],a=o(s);i.addFilter(u=>a)}else i.addFilter(s=>{const a=s.getConfig().include??["**/*"];return o(a)});return i}}function CO(){return(e,n)=>{const r=e;return r.addFilter((i,o)=>o<=(r.getConfig().level??ae.Silly)),r}}function RO(){return new _7().addPlugin(_O()).addPlugin(T7()).addPlugin(UO()).addPlugin(CO()).addPlugin(R7()).provideFactoryGlobal().provideRootGlobal()}const TO=RO();TO.getGlobal();const Cn=z(()=>[Ro,Zr,Co,_o,To,r0],"manager-staff",({mod:e,line:n})=>e),lC=z(()=>[Bt.Staff,Po,Oh,No,Zs],({mod:e,line:n})=>e.assignFn({addressPointerLine(r,i={}){if(console.log("addressPointerLine,0"),typeof r=="string"){const o=pm(r);if(!o)throw new Error("Not an address");r=o}return console.log("addressPointerLine,1"),n.cacheByOptions({name:`GEBID:${JSON.stringify(r)}`,...i},()=>(console.log("addressPointerLine"),this.createChild().add(Cn).add(Yi).add(Ji).provideLatestEvent().addFilter({kinds:[r.kind],authors:[r.pubkey],"#d":[r.identifier],limit:1}).chainCall(async function(){console.log("AddressPointerApi","addressPointer.pubkey"),await this.autoAdd10002(We.fromHex(r.pubkey)),await rt(500),await this.addUrlForHasLatestEventLine(i)})))}})),Zs=z(()=>[Yi,Cn,Ji,Bt.Staff],({mod:e,line:n})=>e.assignChain({async addUrlForHasLatestEventLine(r){if(!this.isHasLatestEvent()&&!(r.urls&&(this.addUrls(r.urls),await rt(500),this.isHasLatestEvent()))&&!((r.autoAddRelayUrls??!0)&&(n.relayConfigurator.onInited(()=>{this.addUrls(n.relayConfigurator.getReadList())}),await rt(500),this.isHasLatestEvent()))&&!(r.pubkey&&(this.autoAdd10002(r.pubkey),await rt(500),this.isHasLatestEvent()))&&r.pubkeys){for(const i of r.pubkeys)if(this.autoAdd10002(i),await rt(500),this.isHasLatestEvent())return}}})),Js=z(()=>[Co,wr],e=>(e.out().onCreateChildDep(n=>{n.on("eose",(r,i)=>{n.relayPool.getLine().emit("desub",r,i)})}),e));function mp(e){return`CE:${e.name?`${e.name}:`:""}:${JSON.stringify(e)}`}const Po=z(({mod:e,line:n})=>e.assignFeat({cacheByOptions(r,i){return Fy(mp(r),i,{duration:1e3*60*60,useMemoryCache:r.cache??!0,useLocalStorage:!1})},recacheByOptions(r){zy(mp(r))}}));function PO(e,n){let r=e.get(n);return r||e.set(n,r={map:new Map,done:!n.limit&&!n.since}),r}function NO(e,n,r){let i=e.map.get(n);return i||e.map.set(n,i=r()),i}let bp=10;function HO(e,n,r=10){let i=MO(e,n,r),o=FO(i);return jO(o)}function jO(e){let n={};return e.forEach(([r,i])=>{(n[r]||(n[r]=[])).push(i)}),n}function FO(e){let n=Math.floor(e.length/2);return e.slice(n)}const Wm=z(()=>[Zr,wr],({mod:e,line:n})=>e.assignOwnFeat(()=>({loadData:new WeakMap})).assignFeat({load(r=bp){let i=HO(this.filterList,this.loadData,r);for(const[o,s]of Object.entries(i))this.sub(o,s,{eoseAutoDesub:!0})},loadNew(r=bp){}}).inLine(r=>r.onCreateChildDep(i=>{i.onEvent((o,s,a)=>{a&&i.filterList.forEach(u=>{let c=PO(i.loadData,u);if(c.done)return;let l=NO(c,a,()=>({newLoadDone:!1,loadDone:!1,since:s.created_at,until:s.created_at}));if(!l.loadDone&&s.created_at<l.since)return l.since=s.created_at;if(!l.newLoadDone&&s.created_at>l.until)return l.until=s.created_at})})})));function MO(e,n,r){let i=[];for(const o of e){let s=n.get(o);if(s&&!s.done)for(const[a,u]of s.map){if(u.loadDone)continue;let c=J4(o);c.until=u.since,c.limit=r,Yl(i,[a,c],l=>l[1].until??0)}}return i}class Sh{constructor(n,r){this.map={},this.cacheOption={duration:1e3*60*60*24,...ks,...r==null?void 0:r.cacheOptions},this.KEY=n;const i=localStorage.getItem(n);if(i)try{const o=JSON.parse(i);typeof o=="object"&&(this.map=o)}catch{localStorage.removeItem(n)}}allMap(){const n={},r=this.map;for(const i in r){const o=this.get(i);o&&(n[i]=o)}return n}values(){const n=[],r=this.map;for(const i in r){const o=this.get(i);o&&n.push(o)}return n}set(n,r){const i=r.id;this.map[n]=i,ki(i,r,this.cacheOption),this.updateMap()}delete(n){delete this.map[n],zy(n),this.updateMap()}get(n){return this._getEvent(n)}_getEvent(n){const r=this.map[n];if(r)try{return tf(r,this.cacheOption)}catch{this.delete(n);return}}updateMap(){localStorage.setItem(this.KEY,JSON.stringify(this.map))}}class Go extends Sh{static isParameterizedReplaceableEvent(n){return n>=3e4&&n<4e4}constructor(n){super(`PRE:${n}`)}add(n){var r;let i=n.kind,o=n.pubkey,s=((r=mh("d",n.tags))==null?void 0:r[1])??"",a=`${i}:${o}:${s}`,u=this.getByA(a);(!u||n.created_at>u.created_at)&&this.set(a,n)}getByA(n){return this.get(typeof n=="string"?n:`${n.kind}:${n.pubkey}:${n.identifier}`)}filter(n){return Object.entries(this.allMap()).filter(([r])=>{let[i,o,s]=r.split(":");return n(parseInt(i),o,s)}).map(([r,i])=>i)}query(n,r,i){const o=[];for(const[s,a]of[[new Set(n),0],[new Set(r),1],[new Set(i),2]])s&&o.push((...u)=>s.has(u[a]));return o.length===0?this.values():this.filter((s,a,u)=>o.every(c=>c(s,a,u)))}}const zO=[0,3];class Zo extends Sh{static isReplaceableKind(n){return 1e4<=n&&n<2e4||zO.some(r=>r===n)}constructor(n){super(`RE:${n}`)}add(n){let r=this.getByPubkey(n.pubkey);(!r||n.created_at>r.created_at)&&this.set(n.pubkey,n)}deleteEventByPubkey(n){this.delete(n)}getByPubkey(n){return this.get(n)}query(n){let r=[];for(const i of n){let o=this.getByPubkey(i);o&&r.push(o)}return r}}const qO=new Set([1]);class Jo extends Sh{static isCommonEventKind(n){return n>=1e3&&n<1e4||qO.has(n)}constructor(n){super(`CE:${n}`)}add(n){this.set(n.id,n)}deleteById(n){this.delete(n)}getById(n){return this.get(n)}query(n){let r=[];for(const i of n){let o=this.getById(i);o&&r.push(o)}return r}}const rn=z(e=>e.defineEmit().defineEmit().assignChain({async emitEvent(n,r,i="local"){await this.emit({types:["event",`event:${n}`],onReturn:(o,{stop:s})=>o&&s()},n,r,i)},onEvent(n,r){r!=null&&r.subId?this.on(`event:${r.subId}`,n,r):this.on("event",n,r)}}));function vp(e,n={}){var r;return!(n.exclude&&(n.exclude instanceof Set||(n.exclude=new Set(n.exclude)),n.exclude.has(e))||n.include&&(n.include instanceof Set||(n.include=new Set(n.include)),!((r=n.include)!=null&&r.has(e))))}const $h=z(()=>[rn,Em],({mod:e,line:n})=>e.assignFeat({localMap:{},autoLocalCache(r){this.autoLoadCache(),r!=null&&r.disabledAutoCache||this.autoCacheEvent(r)},autoLoadCache(r){for(const i of this.filterList)this.autoLoadCacheByFilter(i,Object.assign({},r,{disabledAutoCache:!0}))},autoLoadCacheByFilter(r,i={}){if(r.kinds){for(const o of r.kinds){if(!vp(o,i))return;Zo.isReplaceableKind(o)?this.loadReplaceableEvent(this.getInitReplaceableEventMap(o),r.authors):Go.isParameterizedReplaceableEvent(o)?this.loadParameterizedReplaceableEvent(this.getInitParameterizedReplaceableEventMap(o),o,r.authors,r["#d"]):Jo.isCommonEventKind(o)&&this.loadCommonEvent(this.getInitCommonEvent(o),r.ids)}i!=null&&i.disabledAutoCache||this.autoCacheEvent()}},autoCacheEvent(r){this.on("event",(i,o)=>{let s=o.kind;vp(s,r)&&(Zo.isReplaceableKind(s)?this.getInitReplaceableEventMap(s).add(o):Go.isParameterizedReplaceableEvent(s)?this.getInitParameterizedReplaceableEventMap(s).add(o):Jo.isCommonEventKind(s)&&this.getInitCommonEvent(s).add(o))})},loadReplaceableEvent(r,i){if(!i){this.loadEvents(r.values());return}this.loadEvents(r.query(new Set(i)))},loadParameterizedReplaceableEvent(r,i,o,s){if(!o||!s){this.loadEvents(r.query(new Set([i]),o&&new Set(o),s&&new Set(s)));return}for(const a of o)for(const u of s){const c=r.getByA({kind:i,pubkey:a,identifier:u});c&&this.loadEvents([c])}},loadCommonEvent(r,i){if(!i){this.loadEvents(r.values());return}this.loadEvents(r.query(new Set(i)))},loadEvents(r){for(const i of r)i&&this.emitEvent("local",i)},getInitReplaceableEventMap(r){if(!Zo.isReplaceableKind(r))throw new Error(`kind${r} not is a ReplaceableEvent`);return this.localMap[r]||(this.localMap[r]=new Zo(r))},getInitCommonEvent(r){if(!Jo.isCommonEventKind(r))throw new Error(`kind${r} not is a CommonEvent`);return this.localMap[r]||(this.localMap[r]=new Jo(r))},getInitParameterizedReplaceableEventMap(r){if(!Go.isParameterizedReplaceableEvent(r))throw new Error(`kind${r} not is a ParameterizedReplaceableEvent`);return this.localMap[r]||(this.localMap[r]=new Go(r))}})),Gm=z("default-urls",({mod:e,line:n})=>e.assignFeat({defaultUrls:new Set(["wss://no.str.cr","wss://no-str.org","wss://nos.lol","wss://nostr.com.de","wss://relay.mostr.pub","wss://relay.nostr.wirednet.jp","wss://no-str.org","wss://brb.io"]),setDefaultUrls(r){this.defaultUrls=r},addDefaultUrls(r){Yn(this.defaultUrls,r)}}));var Ih=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function KO(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Zm={exports:{}},Ep={exports:{}},xp;function DO(){return xp||(xp=1,function(e){(function(n){var r={bytesToHex:function(s){return i(s)},hexToBytes:function(s){if(s.length%2===1)throw new Error("hexToBytes can't have a string with an odd number of characters.");return s.indexOf("0x")===0&&(s=s.slice(2)),s.match(/../g).map(function(a){return parseInt(a,16)})}};function i(s){return s.map(function(a){return o(a.toString(16),2)}).join("")}function o(s,a){return s.length>a?s:Array(a-s.length+1).join("0")+s}e.exports?e.exports=r:n.convertHex=r})(Ih)}(Ep)),Ep.exports}var Lp={exports:{}},Ap;function VO(){return Ap||(Ap=1,function(e){(function(n){var r={bytesToString:function(i){return i.map(function(o){return String.fromCharCode(o)}).join("")},stringToBytes:function(i){return i.split("").map(function(o){return o.charCodeAt(0)})}};r.UTF8={bytesToString:function(i){return decodeURIComponent(escape(r.bytesToString(i)))},stringToBytes:function(i){return r.stringToBytes(unescape(encodeURIComponent(i)))}},e.exports?e.exports=r:n.convertString=r})(Ih)}(Lp)),Lp.exports}(function(e){(function(n){var r={};e.exports?(r.bytesToHex=DO().bytesToHex,r.convertString=VO(),e.exports=c):(r.bytesToHex=n.convertHex.bytesToHex,r.convertString=n.convertString,n.sha256=c);var i=[];(function(){function l(b){for(var y=Math.sqrt(b),d=2;d<=y;d++)if(!(b%d))return!1;return!0}function f(b){return(b-(b|0))*4294967296|0}for(var h=2,p=0;p<64;)l(h)&&(i[p]=f(Math.pow(h,1/3)),p++),h++})();var o=function(l){for(var f=[],h=0,p=0;h<l.length;h++,p+=8)f[p>>>5]|=l[h]<<24-p%32;return f},s=function(l){for(var f=[],h=0;h<l.length*32;h+=8)f.push(l[h>>>5]>>>24-h%32&255);return f},a=[],u=function(l,f,h){for(var p=l[0],b=l[1],y=l[2],d=l[3],g=l[4],m=l[5],x=l[6],S=l[7],O=0;O<64;O++){if(O<16)a[O]=f[h+O]|0;else{var B=a[O-15],E=(B<<25|B>>>7)^(B<<14|B>>>18)^B>>>3,L=a[O-2],I=(L<<15|L>>>17)^(L<<13|L>>>19)^L>>>10;a[O]=E+a[O-7]+I+a[O-16]}var R=g&m^~g&x,U=p&b^p&y^b&y,k=(p<<30|p>>>2)^(p<<19|p>>>13)^(p<<10|p>>>22),P=(g<<26|g>>>6)^(g<<21|g>>>11)^(g<<7|g>>>25),T=S+P+R+i[O]+a[O],H=k+U;S=x,x=m,m=g,g=d+T|0,d=y,y=b,b=p,p=T+H|0}l[0]=l[0]+p|0,l[1]=l[1]+b|0,l[2]=l[2]+y|0,l[3]=l[3]+d|0,l[4]=l[4]+g|0,l[5]=l[5]+m|0,l[6]=l[6]+x|0,l[7]=l[7]+S|0};function c(l,f){l.constructor===String&&(l=r.convertString.UTF8.stringToBytes(l));var h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],p=o(l),b=l.length*8;p[b>>5]|=128<<24-b%32,p[(b+64>>9<<4)+15]=b;for(var y=0;y<p.length;y+=16)u(h,p,y);var d=s(h);return f&&f.asBytes?d:f&&f.asString?r.convertString.bytesToString(d):r.bytesToHex(d)}c.x2=function(l,f){return c(c(l,{asBytes:!0}),f)}})(Ih)})(Zm);var WO=Zm.exports;const GO=KO(WO),Jm=z(e=>e.defineEmit()),Ym=z(e=>e.defineEmit("closeRelay",["url"]));async function ZO(e){return new Promise((n,r)=>{logger.http("Start connecting:",e);try{const i=new URL(e);try{const o=new WebSocket(i);o.onopen=()=>{logger.http("Successfully connected:",e),n(o)},o.onerror=s=>{logger.http("connect failed:",e),r(s)}}catch(o){logger.error("WebSocket",o)}}catch{logger.error("Incorrect connection",e)}})}const JO=z("web-socket-factory",e=>e.assignFeat({webSocketFactory:ZO})),YO=z(({mod:e})=>e.defineEmit()),Sp=z(({mod:e,line:n})=>e.defineEmit().defineEmit());var ti=Symbol("verified"),XO=e=>e instanceof Object;function QO(e){if(!XO(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let n=0;n<e.tags.length;n++){let r=e.tags[n];if(!Array.isArray(r))return!1;for(let i=0;i<r.length;i++)if(typeof r[i]=="object")return!1}return!0}new TextDecoder("utf-8");var eU=new TextEncoder,tU=class{generateSecretKey(){return Ft.utils.randomPrivateKey()}getPublicKey(e){return Be(Ft.getPublicKey(e))}finalizeEvent(e,n){const r=e;return r.pubkey=Be(Ft.getPublicKey(n)),r.id=ds(r),r.sig=Be(Ft.sign(ds(r),n)),r[ti]=!0,r}verifyEvent(e){if(typeof e[ti]=="boolean")return e[ti];const n=ds(e);if(n!==e.id)return e[ti]=!1,!1;try{const r=Ft.verify(e.sig,n,e.pubkey);return e[ti]=r,r}catch{return e[ti]=!1,!1}}};function nU(e){if(!QO(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function ds(e){let n=yi(eU.encode(nU(e)));return Be(n)}var tu=new tU;tu.generateSecretKey;tu.getPublicKey;tu.finalizeEvent;var rU=tu.verifyEvent;const Xm=z(e=>e.defineEmit());let iU=10*1e3;const Bh=z(e=>e.defineEmit().assignChain({emitOK(...[n,r]){this.emit({types:["ok",`ok:${n}`]},n,r)},onOK(n,r){if(r!=null&&r.eventId){const i=`ok:${r.eventId}`;this.once(i,n,r)}else{const i="ok";this.on(i,n,r),rt(iU).then(()=>{this.removeListener(i,n)})}}}));let rc=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/server/Relay.ts"),oU=Jl(10);class sU{constructor(n,r){this._line=n,this.subIds=new Set,this.timeout=void 0,this.isClose=!1,this.publishIds=new Set,this.getLine=By(()=>this._line.add(nu.Staff,Ym,Jm,_o,Bh,Ya,Xm,rn)),this.ws=r,this.ws.onmessage=(...i)=>{oU.unShift(()=>{this.handleMessage(...i)})}}handleMessage(n){try{const r=JSON.parse(n.data);rc.http("handleMessage",this.ws.url,r);let i="";if(Array.isArray(r))switch(r[0]){case"EVENT":i=r[1];let o=r[2];if(!rU(o)){rc.error("Event signature error");return}this.getLine().emitEvent(i,o,this.ws.url);break;case"NOTICE":this.getLine().emit("notice",r[1],this.ws.url);break;case"EOSE":i=r[1],this.getLine().emitEose(i,this.ws.url);break;case"OK":let s=r[1];this.getLine().emitOK(s,{ok:r[2],message:r[3],url:this.ws.url}),this.closePublish(s);break;case"AUTH":const a=r[1];this.getLine().emit("auth",this.ws.url,a);break;default:break}}catch{return}}auth(n){this.send(["AUTH",n])}send(n){rc.http("send:",n[0],this.ws.url,n),window.sendCount++,this.ws.send(JSON.stringify(n))}createSubId(){return Math.random().toString().slice(2)}req(n,r=this.createSubId()){this.addSubId(r);try{this.send(["REQ",r,...n])}catch{this.deleteSubId(r)}return r}closePublish(n){this.publishIds.has(n)&&(this.publishIds.delete(n),this.autoClose())}publish(n){this.send(["EVENT",n]),this.publishIds.add(n.id),setTimeout(()=>{this.closePublish(n.id)},6e4)}closeReq(n){this.subIds.has(n)&&(this.send(["CLOSE",n]),this.deleteSubId(n))}addSubId(n){this.isClose&&(this.isClose=!0,this.getLine().relayPool.getPool().set(this.ws.url,this)),this.subIds.add(n),this.getLine().relayPool.allSubIds.add(n)}deleteSubId(n){this.subIds.has(n)&&(this.subIds.delete(n),this.getLine().relayPool.allSubIds.delete(n),this.getLine().removeAllListener(`event:${n}`),this.autoClose())}close(){if(!this.isClose){this.isClose=!0;for(const n of this.subIds)this.deleteSubId(n);this.ws.close(),this.getLine().relayPool.closeRelay(this.ws.url),this.getLine().emit(`relay-closed:${this.ws.url}`)}}clearAutoClose(){clearTimeout(this.timeout),this.timeout=void 0}autoClose(n=!1){this.subIds.size>0||this.publishIds.size>0||(n?this.close():this.timeout=setTimeout(()=>{this.autoClose(!0)},6e4))}}const nu=t0({name:"relayPool",id:"pool-staff"},class extends Xa{constructor(e){super(e),this.name="relayPool",this.pool=new Map,this.allSubIds=new Set,this.getLine=Ki(()=>e.createChild().add(JO).add(Sp).add(Sp).add(YO).add(Ym).add(Jm).add(rn).add(Ya).add(Bh)),this.listen()}async listen(){logger.debug("listen"),this.getLine().on("sub",async(e,n,r)=>{logger.http("sub",e,r,n),(await this.getRelay(e)).req(n,r)}),this.getLine().on("desub",async(e,n)=>{if(logger.http("desub",n,e),!this.allSubIds.has(e))return;this.allSubIds.delete(e);const r=this.getRelayFromPool(n);r&&r.closeReq(e)}),this.getLine().on("publish",async(e,n)=>{logger.http("publish",e,n),(await this.getRelay(e)).publish(n)}),this.getLine().on("closeRelay",async e=>{logger.http("closeRelay",e);const n=this.getRelayFromPool(e);n&&n.close()}),this.getLine().on("auth",async(e,n)=>{logger.http("auth",e,n),(await this.getRelay(e)).auth(n)})}getPool(){return this.pool}async getRelay(e){return this.pool.get(e)||await this.createRelay(e)}getRelayFromPool(e){return this.pool.get(e)}closeRelay(e){if(!this.pool.has(e))return;let n=this.getRelayFromPool(e);if(n){for(const r of n.subIds)this.allSubIds.delete(r);n.close()}this.pool.delete(e)}async createRelay(e){return new Promise(async(n,r)=>{const i=await this.getLine().webSocketFactory(e);i.onerror=i.onclose=()=>{this.closeRelay(e)};const o=new sU(this.getLine(),i);this.pool.set(e,o),n(o)})}}),Qm=z(()=>[Cn,Gm,nu.Staff,Jr],({mod:e,line:n})=>{let r=Jl(500),i=Z4({max:10,min:10}),o="global-urls",{mod:s,line:a}=e.defineEmit().assignFeat({globalUrlList:n.reactive({value:new Set})}).assignFn({getCacheGlobalUrls(){let u=lx(o);return u&&new Set(u)},setGlobalUrlList(u){this.globalUrlList.value=u},loadCacheGlobalUrls(){let u=this.getCacheGlobalUrls();if(u)return this.setGlobalUrlList(Yn(this.getGlobalUrls(),u)),a.emit("added-the-global-url-list",new Set(u),this.getGlobalUrls()),u},fetchGlobalUrls(u){logger.debug("fetchGlobalUrls");let c=hd(f=>{ki(o,[...f],{duration:1*1e3*3600*24,useLocalStorage:!0,useMemoryCache:!0})},1e4);u&&Yn(this.getGlobalUrls(),u);let l=this.createChild();return l.onEvent((f,h)=>{const{write:p,read:b}=dm(h.tags);let y=Yn(new Set,p,b),d=W4(y,this.getGlobalUrls());if(Yn(this.getGlobalUrls(),d),a.emit("added-the-global-url-list",d,this.getGlobalUrls()),l.emit("added-the-global-url-list",d,this.getGlobalUrls()),c(this.getGlobalUrls()),i.isValidVote()&&i.proportion(!1)>=.9){r.clear(),l.removeAllListener("added-the-global-url-list"),l.emitter.clear(),logger.silly("fetchGlobalUrls:",i.proportion(!1));return}if(d.size===0||d.size/y.size<.1||this.getGlobalUrls().size>99){i.add(!1);return}i.add(!0),d.forEach(g=>{r.unShift(()=>{n.addUrl(g)})})}).setSubOpt({eoseAutoDesub:!0}).addFilter({kinds:[10002],limit:200}).addUrls(u||this.defaultUrls)},getGlobalUrls(){return this.globalUrlList.value},autoGetGlobalUrls(){return Fy("autoGetGlobalUrls",()=>new Promise((u,c)=>{let l=this;function*f(){yield l.getGlobalUrls(),yield l.loadCacheGlobalUrls()}for(const b of f())if(b&&b.size>=30){u(b);return}let h=hd(u,4e3),p=this.fetchGlobalUrls();p==null||p.on("added-the-global-url-list",()=>{h(this.getGlobalUrls())})}),{useLocalStorage:!1,useMemoryCache:!0,duration:99,requestMerge:!0})},addGlobalUrls(u){Yn(this.getGlobalUrls(),u)}});return s});let $p={};const eb=z(()=>[Gm,Qm],({mod:e,line:n})=>e.assignFeat({async autoGlobalDiscoveryUserByPubkey(r,i=50,o){let s=yd.fromHex(r.toHex());function a(u){for(const c of u)$p[c]=yd.fromHex(GO(c))}return a(await this.autoGetGlobalUrls()),new Set(Object.entries($p).map(([u,c])=>({url:u,priority:s.XOR(c).leadingZeroNumber()})).sort((u,c)=>c.priority-u.priority).slice(0,i).map(({url:u})=>u))}})),kh=z(()=>[eb],({mod:e,line:n})=>e.assignFeat({autoAddUrlByGlobalDiscoveryUser(r,i=5){let o=Jl(1e3);function s(a,u){for(const c of a)o.unShift(()=>{u.addUrl(c)})}return this.autoGlobalDiscoveryUserByPubkey(r,i).then(a=>{s(a,this)}),()=>{o.clear()}}}));let ic=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/discovery/AutoAddKind10002UrlStaff.ts");const Ji=z(()=>[ou,Ro,$h,Bt.Staff,Oh],"auto-add-kind-url-staff",({mod:e,line:n})=>e.assignFn({autoAdd10002(r,i={}){typeof r=="string"&&(r=We.fromHex(r));let o,s=this.createChild().add(kh,Yi,yo).provideLatestEvent().addFilter({kinds:[10002],authors:[r.toHex()]});s.autoLocalCache();let a=s.isHasLatestEvent();ic.debug("isLocalHas",a),s.onHasLatestEvent(c=>{ic.debug("onHasLatestEvent");const{readUrl:l,writeUrl:f}=hm(c.tags);(i.read??!0)&&this.addUrls(l),(i.write??!0)&&this.addUrls(f),u(),!a&&(s.addUrls(l),s.addUrls(f))}),s.asyncCall(async()=>{s.isHasLatestEvent()||(i.urls&&s.addUrls(i.urls),await rt(500),!s.isHasLatestEvent()&&(s.initedAddReadWrite(),await rt(500),!s.isHasLatestEvent()&&(ic.debug("autoAddUrlByGlobalDiscoveryUser"),o=s.autoAddUrlByGlobalDiscoveryUser(r),await rt(500))))});function u(){o==null||o()}return u}}));let aU=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/api/EventApiStaff.ts");const ru=z(()=>[yo,Bt.Staff,ou,bh,Ji,Po,No],"event-api-staff",({mod:e,line:n})=>e.assignChain({addUrlForCommonEventList(r){_y(async()=>{await this.addUrlsByCub(r),await this.autoAddUrlForRelayConfiguratorByOptions(r)})}}).assignFn({commonEventList(r){return aU.debug("commonEventList:",r),this.cacheByOptions(r,()=>(console.log("commonEventList:cacheByOptions",11),this.createChild().add(gU).add(yo).add(Cn).add(Wm).provideEventList().setupSort(r).addFiltersByOptions(r).addUrlForCommonEventList(r)))}})),Jr=z("reactive-staff",({mod:e,line:n})=>e.assignFn({reactive(r){return r.__isReactive=!1,r},ref(r){return this.reactive({value:r})}})),Yi=z(()=>[rn,Jr,wr],({mod:e,line:n})=>e.defineEmit().provide("latestEvent",function(){let r=this.reactive({value:null});return this.onEvent((i,o,s)=>{(!r.value||o.created_at>r.value.created_at)&&(r.value=o)}),r}).assignFeat({isHasLatestEvent(){return!!this.getLatestEvent()},setLatestEvent(r){return this.injectLatestEvent().value=r},getLatestEvent(){return this.injectLatestEvent().value},updateLatestEvent(r){let i=this.getLatestEvent();this.injectLatestEvent().value=r,this.emit("latestEvent:update",r,i)},onHasLatestEvent(r){this.isHasLatestEvent()&&r(this.getLatestEvent()),this.on("latestEvent:update",r)},onHasLatestEventOnce(r){this.isHasLatestEvent()?r(this.getLatestEvent()):this.on("latestEvent:update",r,{once:!0})}})),tb=z(()=>[Jr,Yi,r0],"metadata-staff",({mod:e,line:n})=>e.assignOwnFeat(()=>({metadata:n.ref({})})).assignFeat({getMetadata(){return this.getLatestEvent()&&cp(this.getLatestEvent())},onHasMetadata(r){this.onHasLatestEvent(i=>{r(cp(i))})}}));__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/api/ChannelMetadataApiStaff.ts");const fC=z(()=>[ru,$h,Bt.Staff],({mod:e,line:n})=>e.assignFeat({getChannelMetadataByChannelId(r,i={}){return this.cacheByOptions({name:uU(r),...i},()=>{const o=n.createChild().add(Cn).add(tb).add(Js).add(Zs).provideLatestEvent();return o.addFilters([{kinds:[40],ids:[r]},{kinds:[41],"#e":[r]}]),o.autoLocalCache(),o.addUrlForHasLatestEventLine(i),o})}}));function uU(e){return"GCMBI:"+e}z(({mod:e,line:n})=>e.assignFeat({getContactListLineByPubkey(r){return r=We.fromMaybeHex(r),cU()}}));function cU(e){throw new Error("Function not implemented.")}const hC=z(()=>[Bt.Staff,Po,No],({mod:e,line:n})=>e.assignChain({addUrlForEventById(r){_y(async()=>{await this.addUrlsByCub(r),await this.autoAddUrlForRelayConfiguratorByOptions(r)})}}).assignFn({getEventById(r,i={}){return this.cacheByOptions({name:"GEBID:"+r,...i},()=>this.createChild().add(kh).add(Cn).add(Yi).provideLatestEvent().addFilter({ids:[r],limit:1}).addUrlForEventById(i))}})),lU=z(()=>[Yi],({mod:e,line:n})=>e.assignFeat({getRelayConfiguration(){const r=this.getLatestEvent();return r?up(r.tags):null},onHasRelayConfiguration(r){this.onHasLatestEvent(i=>{r(up(i.tags))})}}));__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/api/UserApiStaff.ts");const dC=z(()=>[ru,$h,Bt.Staff,Po],({mod:e,line:n})=>e.assignFn({getUserMetadataLineByPubkey(r,i={}){return typeof r=="string"&&(r=We.fromHex(r)),this.cacheByOptions({name:"GUMLBP:"+r.toHex(),...i},()=>{const o=n.createChild().add(Zr).add(tb).add(Js).add(Zs).provideLatestEvent();return o.addFilter({kinds:[0],authors:[r.toHex()]}),o.autoLocalCache(),i.pubkey=r,o.addUrlForHasLatestEventLine(i),o})},getUserRelayUrlConfigByPubkey(r,i={}){return r=We.fromMaybeHex(r),this.cacheByOptions({name:"GURUCBP:"+r.toHex(),...i},()=>{const o=n.createChild().add(Cn).add(Js).add(Zs).add(lU).provideLatestEvent();return o.addFilter({kinds:[10002],authors:[r.toHex()]}),o.autoLocalCache(),i.pubkey=r,o.addUrlForHasLatestEventLine(i),o})}})),No=z(()=>[Ji],({mod:e,line:n})=>e.assignFn({async addUrlsByCub(r){const i=new Set;if(r){if(await this.addUrlsWithTimeout(r==null?void 0:r.urls,1e3),r.pubkey&&!i.has(r.pubkey.toString())&&(i.add(r.pubkey.toString()),this.autoAdd10002(r.pubkey,r.autoAdd10002Options),await rt(500)),r!=null&&r.pubkeys)for(const o of r==null?void 0:r.pubkeys)i.has(o)||(i.add(o),this.autoAdd10002(o,r.autoAdd10002Options),await rt(500));if(r.tags){for(const[o,s]of as(r.tags,["r"]))s&&this.addUrl(s);for(const[o,s,a]of as(r.tags,["e","a","q","p"]))a&&this.addUrl(a);for(const[o,s,a]of as(r.tags,["p"]))i.has(s)||(i.add(s),this.autoAdd10002(s,a?{urls:new Set([a]),...r.autoAdd10002Options}:r.autoAdd10002Options));await rt(500)}}}}).assignChain({addUrlsByCubChain(r){this.addUrlsByCub(r)}})),Oh=z(({mod:e,line:n})=>e.assignFeat({asyncCall(r,i,o){var s;(s=r.call(this))==null||s.then(i,o)},chainCall(r,i,o){return this.asyncCall(r,i,o),this}})),Ip="app-config",Ho=z(()=>[Jr],({mod:e,line:n})=>{let r;try{let s=localStorage.getItem(Ip);s&&(r=JSON.parse(s))}catch{}function i(s){localStorage.setItem(Ip,JSON.stringify(s))}const o=n.reactive(r??{});return e.assignFeat({config:o,setting:n.reactive(new bx)}).assignFn({getConfig:function(){return this.config},defineConfig:function(s,a,u){return this.defineSetting(s,u),a===void 0?this:this.config[s]===void 0?(this.config[s]=a,i(this.config),this):this},defineSetting(s,a){const u={configName:s,...a};return a&&u.path&&this.setting.setValue(u.path,u),this},assignConfig:function(s){console.log("config",s),Object.assign(this.config,s),console.log("this.config",this.config),i(this.config)}})}),fU=z(()=>[Ho],({mod:e,line:n})=>n.defineConfig("lazyDelayForPapaw",0,{path:"papaw",displayType:"range",range:[0,1e3]}).defineConfig("enableLazyLoadPapawTree",!1,{path:"papaw"}).mod),hU=z(()=>[Ho],({mod:e,line:n})=>n.defineConfig("autoPing",!0,{path:""}).mod),dU=z(()=>[Ho],({mod:e,line:n})=>n.defineConfig("enableTree",!1,{path:"papaw"}).mod);z(()=>[Ho,fU,hU,dU],({mod:e,line:n})=>e);const Fr={default(){return(e,n)=>{e.push(n)}},reverseDefault(){return(e,n)=>{e.unshift(n)}},insertOnObjectList(e){return(n,r)=>{Yl(n,r,e)}},reverseInsertOnObjectList(e){return(n,r)=>{Uy(n,r,e)}}},pU=Y4(),Bp=pU({positive:{default:Fr.default(),"created-at":Fr.insertOnObjectList(e=>e.created_at)},reverse:{"created-at":Fr.reverseInsertOnObjectList(e=>e.created_at),default:Fr.reverseDefault()}}),gU=z(()=>[nu.Staff,Jr,wr,rn],({mod:e,line:n})=>{function r(){return n.ref([])}console.log("EventListStaff",n);let i=e.assignFeat({eventList:null,insertEventList:Fr.default(),pushEvent(o,s="local",a="local"){console.log("pushEvent",this.getList().length),this.insertEventList(this.getList(),o)},getList(){if(!this.eventList)throw new Error("'provideEventList'");return this.eventList.value},setList(o){if(!this.eventList)throw new Error("'provideEventList'");this.eventList.value=o},useInsertObjectListByCreatedAt(){this.insertEventList=Fr.insertOnObjectList(o=>o.created_at)},useReverseInsertObjectListByCreatedAt(){this.insertEventList=Fr.reverseInsertOnObjectList(o=>o.created_at)}}).assignChain({setInsertEventList(o=Bp.positive.default){this.insertEventList=o},setupSort(o){this.setInsertEventList(Bp[o.reverseSort?"reverse":"positive"][o.sort??"default"]),this.resort()},resort(){let o=this.insertEventList,s=[];this.getList().map(a=>{o(s,a)}),this.setList(s)}}).assignChain({provideEventList(){this.eventList=r()}});return n.onCreateChildDep(o=>{o.on("event",(s,a,u)=>{o.pushEvent(a,u,s)})}),console.log(),i});z("insertObjectList",({mod:e,line:n})=>e.assignFeat({insertObjectList(r,i,o){r.push(i)}}));__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/event/ReverseSearchInsertOnObjectListStaff.ts");z("reverseInsertOnObjectList",({mod:e,line:n})=>e.assignFeat({reverseInsertOnObjectList:Uy}));z("insertOnObjectList",({mod:e,line:n})=>e.assignFeat({insertOnObjectList:Yl}));z(()=>[rn,Zr],e=>(e.out().on("event",(n,r)=>!!yU(r,[...e.out().filterList],0)),e));function yU(e,n,r){return n.length===0?!0:n.some(i=>wU(e,i,r))}function wU(e,n,r){const{ids:i,kinds:o,authors:s,since:a,until:u,limit:c,search:l}=n;return i&&!i.includes(e.id)||o&&!o.includes(e.kind)||s&&!s.includes(e.pubkey)||a&&!(e.created_at>=a)||u&&!(e.created_at<=u)||c&&!(r<c)?!1:mU(n,e.tags)?!(l&&!JSON.stringify(e).toLowerCase().includes(l.toLowerCase())):!1}function mU(e,n){for(let r in e)if(r[0]==="#"){let i=r.slice(1),o=e[`#${i}`];if(o&&!n.find(([s,a])=>s===i&&o.includes(a)))return!1}return!0}const iu=z(()=>[bh,Zi],({mod:e,line:n})=>e.assignFn({createEventTemplate(r){return Object.assign({kind:1,tags:[],content:"",created_at:this.nowCreateAt()},r)},async createEvent(r){const i=await this.getPubkeyOrNull();if(!i)throw new Error("pubkey");let o=Object.assign(this.createEventTemplate(r),{pubkey:i.toHex()});return this.createEventTemplate({}),o=JSON.parse(JSON.stringify(o)),o.id=ds(o),o=await this.getNostrApi().signEvent(o),o}})),pC=z(({mod:e,line:n})=>e.assignFeat({NostrApiMode:kt,getNostrApiMode:go,setNostrApiMode:so}));z(({mod:e,line:n})=>e.assignFeat({publishEventIdList:new Set,publishEventList:[]}));z(e=>(e.assignFeat({}),e));z(e=>e.defineEmit());z(e=>e.assignFeat({subIds:new Set}));const bU=z(()=>[Co],e=>e.assignFn({timeoutAutoUnsub(n=20*1e3*60){this.relayPool.getLine().on("sub",(r,i,o)=>{setTimeout(()=>{this.relayPool.getLine().emit("desub",o,r)},n)})}})),vU=z(()=>[Bh,Xm,Ya,rn],e=>e);let ni=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/synchronizer/common/Synchronizer.ts");class nb extends Xa{constructor(n,r,i){super(n),this.api=r,this._ready=new q4,this.getLine=Ki(()=>n.createChild().add(vm,Bt.Staff,Co,Cn,vU,_o,vh,Ja,Zi,eb,Js,bU,kh,iu).mod.defineEmit("synchronizer-update").out()),this.options=i??{},this.name=r.name,this.eventMap=new Ql(`__key_list:${r.name}`),this.init(i)}getFilters(){return this.api.getFilters()}serializeToData(n){return this.api.serializeToData(n)}deserializeToEvent(n,r){return this.api.deserializeToEvent(n,r)}eventToFilter(n){return this.api.eventToFilter(n)}createKey(n){return this.api.createKey(n)}setData(n,r){return this.api.setData(n,r)}getData(n){return this.api.getData(n)}getDataKeys(){return this.api.getDataKeys()}toChanged(n){return this.api.toChanged(n)}getChangeAt(n){return this.api.getChangeAt(n)}changesSaved(n){return this.api.changesSaved(n)}async onInited(n){return n?this._ready.promise.then(n):this._ready.promise}async init(n){await this.readEventMap(),n!=null&&n.autoSync&&await this.sync(),this._ready.toResolve()}async createKeyByEvent(n){return await this.createKey(await this.eventToFilter(n))}async readEventMap(){const n=this.eventMap.getMap();for(const[r,i]of n){const o=await this.serializeToData(i),s=this.cacheKeyToKey(r);this.setData(s,o)}}async setLocalEvent(n){const r=await this.createKeyByEvent(n);this.setEvent(r,n)}getEvent(n){return this.eventMap.get(this.createEventCacheKey(n))}setEvent(n,r){this.eventMap.set(this.createEventCacheKey(n),r)}createEventCacheKey(n){return`${this.name}:${n}`}cacheKeyToKey(n){return n.slice(this.name.length+1)}async getChangeAtByFilter(n){const r=await this.createKey(n);return this.getData(r)}getUpdateAt(n){const r=this.getEvent(n);return r?r.created_at:null}async getIsChanged(n){return!!await this.getChangeAt(n)}getRelayConfigurator(){return this.getLine().relayConfigurator}async syncOne(n,r){ni.debug(this.name,"syncOne");const i=new Set;i.add(n);let o=await this.getFilters();if(o.length===0)return;let s=await this._sync(o,r);s.on("synchronizer-update",a=>{s.publishes(Yn(new Set,this.getRelayConfigurator().getWriteList(),this.getRelayConfigurator().getReadList()),a)}),s.addUrls(i)}async sync(n={}){n=Object.assign({},this.options,n),ni.silly(this.name,"sync",n,this.options);const r=Yn(new Set,this.getRelayConfigurator().getWriteList(),this.getRelayConfigurator().getReadList(),n==null?void 0:n.moreUrls);ni.silly("sync:urls",r);let i=await this.getFilters();if(i.length===0)return;ni.silly("sync:filters",i);let o=await(await this._sync(i,n)).add(Ji);ni.silly("sync:urls",o),o.addUrls(r);for(const a of i)if(a.authors)for(const u of a.authors)o.autoAdd10002(u);if(ni.silly("sync:addUrls:",r,"isAutoAddRelayUrl:",n.isAutoAddRelayUrl),!n.isAutoAddRelayUrl)return;const s=await o.getPubkeyOrNull();s&&o.autoAddUrlByGlobalDiscoveryUser(s)}async _sync(n,r={}){const i=new Set;let o=this.getLine().createChild();return this.firstPublish(o,i,r),o.setSubOpt({eoseAutoDesub:!0}),o.addFilters(n),o.onEvent((s,a,u)=>{var c;(c=r.onEvent)==null||c.call(r,a,u),this.syncEvent(o,a,u,i)}),o}async firstPublish(n,r,i){n.onEose((o,s)=>{r.has(s)||this.updatePublish(n,s,r,i)})}updatePublish(n,r,i,o){const s=this.eventMap.getValues(),{onOK:a,onPush:u}=o;n.publishEvents(r,s,{onOK:a}),i.add(r),u==null||u(r)}async syncEvent(n,r,i,o){const s=await this.createKeyByEvent(r),a=this.getUpdateAt(s);if(!a||r.created_at>a)this.setData(s,await this.serializeToData(r)),this.setLocalEvent(r),n.publishes(o,r),n.emit("synchronizer-update",r);else if(r.created_at<a&&i){const u=await this.getEvent(s);u&&n.publish(i,u)}i&&o.add(i)}async save(){const n=[...await this.getDataKeys()];for(const r of n){if(!await this.getIsChanged(r))continue;const i=await this.getChangeAt(r);if(!i)continue;const o=await this.getData(r);if(!o)continue;const s=await this.deserializeToEvent(o,i);this.setEvent(r,s),await this.changesSaved(r),await this.publish(s)}}async publish(n){await this.getLine().publishes(this.getRelayConfigurator().getWriteList(),n)}clear(){this.eventMap.clear()}}class EU{constructor(n,r,i){this.api=r,this.map=new Map;let o=this;this.synchronizer=new nb(n,{...r,async setData(s,a){o.map.set(s,{data:a,changeAt:null})},async getData(s){var a;return((a=o.map.get(s))==null?void 0:a.data)??null},async getDataKeys(){return o.map.keys()},async toChanged(s){const a=o.map.get(s);a&&(a.changeAt=ya())},async getChangeAt(s){const a=o.map.get(s);return a?a.changeAt:null},async changesSaved(s){const a=o.map.get(s);a&&(a.changeAt=null)}},i)}async addData(n,r){this.map.set(n,{data:r,changeAt:null}),this.synchronizer.toChanged(n)}async getDataKeys(){}}class xU extends EU{constructor(n,r,i){super(n,{...r,async eventToFilter(o){const s=mh("d",o.tags);return[{kinds:[o.kind],authors:[o.pubkey],"#d":[(s==null?void 0:s[1])??""]}]},async createKey(o){var s,a,u;const c=o[0];if(!c)return"";const l=(s=c.kinds)==null?void 0:s[0],f=(a=c.authors)==null?void 0:a[0],h=(u=c["#d"])==null?void 0:u[0];return await kp({kind:l??-1,pubkey:f??"",identifier:h??""})}},i)}async addDataByAddressPointer(n,r){await this.addData(await this.createKeyByAddressPointer(n),r)}async createKeyByAddressPointer(n){return kp(n)}}async function kp(e){return`${e.kind}:${e.pubkey}:${e.identifier}`}class rb extends Xa{constructor(n,r,i){super(n),this.changeAt=null,this.api=r;let o=this;this.data=this.createDefault(),this.synchronizer=new nb(n,{...r,async eventToFilter(s){return[]},async createKey(s){return""},async setData(s,a){o.data=a},async getData(s){return o.data},async getDataKeys(){return[""]},async toChanged(s){o.changeAt=ya()},async getChangeAt(s){return o.changeAt},async changesSaved(s){o.changeAt=null}},i)}getLine(){return this.synchronizer.getLine()}getData(){return this.data}save(){return this.synchronizer.save()}createDefault(){return this.api.createDefault()}getFilters(){return this.api.getFilters()}serializeToData(n){return this.api.serializeToData(n)}deserializeToEvent(n,r){return this.api.deserializeToEvent(n,r)}getDataSync(){return this.data}hasChange(){return!!this.changeAt}toChanged(){this.synchronizer.toChanged("")}getLocalEvent(){return this.synchronizer.getEvent("")}getUpdateAt(){return this.synchronizer.getUpdateAt("")}clear(){this.data=this.api.createDefault(),this.synchronizer.clear()}}const LU=window.defaultRelayUrls??["wss://no.str.cr","wss://no-str.org","wss://nos.lol","wss://nostr.com.de","wss://relay.mostr.pub","wss://relay.nostr.wirednet.jp","wss://no-str.org","wss://brb.io"],ul=class extends Xa{constructor(n){super(n);let r=this;this.replaceableSynchronizer=new rb(n,{name:"RelayConfigurator",createDefault:function(){return{read:new Set,write:new Set,config:{}}},async deserializeToEvent(i,o){const s=Xk(i.config);return await r.getLine().createEvent({kind:10002,tags:s,created_at:o})},async serializeToData(i){const{relayConfiguration:o}=hm(i.tags);return o},async getFilters(){const i=await r.getLine().getPubkeyOrNull();return i?[{kinds:[10002],authors:[i.toHex()]}]:[]}},{isAutoAddRelayUrl:!0,autoSync:!0})}hasChange(){this.replaceableSynchronizer.hasChange()}getLine(){return this.replaceableSynchronizer.synchronizer.getLine()}getDataSync(){return this.replaceableSynchronizer.getDataSync()}getData(){return this.replaceableSynchronizer.getDataSync()}getConfiguration(){return this.replaceableSynchronizer.getDataSync()}async initedGetWriteList(){return await this.onInited(),this.getWriteList()}getWriteList(){return this.getConfiguration().write}async initedGetReadList(){return await this.onInited(),this.getReadList()}getReadList(){return this.getConfiguration().read}async initedGetWriteReadList(){return await this.onInited(),new Set([...this.getWriteList(),...this.getReadList()])}addWriteRead(n){this.addRead(n),this.addWrite(n)}addWrite(n){this.replaceableSynchronizer.toChanged(),this.getRule(n).write=!0,this.getConfiguration().write.add(n)}remoteWrite(n){this.replaceableSynchronizer.toChanged(),this.getRule(n).write=!1,this.getConfiguration().write.delete(n)}addRead(n){this.replaceableSynchronizer.toChanged(),this.getRule(n).read=!0,this.getConfiguration().read.add(n)}remoteRead(n){this.replaceableSynchronizer.toChanged(),this.getRule(n).read=!1,this.getConfiguration().read.delete(n)}remove(n){this.replaceableSynchronizer.toChanged(),delete this.replaceableSynchronizer.getDataSync().config[n],this.getConfiguration().write.delete(n),this.getConfiguration().read.delete(n)}setRule(n,r,i){if(this.replaceableSynchronizer.toChanged(),!r&&!i)this.remove(n);else{const o=this.getRule(n);o.read=!!r,o.write=!!i,i?this.getConfiguration().write.add(n):this.getConfiguration().write.delete(n),r?this.getConfiguration().write.add(n):this.getConfiguration().write.delete(n)}}getRule(n){return this.getConfiguration().config[n]??(this.getConfiguration().config[n]={})}hasReadByUrl(n){return this.getReadList().has(n)}getUpdateAt(){return this.replaceableSynchronizer.getUpdateAt()}hasWriteByUrl(n){return this.getWriteList().has(n)}onInited(n){return this.replaceableSynchronizer.synchronizer.onInited(n)}clear(){this.replaceableSynchronizer.clear()}refresh(){this.clear(),this.replaceableSynchronizer.synchronizer.sync()}};ul.Staff=e0("relayConfigurator",ul);let Bt=ul;function AU(e){const n=new Set;return e.tags.forEach(r=>{r[0]==="r"&&n.add(r[1])}),n}const ou=z(()=>[Bt.Staff,Ro],({mod:e,line:n})=>e.assignFn({initedAddRead(){return this.relayConfigurator.onInited(()=>{this.addUrls(this.relayConfigurator.getReadList())})},initedAddWrite(){return this.relayConfigurator.onInited(()=>{this.addUrls(this.relayConfigurator.getWriteList())})},initedAddReadWrite(){return new Promise((r,i)=>{this.relayConfigurator.onInited(()=>{this.addUrls(this.relayConfigurator.getReadList()),this.addUrls(this.relayConfigurator.getWriteList()),r()})})},autoAddUrlForRelayConfiguratorByOptions(r){let{autoAddRelayUrls:i="read"}=r??{};return i===!0?this.initedAddReadWrite():i==="read"?this.initedAddRead():i==="write"?this.initedAddReadWrite():void 0}})),co=24133;class Uh extends ba{static fromBunker(n,r){const i=new URL(r);return new Uh(n,We.fromHex(i.pathname.slice(2)),new Set(i.searchParams.getAll("relay")))}constructor(n,r,i){super(),this.urls=i,logger.debug("NostrConnectNostrApiImpl",this),this.remoteUserPubkey=r;let o=ib("client");this.clientPubkey=o.getPubkey(),this.clientNostrApi=new Uo(o),this.getLine=Ki(()=>n.createChild().add(Zr,ou,Ja,To,z(a=>a.defineEmit())));const s=this;this.nostrApiProvide.resolve({async encrypt(...a){return await s.request({method:"nip04_encrypt",params:[a[0].toHex(),a[1]]})},async decrypt(...a){return await s.request({method:"nip04_decrypt",params:[a[0].toHex(),a[1]]})},async getPublicKey(){return We.fromHex(await s.request({method:"get_public_key",params:[]}))},async getRelays(){return await s.request({method:"get_relays",params:[]})},async signEvent(a){return await s.request({method:"sign_event",params:[a]})}}),this.listen()}async connect(){return await this.request({method:"connect",params:[this.remoteUserPubkey.toHex()]})}async disconnect(){return await this.request({method:"disconnect",params:[]})}listen(){let n=this.getLine().createChild().addFilter({kinds:[co],"#p":[this.clientPubkey.toHex()]}).onEvent((r,i)=>{(async()=>{try{const o=JSON.parse(await this.clientNostrApi.decrypt(We.fromHex(i.pubkey),i.content)),s=o.id;this.getLine().emit(`request:${s}`,o)}catch(o){logger.error(o)}})()});return n.addUrls(this.urls),n}async request(n){return new Promise(async(r,i)=>{const o=ky(),s=JSON.stringify({id:o,method:n.method,params:n.params}),a=await this.clientNostrApi.encrypt(this.remoteUserPubkey,s),u=await this.clientNostrApi.signEvent({kind:co,created_at:this.getLine().nowCreateAt(),pubkey:this.clientPubkey.toHex(),content:a,tags:[["p",this.remoteUserPubkey.toHex()]]});this.getLine().once(`request:${o}`,c=>{c&&(c.error?i(c.error):r(c.result))}),this.getLine().publishes(this.urls,u)})}}function ib(e){let n=localStorage.getItem(`__prikey__${e}`);return n||(n=t7(),localStorage.setItem(`__prikey__${e}`,n)),pr.fromHex(n)}class yC{constructor(n){this.perm=new Ql("provide-remote-signer"),this.secrets=new Set,this.connectList=[],this.provideConnect=By(()=>{let i=this.getLine().createChild().add(yo).add(z(o=>o.defineEmit().assignFeat({onAsk(s){this.on("ask",s)},emitAsk(s){this.emit("ask",s)}}))).onEvent((o,s)=>{Date.now()/1e3-s.created_at>10||this.toPush(s,i)});return this.getLine().getPubkeyOrNull().then(o=>{o&&i.addFilter({"#p":[o.toHex()],kinds:[co],since:i.nowCreateAt()})}),i.initedAddRead(),i}),this.getLine=Ki(()=>n.createChild().add(Zr,ou,Ja,Zi));let r=ib("provide_remote_signer");this.remoteSignerPubkey=r.getPubkey(),this.remoteSignerNostrApi=new Uo(r)}async toPush(n,r){try{console.log("toPush",n.content,n.pubkey);const i=await this.getLine().nostrApi.decrypt(We.fromHex(n.pubkey),n.content);console.log("provideConnect:content",i);const o=JSON.parse(i);console.log("provideConnect:requestOpt",o);const s=o.id;if(!this.perm.has(n.pubkey)&&o.method!=="connect")return;const a={allow:c=>this.allow(n,s,o,r,c),refuse:c=>this.refuse(n,s,o,r,c),event:n,requestOpt:o},u=()=>r.emitAsk(a);this.autoAsk(a,u)}catch(i){logger.error(i)}}autoAsk(n,r){const i=()=>n.allow(),o=()=>n.refuse();let s=this.hasParm(n.event.pubkey,n.requestOpt.method);s===void 0?r():s===!0?i():s===!1&&o()}remember(n,r,i,o){let s=this.perm.get(n);s||(s={},this.perm.set(r,s));let a=[i];o&&a.push(Date.now()+o),s[r]=a,this.perm.set(n,s)}async refuse(n,r,i,o,s){const{method:a}=i;s&&this.remember(n.pubkey,a,!1,s);const u=JSON.stringify({id:r,error:"refuse:The user has rejected your authorization request"}),c=await this.remoteSignerNostrApi.encrypt(We.fromHex(n.pubkey),u);await o.relayConfigurator.onInited(),o.publishes(await o.relayConfigurator.getWriteList(),await this.remoteSignerNostrApi.signEvent({kind:co,content:c,pubkey:this.remoteSignerPubkey.toHex(),created_at:o.nowCreateAt(),tags:[["p",n.pubkey]]}))}async allow(n,r,i,o,s){const{method:a}=i;console.log("duration",s),s&&this.remember(n.pubkey,a,!0,s);let u;try{const l=await this.onRequest({senderPubkey:n.pubkey,...i});u={id:r,result:l}}catch(l){u={id:r,error:l}}const c=await this.remoteSignerNostrApi.encrypt(We.fromHex(n.pubkey),JSON.stringify(u));await o.relayConfigurator.onInited(),o.publishes(o.relayConfigurator.getWriteList(),await this.remoteSignerNostrApi.signEvent({kind:co,content:c,pubkey:this.remoteSignerPubkey.toHex(),created_at:o.nowCreateAt(),tags:[["p",n.pubkey]]}))}async onRequest(n){const{method:r}=n;if(r==="describe")return["describe","get_public_key","sign_event","connect","disconnect","delegate","get_relays","nip04_encrypt","nip04_decrypt"];if(r==="get_public_key")return(await this.getLine().nostrApi.getPublicKey()).toHex();if(r==="sign_event"){const i=n;return await this.getLine().nostrApi.signEvent(...i.params)}else{if(r==="connect")return this.connectList.push(),"ack";if(r==="disconnect")return;if(r==="get_relays")return await this.getLine().relayConfigurator.onInited(),await this.getLine().relayConfigurator.getConfiguration().config;if(r==="nip04_encrypt"){const i=n;let[o,s]=i.params;return await this.getLine().nostrApi.encrypt(We.fromHex(o),s)}else if(r==="nip04_decrypt"){const i=n;let[o,s]=i.params;return await this.getLine().nostrApi.decrypt(We.fromHex(o),s)}else throw new Error("Unsupported method")}}async createBunker(n){n&&this.secrets.add(n);let r=await this.getLine().getPubkeyOrNull(),i=[...this.getLine().relayConfigurator.getWriteList()];return`bunker://${r}?${[...i.map(o=>`relay=${o}`),...n?[`&secret=${n}`]:[]].join("&")}`}getActiveList(){return this.connectList}getAllowList(){return[...this.perm.getKeys()].filter(n=>this.hasParm(n,"connect"))}hasParm(n,r){let i=this.perm.get(n);if(console.log("perm",i,r),i==null)return;let o=i[r];if(o==null)return;const[s,a]=o;if(!(a&&a<=Date.now())){if(s===!0)return!0;if(s===!1)return!1}}disConnect(n){this.perm.remote(n)}}class _h{constructor(n,r,i){if(this.kind=r,!_h.isSetsKind(r))throw new Error("SetsSynchronizer: Not is a SetsKind");this.tagsHandle=new wm(i);let o=this;this.parameterizedReplaceableMapSynchronizer=new xU(n,{name:`SetsSynchronizer:${r}`,async getFilters(){return[{kinds:[r]}]},async serializeToData(s){var a;let u=await o.parameterizedReplaceableMapSynchronizer.synchronizer.getLine().getPubkeyOrNull();return{tags:o.tagsHandle.handle(s.tags),identifier:((a=mh("d",s.tags))==null?void 0:a[1])??"",kind:s.kind,pubkey:(u==null?void 0:u.toHex())??""}},async deserializeToEvent(s,a){const{tags:u,identifier:c,kind:l}=s,f=o.tagsHandle.toTagArrayList(u);return f.push(["d",c]),await o.parameterizedReplaceableMapSynchronizer.synchronizer.getLine().createEvent({kind:l,tags:f,created_at:a})}})}static isSetsKind(n){return n>=3e4&&n<4e4}async createKey(n){let r=await this.parameterizedReplaceableMapSynchronizer.synchronizer.getLine().getPubkeyOrNull();return await this.parameterizedReplaceableMapSynchronizer.createKeyByAddressPointer({kind:this.kind,pubkey:(r==null?void 0:r.toHex())??"",identifier:n})}async add(n,r){const{parameterizedReplaceableMapSynchronizer:{synchronizer:i}}=this;let o=await this.createKey(n),s=await i.getData(o);!s||s.tags.findIndex(a=>this.tagsHandle.tagIsEq(a,r))!==-1||(s.tags.push(r),i.toChanged(o),i.save())}async delete(n,r){let i=await this.createKey(n);const{parameterizedReplaceableMapSynchronizer:{synchronizer:o}}=this;let s=await o.getData(i);if(!s)return;let a=s.tags.findIndex(u=>this.tagsHandle.tagIsEq(u,r));a!==-1&&(s.tags.splice(a,1),o.toChanged(i),o.save())}}class Ch{static isStandardListKind(n){return n>=1e4&&n<2e4||n===su.Follow}constructor(n,r,i){if(!Ch.isStandardListKind(r))throw new Error("StandardListSynchronizer: Not is a StandardListKind");this.tagsHandle=new wm(i);let o=this;this.synchronizer=new rb(n,{name:`StandardListSynchronizer:${r}`,createDefault(){return[]},async getFilters(){let s=await o.synchronizer.synchronizer.getLine().getPubkeyOrNull();return s?[{kinds:[r],limit:1,authors:[s.toHex()]}]:[]},async deserializeToEvent(s,a){return await o.synchronizer.getLine().createEvent({kind:r,tags:o.tagsHandle.toTagArrayList(s),created_at:a})},async serializeToData(s){return o.tagsHandle.handle(s.tags)}},{autoSync:!0})}async add(n){const r=await this.synchronizer.getData();r.findIndex(i=>this.tagsHandle.tagIsEq(i,n))===-1&&(r.push(n),this.synchronizer.toChanged(),this.synchronizer.save())}async delete(n){let r=await this.synchronizer.getData(),i=r.findIndex(o=>this.tagsHandle.tagIsEq(o,n));i!==-1&&(r.splice(i,1),this.synchronizer.toChanged(),this.synchronizer.save())}has(n){return this.getList().findIndex(r=>this.tagsHandle.tagIsEq(r,n))!==-1}getList(){return this.synchronizer.getDataSync()}}const{a:Mr,e:zr,emoji:ob,i:SU,p:sb,r:ab,relay:cl,t:lo,version:$U,word:IU,follow:BU}=g7;var Rh=(e=>(e[e.FollowSets=3e4]="FollowSets",e[e.RelaySets=30002]="RelaySets",e[e.BookmarkSets=30003]="BookmarkSets",e[e.ArticlesCurationSets=30004]="ArticlesCurationSets",e[e.VideosCurationSets=30005]="VideosCurationSets",e[e.InterestSets=30015]="InterestSets",e[e.EmojiSets=30030]="EmojiSets",e[e.ReleaseArtifactSets=30063]="ReleaseArtifactSets",e))(Rh||{}),su=(e=>(e[e.MuteList=1e4]="MuteList",e[e.PinnedNotes=10001]="PinnedNotes",e[e.Bookmarks=10003]="Bookmarks",e[e.Communities=10004]="Communities",e[e.PublicChats=10005]="PublicChats",e[e.BlockedRelays=10006]="BlockedRelays",e[e.SearchRelays=10007]="SearchRelays",e[e.Interests=10015]="Interests",e[e.Emojis=10030]="Emojis",e[e.Follow=3]="Follow",e))(su||{});const kU={1e4:[sb,lo,IU,zr],10001:[zr],10003:[zr,Mr,lo,ab],10004:[Mr],10005:[zr],10006:[cl],10007:[cl],10015:[lo,Mr],10030:[ob,Mr],3:[BU]},{FollowSets:OU,RelaySets:UU,BookmarkSets:_U,ArticlesCurationSets:CU,VideosCurationSets:RU,InterestSets:TU,EmojiSets:PU,ReleaseArtifactSets:NU}=Rh,HU={[OU]:[sb],[UU]:[cl],[_U]:[zr,Mr,lo,ab],[CU]:[Mr,zr],[RU]:[Mr],[TU]:[lo],[PU]:[ob],[NU]:[zr,SU,$U]},jU=t0("listSynchronizerManager",class{constructor(e){this.map=new Map,this.listEnum=su,this.getLine=Ki(()=>e.createChild())}getAndInitMap(e,n){let r=this.map.get(e);return r||(r=n(),this.map.set(e,r)),r}getInitStandardListSynchronizer(e){return this.getAndInitMap(e,()=>new Ch(this.getLine(),e,kU[e]))}getInitSetsSynchronizer(e){return this.getAndInitMap(e,()=>new _h(this.getLine(),e,HU[e]))}}),wC=Object.freeze(Object.defineProperty({__proto__:null,ListEnum:su,ListSynchronizerManager:jU,RelayConfiguratorSynchronizer:Bt,SetsEnum:Rh,defaultUrls:LU,getEventTagRelayUrl:AU},Symbol.toStringTag,{value:"Module"}));class FU{constructor(){this.reset()}toResolve(...[n]){this.resolve(n)}toReject(n){this.reject(n)}reset(){this.promise=new Promise((n,r)=>{this.resolve=n,this.reject=r})}}function MU(e,n,r){let i=0;for(const o of e)r=n(r,o,i,e),i++;return r}(()=>{try{if(window.WeakMap)return()=>new WeakMap}catch{}return()=>new Map})();function Th(e){const n=zU(e,"|",15,36);if(n===-1)throw new Error("CacheString:Expecting a '|'");const[r,i]=e.slice(0,n).split(","),o=e.slice(n+1),s=parseInt(r),a=parseInt(i),u=JSON.parse(o);return{updateTime:s,duration:a,value:u}}function zU(e,n,r,i){e.length-1<i&&(i=e.length-1);for(let o=r;o<=i;o++)if(e[o]===n)return o;return-1}class qU{constructor(n){this.LIST_KEY=n,this.init()}init(){const n=localStorage.getItem(this.LIST_KEY);if(!n){this.keyList=new Set;return}const r=JSON.parse(n);if(!Array.isArray(r)){this.keyList=new Set;return}this.keyList=new Set(r)}add(n){this.keyList.add(n),this.updateKeyList()}delete(n){this.keyList.delete(n),this.updateKeyList()}getKeys(){return this.keyList}updateKeyList(){const n=JSON.stringify(Array.from(this.keyList));localStorage.setItem(this.LIST_KEY,n)}clear(){localStorage.removeItem(this.LIST_KEY)}}const ub=new qU("__cache_key_list_");setTimeout(()=>{KU()});function KU(){const e=window.localStorage,n=ub.getKeys();for(const r of n)try{const i=e.getItem(r);if(!i)continue;const o=Th(i);if(!Ph(o))continue;XU(o)}catch{e.removeItem(r)}}window.clearCache=DU;function DU(){const e=window.localStorage,n=ub.getKeys();for(const r of n)try{const i=e.getItem(r);if(!i)continue;const o=Th(i);if(!Ph(o))continue;e.removeItem(r)}catch{}}window.clearCacheAll=VU;function VU(){const e=window.localStorage,n=e.length;for(let r=0;r<n;r++){const i=e.key(r);if(!i)continue;const o=e.getItem(i);if(o)try{const s=Th(o);if(!Ph(s))continue;e.removeItem(i)}catch{continue}}}var Ei=typeof Reflect=="object"?Reflect:null,Op=Ei&&typeof Ei.apply=="function"?Ei.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},ps;Ei&&typeof Ei.ownKeys=="function"?ps=Ei.ownKeys:Object.getOwnPropertySymbols?ps=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ps=function(e){return Object.getOwnPropertyNames(e)};function WU(e){console&&console.warn&&console.warn(e)}var cb=Number.isNaN||function(e){return e!==e};function se(){se.init.call(this)}se.EventEmitter=se;se.prototype._events=void 0;se.prototype._eventsCount=0;se.prototype._maxListeners=void 0;var Up=10;function au(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(se,"defaultMaxListeners",{enumerable:!0,get:function(){return Up},set:function(e){if(typeof e!="number"||e<0||cb(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Up=e}});se.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};se.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||cb(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function lb(e){return e._maxListeners===void 0?se.defaultMaxListeners:e._maxListeners}se.prototype.getMaxListeners=function(){return lb(this)};se.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")Op(u,this,n);else for(var c=u.length,l=gb(u,c),r=0;r<c;++r)Op(l[r],this,n);return!0};function fb(e,n,r,i){var o,s,a;if(au(r),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",n,r.listener?r.listener:r),s=e._events),a=s[n]),a===void 0)a=s[n]=r,++e._eventsCount;else if(typeof a=="function"?a=s[n]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),o=lb(e),o>0&&a.length>o&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=n,u.count=a.length,WU(u)}return e}se.prototype.addListener=function(e,n){return fb(this,e,n,!1)};se.prototype.on=se.prototype.addListener;se.prototype.prependListener=function(e,n){return fb(this,e,n,!0)};function GU(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function hb(e,n,r){var i={fired:!1,wrapFn:void 0,target:e,type:n,listener:r},o=GU.bind(i);return o.listener=r,i.wrapFn=o,o}se.prototype.once=function(e,n){return au(n),this.on(e,hb(this,e,n)),this};se.prototype.prependOnceListener=function(e,n){return au(n),this.prependListener(e,hb(this,e,n)),this};se.prototype.removeListener=function(e,n){var r,i,o,s,a;if(au(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){a=r[s].listener,o=s;break}if(o<0)return this;o===0?r.shift():ZU(r,o),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};se.prototype.off=se.prototype.removeListener;se.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function db(e,n,r){var i=e._events;if(i===void 0)return[];var o=i[n];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?JU(o):gb(o,o.length)}se.prototype.listeners=function(e){return db(this,e,!0)};se.prototype.rawListeners=function(e){return db(this,e,!1)};se.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):pb.call(e,n)};se.prototype.listenerCount=pb;function pb(e){var n=this._events;if(n!==void 0){var r=n[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}se.prototype.eventNames=function(){return this._eventsCount>0?ps(this._events):[]};function gb(e,n){for(var r=new Array(n),i=0;i<n;++i)r[i]=e[i];return r}function ZU(e,n){for(;n+1<e.length;n++)e[n]=e[n+1];e.pop()}function JU(e){for(var n=new Array(e.length),r=0;r<n.length;++r)n[r]=e[r].listener||e[r];return n}const YU=new se;YU.setMaxListeners(1e3);const oc=Symbol("noCache");function XU(e){if(!e)throw oc;const n=Date.now(),r=e.updateTime,i=e.duration;try{if(!(n-r<i))throw oc}catch{throw oc}}function Ph(e){return!(!e||typeof e!="object"||typeof e.updateTime!="number"||typeof e.duration!="number")}const QU=e=>e.charAt(0).toUpperCase()+e.slice(1);let Ys=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/core/src/LineEmitter.ts");console.log("logger",Ys);Ys.debug("xx");class e_{constructor(n){this.events={},this.parseState=!1,this.parsePromise=new FU,this.name="",n&&n.name&&(this.name=n==null?void 0:n.name)}getEventAndInit(n){return this.events[n]||(this.events[n]=new Set)}setEventAndInit(n,r){return this.events[n]=r}on(n,r,i){Object.assign(r,i),i!=null&&i.unShift?this.setEventAndInit(n,new Set([r,...this.getEventAndInit(n)])):this.getEventAndInit(n).add(r)}once(n,r,i){this.on(n,Object.assign(r,{once:!0,...i}))}async emitResult(n,...r){return new Promise((i,o)=>{typeof n=="object"?this.emit(Object.assign(n,{onReturn:i}),...r):this.emit({type:n,onReturn:i},r)})}async emitResults(n,...r){return new Promise((i,o)=>{typeof n=="object"?this.emit(Object.assign(n,{onReturns:i}),...r):this.emit({type:n,onReturns:i},r)})}async emit(n,...r){if(typeof n=="object"){if(n.type&&await this._emit(n.type,n,r),n.types)for(const i of n.types)await this._emit(i,n,r)}else await this._emit(n,{},r)}async _emit(n,r,i){if(new Set(["create-child"]).has(n)||r.noPause){this.__emit(n,r,i);return}await this.awaitToRun(),this.__emit(n,r,i)}__emit(n,r,i){let{onReturn:o,onReturns:s,once:a,onReturnOnce:u}=r,c=this.events[n];if(!c)return;let l=!1;const f={stop(){l=!0}};let h=[];for(const p of c){let b=p(...i);if(h.push(b),p.once&&this.removeListen(n,p),o==null||o(b,f),u&&(o=void 0),l)break}s==null||s(h),a&&this.removeAllListen(n)}parse(){this.parseState=!0,this.parsePromise.reset(),Ys.debug(`emitter${this.name?`:${this.name}`:""}:`,"")}continue(){this.parseState=!1,this.parsePromise.resolve(),Ys.debug(`emitter${this.name?`:${this.name}`:""}:`,"")}awaitToRun(){if(this.parseState)return this.parsePromise.promise}async emitOnce(n,...r){await this.emit({type:n,once:!0},...r),this.removeAllListen(n)}removeListen(n,r){let i=this.events[n];i==null||i.delete(r)}removeAllListen(n){delete this.events[n]}clear(){this.events={}}}class t_{constructor(n,r){this.parent=null,this.mod=n,this.emitter=new e_(r),this.feat=this,this.line=this,setTimeout(()=>{this.add(Nh).on("pause",i=>{this.emitter.parse(),i.on("continue",()=>{this.emitter.continue()})})})}modify(n){return n(this.mod).out()}getName(){return this.mod.getName()}on(n,r,i){return this.emitter.on(n,r,i),this}once(n,r,i){return this.emitter.once(n,r,i),this}emit(n,...r){return this.emitter.emit(n,...r),this.emitter.emit("emit",n,...r),this}createChild(n){return this.mod.createChild(n).out()}extendsEmit(n,r){if(!r)return n.on("emit",(i,...o)=>{this.emit(i,...o)}),this;for(const i of r)n.on(i,(...o)=>{this.emit(i,...o)});return this}removeListener(n,r){this.emitter.removeListen(n,r)}removeAllListener(n){this.emitter.removeAllListen(n)}add(...n){return this.mod.add(...n).out()}}let n_=0;class Xs{constructor(n){if(this.id=n_++,this.parent=null,this.staffNames=new Set,this.staffs=new Set,n!=null&&n.name&&this.setName(n.name),this.core=new t_(this,n),n!=null&&n.parent){let i=n.parent;console.log(this.id,i.id),this.parent=i,this.line.parent=i.line,Object.setPrototypeOf(this,i),Object.setPrototypeOf(this.core,i.core)}let r=n!=null&&n.staffs?MU(n.staffs,(i,o)=>i.add(o),this):this;return this.add(yb,Nh),this.add(u_).line.emit({type:"create",noPause:!0},this.out()),r}get line(){return this.core}get mod(){return this}setName(n){this.name=n}getName(){return this.name}createChild(n){let r=new Xs(Object.assign({parent:this},n));return this.emitHook("create-child",this.out(),r.out()),r}emitHook(n,...r){this.line.emit({type:n,noPause:!0},...r)}defineEmit(n,r){return this}defineFeat(n,r){return this.core.feat[n]=r,this}assignOwnFeat(n){return this.assignFeat(n()),this.core.on("create-child",(r,i)=>{i.mod.assignOwnFeat(n)}),this}defineFn(n,r){return this.assignFeat({name:r}),this}assignFn(n){return this.assignFeat(n)}assignFeat(n){return Object.assign(this.core,n),this}provide(n,r){let i=this.line,o=QU(n);return i[`provide${o}`]=function(){return this[n]=r.call(this),this},i[`inject${o}`]=function(){if(this[n]===void 0)throw new Error(`EventLine:inject Not find ${n}`);return this[n]},this}assignChain(n){return this.assignFeat(Object.fromEntries(Object.entries(n).map(([r,i])=>[r,function(...o){return i.bind(this)(...o),this}]))),this}onlyFeat(n){return Object.entries(n).forEach(([r,i])=>{this.core[r]!==void 0&&(this.core[r]=i)}),Object.assign(this.core,n),this}hasStaff(n){let r=n.id??n.name;return!!(this.staffNames.has(r)||this.staffs.has(n)||this.parent&&this.parent.hasStaff(n))}add(...n){return n.reduce((r,i)=>r._add(i),this)}_add(n){if(!n)return this;if(String(n).startsWith("class"))return this.addClassStaff(n);if(typeof n=="function")return this.addFunctionStaff(n);throw new Error("EventLine.add:not is a staff")}addFunctionStaff(n){if(this.hasStaff(n))return this;let r=n.id;if(r&&this.staffNames.add(r),this.staffs.add(n),n.dependents){const i=n.dependents();for(const o of i)this.add(o)}return n(this)}addClassStaff(n){let r=new n(this.out());return this.assignFeat({[r.name]:r})}reuse(){return this.core}createAsATemplate(){return this.createAsATemplateMod().out()}createAsATemplateMod(){return new Xs({staffs:this.staffs})}out(){return this.reuse()}inLine(n){return n(this.out()),this}}let r_=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/core/src/staff.ts");function i_(e,n,...r){const i=typeof e=="string"?{name:e}:e;return xr(i.id??i.name,o=>o.assignFeat({[i.name]:new n(o.out(),...r)}))}function mC(e,n){const r=typeof e=="string"?{name:e}:e;return n.Staff=i_(r,n,...r.rest??[]),n}function xr(...e){if(r_.debug("create-staff",e),e.length===1){if(!e[0])throw new Error("staff cannot be undefined");return Yo(e[0]),ri(()=>[],void 0,e[0])}else{if(sc(e[0]))return Yo(e[1]),ri(()=>[],e[0],e[1]);if(Array.isArray(e[0])||typeof e[0]=="function"&&!e[0].__staff__)return sc(e[1])?(Yo(e[2]),ri(e[0],e[1],e[2])):(Yo(e[1]),ri(e[0],void 0,e[1]));if(o_(e[e.length-1]))return sc(e[e.length-2])?ri(e.slice(0,e.length-2),e[e.length-2],e[e.length-1]):ri(e.slice(0,e.length-1),void 0,e[e.length-1])}throw new Error("createStaff INVALID PARAMETER")}function sc(e){return typeof e=="string"}function o_(e){return!(!e||!(typeof e=="function"&&!e.__staff__))}function Yo(e){if(e){if(!(typeof e=="function"&&!e.__staff__))throw new Error("Not is a StaffStructure")}else throw new Error("StaffStructure cannot be undefined")}function ri(e,n,r){if(Array.isArray(e)){let i=e;e=()=>i}return Object.assign(r,{dependents:e,id:n,__staff__:!0}),r}function bC(e){return xr(e,n=>{throw new Error(`Not Inject '${e}' Staff`)})}const s_=xr(({mod:e,line:n})=>e.defineEmit()),yb=xr(()=>[s_],e=>e.assignFeat({onCreateChildDep(n){n(this),this.on("create-child",(r,i)=>{i.onCreateChildDep(n)})}})),a_=xr(({mod:e,line:n})=>e.defineEmit()),u_=xr(()=>[a_],({mod:e,line:n})=>e.assignFeat({onCreate(r){r(this),this.on("create",i=>{i.onCreate(r)})}})),Nh=xr(()=>[yb],({mod:e,line:n})=>e.defineEmit().defineEmit().assignOwnFeat(()=>({parseState:!0})).assignFeat({emitParse(r,i){console.log("emitParse",(r??this).mod.id),this.emit({type:"pause",noPause:!0},r??this,i)},parse(r){this.parseState=!0,this.emitParse(void 0,r)},emitContinue(r){this.emit({type:"continue",noPause:!0},r)},continue(r){this.parseState=!1,this.emitContinue(r)},async awaitToRun(){var r;if((r=this.parent)!=null&&r.awaitToRun&&await this.parent.awaitToRun(),this.parseState)return new Promise((i,o)=>{this.on("continue",()=>i(),{once:!0})})}}).inLine(r=>r.onCreateChildDep(i=>{var o;(o=i.parent)==null||o.on("pause",(...s)=>{i.emitParse(...s)})}))),c_=xr("reactive-staff",({mod:e,line:n})=>e.assignFeat({reactive(r){return Object.assign(r,{__isReactive:!0}),Object.defineProperty(r,"__isReactive",{value:!0,enumerable:!1}),Ib(r)},ref(r){return le(r)}}));function wb(e,n,r){let i=typeof e=="string"?{name:e}:e,o=i.name;const s=Symbol.for(o);return[n?(...a)=>{const u=n(...a);return gs(s,u),u}:a=>gs(s,a),r?()=>$r(s,r,!0):i!=null&&i.noWarn?()=>$r(s,()=>null,!0):()=>$r(s),r?()=>$r(s,r,!0):()=>$r(s,()=>{throw new Error(`${o??"inject"}`)},!0)]}function vC(e){const n=le(0),r=nn(()=>{const i=Math.abs(n.value);return i>=qr(e)?0:(qr(e)-i)/qr(e)});return{shifting:n,moveScale:r,add(i){n.value+=i*r.value},remake(){n.value=0}}}const mb=Symbol("scrollbarInstKey"),_p=new Bb,EC=e=>{const n={scrollbarInst:le(null),onScroll(r){_p.on("scroll",r)},removeScrollListener(r){_p.removeListener("scroll",r)},containerRef:e};return gs(mb,n),n},l_=()=>$r(mb,()=>{},!0);function xC(e=500,n){const r=le((n==null?void 0:n.active)??!1),i=le(!1);let o=null;Kt(r,()=>{i.value=!0,clearTimeout(o),o=setTimeout(()=>{i.value=!1},qr(e))});const s=nn(()=>r.value||i.value),a=le(!1);Cp(()=>{if(!r.value){a.value=!1;return}setTimeout(()=>{a.value=!0},0)});function u(){r.value=!0}function c(){r.value=!1}return{show:u,hidden:c,active:r,transitionActive:a,safeActive:s,transitioning:i,duration:le(e)}}function LC(e){const n=le(void 0);return e().then(r=>{n.value=r}),n}function AC(e,n){const[r,i]=f_(void 0,n);return[nn(()=>i.value?e():null),r,i]}function f_(e,n){const r=le(n==null?void 0:n.target),i=le(!0),o=p_(r,{delay:e,...n,isListener:i});let s=le(o.value);const a=Kt(o,()=>{o.value&&(s.value=!0,a(),i.value=!1)},{immediate:!0});return[r,s]}const[h_,d_]=y_(e=>({isIntoScreen:le(!1),...e}));function bb(e){const n=le();ll(r),kb(i);try{Ob(r),Ub(i)}catch{}function r(){n.value=!0}function i(){n.value=!1}return n}function p_(e,n){const r=Eb(n,{isListener:!0,componentTreeOptimization:!0,preloadDistance:30}),i=d_(),{isIntoScreen:o,active:s}=i??{},a=bb(),{isIntoScreen:u,active:c,isAddListener:l}=h_({opt:n,isAddListener:le(!1),parent:i,active:nn(()=>(n==null?void 0:n.active)===void 0?s===void 0?a.value:s.value:s===void 0?(n.active.value??!0)&&a.value:(n.active.value??!0)&&s.value)}),f=function(){var d;if(!c.value||!e.value)return;if(!qr(r.isListener)){u.value=!0;return}const y=(d=e.value)==null?void 0:d.getBoundingClientRect();y.y<=window.innerHeight+r.preloadDistance&&y.bottom>=0-r.preloadDistance?u.value=!0:u.value=!1},h=xb(f,(n==null?void 0:n.delay)??500);ll(f),h(),l_(),Cp(()=>{if(!c.value){b();return}if(!e.value){b();return}if(!(n!=null&&n.componentTreeOptimization&&((o==null?void 0:o.value)??!0))){b();return}if(!qr(r.isListener)){u.value=!0,b();return}h(),p()});function p(){l.value=!0,window.addEventListener("mousewheel",h,{passive:!0}),window.addEventListener("resize",h,{passive:!0}),window.addEventListener("touchend",h,{passive:!0})}function b(){l.value=!1,window.removeEventListener("mousewheel",h),window.removeEventListener("resize",h),window.removeEventListener("touchend",h)}return u}function SC(e,n,r){const i=g_(),o=jo();return async function(a,u){var f;a.kind=e;const c=o.createChild().add(To,iu,Bt.Staff,Ji);let l=await c.createEvent(a);c.addPublish(l,{onOK:i}),c.initedAddWrite(),u&&c.addUrls(u),r!=null&&r.urls&&c.addUrls(qr(r.urls)),c.autoAdd10002(l.pubkey);for(const h of l.tags)if(h[0]==="p"&&h[1])try{c.autoAdd10002(h[1])}catch(p){logger.error(!1,p)}else h[0]==="e"&&h[1]&&h[2]&&c.addUrl(h[2]);l&&((f=n==null?void 0:n.value)==null||f.call(n,l))}}function $C(e,n){const r=Pb();if(!r)throw new Error("setup");const i=_b(e,n),o=le(i.value);return Kt(i,()=>{o.value=i.value}),nn({get(){return o.value},set(s){o.value=s,r.emit(`update:${n}`,s)}})}function IC(e=.5625){const n=le(null);ll(()=>{r()}),Cb(()=>{r()}),ys(window,"resize",()=>{r()}),Kt(n,()=>{r()});function r(){n.value&&(n.value.style.height=n.value.scrollWidth*e+"px")}return[n]}function g_(){const e=Rb();return function(r,i){i.ok?e.success(t("published_to",i)):e.error(t("not_published_to",i))}}function BC(e=1060,n=2650){const r=le(window.innerWidth);return ys("resize",()=>{r.value=window.innerWidth}),function(o,s,a={}){return nn(()=>{const{floor:u=!0}=a;if(r.value>n)return s;if(r.value<e)return o;{const c=(r.value-e)/(n-e),l=(s-o)*c+o;return u?Math.floor(l):l}})}}function kC(){return Lb("useNowSecondTimestamp",()=>{const e=le(Hh());let n;function r(){clearInterval(n),setTimeout(()=>{n=setInterval(()=>{e.value=Hh()},1e3)},Date.now()%1e3)}return r(),setInterval(r,1e3*60*5),e},{useLocalStorage:!1,duration:999999999999999})}function y_(e,n){const r=Symbol();return[(...i)=>{const o=e(...i);return gs(r,o),o},()=>$r(r,n??(()=>null),!0)]}function OC(e,n,r){const i={...Ab,...r??{}},o=le(Sb(e,i)??n);return nn({get(){return o.value},set(s){o.value=s,$b(e,s,i)}})}function UC(e,n){ys(e,"mousedown",i,{passive:!0}),ys(e,"touchstart",i,{passive:!0});const r=le(!1);function i(){s(),r.value=!0}let o;async function s(){const c=e.value;c&&(c.addEventListener("click",u,{once:!0}),c.addEventListener("mousemove",a,{once:!0,passive:!0}),c.addEventListener("touchmove",a,{once:!0,passive:!0}),c.addEventListener("touchcancel",a,{once:!0,passive:!0}),clearTimeout(o),o=setTimeout(()=>{a()},500))}function a(){r.value=!1}function u(c){r.value&&(c.stopPropagation(),r.value=!1,n())}return{isPress:r}}function _C(e,n){var l;const r=le(),i=le(!1);async function o(){r.value=await e(u)}const s=le(new Set);let a;Kt(s,()=>{a==null||a(),a=Kt(s.value,()=>{o()})}),Kt(s.value,()=>{o()});const u=((l=n==null?void 0:n.sources)==null?void 0:l.map(f=>Tb(f)?()=>(Kt(f,()=>{i.value=!i.value}),s.value.add(f),f.value):()=>{s.value.add(f),f()}))??[];return nn(()=>(o(),r.value??(n==null?void 0:n.default)))}function CC(e,n,r){const i=le(r==null?void 0:r.default);return Kt(e,async o=>{i.value=await n(o)},Object.assign({immediate:!0},r)),i}const[w_,m_,RC]=wb("active",e=>e,()=>null);function TC(e){const n=vb(e);return w_(n),n}function vb(e){let n=m_();const r=bb();return nn(()=>!!(((n==null?void 0:n.value)??!0)&&((e==null?void 0:e.value)??!0)&&(r.value??!0)))}const[b_,v_,E_]=wb({name:"event-line",noWarn:!0},(...e)=>new Xs().add(c_,nu.Staff,Bt.Staff,Ja,Nh,Ho));function PC(e){let n=v_(),r;n?r=n.createChild({name:e}):r=b_();let i=r.out(),o=vb();return Kt(o,()=>{logger.debug(`${e}:active:`,o.value),o.value?i.continue():i.parse()},{immediate:!0}),r}const jo=function(...e){return E_().out().add(...e)};function x_(){let e=jo(Zi);return fl(()=>e.getPubkeyOrNull())}function NC(e){const n=x_();return nn(()=>e.value&&n.value&&e.value.toHex()===n.value.toHex())}const HC=(...e)=>jo(...e).getConfig();function jC(){let e=jo(Zi);return fl(async()=>await e.isLogin())}function FC(){let e=jo(Qm);return fl(async()=>await e.autoGetGlobalUrls())}export{ru as $,IC as A,NC as B,p_ as C,xr as D,To as E,uC as F,Bs as G,yb as H,eb as I,eC as J,bC as K,D_ as L,J_ as M,u_ as N,Uh as O,mC as P,Bt as Q,A4 as R,L4 as S,sC as T,Z_ as U,i_ as V,W_ as W,fC as X,Q_ as Y,B4 as Z,iC as _,OC as a,rC as a0,S4 as a1,tC as a2,G_ as a3,HC as a4,dU as a5,fU as a6,hU as a7,bb as a8,Sy as a9,hC as aa,V_ as ab,f_ as ac,$h as ad,$C as ae,iu as af,xC as ag,ou as ah,AC as ai,wb as aj,vC as ak,EC as al,lC as am,kC as an,TC as ao,PC as ap,X_ as aq,b7 as ar,nC as as,UC as at,yC as au,_C as b,Zi as c,Iy as d,vh as e,cC as f,y_ as g,BC as h,pC as i,aC as j,LC as k,jC as l,Ja as m,su as n,SC as o,wC as p,FC as q,x_ as r,g_ as s,kt as t,jo as u,CC as v,l_ as w,Y_ as x,dC as y,ba as z};
