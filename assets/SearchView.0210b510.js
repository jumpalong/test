import{H as $,q as A,p as L}from"./use.1e6bcf04.js";import{p as T,m as I,P as O}from"./Papaw.58818fc9.js";import{b as U}from"./RelayConnectList.vue_vue_type_script_setup_true_lang.fc5e4822.js";import{E as F}from"./Ellipsis.d8aa1f93.js";import{f as V,aL as H,k,o as r,z as f,au as b,m as E,w as l,v as M,x as R,n as d,y as h,N as j,af as q,l as n,A as g,F as C,E as z,D as G}from"./index.1b90d9b0.js";import{a as x,T as D}from"./nostr.754d0882.js";import{t as Y,e as J}from"./nostr.5da3da54.js";import{_ as K,a as Q}from"./ListItem.9baa61b5.js";import{_ as W}from"./Card.0e05d980.js";import{_ as X}from"./Space.233e452c.js";import"./Staff.e039c64f.js";import"./RegExpUtils.5e225811.js";import"./utils.6eaabb91.js";import"./is-browser.21659b45.js";import"./Scrollbar.d017889b.js";import"./use-rtl.e3f5641a.js";import"./cssr.ebdd28c2.js";import"./use-css-vars-class.2322281d.js";import"./fade-in-scale-up.cssr.769ecc19.js";import"./use-locale.d88a40dd.js";import"./Loading.68c8fb32.js";import"./use-style.d41c90c3.js";import"./Follower.46005694.js";import"./Icon.8b94fe05.js";import"./replaceable.3760d7d0.js";import"./Button.426eb201.js";import"./create-key.7b548031.js";import"./Tooltip.e97f4bd5.js";import"./Popover.52f6051a.js";import"./format-length.3612bbc8.js";import"./nostr.1ed837f5.js";import"./createEventSourceTracers.70279edb.js";import"./Icon.d35ca04d.js";import"./NaddrLink.vue_vue_type_script_setup_true_lang.ac9bb804.js";import"./error.32f9621f.js";import"./login.8c6c9b27.js";import"./Markdown.65b67b2d.js";import"./Empty.36cca092.js";import"./UserLink.vue_vue_type_script_setup_true_lang.f1185f1f.js";import"./RelayAddButton.vue_vue_type_script_setup_true_lang.309f50bc.js";import"./MavonEditor.0c88b495.js";import"./use-theme-vars.726be0e1.js";import"./Tag.6048a194.js";import"./Close.89e6ef62.js";import"./Close.dda15693.js";import"./DrawerProvide.vue_vue_type_script_setup_true_lang.c46f8d3c.js";import"./DrawerContent.f946858a.js";import"./index.71604e6f.js";import"./RelayInfoView.f4d9e053.js";import"./index.62f1e1b0.js";import"./Scrollbar.2eeae0bc.js";import"./LoadProgress.6869a86c.js";import"./Scrollbar.b84961bc.js";import"./fade-in-height-expand.cssr.b76b5d75.js";import"./naiveUi.c6ae432d.js";import"./composables.d23d34d7.js";import"./Input.6cd78f60.js";import"./nostrApiUse.7176aa1b.js";import"./ContentBlacklistView.6132c1d6.js";import"./Dropdown.03a74dd4.js";import"./render.71a5584a.js";import"./create.2deeaf6a.js";import"./profile-2-400x400.3309f571.js";import"./keysOf.8a025f7e.js";import"./get-slot.4ceacf82.js";const Z={class:"font-bold"},ee={key:0,class:"w-full"},te=V({__name:"SearchChannelItem",props:{event:null},setup(S){const w=S,{event:u}=H(w),v=k(()=>u.value&&T(u.value)),t=k(()=>{if(u.value.kind===40)return u.value.id;if(u.value.kind===41){const p=$(u.value.tags);return p?p[1]:void 0}});return(p,c)=>(r(),f("div",{class:"flex flex-col",onClick:c[0]||(c[0]=()=>d(t)&&p.$router.push({name:"channel-message",params:{value:d(t)}}))},[b("div",Z,[E(F,null,{default:l(()=>{var a;return[M(R((a=d(v).name)!=null?a:d(t)&&d(t).slice(0,10)),1)]}),_:1})]),d(v).about?(r(),f("div",ee,[E(F,{class:"w-full"},{default:l(()=>[b("small",null,R(d(v).about),1)]),_:1})])):h("",!0)]))}}),ae=b("div",{class:"flex items-center justify-center"},[b("div",{id:"search-input"})],-1),_t=V({__name:"SearchView",setup(S){const w=A(D.EventApi),u=A(D.UserApi);z();const v=G(),t=k(()=>v.params.value),p=k(()=>t.value&&Y(t.value)),c=k(()=>t.value&&J(t.value)),a=j({}),y=x.createChild().addStaff(L());function N(){return y.createChild().addStaff(L())}q(t,()=>{if(a.value={},!(!t.value||t.value.length===0))if(p.value){const e=p.value.relays,o=u.getUserMetadataLineByPubkey(p.value.pubkey,{urls:e&&new Set(e)});y.addChild(o),a.value[0]=o}else if(c.value){const e=c.value,o=c.value.relays,s=w.getEventLineById(e.id,o&&{urls:new Set(o)});y.addChild(s),s.feat.onHasEventOnce(m=>{B(m,a.value)})}else{const e=x.createChild().addStaff(L()).addStaff({push(_){B(_,a.value)}});y.addChild(e);const o=[{search:t.value},{["#r"]:[t.value]}],s=e.createChild().addFilters(o).addExtends(x);e.addExtends(s);const m=e.createChild().addFilter({search:t.value,limit:50}).addReadUrl();e.addExtends(m)}},{immediate:!0});function B(e,o){var s,m;switch(e.kind){case 0:case 1:case 2:case 3:((s=o[e.kind])!=null?s:o[e.kind]=N()).pushEvent(e);break;case 40:case 41:((m=o.channel)!=null?m:o.channel=N()).pushEvent(e);break}}return(e,o)=>{const s=Q,m=K,_=W,P=X;return r(),n(P,{vertical:""},{default:l(()=>[ae,a.value.channel?(r(),n(_,{key:0,class:"w-full",title:"\u7FA4\u804A"},{default:l(()=>[E(m,{class:"w-full",hoverable:"",clickable:""},{default:l(()=>[(r(!0),f(C,null,g(a.value.channel.getList(),i=>(r(),n(s,{key:i.id},{default:l(()=>[E(te,{event:i},null,8,["event"])]),_:2},1024))),128))]),_:1})]),_:1})):h("",!0),a.value[0]?(r(),n(_,{key:1,title:"\u7528\u6237"},{default:l(()=>[(r(!0),f(C,null,g(a.value[0].getList(),i=>(r(),n(I,{key:i.id,pubkey:i.pubkey,created_at:i.created_at},null,8,["pubkey","created_at"]))),128))]),_:1})):h("",!0),a.value[2]?(r(),n(_,{key:2,title:"relay"},{default:l(()=>[(r(!0),f(C,null,g(a.value[2].getList(),i=>(r(),n(U,{key:i.id,url:i.content},null,8,["url"]))),128))]),_:1})):h("",!0),a.value[1]?(r(),n(_,{key:3,title:"\u6D88\u606F"},{default:l(()=>[(r(!0),f(C,null,g(a.value[1].getList(),i=>(r(),n(O,{key:i.id,event:i},null,8,["event"]))),128))]),_:1})):h("",!0)]),_:1})}}});export{_t as default};
