import{f as X,k as b,N as m,o as f,l as x,w as e,m as t,n as a,C as r,an as ie,au as S,v as d,x as u,ap as G,z as D,A as K,F as Q,y as de,aF as pe,aD as H,dT as ce}from"./index.8f62a545.js";import{r as O,a as F}from"./nostr.c03670ae.js";import{_ as I,a as me}from"./RelayConnectList.vue_vue_type_script_setup_true_lang.2443e1f7.js";import{_ as _e,a as fe}from"./DrawerProvide.vue_vue_type_script_setup_true_lang.da186b5d.js";import{S as Y}from"./Scrollbar.c7e90ffe.js";import{_ as ve}from"./Input.90533fe2.js";import{_ as Z}from"./Thing.cada672f.js";import{_ as J}from"./RelayConnectListCard.vue_vue_type_script_setup_true_lang.46165a23.js";import{_ as he}from"./UserLink.vue_vue_type_script_setup_true_lang.0cad1bf3.js";import{f as ye,p as ge}from"./use.b23b6c29.js";import{c as ke,g as be}from"./createEventSourceTracers.1da380d1.js";import{a as we}from"./nostrApiUse.43d55506.js";import{u as Ce}from"./use-theme-vars.c704e62a.js";import{_ as xe,a as Se}from"./Checkbox.fc71365b.js";import{_ as Le}from"./Card.6e48fdd4.js";import{_ as Ue}from"./Button.22997a19.js";import{_ as $e}from"./Space.32f062de.js";import{_ as Re}from"./Empty.81d9c633.js";import"./Icon.904bc99e.js";import"./use-css-vars-class.1ada0b07.js";import"./format-length.3612bbc8.js";import"./RelayInfoView.0394eae9.js";import"./Scrollbar.8d5a1903.js";import"./use-rtl.6d35c504.js";import"./cssr.21c6f8e2.js";import"./index.62f1e1b0.js";import"./create-key.7b548031.js";import"./Loading.0b953150.js";import"./use-style.d8216a24.js";import"./Ellipsis.021c946e.js";import"./Tooltip.d86a0762.js";import"./Popover.6590eae2.js";import"./Follower.7ba57362.js";import"./is-browser.f4df612e.js";import"./ListItem.5a517004.js";import"./DrawerContent.bb261013.js";import"./index.71604e6f.js";import"./Close.dba1bcea.js";import"./Icon.1c3d6ebf.js";import"./Close.7d56270d.js";import"./replaceable.815b8f5c.js";import"./LoadProgress.a8e5dee8.js";import"./Scrollbar.75edf2b0.js";import"./use-locale.cbb1f83b.js";import"./nostr.0043d5e6.js";import"./nostr.ad89cf30.js";import"./Staff.e039c64f.js";import"./error.469adc75.js";import"./login.0b8718d8.js";import"./composables.10bdf172.js";import"./keysOf.8a025f7e.js";import"./get-slot.4ceacf82.js";const Pe=X({__name:"AddRelay",props:{show:{type:Boolean},disabledList:null},emits:["add-relay","update:show"],setup(h,{emit:v}){const w=b(()=>O.getOtherList()),_=m("");return(L,p)=>{const y=ve,U=Z;return f(),x(_e,{show:h.show,"onUpdate:show":p[2]||(p[2]=c=>v("update:show",c)),closable:"",height:"100%",title:a(r)("add_relay")},{default:e(()=>[t(Y,null,{default:e(()=>[t(U,{class:"my-2"},{header:e(()=>[t(y,{value:_.value,"onUpdate:value":p[0]||(p[0]=c=>_.value=c),placeholder:"eg: wss://relay.com",size:"small"},null,8,["value"])]),"header-extra":e(()=>[t(I,{onClick:p[1]||(p[1]=()=>v("add-relay",_.value)),disabled:h.disabledList&&h.disabledList.has(_.value)},null,8,["disabled"])]),_:1}),t(me,{urls:a(w),loadable:""},{right:e(({url:c})=>[t(I,{onClick:()=>v("add-relay",c),disabled:h.disabledList&&h.disabledList.has(c)},null,8,["onClick","disabled"])]),_:1},8,["urls"])]),_:1})]),_:1},8,["show","title"])}}}),Te=["id"],Ve=S("div",{class:"grid grid-cols-2"},null,-1),Tt=X({__name:"MoveHouseView",setup(h){const v=m(O.getReadList()),w=m(O.getWriteList()),_=m(!1),L=m(!1),p=[0,1,2,3,4,5,6,7,8,40,41,42,43,44,1984,9734,9735,1e4,10001,10002,3e4,30001,30008,30009,30023,30078],y=ye("checkedKinds",p),U=we(),c=b(()=>U.value?[U.value]:[]),$=b(()=>[...c.value]),C=m(new Map),M=b(()=>[{kinds:y.value,authors:$.value}]),R=b(()=>(C.value.clear(),F.createChild().addStaff(ge()).addFilters(M.value).addStaff({push(o){var n;const l=o.kind;C.value.set(l,((n=C.value.get(l))!=null?n:0)+1)}}).addExtends(F)));function ee(){_.value=!0,R.value.addExtends(F.createChild().addStaff(ke()).addFilters(M.value).addRelayUrls(v.value))}const W=ce(10),P=b(()=>{let o=0;for(const[l,n]of C.value)o+=n;return o}),T=m(new Map);function te(){return{ok:0,error:0,ignore:0}}function j(o,l){const n=l.get(o);if(!n){const i=te();return T.value.set(o,i),i}return n}function ae(){const o=pe(new Map);T.value=o,L.value=!0,F.createChild().addFilters(M.value).addStaff({push(l){W.unShift(()=>{var n;R.value.getRelayEmiter().on("ok",l.id,({ok:i,url:B})=>{const g=j(B,o);i?g.ok++:g.error++},{overtime:6e4});for(const i of w.value){if((n=be(l.id))!=null&&n.has(i)){j(i,o).ignore++;continue}W.unShift(()=>{R.value.publish(l,new Set().add(i),{autoPublishToTagR:!1})})}})}}).addExtends(R.value)}const N=Ce(),le=ie(),V=m(null);function oe(o){var l;(l=V.value)==null||l.add(o),le.success(r("successfully_added"))}const A=m(!1);function se(){V.value=v.value,A.value=!0}function ne(){V.value=w.value,A.value=!0}return(o,l)=>{const n=Se,i=Z,B=xe,g=Le,E=Ue,z=$e,re=Re;return f(),x(fe,null,{default:e(({id:ue})=>{var q;return[t(Pe,{show:A.value,"onUpdate:show":l[0]||(l[0]=s=>A.value=s),onAddRelay:oe,disabledList:(q=V.value)!=null?q:void 0},null,8,["show","disabledList"]),S("div",{id:ue},[t(Y,null,{default:e(()=>[t(z,{vertical:""},{default:e(()=>[t(g,{title:a(r)("kind")},{"header-extra":e(()=>[d(u(a(P)),1)]),default:e(()=>[t(B,{value:a(y),"onUpdate:value":[l[1]||(l[1]=s=>G(y)?y.value=s:null),l[2]||(l[2]=()=>{_.value=!1,L.value=!1})]},{default:e(()=>[(f(),D(Q,null,K(p,s=>t(i,null,{header:e(()=>[t(n,{value:s,label:a(r)(`kind${s}`)},null,8,["value","label"])]),"header-extra":e(()=>{var k;return[d(u((k=C.value.get(s))!=null?k:0),1)]}),_:2},1024)),64))]),_:1},8,["value"])]),_:1},8,["title"]),t(g,{title:a(r)("include_user")},{default:e(()=>[t(B,{value:a($),"onUpdate:value":l[3]||(l[3]=s=>G($)?$.value=s:null)},{default:e(()=>[Ve,(f(!0),D(Q,null,K(a(c),s=>(f(),x(n,{value:s},{default:e(()=>[t(he,{withPrefix:!1,value:s},null,8,["value"])]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},8,["title"]),t(J,{urls:v.value,title:a(r)("pull")},{action:e(()=>[t(z,null,{default:e(()=>[t(E,{disabled:_.value,type:"primary",onClick:ee},{default:e(()=>[d(u(a(r)("pull")),1)]),_:1},8,["disabled"]),t(E,{type:"primary",onClick:se},{default:e(()=>[d(u(a(r)("add_relay")),1)]),_:1})]),_:1})]),_:1},8,["urls","title"]),t(J,{urls:w.value,title:a(r)("push")},{action:e(()=>[t(z,null,{default:e(()=>[t(E,{disabled:L.value||a(P)===0,type:"primary",onClick:ae},{default:e(()=>[d(u(a(r)("push"))+"("+u(a(P))+") ",1)]),_:1},8,["disabled"]),t(E,{type:"primary",onClick:ne},{default:e(()=>[d(u(a(r)("add_relay")),1)]),_:1})]),_:1})]),_:1},8,["urls","title"]),t(g,{title:a(r)("result")},{"header-extra":e(()=>[d(u(a(P)),1)]),default:e(()=>[T.value.size===0?(f(),x(re,{key:0,description:a(r)("empty_text")},null,8,["description"])):de("",!0),(f(!0),D(Q,null,K(T.value,([s,k])=>(f(),x(i,null,{header:e(()=>[d(u(s),1)]),"header-extra":e(()=>[S("span",{style:H({color:a(N).successColor})},u(k.ok),5),d(" / "),S("span",{style:H({color:a(N).primaryColor})},u(k.ignore),5),d(" / "),S("span",{style:H({color:a(N).errorColor})},u(k.error),5)]),_:2},1024))),256))]),_:1},8,["title"])]),_:1})]),_:1})],8,Te)]}),_:1})}}});export{Tt as default};
