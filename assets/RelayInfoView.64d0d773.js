import{f as oe,j as x,m as bn,n as pe,N as Yn,dw as Qn,y as Jn,V as T,b0 as We,o as B,cM as Zn,as as $,ao as et,ex as nt,dx as un,dA as tt,bi as lt,c as _,b as te,a as P,bf as fn,d as ke,e as Se,i as Ye,u as at,g as ot,h as kn,eQ as rt,ck as it,aA as Ne,al as N,b5 as Ie,ae as xe,b6 as Qe,eR as hn,dt,v as z,p as ct,r as st,bh as ut,eS as gn,x as ft,cn as ht,aB as gt,aI as vt,A as W,L as ce,D as le,C as Q,B as Je,H as Ze,I as Oe,F as Ke,J as se,eT as yt,O as vn,M as bt,W as kt,R as mt,by as xt,Q as me,cX as pt,X as wt,aa as Rt,eU as Ct,dE as St}from"./index.ddbfeb2e.js";import{a as Nt}from"./Checkbox.23bc7b2e.js";import{V as Kt}from"./VirtualList.40d87c64.js";import{_ as _t}from"./Result.046bf07f.js";function mn(e){return typeof e=="string"?`s-${e}`:`n-${e}`}const Dt=oe({name:"Switcher",render(){return x("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},x("path",{d:"M12 8l10 8l-10 8z"}))}}),xn=bn("n-tree-select"),_e=bn("n-tree"),Ft=oe({name:"NTreeSwitcher",props:{clsPrefix:{type:String,required:!0},expanded:Boolean,selected:Boolean,hide:Boolean,loading:Boolean,onClick:Function},setup(e){const{renderSwitcherIconRef:l}=pe(_e,null);return()=>{const{clsPrefix:f}=e;return x("span",{"data-switcher":!0,class:[`${f}-tree-node-switcher`,e.expanded&&`${f}-tree-node-switcher--expanded`,e.hide&&`${f}-tree-node-switcher--hide`],onClick:e.onClick},x("div",{class:`${f}-tree-node-switcher__icon`},x(Yn,null,{default:()=>{if(e.loading)return x(Qn,{clsPrefix:f,key:"loading",radius:85,strokeWidth:20});const{value:h}=l;return h?h({expanded:e.expanded,selected:e.selected}):x(Jn,{clsPrefix:f,key:"switcher"},{default:()=>x(Dt,null)})}})))}}}),At=oe({name:"NTreeNodeCheckbox",props:{clsPrefix:{type:String,required:!0},right:Boolean,focusable:Boolean,disabled:Boolean,checked:Boolean,indeterminate:Boolean,onCheck:Function},setup(e){const l=pe(_e);function f(u){const{onCheck:i}=e;if(i)return i(u)}function h(u){e.indeterminate?f(!1):f(u)}return{handleUpdateValue:h,mergedTheme:l.mergedThemeRef}},render(){const{clsPrefix:e,mergedTheme:l,checked:f,indeterminate:h,disabled:u,focusable:i,handleUpdateValue:g}=this;return x("span",{class:[`${e}-tree-node-checkbox`,this.right&&`${e}-tree-node-checkbox--right`],"data-checkbox":!0},x(Nt,{focusable:i,disabled:u,theme:l.peers.Checkbox,themeOverrides:l.peerOverrides.Checkbox,checked:f,indeterminate:h,onUpdateChecked:g}))}}),Tt=oe({name:"TreeNodeContent",props:{clsPrefix:{type:String,required:!0},disabled:Boolean,checked:Boolean,selected:Boolean,onClick:Function,onDragstart:Function,tmNode:{type:Object,required:!0},nodeProps:Object},setup(e){const{renderLabelRef:l,renderPrefixRef:f,renderSuffixRef:h,labelFieldRef:u}=pe(_e),i=T(null);function g(v){const{onClick:m}=e;m&&m(v)}function p(v){g(v)}return{selfRef:i,renderLabel:l,renderPrefix:f,renderSuffix:h,labelField:u,handleClick:p}},render(){const{clsPrefix:e,labelField:l,nodeProps:f,checked:h=!1,selected:u=!1,renderLabel:i,renderPrefix:g,renderSuffix:p,handleClick:v,onDragstart:m,tmNode:{rawNode:y,rawNode:{prefix:w,suffix:b,[l]:a}}}=this;return x("span",Object.assign({},f,{ref:"selfRef",class:[`${e}-tree-node-content`,f==null?void 0:f.class],onClick:v,draggable:m===void 0?void 0:!0,onDragstart:m}),g||w?x("div",{class:`${e}-tree-node-content__prefix`},g?g({option:y,selected:u,checked:h}):We(w)):null,x("div",{class:`${e}-tree-node-content__text`},i?i({option:y,selected:u,checked:h}):We(a)),p||b?x("div",{class:`${e}-tree-node-content__suffix`},p?p({option:y,selected:u,checked:h}):We(b)):null)}});function yn({position:e,offsetLevel:l,indent:f,el:h}){const u={position:"absolute",boxSizing:"border-box",right:0};if(e==="inside")u.left=0,u.top=0,u.bottom=0,u.borderRadius="inherit",u.boxShadow="inset 0 0 0 2px var(--n-drop-mark-color)";else{const i=e==="before"?"top":"bottom";u[i]=0,u.left=`${h.offsetLeft+6-l*f}px`,u.height="2px",u.backgroundColor="var(--n-drop-mark-color)",u.transformOrigin=i,u.borderRadius="1px",u.transform=e==="before"?"translateY(-4px)":"translateY(4px)"}return x("div",{style:u})}function Lt({dropPosition:e,node:l}){return l.isLeaf===!1||l.children?!0:e!=="inside"}function Et(e){return B(()=>e.leafOnly?"child":e.checkStrategy)}function ae(e,l){return!!e.rawNode[l]}function pn(e,l,f,h){e==null||e.forEach(u=>{f(u),pn(u[l],l,f,h),h(u)})}function Pt(e,l,f,h,u){const i=new Set,g=new Set,p=[];return pn(e,h,v=>{if(p.push(v),u(l,v)){g.add(v[f]);for(let m=p.length-2;m>=0;--m)if(!i.has(p[m][f]))i.add(p[m][f]);else return}},()=>{p.pop()}),{expandedKeys:Array.from(i),highlightKeySet:g}}if(Zn&&Image){const e=new Image;e.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}function Bt(e,l,f,h,u){const i=new Set,g=new Set,p=new Set,v=[],m=[],y=[];function w(a){a.forEach(c=>{if(y.push(c),l(f,c)){i.add(c[h]),p.add(c[h]);for(let R=y.length-2;R>=0;--R){const F=y[R][h];if(!g.has(F))g.add(F),i.has(F)&&i.delete(F);else break}}const k=c[u];k&&w(k),y.pop()})}w(e);function b(a,c){a.forEach(k=>{const R=k[h],F=i.has(R),K=g.has(R);if(!F&&!K)return;const U=k[u];if(U)if(F)c.push(k);else{v.push(R);const L=Object.assign(Object.assign({},k),{[u]:[]});c.push(L),b(U,L[u])}else c.push(k)})}return b(e,m),{filteredTree:m,highlightKeySet:p,expandedKeys:v}}const It=oe({name:"TreeNode",props:{clsPrefix:{type:String,required:!0},tmNode:{type:Object,required:!0}},setup(e){const l=pe(_e),{droppingNodeParentRef:f,droppingMouseNodeRef:h,draggingNodeRef:u,droppingPositionRef:i,droppingOffsetLevelRef:g,nodePropsRef:p,indentRef:v,blockLineRef:m,checkboxPlacementRef:y,checkOnClickRef:w,disabledFieldRef:b}=l,a=$(()=>!!e.tmNode.rawNode.checkboxDisabled),c=$(()=>ae(e.tmNode,b.value)),k=$(()=>l.disabledRef.value||c.value),R=B(()=>{const{value:r}=p;if(!!r)return r({option:e.tmNode.rawNode})}),F=T(null),K={value:null};et(()=>{K.value=F.value.$el});function U(){const{tmNode:r}=e;if(!r.isLeaf&&!r.shallowLoaded){if(!l.loadingKeysRef.value.has(r.key))l.loadingKeysRef.value.add(r.key);else return;const{onLoadRef:{value:C}}=l;C&&C(r.rawNode).then(D=>{D!==!1&&l.handleSwitcherClick(r)}).finally(()=>{l.loadingKeysRef.value.delete(r.key)})}else l.handleSwitcherClick(r)}const L=$(()=>!c.value&&l.selectableRef.value&&(l.internalTreeSelect?l.mergedCheckStrategyRef.value!=="child"||l.multipleRef.value&&l.cascadeRef.value||e.tmNode.isLeaf:!0)),H=$(()=>l.checkableRef.value&&(l.cascadeRef.value||l.mergedCheckStrategyRef.value!=="child"||e.tmNode.isLeaf)),M=$(()=>l.displayedCheckedKeysRef.value.includes(e.tmNode.key)),re=$(()=>{const{value:r}=H;if(!r)return!1;const{value:C}=w;return typeof C=="boolean"?C:C(e.tmNode.rawNode)});function X(r){const{value:C}=l.expandOnClickRef,{value:D}=L,{value:he}=re;if(!D&&!C&&!he||un(r,"checkbox")||un(r,"switcher"))return;const{tmNode:Fe}=e;D&&l.handleSelect(Fe),C&&!Fe.isLeaf&&U(),he&&fe(!M.value)}function Ue(r){var C,D;m.value||(k.value||X(r),(D=(C=R.value)===null||C===void 0?void 0:C.onClick)===null||D===void 0||D.call(C,r))}function ue(r){var C,D;!m.value||(k.value||X(r),(D=(C=R.value)===null||C===void 0?void 0:C.onClick)===null||D===void 0||D.call(C,r))}function fe(r){l.handleCheck(e.tmNode,r)}function De(r){l.handleDragStart({event:r,node:e.tmNode})}function Me(r){r.currentTarget===r.target&&l.handleDragEnter({event:r,node:e.tmNode})}function q(r){r.preventDefault(),l.handleDragOver({event:r,node:e.tmNode})}function J(r){l.handleDragEnd({event:r,node:e.tmNode})}function Z(r){r.currentTarget===r.target&&l.handleDragLeave({event:r,node:e.tmNode})}function je(r){r.preventDefault(),i.value!==null&&l.handleDrop({event:r,node:e.tmNode,dropPosition:i.value})}return{showDropMark:$(()=>{const{value:r}=u;if(!r)return;const{value:C}=i;if(!C)return;const{value:D}=h;if(!D)return;const{tmNode:he}=e;return he.key===D.key}),showDropMarkAsParent:$(()=>{const{value:r}=f;if(!r)return!1;const{tmNode:C}=e,{value:D}=i;return D==="before"||D==="after"?r.key===C.key:!1}),pending:$(()=>l.pendingNodeKeyRef.value===e.tmNode.key),loading:$(()=>l.loadingKeysRef.value.has(e.tmNode.key)),highlight:$(()=>{var r;return(r=l.highlightKeySetRef.value)===null||r===void 0?void 0:r.has(e.tmNode.key)}),checked:M,indeterminate:$(()=>l.displayedIndeterminateKeysRef.value.includes(e.tmNode.key)),selected:$(()=>l.mergedSelectedKeysRef.value.includes(e.tmNode.key)),expanded:$(()=>l.mergedExpandedKeysRef.value.includes(e.tmNode.key)),disabled:k,checkable:H,mergedCheckOnClick:re,checkboxDisabled:a,selectable:L,expandOnClick:l.expandOnClickRef,internalScrollable:l.internalScrollableRef,draggable:l.draggableRef,blockLine:m,nodeProps:R,checkboxFocusable:l.internalCheckboxFocusableRef,droppingPosition:i,droppingOffsetLevel:g,indent:v,checkboxPlacement:y,contentInstRef:F,contentElRef:K,handleCheck:fe,handleDrop:je,handleDragStart:De,handleDragEnter:Me,handleDragOver:q,handleDragEnd:J,handleDragLeave:Z,handleLineClick:ue,handleContentClick:Ue,handleSwitcherClick:U}},render(){const{tmNode:e,clsPrefix:l,checkable:f,expandOnClick:h,selectable:u,selected:i,checked:g,highlight:p,draggable:v,blockLine:m,indent:y,disabled:w,pending:b,internalScrollable:a,nodeProps:c,checkboxPlacement:k}=this,R=v&&!w?{onDragenter:this.handleDragEnter,onDragleave:this.handleDragLeave,onDragend:this.handleDragEnd,onDrop:this.handleDrop,onDragover:this.handleDragOver}:void 0,F=a?mn(e.key):void 0,K=k==="right",U=f?x(At,{right:K,focusable:this.checkboxFocusable,disabled:w||this.checkboxDisabled,clsPrefix:l,checked:this.checked,indeterminate:this.indeterminate,onCheck:this.handleCheck}):null;return x("div",Object.assign({class:`${l}-tree-node-wrapper`},R),x("div",Object.assign({},m?c:void 0,{class:[`${l}-tree-node`,{[`${l}-tree-node--selected`]:i,[`${l}-tree-node--checkable`]:f,[`${l}-tree-node--highlight`]:p,[`${l}-tree-node--pending`]:b,[`${l}-tree-node--disabled`]:w,[`${l}-tree-node--selectable`]:u,[`${l}-tree-node--clickable`]:u||h||this.mergedCheckOnClick},c==null?void 0:c.class],"data-key":F,draggable:v&&m,onClick:this.handleLineClick,onDragstart:v&&m&&!w?this.handleDragStart:void 0}),nt(e.level,x("div",{class:`${l}-tree-node-indent`},x("div",{style:{width:`${y}px`}}))),x(Ft,{clsPrefix:l,expanded:this.expanded,selected:i,loading:this.loading,hide:e.isLeaf,onClick:this.handleSwitcherClick}),K?null:U,x(Tt,{ref:"contentInstRef",clsPrefix:l,checked:g,selected:i,onClick:this.handleContentClick,nodeProps:m?void 0:c,onDragstart:v&&!m&&!w?this.handleDragStart:void 0,tmNode:e}),v?this.showDropMark?yn({el:this.contentElRef.value,position:this.droppingPosition,offsetLevel:this.droppingOffsetLevel,indent:y}):this.showDropMarkAsParent?yn({el:this.contentElRef.value,position:"inside",offsetLevel:this.droppingOffsetLevel,indent:y}):null:null,K?U:null))}}),wn=It;function Ot({props:e,fNodesRef:l,mergedExpandedKeysRef:f,mergedSelectedKeysRef:h,handleSelect:u,handleSwitcherClick:i}){const{value:g}=h,p=pe(xn,null),v=p?p.pendingNodeKeyRef:T(g.length?g[g.length-1]:null);function m(y){if(!e.keyboard)return;const{value:w}=v;if(w===null){if((y.key==="ArrowDown"||y.key==="ArrowUp")&&y.preventDefault(),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(y.key)&&w===null){const{value:b}=l;let a=0;for(;a<b.length;){if(!b[a].disabled){v.value=b[a].key;break}a+=1}}}else{const{value:b}=l;let a=b.findIndex(c=>c.key===w);if(!~a)return;if(y.key==="Enter")u(b[a]);else if(y.key==="ArrowDown")for(y.preventDefault(),a+=1;a<b.length;){if(!b[a].disabled){v.value=b[a].key;break}a+=1}else if(y.key==="ArrowUp")for(y.preventDefault(),a-=1;a>=0;){if(!b[a].disabled){v.value=b[a].key;break}a-=1}else if(y.key==="ArrowLeft"){const c=b[a];if(c.isLeaf||!f.value.includes(w)){const k=c.getParent();k&&(v.value=k.key)}else i(c)}else if(y.key==="ArrowRight"){const c=b[a];if(c.isLeaf)return;if(!f.value.includes(w))i(c);else for(a+=1;a<b.length;){if(!b[a].disabled){v.value=b[a].key;break}a+=1}}}}return{pendingNodeKeyRef:v,handleKeydown:m}}const $t=oe({name:"TreeMotionWrapper",props:{clsPrefix:{type:String,required:!0},height:Number,nodes:{type:Array,required:!0},mode:{type:String,required:!0},onAfterEnter:{type:Function,required:!0}},render(){const{clsPrefix:e}=this;return x(lt,{onAfterEnter:this.onAfterEnter,appear:!0,reverse:this.mode==="collapse"},{default:()=>x("div",{class:[`${e}-tree-motion-wrapper`,`${e}-tree-motion-wrapper--${this.mode}`],style:{height:tt(this.height)}},this.nodes.map(l=>x(wn,{clsPrefix:e,tmNode:l})))})}}),Ut=_("tree",`
 font-size: var(--n-font-size);
 outline: none;
`,[te("ul, li",`
 margin: 0;
 padding: 0;
 list-style: none;
 `),te(">",[_("tree-node",[te("&:first-child",{marginTop:0})])]),_("tree-node-indent",`
 flex-grow: 0;
 flex-shrink: 0;
 height: 0;
 `),_("tree-motion-wrapper",[P("expand",[fn({duration:"0.2s"})]),P("collapse",[fn({duration:"0.2s",reverse:!0})])]),_("tree-node-wrapper",`
 box-sizing: border-box;
 padding: 3px 0;
 `),_("tree-node",`
 transform: translate3d(0,0,0);
 position: relative;
 display: flex;
 border-radius: var(--n-node-border-radius);
 transition: background-color .3s var(--n-bezier);
 `,[P("highlight",[_("tree-node-content",[ke("text",{borderBottomColor:"var(--n-node-text-color-disabled)"})])]),P("disabled",[_("tree-node-content",`
 color: var(--n-node-text-color-disabled);
 cursor: not-allowed;
 `)]),Se("disabled",[P("clickable",[_("tree-node-content",`
 cursor: pointer;
 `)])])]),P("block-node",[_("tree-node-content",`
 flex: 1;
 min-width: 0;
 `)]),Se("block-line",[_("tree-node",[Se("disabled",[_("tree-node-content",[te("&:hover",{backgroundColor:"var(--n-node-color-hover)"})]),P("selectable",[_("tree-node-content",[te("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),P("pending",[_("tree-node-content",`
 background-color: var(--n-node-color-hover);
 `)]),P("selected",[_("tree-node-content",{backgroundColor:"var(--n-node-color-active)"})])])])]),P("block-line",[_("tree-node",[Se("disabled",[te("&:hover",{backgroundColor:"var(--n-node-color-hover)"}),P("pending",`
 background-color: var(--n-node-color-hover);
 `),P("selectable",[Se("selected",[te("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),P("selected",{backgroundColor:"var(--n-node-color-active)"})]),P("disabled",`
 cursor: not-allowed;
 `)])]),_("tree-node-switcher",`
 cursor: pointer;
 display: inline-flex;
 flex-shrink: 0;
 height: 24px;
 width: 24px;
 align-items: center;
 justify-content: center;
 transition: transform .15s var(--n-bezier);
 vertical-align: bottom;
 `,[ke("icon",`
 position: relative;
 height: 14px;
 width: 14px;
 display: flex;
 color: var(--n-arrow-color);
 transition: color .3s var(--n-bezier);
 font-size: 14px;
 `,[_("icon",[Ye()]),_("base-loading",`
 color: var(--n-loading-color);
 position: absolute;
 left: 0;
 top: 0;
 right: 0;
 bottom: 0;
 `,[Ye()]),_("base-icon",[Ye()])]),P("hide",{visibility:"hidden"}),P("expanded",{transform:"rotate(90deg)"})]),_("tree-node-checkbox",`
 display: inline-flex;
 height: 24px;
 width: 16px;
 vertical-align: bottom;
 align-items: center;
 justify-content: center;
 margin-right: 4px;
 `,[P("right","margin-left: 4px;")]),P("checkable",[_("tree-node-content",`
 padding: 0 6px;
 `)]),_("tree-node-content",`
 position: relative;
 display: inline-flex;
 align-items: center;
 min-height: 24px;
 box-sizing: border-box;
 line-height: 1.5;
 vertical-align: bottom;
 padding: 0 6px 0 4px;
 cursor: default;
 border-radius: var(--n-node-border-radius);
 text-decoration-color: #0000;
 text-decoration-line: underline;
 color: var(--n-node-text-color);
 transition:
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[te("&:last-child",{marginBottom:0}),ke("prefix",`
 display: inline-flex;
 margin-right: 8px;
 `),ke("text",`
 border-bottom: 1px solid #0000;
 transition: border-color .3s var(--n-bezier);
 flex-grow: 1;
 max-width: 100%;
 `),ke("suffix",`
 display: inline-flex;
 `)]),ke("empty","margin: auto;")]);var Mt=globalThis&&globalThis.__awaiter||function(e,l,f,h){function u(i){return i instanceof f?i:new f(function(g){g(i)})}return new(f||(f=Promise))(function(i,g){function p(y){try{m(h.next(y))}catch(w){g(w)}}function v(y){try{m(h.throw(y))}catch(w){g(w)}}function m(y){y.done?i(y.value):u(y.value).then(p,v)}m((h=h.apply(e,l||[])).next())})};const $e=30;function jt(e,l,f,h){return{getIsGroup(){return!1},getKey(i){return i[e]},getChildren:h||(i=>i[l]),getDisabled(i){return!!(i[f]||i.checkboxDisabled)}}}const zt={allowCheckingNotLoaded:Boolean,filter:Function,defaultExpandAll:Boolean,expandedKeys:Array,keyField:{type:String,default:"key"},labelField:{type:String,default:"label"},childrenField:{type:String,default:"children"},disabledField:{type:String,default:"disabled"},defaultExpandedKeys:{type:Array,default:()=>[]},indeterminateKeys:Array,renderSwitcherIcon:Function,onUpdateIndeterminateKeys:[Function,Array],"onUpdate:indeterminateKeys":[Function,Array],onUpdateExpandedKeys:[Function,Array],"onUpdate:expandedKeys":[Function,Array]},Vt=Object.assign(Object.assign(Object.assign(Object.assign({},kn.props),{accordion:Boolean,showIrrelevantNodes:{type:Boolean,default:!0},data:{type:Array,default:()=>[]},expandOnDragenter:{type:Boolean,default:!0},expandOnClick:Boolean,checkOnClick:{type:[Boolean,Function],default:!1},cancelable:{type:Boolean,default:!0},checkable:Boolean,draggable:Boolean,blockNode:Boolean,blockLine:Boolean,disabled:Boolean,checkedKeys:Array,defaultCheckedKeys:{type:Array,default:()=>[]},selectedKeys:Array,defaultSelectedKeys:{type:Array,default:()=>[]},multiple:Boolean,pattern:{type:String,default:""},onLoad:Function,cascade:Boolean,selectable:{type:Boolean,default:!0},indent:{type:Number,default:16},allowDrop:{type:Function,default:Lt},animated:{type:Boolean,default:!0},checkboxPlacement:{type:String,default:"left"},virtualScroll:Boolean,watchProps:Array,renderLabel:Function,renderPrefix:Function,renderSuffix:Function,nodeProps:Function,keyboard:{type:Boolean,default:!0},getChildren:Function,onDragenter:[Function,Array],onDragleave:[Function,Array],onDragend:[Function,Array],onDragstart:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onUpdateCheckedKeys:[Function,Array],"onUpdate:checkedKeys":[Function,Array],onUpdateSelectedKeys:[Function,Array],"onUpdate:selectedKeys":[Function,Array]}),zt),{internalTreeSelect:Boolean,internalScrollable:Boolean,internalScrollablePadding:String,internalRenderEmpty:Function,internalHighlightKeySet:Object,internalUnifySelectCheck:Boolean,internalCheckboxFocusable:{type:Boolean,default:!0},internalFocusable:{type:Boolean,default:!0},checkStrategy:{type:String,default:"all"},leafOnly:Boolean}),Ht=oe({name:"Tree",props:Vt,setup(e){const{mergedClsPrefixRef:l,inlineThemeDisabled:f,mergedRtlRef:h}=at(e),u=ot("Tree",h,l),i=kn("Tree","-tree",Ut,rt,e,l),g=T(null),p=T(null),v=T(null);function m(){var n;return(n=v.value)===null||n===void 0?void 0:n.listElRef}function y(){var n;return(n=v.value)===null||n===void 0?void 0:n.itemsElRef}const w=B(()=>{const{filter:n}=e;if(n)return n;const{labelField:t}=e;return(o,d)=>{if(!o.length)return!0;const s=d[t];return typeof s=="string"?s.toLowerCase().includes(o.toLowerCase()):!1}}),b=B(()=>{const{pattern:n}=e;return n?!n.length||!w.value?{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}:Bt(e.data,w.value,n,e.keyField,e.childrenField):{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}}),a=B(()=>it(e.showIrrelevantNodes?e.data:b.value.filteredTree,jt(e.keyField,e.childrenField,e.disabledField,e.getChildren))),c=pe(xn,null),k=e.internalTreeSelect?c.dataTreeMate:a,{watchProps:R}=e,F=T([]);R!=null&&R.includes("defaultCheckedKeys")?Ne(()=>{F.value=e.defaultCheckedKeys}):F.value=e.defaultCheckedKeys;const K=N(e,"checkedKeys"),U=Ie(K,F),L=B(()=>k.value.getCheckedKeys(U.value,{cascade:e.cascade,allowNotLoaded:e.allowCheckingNotLoaded})),H=Et(e),M=B(()=>L.value.checkedKeys),re=B(()=>{const{indeterminateKeys:n}=e;return n!==void 0?n:L.value.indeterminateKeys}),X=T([]);R!=null&&R.includes("defaultSelectedKeys")?Ne(()=>{X.value=e.defaultSelectedKeys}):X.value=e.defaultSelectedKeys;const Ue=N(e,"selectedKeys"),ue=Ie(Ue,X),fe=T([]),De=n=>{fe.value=e.defaultExpandAll?k.value.getNonLeafKeys():n===void 0?e.defaultExpandedKeys:n};R!=null&&R.includes("defaultExpandedKeys")?Ne(()=>De(void 0)):Ne(()=>De(e.defaultExpandedKeys));const Me=N(e,"expandedKeys"),q=Ie(Me,fe),J=B(()=>a.value.getFlattenedNodes(q.value)),{pendingNodeKeyRef:Z,handleKeydown:je}=Ot({props:e,mergedSelectedKeysRef:ue,fNodesRef:J,mergedExpandedKeysRef:q,handleSelect:qe,handleSwitcherClick:an});let r=null,C=null;const D=T(new Set),he=B(()=>e.internalHighlightKeySet||b.value.highlightKeySet),Fe=Ie(he,D),Ae=T(new Set),Rn=B(()=>q.value.filter(n=>!Ae.value.has(n)));let en=0;const we=T(null),Te=T(null),Le=T(null),Ee=T(null),Pe=T(0),Cn=B(()=>{const{value:n}=Te;return n?n.parent:null});xe(N(e,"data"),()=>{Ae.value.clear(),Z.value=null,Ce()},{deep:!1});let ze=!1;const Ve=()=>{ze=!0,Qe(()=>{ze=!1})};let Re;xe(N(e,"pattern"),(n,t)=>{if(e.showIrrelevantNodes)if(Re=void 0,n){const{expandedKeys:o,highlightKeySet:d}=Pt(e.data,e.pattern,e.keyField,e.childrenField,w.value);D.value=d,Ve(),ve(o,V(o),{node:null,action:"filter"})}else D.value=new Set;else if(!n.length)Re!==void 0&&(Ve(),ve(Re,V(Re),{node:null,action:"filter"}));else{t.length||(Re=q.value);const{expandedKeys:o}=b.value;o!==void 0&&(Ve(),ve(o,V(o),{node:null,action:"filter"}))}});function nn(n){return Mt(this,void 0,void 0,function*(){const{onLoad:t}=e;if(!t)return yield Promise.resolve();const{value:o}=Ae;if(!o.has(n.key)){o.add(n.key);try{(yield t(n.rawNode))===!1&&ye()}catch(d){console.error(d),ye()}o.delete(n.key)}})}Ne(()=>{var n;const{value:t}=a;if(!t)return;const{getNode:o}=t;(n=q.value)===null||n===void 0||n.forEach(d=>{const s=o(d);s&&!s.shallowLoaded&&nn(s)})});const ge=T(!1),ee=T([]);xe(Rn,(n,t)=>{if(!e.animated||ze){Qe(Be);return}const o=new Set(t);let d=null,s=null;for(const A of n)if(!o.has(A)){if(d!==null)return;d=A}const I=new Set(n);for(const A of t)if(!I.has(A)){if(s!==null)return;s=A}if(d===null&&s===null)return;const{virtualScroll:E}=e,Y=(E?v.value.listElRef:g.value).offsetHeight,de=Math.ceil(Y/$e)+1;let G;if(d!==null&&(G=t),s!==null&&(G===void 0?G=n:G=G.filter(A=>A!==s)),ge.value=!0,ee.value=a.value.getFlattenedNodes(G),d!==null){const A=ee.value.findIndex(O=>O.key===d);if(~A){const O=ee.value[A].children;if(O){const ne=hn(O,n);ee.value.splice(A+1,0,{__motion:!0,mode:"expand",height:E?ne.length*$e:void 0,nodes:E?ne.slice(0,de):ne})}}}if(s!==null){const A=ee.value.findIndex(O=>O.key===s);if(~A){const O=ee.value[A].children;if(!O)return;ge.value=!0;const ne=hn(O,n);ee.value.splice(A+1,0,{__motion:!0,mode:"collapse",height:E?ne.length*$e:void 0,nodes:E?ne.slice(0,de):ne})}}});const Sn=B(()=>dt(J.value)),Nn=B(()=>ge.value?ee.value:J.value);function Be(){const{value:n}=p;n&&n.sync()}function Kn(){ge.value=!1,e.virtualScroll&&Qe(Be)}function V(n){const{getNode:t}=k.value;return n.map(o=>{var d;return((d=t(o))===null||d===void 0?void 0:d.rawNode)||null})}function ve(n,t,o){const{"onUpdate:expandedKeys":d,onUpdateExpandedKeys:s}=e;fe.value=n,d&&z(d,n,t,o),s&&z(s,n,t,o)}function tn(n,t,o){const{"onUpdate:checkedKeys":d,onUpdateCheckedKeys:s}=e;F.value=n,s&&z(s,n,t,o),d&&z(d,n,t,o)}function _n(n,t){const{"onUpdate:indeterminateKeys":o,onUpdateIndeterminateKeys:d}=e;o&&z(o,n,t),d&&z(d,n,t)}function He(n,t,o){const{"onUpdate:selectedKeys":d,onUpdateSelectedKeys:s}=e;X.value=n,s&&z(s,n,t,o),d&&z(d,n,t,o)}function Dn(n){const{onDragenter:t}=e;t&&z(t,n)}function Fn(n){const{onDragleave:t}=e;t&&z(t,n)}function An(n){const{onDragend:t}=e;t&&z(t,n)}function Tn(n){const{onDragstart:t}=e;t&&z(t,n)}function Ln(n){const{onDragover:t}=e;t&&z(t,n)}function En(n){const{onDrop:t}=e;t&&z(t,n)}function Ce(){Pn(),ie()}function Pn(){we.value=null}function ie(){Pe.value=0,Te.value=null,Le.value=null,Ee.value=null,ye()}function ye(){r&&(window.clearTimeout(r),r=null),C=null}function ln(n,t){if(e.disabled||ae(n,e.disabledField))return;if(e.internalUnifySelectCheck&&!e.multiple){qe(n);return}const o=t?"check":"uncheck",{checkedKeys:d,indeterminateKeys:s}=k.value[o](n.key,M.value,{cascade:e.cascade,checkStrategy:H.value,allowNotLoaded:e.allowCheckingNotLoaded});tn(d,V(d),{node:n.rawNode,action:o}),_n(s,V(s))}function Bn(n){if(e.disabled)return;const{key:t}=n,{value:o}=q,d=o.findIndex(s=>s===t);if(~d){const s=Array.from(o);s.splice(d,1),ve(s,V(s),{node:n.rawNode,action:"collapse"})}else{const s=a.value.getNode(t);if(!s||s.isLeaf)return;let I;if(e.accordion){const E=new Set(n.siblings.map(({key:Y})=>Y));I=o.filter(Y=>!E.has(Y)),I.push(t)}else I=o.concat(t);ve(I,V(I),{node:n.rawNode,action:"expand"})}}function an(n){e.disabled||ge.value||Bn(n)}function qe(n){if(!(e.disabled||!e.selectable)){if(Z.value=n.key,e.internalUnifySelectCheck){const{value:{checkedKeys:t,indeterminateKeys:o}}=L;e.multiple?ln(n,!(t.includes(n.key)||o.includes(n.key))):tn([n.key],V([n.key]),{node:n.rawNode,action:"check"})}if(e.multiple){const t=Array.from(ue.value),o=t.findIndex(d=>d===n.key);~o?e.cancelable&&t.splice(o,1):~o||t.push(n.key),He(t,V(t),{node:n.rawNode,action:~o?"unselect":"select"})}else ue.value.includes(n.key)?e.cancelable&&He([],[],{node:n.rawNode,action:"unselect"}):He([n.key],V([n.key]),{node:n.rawNode,action:"select"})}}function In(n){if(r&&(window.clearTimeout(r),r=null),n.isLeaf)return;C=n.key;const t=()=>{if(C!==n.key)return;const{value:o}=Le;if(o&&o.key===n.key&&!q.value.includes(n.key)){const d=q.value.concat(n.key);ve(d,V(d),{node:n.rawNode,action:"expand"})}r=null,C=null};n.shallowLoaded?r=window.setTimeout(()=>{t()},1e3):r=window.setTimeout(()=>{nn(n).then(()=>{t()})},1e3)}function On({event:n,node:t}){!e.draggable||e.disabled||ae(t,e.disabledField)||(on({event:n,node:t},!1),Dn({event:n,node:t.rawNode}))}function $n({event:n,node:t}){!e.draggable||e.disabled||ae(t,e.disabledField)||Fn({event:n,node:t.rawNode})}function Un(n){n.target===n.currentTarget&&ie()}function Mn({event:n,node:t}){Ce(),!(!e.draggable||e.disabled||ae(t,e.disabledField))&&An({event:n,node:t.rawNode})}function jn({event:n,node:t}){!e.draggable||e.disabled||ae(t,e.disabledField)||(en=n.clientX,we.value=t,Tn({event:n,node:t.rawNode}))}function on({event:n,node:t},o=!0){var d;if(!e.draggable||e.disabled||ae(t,e.disabledField))return;const{value:s}=we;if(!s)return;const{allowDrop:I,indent:E}=e;o&&Ln({event:n,node:t.rawNode});const Y=n.currentTarget,{height:de,top:G}=Y.getBoundingClientRect(),A=n.clientY-G;let O;I({node:t.rawNode,dropPosition:"inside",phase:"drag"})?A<=8?O="before":A>=de-8?O="after":O="inside":A<=de/2?O="before":O="after";const{value:Wn}=Sn;let S,j;const Xe=Wn(t.key);if(Xe===null){ie();return}let dn=!1;O==="inside"?(S=t,j="inside"):O==="before"?t.isFirstChild?(S=t,j="before"):(S=J.value[Xe-1],j="after"):(S=t,j="after"),!S.isLeaf&&q.value.includes(S.key)&&(dn=!0,j==="after"&&(S=J.value[Xe+1],S?j="before":(S=t,j="inside")));const cn=S;if(Le.value=cn,!dn&&s.isLastChild&&s.key===S.key&&(j="after"),j==="after"){let sn=en-n.clientX,Ge=0;for(;sn>=E/2&&S.parent!==null&&S.isLastChild&&Ge<1;)sn-=E,Ge+=1,S=S.parent;Pe.value=Ge}else Pe.value=0;if((s.contains(S)||j==="inside"&&((d=s.parent)===null||d===void 0?void 0:d.key)===S.key)&&!(s.key===cn.key&&s.key===S.key)){ie();return}if(!I({node:S.rawNode,dropPosition:j,phase:"drag"})){ie();return}if(s.key===S.key)ye();else if(C!==S.key)if(j==="inside"){if(e.expandOnDragenter){if(In(S),!S.shallowLoaded&&C!==S.key){Ce();return}}else if(!S.shallowLoaded){Ce();return}}else ye();else j!=="inside"&&ye();Ee.value=j,Te.value=S}function zn({event:n,node:t,dropPosition:o}){if(!e.draggable||e.disabled||ae(t,e.disabledField))return;const{value:d}=we,{value:s}=Te,{value:I}=Ee;if(!(!d||!s||!I)&&!!e.allowDrop({node:s.rawNode,dropPosition:I,phase:"drag"})&&d.key!==s.key){if(I==="before"){const E=d.getNext({includeDisabled:!0});if(E&&E.key===s.key){ie();return}}if(I==="after"){const E=d.getPrev({includeDisabled:!0});if(E&&E.key===s.key){ie();return}}En({event:n,node:s.rawNode,dragNode:d.rawNode,dropPosition:o}),Ce()}}function Vn(){Be()}function Hn(){Be()}function qn(n){var t;if(e.virtualScroll||e.internalScrollable){const{value:o}=p;if(!((t=o==null?void 0:o.containerRef)===null||t===void 0)&&t.contains(n.relatedTarget))return;Z.value=null}else{const{value:o}=g;if(o!=null&&o.contains(n.relatedTarget))return;Z.value=null}}xe(Z,n=>{var t,o;if(n!==null){if(e.virtualScroll)(t=v.value)===null||t===void 0||t.scrollTo({key:n});else if(e.internalScrollable){const{value:d}=p;if(d===null)return;const s=(o=d.contentRef)===null||o===void 0?void 0:o.querySelector(`[data-key="${mn(n)}"]`);if(!s)return;d.scrollTo({el:s})}}}),ct(_e,{loadingKeysRef:Ae,highlightKeySetRef:Fe,displayedCheckedKeysRef:M,displayedIndeterminateKeysRef:re,mergedSelectedKeysRef:ue,mergedExpandedKeysRef:q,mergedThemeRef:i,mergedCheckStrategyRef:H,nodePropsRef:N(e,"nodeProps"),disabledRef:N(e,"disabled"),checkableRef:N(e,"checkable"),selectableRef:N(e,"selectable"),expandOnClickRef:N(e,"expandOnClick"),onLoadRef:N(e,"onLoad"),draggableRef:N(e,"draggable"),blockLineRef:N(e,"blockLine"),indentRef:N(e,"indent"),cascadeRef:N(e,"cascade"),checkOnClickRef:N(e,"checkOnClick"),checkboxPlacementRef:e.checkboxPlacement,droppingMouseNodeRef:Le,droppingNodeParentRef:Cn,draggingNodeRef:we,droppingPositionRef:Ee,droppingOffsetLevelRef:Pe,fNodesRef:J,pendingNodeKeyRef:Z,disabledFieldRef:N(e,"disabledField"),internalScrollableRef:N(e,"internalScrollable"),internalCheckboxFocusableRef:N(e,"internalCheckboxFocusable"),internalTreeSelect:e.internalTreeSelect,renderLabelRef:N(e,"renderLabel"),renderPrefixRef:N(e,"renderPrefix"),renderSuffixRef:N(e,"renderSuffix"),renderSwitcherIconRef:N(e,"renderSwitcherIcon"),labelFieldRef:N(e,"labelField"),multipleRef:N(e,"multiple"),handleSwitcherClick:an,handleDragEnd:Mn,handleDragEnter:On,handleDragLeave:$n,handleDragStart:jn,handleDrop:zn,handleDragOver:on,handleSelect:qe,handleCheck:ln});function Xn(n){var t;(t=v.value)===null||t===void 0||t.scrollTo(n)}const Gn={handleKeydown:je,scrollTo:Xn,getCheckedData:()=>{if(!e.checkable)return{keys:[],options:[]};const{checkedKeys:n}=L.value;return{keys:n,options:V(n)}},getIndeterminateData:()=>{if(!e.checkable)return{keys:[],options:[]};const{indeterminateKeys:n}=L.value;return{keys:n,options:V(n)}}},rn=B(()=>{const{common:{cubicBezierEaseInOut:n},self:{fontSize:t,nodeBorderRadius:o,nodeColorHover:d,nodeColorPressed:s,nodeColorActive:I,arrowColor:E,loadingColor:Y,nodeTextColor:de,nodeTextColorDisabled:G,dropMarkColor:A}}=i.value;return{"--n-arrow-color":E,"--n-loading-color":Y,"--n-bezier":n,"--n-font-size":t,"--n-node-border-radius":o,"--n-node-color-active":I,"--n-node-color-hover":d,"--n-node-color-pressed":s,"--n-node-text-color":de,"--n-node-text-color-disabled":G,"--n-drop-mark-color":A}}),be=f?st("tree",void 0,rn,e):void 0;return Object.assign(Object.assign({},Gn),{mergedClsPrefix:l,mergedTheme:i,rtlEnabled:u,fNodes:Nn,aip:ge,selfElRef:g,virtualListInstRef:v,scrollbarInstRef:p,handleFocusout:qn,handleDragLeaveTree:Un,handleScroll:Vn,getScrollContainer:m,getScrollContent:y,handleAfterEnter:Kn,handleResize:Hn,cssVars:f?void 0:rn,themeClass:be==null?void 0:be.themeClass,onRender:be==null?void 0:be.onRender})},render(){var e;const{fNodes:l,internalRenderEmpty:f}=this;if(!l.length&&f)return f();const{mergedClsPrefix:h,blockNode:u,blockLine:i,draggable:g,disabled:p,internalFocusable:v,checkable:m,handleKeydown:y,rtlEnabled:w,handleFocusout:b}=this,a=v&&!p,c=a?"0":void 0,k=[`${h}-tree`,w&&`${h}-tree--rtl`,m&&`${h}-tree--checkable`,(i||u)&&`${h}-tree--block-node`,i&&`${h}-tree--block-line`],R=K=>"__motion"in K?x($t,{height:K.height,nodes:K.nodes,clsPrefix:h,mode:K.mode,onAfterEnter:this.handleAfterEnter}):x(wn,{key:K.key,tmNode:K,clsPrefix:h});if(this.virtualScroll){const{mergedTheme:K,internalScrollablePadding:U}=this,L=ut(U||"0");return x(gn,{ref:"scrollbarInstRef",onDragleave:g?this.handleDragLeaveTree:void 0,container:this.getScrollContainer,content:this.getScrollContent,class:k,theme:K.peers.Scrollbar,themeOverrides:K.peerOverrides.Scrollbar,tabindex:c,onKeydown:a?y:void 0,onFocusout:a?b:void 0},{default:()=>{var H;return(H=this.onRender)===null||H===void 0||H.call(this),x(Kt,{ref:"virtualListInstRef",items:this.fNodes,itemSize:$e,ignoreItemResize:this.aip,paddingTop:L.top,paddingBottom:L.bottom,class:this.themeClass,style:[this.cssVars,{paddingLeft:L.left,paddingRight:L.right}],onScroll:this.handleScroll,onResize:this.handleResize,showScrollbar:!1,itemResizable:!0},{default:({item:M})=>R(M)})}})}const{internalScrollable:F}=this;return k.push(this.themeClass),(e=this.onRender)===null||e===void 0||e.call(this),F?x(gn,{class:k,tabindex:c,onKeydown:a?y:void 0,onFocusout:a?b:void 0,style:this.cssVars,contentStyle:{padding:this.internalScrollablePadding}},{default:()=>x("div",{onDragleave:g?this.handleDragLeaveTree:void 0,ref:"selfElRef"},this.fNodes.map(R))}):x("div",{class:k,tabindex:c,ref:"selfElRef",style:this.cssVars,onKeydown:a?y:void 0,onFocusout:a?b:void 0,onDragleave:g?this.handleDragLeaveTree:void 0},l.length?l.map(R):ft(this.$slots.empty,()=>[x(ht,{class:`${h}-tree__empty`,theme:this.mergedTheme.peers.Empty,themeOverrides:this.mergedTheme.peerOverrides.Empty})]))}}),qt={key:0,size:"large"},Xt=kt("div",{class:"h-[80vh]"},null,-1),Gt={key:2},Wt={key:0},Yt={key:0},Qt={key:1},tl=oe({__name:"RelayInfoView",setup(e){const{error:l}=gt(),f=vt(),h=mt(),u=B(()=>{const a=h.params.url;if(a){const c=new URL(a);return c.protocol="http://",c.toString()}return a}),i=T(null),g=T(null);xe(u,async()=>{i.value=null,p().then(a=>{g.value=a}).catch(a=>{i.value=a})},{immediate:!0});async function p(){if(!u.value)return null;const a="https://cors-anywhere.herokuapp.com/";return await xt(`fetch:${a}${u.value}:get:application/nostr+json`,async()=>await fetch(`${a}${u.value}`,{headers:{accept:"application/nostr+json"}}).then(c=>c.text()).then(c=>{try{return JSON.parse(c)}catch{return c.includes("/corsdemo")&&(l(c,{duration:2e5,closable:!0}),f.warning({title:me("warning"),content:me("message.relay_info_view_verified"),positiveText:me("yes"),negativeText:me("no"),onPositiveClick:()=>{window.open("https://cors-anywhere.herokuapp.com/corsdemo")},onNegativeClick:()=>{}})),Promise.reject(c)}}),{cacheError:!1})}const v=Ct();xe(g,()=>{var c;const a=(c=g.value)==null?void 0:c.supported_nips;a&&a.forEach(k=>{v.value.add(k)})});const m=B(()=>{var a;return new Set((a=g.value)==null?void 0:a.supported_nips)});function y(a){const c=`https://github.com/nostr-protocol/nips/blob/master/${a.toString().padStart(2,"0")}.md`;window.open(c)}const w=B(()=>b(g.value));function b(a){return a?Array.isArray(a)?a.map(c=>({whateverLabel:c,whateverKey:c})):typeof a=="object"?Object.entries(a).map(([c,k])=>typeof k=="string"||typeof k=="number"?{whateverLabel:`${c}: ${k}`,whateverKey:c}:{whateverLabel:c,whateverKey:c,whateverChildren:b(k)}):[]:[]}return(a,c)=>{const k=pt,R=wt,F=_t,K=Rt,U=St,L=Ht;return W(),ce(vn,null,[i.value===null&&!g.value?(W(),ce("div",qt,[le(R,{vertical:""},{default:Q(()=>[i.value===null&&!g.value?(W(),Je(k,{key:0,size:"large"},{description:Q(()=>[Ze(Oe(Ke(me)("loading")),1)]),default:Q(()=>[Xt]),_:1})):se("",!0)]),_:1})])):se("",!0),i.value?(W(),Je(F,{key:1,status:"404",title:`404 ${Ke(me)("resource_does_not_exist")}`,description:"\u751F\u6D3B\u603B\u5F52\u5E26\u70B9\u8352\u8C2C"},null,8,["title"])):se("",!0),g.value?(W(),ce("div",Gt,[le(R,{vertical:""},{default:Q(()=>{var H;return[g.value.name?(W(),ce("h1",Wt,Oe((H=g.value)==null?void 0:H.name),1)):se("",!0),le(K,{title:"\u57FA\u672C\u4FE1\u606F"},{default:Q(()=>{var M,re,X;return[(M=g.value)!=null&&M.description?(W(),ce("p",Yt,"\u63CF\u8FF0 \uFF1A"+Oe((re=g.value)==null?void 0:re.description),1)):se("",!0),(X=g.value)!=null&&X.pubkey?(W(),ce("p",Qt,[Ze(" \u7BA1\u7406\u8005 \uFF1A"),le(yt,{pubkey:g.value.pubkey},null,8,["pubkey"])])):se("",!0)]}),_:1}),le(K,{title:"\u652F\u6301\u7684nip\u60C5\u51B5"},{default:Q(()=>[le(R,null,{default:Q(()=>[(W(!0),ce(vn,null,bt(Ke(v),M=>(W(),Je(U,{bordered:!1,type:Ke(m).has(M)?"success":"error",onClick:()=>y(M)},{default:Q(()=>[Ze(" nip-"+Oe(M),1)]),_:2},1032,["type","onClick"]))),256))]),_:1})]),_:1}),le(K,{title:"\u66F4\u591A\u4FE1\u606F"},{default:Q(()=>[le(L,{"block-line":"",data:Ke(w),"key-field":"whateverKey","label-field":"whateverLabel","children-field":"whateverChildren",selectable:""},null,8,["data"])]),_:1})]}),_:1})])):se("",!0)],64)}}});export{tl as default};
