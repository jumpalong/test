import{_ as ee,a as te}from"./DrawerProvide.vue_vue_type_script_setup_true_lang.da186b5d.js";import{C as ne}from"./Copy16Filled.32c2e6ba.js";import{c as L,f as W,u as ae,N as f,g as q,ds as oe,M as se,k as l,h as O,P as le,aJ as ie,o as G,z as re,au as E,G as ue,af as H,l as de,w as z,m as d,n as P,D as me,E as ce,bl as pe,ar as fe,C as M}from"./index.8f62a545.js";import{u as ve}from"./Markdown.05f716d1.js";import{M as ge}from"./MavonEditor.aa4b0597.js";import{u as he}from"./Upload.39a290a3.js";import{_ as _e}from"./UploadInput.vue_vue_type_script_setup_true_lang.caf8a136.js";import{u as ye}from"./naiveUi.02e209d9.js";import{a as be}from"./nostr.0043d5e6.js";import{a as Ce}from"./nostrApiUse.43d55506.js";import{v as we}from"./use.b23b6c29.js";import{n as K}from"./nostr.ad89cf30.js";import{_ as ke,c as Te}from"./Tag.7e30ed31.js";import{u as Ve}from"./use-locale.cbb1f83b.js";import{u as Fe,c as j}from"./Loading.0b953150.js";import{u as Ie}from"./cssr.21c6f8e2.js";import{s as Re}from"./prop.0533c762.js";import{u as Se}from"./use-css-vars-class.1ada0b07.js";import{_ as J}from"./Input.90533fe2.js";import{_ as Ae}from"./Button.22997a19.js";import{N as Oe}from"./Icon.1c3d6ebf.js";import{A as ze}from"./Add.d66e299e.js";import{_ as Q}from"./Space.32f062de.js";import{N as xe}from"./Icon.904bc99e.js";import"./DrawerContent.bb261013.js";import"./Follower.7ba57362.js";import"./use-rtl.6d35c504.js";import"./Popover.6590eae2.js";import"./format-length.3612bbc8.js";import"./Scrollbar.8d5a1903.js";import"./is-browser.f4df612e.js";import"./index.71604e6f.js";import"./Close.dba1bcea.js";import"./use-style.d8216a24.js";import"./Close.7d56270d.js";import"./replaceable.815b8f5c.js";import"./nostr.c03670ae.js";import"./use-theme-vars.c704e62a.js";import"./Warning.6502c178.js";import"./create-key.7b548031.js";import"./RegExpUtils.102c01f0.js";import"./utils.e1137b57.js";import"./fade-in-scale-up.cssr.5ebe4351.js";import"./Tooltip.d86a0762.js";import"./UploadButton.vue_vue_type_script_setup_true_lang.a94967af.js";import"./CloudUpload.c28b341b.js";import"./Upload.b5c9ebfa.js";import"./fade-in-height-expand.cssr.a4865c47.js";import"./composables.10bdf172.js";import"./error.469adc75.js";import"./login.0b8718d8.js";import"./Staff.e039c64f.js";import"./index.62f1e1b0.js";import"./get-slot.4ceacf82.js";const Be=L("dynamic-tags",[L("input",{minWidth:"var(--n-input-width)"})]),Ue=Object.assign(Object.assign(Object.assign({},q.props),Te),{size:{type:String,default:"medium"},closable:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[]},value:Array,inputStyle:[String,Object],inputProps:Object,max:Number,tagStyle:[String,Object],renderTag:Function,onCreate:{type:Function,default:a=>a},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),$e=W({name:"DynamicTags",props:Ue,setup(a){const{mergedClsPrefixRef:c,inlineThemeDisabled:v}=ae(a),{localeRef:_}=Ve("DynamicTags"),y=Fe(a),{mergedDisabledRef:r}=y,p=f(""),g=f(!1),b=f(!0),C=f(null),x=q("DynamicTags","-dynamic-tags",Be,oe,a,c),F=f(a.defaultValue),m=se(a,"value"),t=Ie(m,F),B=l(()=>_.value.add),U=l(()=>Re(a.size)),I=l(()=>r.value||!!a.max&&t.value.length>=a.max);function R(e){const{onChange:o,"onUpdate:value":k,onUpdateValue:N}=a,{nTriggerFormInput:s,nTriggerFormChange:n}=y;o&&j(o,e),N&&j(N,e),k&&j(k,e),F.value=e,s(),n()}function S(e){const o=t.value.slice(0);o.splice(e,1),R(o)}function $(e){switch(e.key){case"Enter":h()}}function h(e){const o=e!=null?e:p.value;if(o){const k=t.value.slice(0);k.push(a.onCreate(o)),R(k)}g.value=!1,b.value=!0,p.value=""}function w(){h()}function D(){g.value=!0,le(()=>{var e;(e=C.value)===null||e===void 0||e.focus(),b.value=!1})}const A=l(()=>{const{self:{inputWidth:e}}=x.value;return{"--n-input-width":e}}),i=v?Se("dynamic-tags",void 0,A,a):void 0;return{mergedClsPrefix:c,inputInstRef:C,localizedAdd:B,inputSize:U,inputValue:p,showInput:g,inputForceFocused:b,mergedValue:t,mergedDisabled:r,triggerDisabled:I,handleInputKeyUp:$,handleAddClick:D,handleInputBlur:w,handleCloseClick:S,handleInputConfirm:h,mergedTheme:x,cssVars:v?void 0:A,themeClass:i==null?void 0:i.themeClass,onRender:i==null?void 0:i.onRender}},render(){const{mergedTheme:a,cssVars:c,mergedClsPrefix:v,onRender:_,renderTag:y}=this;return _==null||_(),O(Q,{class:[`${v}-dynamic-tags`,this.themeClass],size:"small",style:c,theme:a.peers.Space,themeOverrides:a.peerOverrides.Space,itemStyle:"display: flex;"},{default:()=>{const{mergedTheme:r,tagStyle:p,type:g,round:b,size:C,color:x,closable:F,mergedDisabled:m,showInput:t,inputValue:B,inputStyle:U,inputSize:I,inputForceFocused:R,triggerDisabled:S,handleInputKeyUp:$,handleInputBlur:h,handleAddClick:w,handleCloseClick:D,handleInputConfirm:A,$slots:i}=this;return this.mergedValue.map((e,o)=>y?y(e,o):O(ke,{key:o,theme:r.peers.Tag,themeOverrides:r.peerOverrides.Tag,style:p,type:g,round:b,size:C,color:x,closable:F,disabled:m,onClose:()=>D(o)},{default:()=>typeof e=="string"?e:e.label})).concat(t?i.input?i.input({submit:A,deactivate:h}):O(J,Object.assign({placeholder:"",size:I,style:U,autosize:!0},this.inputProps,{ref:"inputInstRef",value:B,onUpdateValue:e=>{this.inputValue=e},theme:r.peers.Input,themeOverrides:r.peerOverrides.Input,onKeyup:$,onBlur:h,internalForceFocus:R})):i.trigger?i.trigger({activate:w,disabled:S}):O(Ae,{dashed:!0,disabled:S,theme:r.peers.Button,themeOverrides:r.peerOverrides.Button,size:I,onClick:w},{icon:()=>O(Oe,{clsPrefix:v},{default:()=>O(ze,null)})}))}})}}),De={},Pe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},Me=E("g",{fill:"none"},[E("path",{d:"M3 5.5A2.5 2.5 0 0 1 5.5 3h9A2.5 2.5 0 0 1 17 5.5v9a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 3 14.5v-9zM4.5 7v7.5a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V7h-11z",fill:"currentColor"})],-1),Ee=[Me];function Ne(a,c){return G(),re("svg",Pe,Ee)}const je=ie(De,[["render",Ne]]),Le=["id"],He=["title"],Ke=["title"],Wt=W({__name:"MarkdownEditorView",setup(a){const c=ue(),v=me(),_=ce();c.start();const y=l(()=>v.params.value),r=l(()=>v.query.new);H(r,()=>{r.value&&c.finish()});const p=f(30023),{addressPointer:g,line:b,longFormContentOptions:C,event:x}=ve(y),F=Ce(),m=l(()=>{var n;if(Boolean(g.value))return g.value;const s={identifier:pe(),pubkey:(n=F.value)!=null?n:"",kind:p.value,relays:[]};return setTimeout(()=>{_.push({name:"markdown-editor",params:{value:K.naddrEncode(s)},query:{new:"1"}})}),s});m.value;const t=f({content:"",title:"",publishedAt:fe(),summary:"",image:"",hashtags:[]});H(C,()=>{const s=t.value,n=C.value;if(n){setTimeout(()=>{c.finish()});for(const[T,V]of Object.entries(n))s[T]=V}},{deep:!0,immediate:!0});const B=l(()=>["title",t.value.title]),U=l(()=>["published_at",String(t.value.publishedAt)]),I=l(()=>["summary",t.value.summary]),R=l(()=>["image",t.value.image]),S=l(()=>["a",`${m.value.kind}:${m.value.pubkey}:${m.value.identifier}`]),$=l(()=>["d",m.value.identifier]),h=l(()=>be({kind:p.value,content:t.value.content,tags:[$.value,B.value,U.value,I.value,R.value,S.value,...t.value.hashtags.map(s=>["t",s])]})),w=f(),D=he(),A=async(s,n)=>{var V;const T=await D(n);T.url,(V=w.value)==null||V.$img2Url(s,T.url)},i=we(p.value,b,void 0);function e(s){t.value.content=s,i(h.value)}const o=f(!1);setTimeout(()=>o.value=!0);const k=ye();function N(){const s=K.naddrEncode(m.value);k(s)}return(s,n)=>{const T=xe,V=J,X=$e,Y=Q;return G(),de(te,null,{default:z(({id:Z})=>[E("div",{class:"h-full w-full",id:Z},[d(ge,{ref_key:"md",ref:w,class:"h-full",onImgAdd:A,onSave:e,modelValue:t.value.content,"onUpdate:modelValue":n[1]||(n[1]=u=>t.value.content=u)},{"right-toolbar-after":z(()=>[E("button",{type:"button",onClick:N,class:"op-icon","aria-hidden":"true",title:`${P(M)("copy")}naddr`},[d(T,null,{default:z(()=>[d(ne)]),_:1})],8,He),E("button",{type:"button",onClick:n[0]||(n[0]=()=>o.value=!o.value),class:"op-icon","aria-hidden":"true",title:P(M)("edit")},[d(T,null,{default:z(()=>[d(je)]),_:1})],8,Ke)]),_:1},8,["modelValue"]),d(ee,{show:o.value,"onUpdate:show":n[6]||(n[6]=u=>o.value=u),closable:"",height:"100%"},{default:z(()=>[d(Y,{vertical:""},{default:z(()=>[d(_e,{class:"w-full",placeholder:P(M)("banner"),value:t.value.image,"onUpdate:value":n[2]||(n[2]=u=>t.value.image=u)},null,8,["placeholder","value"]),d(V,{placeholder:P(M)("title"),value:t.value.title,"onUpdate:value":n[3]||(n[3]=u=>t.value.title=u),class:"w-full"},null,8,["placeholder","value"]),d(V,{placeholder:P(M)("summary"),value:t.value.summary,"onUpdate:value":n[4]||(n[4]=u=>t.value.summary=u)},null,8,["placeholder","value"]),d(X,{value:t.value.hashtags,"onUpdate:value":n[5]||(n[5]=u=>t.value.hashtags=u)},null,8,["value"])]),_:1})]),_:1},8,["show"])],8,Le)]),_:1})}}});export{Wt as default};
