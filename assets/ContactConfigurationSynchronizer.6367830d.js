import{b as l}from"./NaddrLink.vue_vue_type_script_setup_true_lang.ac9bb804.js";import{a as c,T as g}from"./nostr.754d0882.js";import{ao as u,av as C,al as h,aC as d,i as v,j as y}from"./use.1e6bcf04.js";import{t as S}from"./Papaw.58818fc9.js";import{R as E,l as D}from"./Provides.79af8a6c.js";import{g as P}from"./error.32f9621f.js";import{ae as b}from"./index.1b90d9b0.js";import"./nostr.5da3da54.js";import"./nostr.1ed837f5.js";import"./createEventSourceTracers.70279edb.js";import"./Staff.e039c64f.js";import"./Markdown.65b67b2d.js";import"./RegExpUtils.5e225811.js";import"./utils.6eaabb91.js";import"./is-browser.21659b45.js";import"./Scrollbar.d017889b.js";import"./use-rtl.e3f5641a.js";import"./cssr.ebdd28c2.js";import"./use-css-vars-class.2322281d.js";import"./fade-in-scale-up.cssr.769ecc19.js";import"./use-locale.d88a40dd.js";import"./Loading.68c8fb32.js";import"./use-style.d41c90c3.js";import"./Follower.46005694.js";import"./Icon.8b94fe05.js";import"./replaceable.3760d7d0.js";import"./Button.426eb201.js";import"./create-key.7b548031.js";import"./Tooltip.e97f4bd5.js";import"./Popover.52f6051a.js";import"./format-length.3612bbc8.js";import"./Card.0e05d980.js";import"./index.62f1e1b0.js";import"./keysOf.8a025f7e.js";import"./Close.89e6ef62.js";import"./Close.dda15693.js";import"./Icon.d35ca04d.js";import"./Empty.36cca092.js";import"./UserLink.vue_vue_type_script_setup_true_lang.f1185f1f.js";import"./RelayAddButton.vue_vue_type_script_setup_true_lang.309f50bc.js";import"./RelayConnectList.vue_vue_type_script_setup_true_lang.fc5e4822.js";import"./RelayInfoView.f4d9e053.js";import"./Ellipsis.d8aa1f93.js";import"./use-theme-vars.726be0e1.js";import"./ListItem.9baa61b5.js";import"./MavonEditor.0c88b495.js";import"./Tag.6048a194.js";import"./Space.233e452c.js";import"./get-slot.4ceacf82.js";import"./DrawerProvide.vue_vue_type_script_setup_true_lang.c46f8d3c.js";import"./DrawerContent.f946858a.js";import"./index.71604e6f.js";import"./Scrollbar.2eeae0bc.js";import"./LoadProgress.6869a86c.js";import"./Scrollbar.b84961bc.js";import"./fade-in-height-expand.cssr.b76b5d75.js";import"./naiveUi.c6ae432d.js";import"./composables.d23d34d7.js";import"./Input.6cd78f60.js";import"./nostrApiUse.7176aa1b.js";import"./login.8c6c9b27.js";import"./ContentBlacklistView.6132c1d6.js";import"./Dropdown.03a74dd4.js";import"./render.71a5584a.js";import"./create.2deeaf6a.js";import"./profile-2-400x400.3309f571.js";import"./CategorizedBookmarksSynchronizer.f736dfa7.js";import"./SynchronizerAbstract.c6a8e83e.js";import"./Checkbox.945c7e6c.js";import"./PubkeyLink.vue_vue_type_script_setup_true_lang.c1e7529b.js";import"./RadioGroup.f63f3c90.js";import"./injectWindowNostr.2511c350.js";import"./NostrConnect.c31e5415.js";import"./Upload.b824065e.js";import"./Warning.c5444fa8.js";import"./Add.90e13d8d.js";import"./Upload.e47722e1.js";import"./Modal.e04e8a07.js";import"./omit.ef9bf2ca.js";var w=Object.defineProperty,_=Object.getOwnPropertyDescriptor,j=(t,o,a,e)=>{for(var i=e>1?void 0:e?_(o,a):o,r=t.length-1,n;r>=0;r--)(n=t[r])&&(i=(e?n(o,a,i):n(i))||i);return e&&i&&w(o,a,i),i},O=(t,o)=>(a,e)=>o(a,e,t);let f=class extends E{constructor(t){super("ContactConfiguration"),this.userApi=t,D.verbose("new ContactConfiguration()")}createDefault(){return{contactConfiguration:{},channelConfiguration:new Map}}async getFilters(){const t=await P();return t?[{kinds:[3],authors:[t]}]:[]}async serializeToData(t){const o={},a=u(t.tags);for(const{name:r,pubkey:n,relayUrl:s}of a)o[n]={name:r,pubkey:n,relayUrl:s};const e=new Map,i=C(t.tags);for(const r of i){const n=c.createChild().addFilter({kinds:[41],"#e":[r.eventId]}).addFilter({ids:[r.eventId],kinds:[40]}).addStaff(h()).addStaff(S());n.feat.onHasLatestEvent(s=>{Object.assign(r,s)}),n.addExtends(c),e.set(r.eventId,r)}return{contactConfiguration:o,channelConfiguration:e}}getContactConfiguration(){return this.getDataSync().contactConfiguration}async deserializeToEvent(t,o){const a=t.contactConfiguration,e=Object.entries(a).map(([n,{name:s,relayUrl:p}])=>["p",n,p,s].filter(Boolean)),i=t.channelConfiguration,r=d(Array.from(i.entries(),([n,s])=>s));return l({kind:3,tags:[...e,...r],created_at:o})}getChannelConfiguration(){return this.getDataSync().channelConfiguration}getChannelList(){return Array.from(this.getChannelConfiguration()).map(([t,o])=>o)}follow(t,o,a){if(!t)return;const e=this.getDataSync().contactConfiguration,i=e[t]={pubkey:t,name:a!=null?a:"",relayUrl:o!=null?o:""};this.toChanged();const r=this.userApi.getUserMetadataLineByPubkey(t),n=b((s,p)=>{if(Object.assign(i,s),s.relayUrls&&s.relayUrls.length>0)i.relayUrl=s.relayUrls[0];else{const m=r.getUrlBySubId(p!=null?p:"");m&&(i.relayUrl=m)}});this.save(),r.feat.onHasMetadata(n)}unFollow(t){if(!t)return;const o=this.getDataSync().contactConfiguration;o[t]!==void 0&&(this.toChanged(),delete o[t],this.save())}isFollow(t){return Boolean(this.getDataSync().contactConfiguration[t])}};f=j([v(),O(0,y(g.UserApi))],f);export{f as ContactConfigurationSynchronizer};
