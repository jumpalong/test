import{b as l}from"./NaddrLink.vue_vue_type_script_setup_true_lang.e9edc141.js";import{a as c,T as g}from"./nostr.c03670ae.js";import{ao as u,av as C,al as h,aC as d,i as v,j as y}from"./use.b23b6c29.js";import{t as S}from"./Papaw.635c4eff.js";import{R as E,l as D}from"./Provides.b6aac14f.js";import{g as P}from"./error.469adc75.js";import{ae as b}from"./index.8f62a545.js";import"./nostr.0043d5e6.js";import"./nostr.ad89cf30.js";import"./createEventSourceTracers.1da380d1.js";import"./Staff.e039c64f.js";import"./Markdown.05f716d1.js";import"./RegExpUtils.102c01f0.js";import"./utils.e1137b57.js";import"./is-browser.f4df612e.js";import"./Scrollbar.8d5a1903.js";import"./use-rtl.6d35c504.js";import"./cssr.21c6f8e2.js";import"./use-css-vars-class.1ada0b07.js";import"./fade-in-scale-up.cssr.5ebe4351.js";import"./use-locale.cbb1f83b.js";import"./Loading.0b953150.js";import"./use-style.d8216a24.js";import"./Follower.7ba57362.js";import"./Icon.1c3d6ebf.js";import"./replaceable.815b8f5c.js";import"./Button.22997a19.js";import"./create-key.7b548031.js";import"./Tooltip.d86a0762.js";import"./Popover.6590eae2.js";import"./format-length.3612bbc8.js";import"./Card.6e48fdd4.js";import"./index.62f1e1b0.js";import"./keysOf.8a025f7e.js";import"./Close.dba1bcea.js";import"./Close.7d56270d.js";import"./Icon.904bc99e.js";import"./Empty.81d9c633.js";import"./UserLink.vue_vue_type_script_setup_true_lang.0cad1bf3.js";import"./RelayAddButton.vue_vue_type_script_setup_true_lang.03e333cd.js";import"./RelayConnectList.vue_vue_type_script_setup_true_lang.2443e1f7.js";import"./RelayInfoView.0394eae9.js";import"./Ellipsis.021c946e.js";import"./use-theme-vars.c704e62a.js";import"./ListItem.5a517004.js";import"./MavonEditor.aa4b0597.js";import"./Tag.7e30ed31.js";import"./Space.32f062de.js";import"./get-slot.4ceacf82.js";import"./DrawerProvide.vue_vue_type_script_setup_true_lang.da186b5d.js";import"./DrawerContent.bb261013.js";import"./index.71604e6f.js";import"./Scrollbar.c7e90ffe.js";import"./LoadProgress.a8e5dee8.js";import"./Scrollbar.75edf2b0.js";import"./fade-in-height-expand.cssr.a4865c47.js";import"./naiveUi.02e209d9.js";import"./composables.10bdf172.js";import"./Input.90533fe2.js";import"./nostrApiUse.43d55506.js";import"./login.0b8718d8.js";import"./ContentBlacklistView.1f898a24.js";import"./Dropdown.09a70bb4.js";import"./render.568a1ab1.js";import"./create.2deeaf6a.js";import"./profile-2-400x400.3309f571.js";import"./CategorizedBookmarksSynchronizer.87c6986d.js";import"./SynchronizerAbstract.b6083252.js";import"./Checkbox.fc71365b.js";import"./PubkeyLink.vue_vue_type_script_setup_true_lang.1d1b2ee1.js";import"./RadioGroup.b3ff4b7f.js";import"./injectWindowNostr.759c669e.js";import"./NostrConnect.ef90b4f4.js";import"./Upload.39a290a3.js";import"./Warning.6502c178.js";import"./Add.d66e299e.js";import"./Upload.b5c9ebfa.js";import"./Modal.2a8cd6ad.js";import"./omit.ef9bf2ca.js";var w=Object.defineProperty,_=Object.getOwnPropertyDescriptor,j=(t,o,a,e)=>{for(var i=e>1?void 0:e?_(o,a):o,r=t.length-1,n;r>=0;r--)(n=t[r])&&(i=(e?n(o,a,i):n(i))||i);return e&&i&&w(o,a,i),i},O=(t,o)=>(a,e)=>o(a,e,t);let f=class extends E{constructor(t){super("ContactConfiguration"),this.userApi=t,D.verbose("new ContactConfiguration()")}createDefault(){return{contactConfiguration:{},channelConfiguration:new Map}}async getFilters(){const t=await P();return t?[{kinds:[3],authors:[t]}]:[]}async serializeToData(t){const o={},a=u(t.tags);for(const{name:r,pubkey:n,relayUrl:s}of a)o[n]={name:r,pubkey:n,relayUrl:s};const e=new Map,i=C(t.tags);for(const r of i){const n=c.createChild().addFilter({kinds:[41],"#e":[r.eventId]}).addFilter({ids:[r.eventId],kinds:[40]}).addStaff(h()).addStaff(S());n.feat.onHasLatestEvent(s=>{Object.assign(r,s)}),n.addExtends(c),e.set(r.eventId,r)}return{contactConfiguration:o,channelConfiguration:e}}getContactConfiguration(){return this.getDataSync().contactConfiguration}async deserializeToEvent(t,o){const a=t.contactConfiguration,e=Object.entries(a).map(([n,{name:s,relayUrl:p}])=>["p",n,p,s].filter(Boolean)),i=t.channelConfiguration,r=d(Array.from(i.entries(),([n,s])=>s));return l({kind:3,tags:[...e,...r],created_at:o})}getChannelConfiguration(){return this.getDataSync().channelConfiguration}getChannelList(){return Array.from(this.getChannelConfiguration()).map(([t,o])=>o)}follow(t,o,a){if(!t)return;const e=this.getDataSync().contactConfiguration,i=e[t]={pubkey:t,name:a!=null?a:"",relayUrl:o!=null?o:""};this.toChanged();const r=this.userApi.getUserMetadataLineByPubkey(t),n=b((s,p)=>{if(Object.assign(i,s),s.relayUrls&&s.relayUrls.length>0)i.relayUrl=s.relayUrls[0];else{const m=r.getUrlBySubId(p!=null?p:"");m&&(i.relayUrl=m)}});this.save(),r.feat.onHasMetadata(n)}unFollow(t){if(!t)return;const o=this.getDataSync().contactConfiguration;o[t]!==void 0&&(this.toChanged(),delete o[t],this.save())}isFollow(t){return Boolean(this.getDataSync().contactConfiguration[t])}};f=j([v(),O(0,y(g.UserApi))],f);export{f as ContactConfigurationSynchronizer};
