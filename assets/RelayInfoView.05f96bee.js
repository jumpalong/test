import{_ as T}from"./PubkeyLink.vue_vue_type_script_setup_true_lang.c1e7529b.js";import{f as M,an as O,k as v,N as A,af as B,o,z as i,m as u,w as a,l as w,v as y,x as d,n as _,y as s,F as N,A as P,au as U,D as q,ac as I,C as p}from"./index.1b90d9b0.js";import{_ as J,a as G}from"./RelayInfoView.f4d9e053.js";import{u as H}from"./composables.d23d34d7.js";import{_ as K}from"./Space.233e452c.js";import{_ as Q}from"./Result.bf419f37.js";import{_ as W}from"./Card.0e05d980.js";import{_ as X}from"./Tree.60d30374.js";import{_ as Y}from"./Tag.6048a194.js";import"./nostr.754d0882.js";import"./nostr.5da3da54.js";import"./use.1e6bcf04.js";import"./Staff.e039c64f.js";import"./nostr.1ed837f5.js";import"./Button.426eb201.js";import"./use-rtl.e3f5641a.js";import"./is-browser.21659b45.js";import"./Loading.68c8fb32.js";import"./use-style.d41c90c3.js";import"./create-key.7b548031.js";import"./use-css-vars-class.2322281d.js";import"./Scrollbar.d017889b.js";import"./cssr.ebdd28c2.js";import"./index.62f1e1b0.js";import"./get-slot.4ceacf82.js";import"./Icon.8b94fe05.js";import"./Warning.c5444fa8.js";import"./replaceable.3760d7d0.js";import"./keysOf.8a025f7e.js";import"./Close.89e6ef62.js";import"./Close.dda15693.js";import"./Checkbox.945c7e6c.js";import"./render.71a5584a.js";import"./create.2deeaf6a.js";import"./fade-in-height-expand.cssr.b76b5d75.js";import"./VirtualList.11936635.js";import"./Empty.36cca092.js";import"./use-locale.d88a40dd.js";const Z={key:0,size:"large"},ee=U("div",{class:"h-[80vh]"},null,-1),te={key:2},re={key:0},oe={key:0},ne={key:1},Ie=M({__name:"RelayInfoView",setup(ae){const{error:$}=O(),x=H(),D=q(),m=v(()=>{const e=D.params.url;if(e){const t=new URL(e);return t.protocol="http://",t.toString()}return e}),c=A(null),r=A(null);B(m,async()=>{c.value=null,E().then(e=>{r.value=e}).catch(e=>{c.value=e})},{immediate:!0});async function E(){if(!m.value)return null;const e="https://cors-anywhere.herokuapp.com/";return await I(`fetch:${e}${m.value}:get:application/nostr+json`,async()=>await fetch(`${e}${m.value}`,{headers:{accept:"application/nostr+json"}}).then(t=>t.text()).then(t=>{try{return JSON.parse(t)}catch{return t.includes("/corsdemo")&&($(t,{duration:2e5,closable:!0}),x.warning({title:p("warning"),content:p("relay_info_view_verified"),positiveText:p("yes"),negativeText:p("no"),onPositiveClick:()=>{window.open("https://cors-anywhere.herokuapp.com/corsdemo")},onNegativeClick:()=>{}})),Promise.reject(t)}}),{cacheError:!1})}const g=G();B(r,()=>{var t;const e=(t=r.value)==null?void 0:t.supported_nips;e&&e.forEach(n=>{g.value.add(n)})});const L=v(()=>{var e;return new Set((e=r.value)==null?void 0:e.supported_nips)});function S(e){const t=`https://github.com/nostr-protocol/nips/blob/master/${e.toString().padStart(2,"0")}.md`;window.open(t)}const j=v(()=>k(r.value));function k(e){return e?Array.isArray(e)?e.map(t=>({whateverLabel:t,whateverKey:t})):typeof e=="object"?Object.entries(e).map(([t,n])=>typeof n=="string"||typeof n=="number"?{whateverLabel:`${t}: ${n}`,whateverKey:t}:{whateverLabel:t,whateverKey:t,whateverChildren:k(n)}):[]:[]}return(e,t)=>{const n=J,f=K,V=Q,h=W,z=Y,R=X;return o(),i(N,null,[c.value===null&&!r.value?(o(),i("div",Z,[u(f,{vertical:""},{default:a(()=>[c.value===null&&!r.value?(o(),w(n,{key:0,size:"large"},{description:a(()=>[y(d(_(p)("loading")),1)]),default:a(()=>[ee]),_:1})):s("",!0)]),_:1})])):s("",!0),c.value?(o(),w(V,{key:1,status:"404",title:`404 ${_(p)("resource_does_not_exist")}`,description:"\u751F\u6D3B\u603B\u5F52\u5E26\u70B9\u8352\u8C2C"},null,8,["title"])):s("",!0),r.value?(o(),i("div",te,[u(f,{vertical:""},{default:a(()=>{var F;return[r.value.name?(o(),i("h1",re,d((F=r.value)==null?void 0:F.name),1)):s("",!0),u(h,{title:"\u57FA\u672C\u4FE1\u606F"},{default:a(()=>{var l,C,b;return[(l=r.value)!=null&&l.description?(o(),i("p",oe,"\u63CF\u8FF0 \uFF1A"+d((C=r.value)==null?void 0:C.description),1)):s("",!0),(b=r.value)!=null&&b.pubkey?(o(),i("p",ne,[y(" \u7BA1\u7406\u8005 \uFF1A"),u(T,{pubkey:r.value.pubkey},null,8,["pubkey"])])):s("",!0)]}),_:1}),u(h,{title:"\u652F\u6301\u7684nip\u60C5\u51B5"},{default:a(()=>[u(f,null,{default:a(()=>[(o(!0),i(N,null,P(_(g),l=>(o(),w(z,{bordered:!1,type:_(L).has(l)?"success":"error",onClick:()=>S(l)},{default:a(()=>[y(" nip-"+d(l),1)]),_:2},1032,["type","onClick"]))),256))]),_:1})]),_:1}),u(h,{title:"\u66F4\u591A\u4FE1\u606F"},{default:a(()=>[u(R,{"block-line":"",data:_(j),"key-field":"whateverKey","label-field":"whateverLabel","children-field":"whateverChildren",selectable:""},null,8,["data"])]),_:1})]}),_:1})])):s("",!0)],64)}}});export{Ie as default};
