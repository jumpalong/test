var s=Object.defineProperty;var e=(p,o,t)=>o in p?s(p,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[o]=t;var m=(p,o,t)=>(e(p,typeof o!="symbol"?o+"":o,t),t);import{g as c}from"./error.32f9621f.js";import{b as g}from"./NaddrLink.vue_vue_type_script_setup_true_lang.ac9bb804.js";import{o as n}from"./use.1e6bcf04.js";import{R as u}from"./Provides.79af8a6c.js";import"./nostr.754d0882.js";import"./index.1b90d9b0.js";import"./login.8c6c9b27.js";import"./nostr.1ed837f5.js";import"./nostr.5da3da54.js";import"./createEventSourceTracers.70279edb.js";import"./Staff.e039c64f.js";import"./Markdown.65b67b2d.js";import"./CategorizedBookmarksSynchronizer.f736dfa7.js";import"./SynchronizerAbstract.c6a8e83e.js";import"./Papaw.58818fc9.js";import"./RegExpUtils.5e225811.js";import"./utils.6eaabb91.js";import"./is-browser.21659b45.js";import"./Scrollbar.d017889b.js";import"./use-rtl.e3f5641a.js";import"./cssr.ebdd28c2.js";import"./use-css-vars-class.2322281d.js";import"./fade-in-scale-up.cssr.769ecc19.js";import"./use-locale.d88a40dd.js";import"./Loading.68c8fb32.js";import"./use-style.d41c90c3.js";import"./Follower.46005694.js";import"./Icon.8b94fe05.js";import"./replaceable.3760d7d0.js";import"./Button.426eb201.js";import"./create-key.7b548031.js";import"./Tooltip.e97f4bd5.js";import"./Popover.52f6051a.js";import"./format-length.3612bbc8.js";import"./Card.0e05d980.js";import"./index.62f1e1b0.js";import"./keysOf.8a025f7e.js";import"./Close.89e6ef62.js";import"./Close.dda15693.js";import"./Icon.d35ca04d.js";import"./Empty.36cca092.js";import"./UserLink.vue_vue_type_script_setup_true_lang.f1185f1f.js";import"./RelayAddButton.vue_vue_type_script_setup_true_lang.309f50bc.js";import"./RelayConnectList.vue_vue_type_script_setup_true_lang.fc5e4822.js";import"./RelayInfoView.f4d9e053.js";import"./Ellipsis.d8aa1f93.js";import"./use-theme-vars.726be0e1.js";import"./ListItem.9baa61b5.js";import"./MavonEditor.0c88b495.js";import"./Tag.6048a194.js";import"./Space.233e452c.js";import"./get-slot.4ceacf82.js";import"./DrawerProvide.vue_vue_type_script_setup_true_lang.c46f8d3c.js";import"./DrawerContent.f946858a.js";import"./index.71604e6f.js";import"./Scrollbar.2eeae0bc.js";import"./LoadProgress.6869a86c.js";import"./Scrollbar.b84961bc.js";import"./fade-in-height-expand.cssr.b76b5d75.js";import"./naiveUi.c6ae432d.js";import"./composables.d23d34d7.js";import"./Input.6cd78f60.js";import"./nostrApiUse.7176aa1b.js";import"./ContentBlacklistView.6132c1d6.js";import"./Dropdown.03a74dd4.js";import"./render.71a5584a.js";import"./create.2deeaf6a.js";import"./profile-2-400x400.3309f571.js";import"./Checkbox.945c7e6c.js";import"./PubkeyLink.vue_vue_type_script_setup_true_lang.c1e7529b.js";import"./RadioGroup.f63f3c90.js";import"./injectWindowNostr.2511c350.js";import"./NostrConnect.c31e5415.js";import"./Upload.b824065e.js";import"./Warning.c5444fa8.js";import"./Add.90e13d8d.js";import"./Upload.e47722e1.js";import"./Modal.e04e8a07.js";import"./omit.ef9bf2ca.js";class Ft extends u{constructor(){super("PinListSync");m(this,"kind",10001)}createDefault(){return{tagMap:new Map}}async getFilters(){const t=await c();return t?[{authors:[t],kinds:[this.kind]}]:[]}async serializeToData(t){const i=new Map;for(const r of t.tags)i.set(JSON.stringify(r),r);return{tagMap:i}}async deserializeToEvent(t,i){return await g({tags:[...t.tagMap.values()],created_at:i,kind:this.kind})}getPinListSync(){return this.getDataSync()}createPinTag(t){const i=t.kind;if(i===0)return["p",t.pubkey];if(i===1)return["e",t.id];if(i>=3e4&&i<=39999){const r=n("a",t.tags);if(r)return r;const a=n("d",t.tags);return a&&a[1]?["a",`${t.kind}:${t.pubkey}:${a[1]}`]:null}else return["e",t.id]}has(t){return this.getPinListSync().tagMap.has(JSON.stringify(t))}hasByEvent(t){const i=this.createPinTag(t);return i?this.getPinListSync().tagMap.has(JSON.stringify(i)):!1}addPin(t){this.getPinListSync().tagMap.set(JSON.stringify(t),t)}removePin(t){this.getPinListSync().tagMap.delete(JSON.stringify(t))}async pin(t,i){const r=this.createPinTag(t);!r||this.has(r)||(this.addPin(r),this.toChanged(),await this.save(i))}async unpin(t,i){const r=this.createPinTag(t);!r||!this.has(r)||(this.removePin(r),this.toChanged(),await this.save(i))}}export{Ft as PinListSynchronizer};
