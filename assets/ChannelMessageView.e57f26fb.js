import{aJ as F,o as p,z as y,au as f,N as W,am as Y,af as K,an as N,f as A,aL as Q,l as d,n as r,k as s,_ as X,w as m,m as u,y as h,v as Z,x as ee,D as te,C as v,bn as ne}from"./index.1b90d9b0.js";import{_ as oe}from"./PapawList.vue_vue_type_script_setup_true_lang.b771e1a5.js";import{b as re,F as ae,q as $,v as se}from"./use.1e6bcf04.js";import{T as B}from"./nostr.754d0882.js";import{a as ie}from"./LoadProgress.6869a86c.js";import{u as le}from"./Papaw.58818fc9.js";import{_ as ue}from"./RichTextEditBox.vue_vue_type_script_setup_true_lang.e3cb5e5e.js";import{S as ce}from"./Scrollbar.2eeae0bc.js";import{u as me}from"./naiveUi.c6ae432d.js";import{e as pe}from"./nostr.5da3da54.js";import{a as fe}from"./nostrApiUse.7176aa1b.js";import{n as _e}from"./nostr.1ed837f5.js";import{_ as he}from"./PageHeader.84a84ce5.js";import{N as ve}from"./Icon.d35ca04d.js";import{_ as de}from"./Button.426eb201.js";import"./Staff.e039c64f.js";import"./RegExpUtils.5e225811.js";import"./utils.6eaabb91.js";import"./is-browser.21659b45.js";import"./Scrollbar.d017889b.js";import"./use-rtl.e3f5641a.js";import"./cssr.ebdd28c2.js";import"./use-css-vars-class.2322281d.js";import"./fade-in-scale-up.cssr.769ecc19.js";import"./use-locale.d88a40dd.js";import"./Loading.68c8fb32.js";import"./use-style.d41c90c3.js";import"./Follower.46005694.js";import"./Icon.8b94fe05.js";import"./replaceable.3760d7d0.js";import"./Tooltip.e97f4bd5.js";import"./Popover.52f6051a.js";import"./format-length.3612bbc8.js";import"./createEventSourceTracers.70279edb.js";import"./Card.0e05d980.js";import"./create-key.7b548031.js";import"./index.62f1e1b0.js";import"./keysOf.8a025f7e.js";import"./Close.89e6ef62.js";import"./Close.dda15693.js";import"./NaddrLink.vue_vue_type_script_setup_true_lang.ac9bb804.js";import"./error.32f9621f.js";import"./login.8c6c9b27.js";import"./Markdown.65b67b2d.js";import"./Empty.36cca092.js";import"./UserLink.vue_vue_type_script_setup_true_lang.f1185f1f.js";import"./RelayAddButton.vue_vue_type_script_setup_true_lang.309f50bc.js";import"./RelayConnectList.vue_vue_type_script_setup_true_lang.fc5e4822.js";import"./RelayInfoView.f4d9e053.js";import"./Ellipsis.d8aa1f93.js";import"./use-theme-vars.726be0e1.js";import"./ListItem.9baa61b5.js";import"./MavonEditor.0c88b495.js";import"./Tag.6048a194.js";import"./Space.233e452c.js";import"./get-slot.4ceacf82.js";import"./DrawerProvide.vue_vue_type_script_setup_true_lang.c46f8d3c.js";import"./DrawerContent.f946858a.js";import"./index.71604e6f.js";import"./fade-in-height-expand.cssr.b76b5d75.js";import"./ContentBlacklistView.6132c1d6.js";import"./Input.6cd78f60.js";import"./Dropdown.03a74dd4.js";import"./render.71a5584a.js";import"./create.2deeaf6a.js";import"./profile-2-400x400.3309f571.js";import"./Result.bf419f37.js";import"./Warning.c5444fa8.js";import"./Tabs.0f3bfb7a.js";import"./Add.90e13d8d.js";import"./omit.ef9bf2ca.js";import"./Close.accddb8c.js";import"./SelectMenu.f15b4eaf.js";import"./Checkmark.c34e0225.js";import"./VirtualList.11936635.js";import"./Upload.b824065e.js";import"./UploadButton.vue_vue_type_script_setup_true_lang.446f5e11.js";import"./CloudUpload.1c386f41.js";import"./Upload.e47722e1.js";import"./Scrollbar.b84961bc.js";import"./composables.d23d34d7.js";const ge={},Ce={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 512 512","enable-background":"new 0 0 512 512","xml:space":"preserve"},we=f("g",null,[f("g",null,[f("path",{d:`M383.822,344.427c-16.045,0-31.024,5.326-41.721,15.979l-152.957-88.42c1.071-5.328,2.142-9.593,2.142-14.919\r
			c0-5.328-1.071-9.593-2.142-14.919l150.826-87.35c11.762,10.653,26.741,17.041,43.852,17.041c35.295,0,64.178-28.766,64.178-63.92\r
			C448,72.767,419.117,44,383.822,44c-35.297,0-64.179,28.767-64.179,63.92c0,5.327,1.065,9.593,2.142,14.919l-150.821,87.35\r
			c-11.767-10.654-26.741-17.041-43.856-17.041c-35.296,0-63.108,28.766-63.108,63.92c0,35.153,28.877,63.92,64.178,63.92\r
			c17.115,0,32.089-6.389,43.856-17.042l151.891,88.421c-1.076,4.255-2.141,8.521-2.141,13.847\r
			c0,34.094,27.806,61.787,62.037,61.787c34.229,0,62.036-27.693,62.036-61.787C445.858,372.12,418.052,344.427,383.822,344.427z`})])],-1),xe=[we];function ke(a,o){return p(),y("svg",Ce,xe)}const Be=F(ge,[["render",ke]]),ye={},Le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 576 512"},be=f("path",{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z",fill:"currentColor"},null,-1),Se=[be];function Ee(a,o){return p(),y("svg",Le,Se)}const De=F(ye,[["render",Ee]]);function Me(a){const o=re(),i=W(!0),t=()=>{i.value=!1};for(const n of["scroll","touchmove"])Y(o==null?void 0:o.containerRef,n,t,{once:!0});const c=K(()=>{var n;return(n=a.value)==null?void 0:n.length},()=>{var n;i.value?(n=o==null?void 0:o.scrollbarInst.value)==null||n.scrollBy({top:99999,behavior:"smooth"}):c()})}function $e(a){const o=ae(),i=N();function t(){return o.get(B.FollowChannelSynchronizer)}function c(){!a.value||(t().joinChannel(a.value),i.info("\u5DF2\u63D0\u4EA4\u52A0\u5165\u7FA4\u804A\u7684\u8BF7\u6C42"))}function n(){!a.value||(t().leaveChannel(a.value),i.info("\u5DF2\u7ECF\u63D0\u4EA4\u4E86\u79BB\u5F00\u7FA4\u804A\u7684\u8BF7\u6C42"))}return{handleJoinChannel:c,handleLeaveChannel:n}}const Fe=A({__name:"ChannelMessageList",props:{eventList:null},emits:["eventDeletion"],setup(a,{emit:o}){const i=a,{eventList:t}=Q(i);return Me(t),(c,n)=>(p(),d(oe,{withPapawOptionsButtons:!1,eventList:r(t),onEventDeletion:n[0]||(n[0]=_=>o("eventDeletion",_))},null,8,["eventList"]))}}),Ne={key:0,class:"flex flex-col h-full overflow-auto"},Ae={class:"felx items-center justify-center"},un=A({__name:"ChannelMessageView",setup(a){const o=te(),i=s(()=>pe(o.params.value)),t=s(()=>{var e;return(e=i.value)==null?void 0:e.id}),c=$(B.FollowChannelSynchronizer);X(()=>{!t.value||le(t.value)});const n=s(()=>t.value?c.getData().get(t.value):void 0),_=$(B.CahnnelMessageBeltline),g=s(()=>{var e;return(e=n.value)==null?void 0:e.relayUrls}),l=s(()=>{if(!!t.value)return _.getChannelMessageBeltline(t.value,{urls:g.value})});ie(l),s(()=>l.value&&l.value.getList());const L=s(()=>t.value&&_.getChannelMetadataBeltlineByChannelId(t.value)),b=s(()=>L.value&&L.value.feat.useMetadata()),S=s(()=>{var e;if(!!t.value)return(e=n.value)==null?void 0:e.event}),E=N();function V(){var e;(e=l.value)==null||e.feat.refresh(),E.info(v("refreshing"))}function z(){var e;(e=l.value)==null||e.feat.load(),E.info(v("loading"))}setInterval(()=>{var e;(e=l.value)==null||e.feat.refresh()},15e3);const{handleJoinChannel:J,handleLeaveChannel:T}=$e(t);function j(){C.value?T():J()}const H=se(42,l);function P(e){var w;if(!!t.value){e.tags=[...e.tags,["e",t.value,"root"]];for(const x of(w=g.value)!=null?w:[])e.tags.push(["r",x]);H(e)}}const C=s(()=>t.value?c.hasJoin(t.value):!1),R=me();function D(){var e;if(!!t.value)return _e.neventEncode({id:t.value,relays:[...(e=g.value)!=null?e:[]]})}function O(){const e=D();!e||R(e)}function U(){const e=D();!e||ne.push({name:"edit-channel",params:{value:e}})}const q=fe();return(e,w)=>{const x=De,M=ve,k=de,G=Be,I=he;return r(t)?(p(),y("div",Ne,[r(b)?(p(),d(I,{key:0,class:"flex-shrink-0",subtitle:r(b).name,onBack:e.$router.back},{extra:m(()=>[f("div",Ae,[r(S)&&r(S).pubkey===r(q)?(p(),d(k,{key:0,class:"mr-2",round:"",onClick:U},{default:m(()=>[u(M,null,{default:m(()=>[u(x)]),_:1})]),_:1})):h("",!0),u(k,{class:"mr-2",round:"",onClick:O},{default:m(()=>[u(M,null,{default:m(()=>[u(G)]),_:1})]),_:1}),u(k,{round:"",type:r(C)?"default":"primary",onClick:j},{default:m(()=>[Z(ee(r(C)?r(v)("leave"):r(v)("join")),1)]),_:1},8,["type"])])]),_:1},8,["subtitle","onBack"])):h("",!0),u(ce,{class:"flex-shrink flex-1",loadable:"",refreshable:"",onLoad:V,onRefresh:z},{default:m(()=>[r(l)?(p(),d(Fe,{key:0,eventList:r(l).getList()},null,8,["eventList"])):h("",!0)]),_:1}),u(ue,{onSend:P})])):h("",!0)}}});export{un as default};
