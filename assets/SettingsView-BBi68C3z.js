var ni=Object.defineProperty;var ri=(r,e,n)=>e in r?ni(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var Te=(r,e,n)=>(ri(r,typeof e!="symbol"?e+"":e,n),n);import{aC as ai,b as J,c as S,a as I,d as L,aw as ii,ax as si,f as Xe,u as cn,g as Ke,aD as oi,L as q,k as P,N as vr,H as Vn,aE as Jt,I as li,h as E,T as ci,e as Wn,aF as di,l as Se,aG as ui,F as rn,_ as hi,o as D,B as an,E as fi,aH as Ye,aI as gi,aJ as pr,aK as W,aL as yr,aM as vi,aN as pe,aO as pi,aP as dn,aQ as yi,ar as mi,al as Gn,aR as bi,at as mr,av as br,aS as qn,as as wi,aT as wr,aU as Si,aV as Ei,aW as Sr,aX as ki,aY as un,aZ as Er,a_ as kr,a$ as Ci,b0 as xi,W as Cr,m as V,w as F,q as w,n as j,U as Zt,ag as Li,y as Jn,z as Zn,A as Ri,V as _i,C as Xn}from"./index-Bp8Ru9nj.js";import{D as p,H as Re,J as Ai,d as re,Z as Pi,G as Et,K as xr,L as mt,N as Lr,P as Rr,R as Ii,S as hn,U as _r,V as Ui,W as zi,Y as Ti,_ as Ar,a0 as Fi,a1 as Oi,a2 as Yn,a3 as Qn,a4 as Pr,u as Ir,a5 as Mi,a6 as Bi,a7 as Ni}from"./ProvideEventLine-XLCKst21.js";import{i as $i,c as Di}from"./utils-Bn9avYFz.js";import{b as $e,a as O,h as De,c as kt,s as fn,r as Ur,d as zr,e as ye,f as Ne,g as ne,u as Ki,i as Hi,j as ji,k as Vi,l as Tr,m as Wi,N as Gi}from"./hkdf-mSU36INM.js";import{u as qi}from"./use-rtl-gkSu3eK_.js";import{u as Ct}from"./use-css-vars-class-DV7GkkKb.js";import{f as er}from"./fade-in-scale-up.cssr-YaysNU6q.js";import{u as Fr,e as Ji,a as Zi,c as ke,i as tr,g as Xt,r as Ee,N as Xi,h as Yi}from"./Button-DF3Ei97P.js";import{a as Or,o as ht,b as ft}from"./Scrollbar-Bcd6cbpf.js";import{u as sn,V as Qi,a as es,b as ts}from"./Follower-BLKhK3H2.js";import{p as Yt,d as oe}from"./index-vZmvdULR.js";import{u as ns}from"./composables-Den7Xj81.js";import{N as rs}from"./InputNumber-XDaP2vrd.js";import{_ as as}from"./Input-uRxkwxbK.js";import{a as Mr,_ as is}from"./ListItem-aigzRhFW.js";import{N as Br}from"./Icon-BUbDyWQc.js";import{_ as ss}from"./PageHeader-BWtlB8rT.js";import{_ as os}from"./Space-D7Gj9TeE.js";import"./is-browser-Ki2-8vi-.js";import"./use-locale-DHyx6amc.js";import"./Icon-C2DldZ3i.js";import"./Add-b3eAxPp_.js";import"./replaceable-B2OdU2Vz.js";import"./format-length-B-p6aW7q.js";import"./get-slot-Bk_rJcZu.js";var gn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ls(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function nr(r){return window.TouchEvent&&r instanceof window.TouchEvent}function rr(){const r=new Map,e=n=>a=>{r.set(n,a)};return ai(()=>{r.clear()}),[r,e]}const cs=J([S("slider",`
 display: block;
 padding: calc((var(--n-handle-size) - var(--n-rail-height)) / 2) 0;
 position: relative;
 z-index: 0;
 width: 100%;
 cursor: pointer;
 user-select: none;
 -webkit-user-select: none;
 `,[I("reverse",[S("slider-handles",[S("slider-handle-wrapper",`
 transform: translate(50%, -50%);
 `)]),S("slider-dots",[S("slider-dot",`
 transform: translateX(50%, -50%);
 `)]),I("vertical",[S("slider-handles",[S("slider-handle-wrapper",`
 transform: translate(-50%, -50%);
 `)]),S("slider-marks",[S("slider-mark",`
 transform: translateY(calc(-50% + var(--n-dot-height) / 2));
 `)]),S("slider-dots",[S("slider-dot",`
 transform: translateX(-50%) translateY(0);
 `)])])]),I("vertical",`
 padding: 0 calc((var(--n-handle-size) - var(--n-rail-height)) / 2);
 width: var(--n-rail-width-vertical);
 height: 100%;
 `,[S("slider-handles",`
 top: calc(var(--n-handle-size) / 2);
 right: 0;
 bottom: calc(var(--n-handle-size) / 2);
 left: 0;
 `,[S("slider-handle-wrapper",`
 top: unset;
 left: 50%;
 transform: translate(-50%, 50%);
 `)]),S("slider-rail",`
 height: 100%;
 `,[L("fill",`
 top: unset;
 right: 0;
 bottom: unset;
 left: 0;
 `)]),I("with-mark",`
 width: var(--n-rail-width-vertical);
 margin: 0 32px 0 8px;
 `),S("slider-marks",`
 top: calc(var(--n-handle-size) / 2);
 right: unset;
 bottom: calc(var(--n-handle-size) / 2);
 left: 22px;
 font-size: var(--n-mark-font-size);
 `,[S("slider-mark",`
 transform: translateY(50%);
 white-space: nowrap;
 `)]),S("slider-dots",`
 top: calc(var(--n-handle-size) / 2);
 right: unset;
 bottom: calc(var(--n-handle-size) / 2);
 left: 50%;
 `,[S("slider-dot",`
 transform: translateX(-50%) translateY(50%);
 `)])]),I("disabled",`
 cursor: not-allowed;
 opacity: var(--n-opacity-disabled);
 `,[S("slider-handle",`
 cursor: not-allowed;
 `)]),I("with-mark",`
 width: 100%;
 margin: 8px 0 32px 0;
 `),J("&:hover",[S("slider-rail",{backgroundColor:"var(--n-rail-color-hover)"},[L("fill",{backgroundColor:"var(--n-fill-color-hover)"})]),S("slider-handle",{boxShadow:"var(--n-handle-box-shadow-hover)"})]),I("active",[S("slider-rail",{backgroundColor:"var(--n-rail-color-hover)"},[L("fill",{backgroundColor:"var(--n-fill-color-hover)"})]),S("slider-handle",{boxShadow:"var(--n-handle-box-shadow-hover)"})]),S("slider-marks",`
 position: absolute;
 top: 18px;
 left: calc(var(--n-handle-size) / 2);
 right: calc(var(--n-handle-size) / 2);
 `,[S("slider-mark",`
 position: absolute;
 transform: translateX(-50%);
 white-space: nowrap;
 `)]),S("slider-rail",`
 width: 100%;
 position: relative;
 height: var(--n-rail-height);
 background-color: var(--n-rail-color);
 transition: background-color .3s var(--n-bezier);
 border-radius: calc(var(--n-rail-height) / 2);
 `,[L("fill",`
 position: absolute;
 top: 0;
 bottom: 0;
 border-radius: calc(var(--n-rail-height) / 2);
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-fill-color);
 `)]),S("slider-handles",`
 position: absolute;
 top: 0;
 right: calc(var(--n-handle-size) / 2);
 bottom: 0;
 left: calc(var(--n-handle-size) / 2);
 `,[S("slider-handle-wrapper",`
 outline: none;
 position: absolute;
 top: 50%;
 transform: translate(-50%, -50%);
 cursor: pointer;
 display: flex;
 `,[S("slider-handle",`
 height: var(--n-handle-size);
 width: var(--n-handle-size);
 border-radius: 50%;
 overflow: hidden;
 transition: box-shadow .2s var(--n-bezier), background-color .3s var(--n-bezier);
 background-color: var(--n-handle-color);
 box-shadow: var(--n-handle-box-shadow);
 `,[J("&:hover",`
 box-shadow: var(--n-handle-box-shadow-hover);
 `)]),J("&:focus",[S("slider-handle",`
 box-shadow: var(--n-handle-box-shadow-focus);
 `,[J("&:hover",`
 box-shadow: var(--n-handle-box-shadow-active);
 `)])])])]),S("slider-dots",`
 position: absolute;
 top: 50%;
 left: calc(var(--n-handle-size) / 2);
 right: calc(var(--n-handle-size) / 2);
 `,[I("transition-disabled",[S("slider-dot","transition: none;")]),S("slider-dot",`
 transition:
 border-color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 position: absolute;
 transform: translate(-50%, -50%);
 height: var(--n-dot-height);
 width: var(--n-dot-width);
 border-radius: var(--n-dot-border-radius);
 overflow: hidden;
 box-sizing: border-box;
 border: var(--n-dot-border);
 background-color: var(--n-dot-color);
 `,[I("active","border: var(--n-dot-border-active);")])])]),S("slider-handle-indicator",`
 font-size: var(--n-font-size);
 padding: 6px 10px;
 border-radius: var(--n-indicator-border-radius);
 color: var(--n-indicator-text-color);
 background-color: var(--n-indicator-color);
 box-shadow: var(--n-indicator-box-shadow);
 `,[er()]),S("slider-handle-indicator",`
 font-size: var(--n-font-size);
 padding: 6px 10px;
 border-radius: var(--n-indicator-border-radius);
 color: var(--n-indicator-text-color);
 background-color: var(--n-indicator-color);
 box-shadow: var(--n-indicator-box-shadow);
 `,[I("top",`
 margin-bottom: 12px;
 `),I("right",`
 margin-left: 12px;
 `),I("bottom",`
 margin-top: 12px;
 `),I("left",`
 margin-right: 12px;
 `),er()]),ii(S("slider",[S("slider-dot","background-color: var(--n-dot-color-modal);")])),si(S("slider",[S("slider-dot","background-color: var(--n-dot-color-popover);")]))]),ds=0,us=Object.assign(Object.assign({},Ke.props),{to:sn.propTo,defaultValue:{type:[Number,Array],default:0},marks:Object,disabled:{type:Boolean,default:void 0},formatTooltip:Function,keyboard:{type:Boolean,default:!0},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:[Number,String],default:1},range:Boolean,value:[Number,Array],placement:String,showTooltip:{type:Boolean,default:void 0},tooltip:{type:Boolean,default:!0},vertical:Boolean,reverse:Boolean,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onDragstart:[Function],onDragend:[Function]}),hs=Xe({name:"Slider",props:us,setup(r){const{mergedClsPrefixRef:e,namespaceRef:n,inlineThemeDisabled:a}=cn(r),i=Ke("Slider","-slider",cs,oi,r,e),s=q(null),[o,l]=rr(),[h,c]=rr(),f=q(new Set),b=Fr(r),{mergedDisabledRef:u}=b,v=P(()=>{const{step:d}=r;if(Number(d)<=0||d==="mark")return 0;const g=d.toString();let y=0;return g.includes(".")&&(y=g.length-g.indexOf(".")-1),y}),m=q(r.defaultValue),k=vr(r,"value"),A=Or(k,m),R=P(()=>{const{value:d}=A;return(r.range?d:[d]).map(fe)}),$=P(()=>R.value.length>2),se=P(()=>r.placement===void 0?r.vertical?"right":"top":r.placement),M=P(()=>{const{marks:d}=r;return d?Object.keys(d).map(parseFloat):null}),T=q(-1),be=q(-1),z=q(-1),x=q(!1),Z=q(!1),ee=P(()=>{const{vertical:d,reverse:g}=r;return d?g?"top":"bottom":g?"right":"left"}),ue=P(()=>{if($.value)return;const d=R.value,g=Pe(r.range?Math.min(...d):r.min),y=Pe(r.range?Math.max(...d):d[0]),{value:C}=ee;return r.vertical?{[C]:`${g}%`,height:`${y-g}%`}:{[C]:`${g}%`,width:`${y-g}%`}}),we=P(()=>{const d=[],{marks:g}=r;if(g){const y=R.value.slice();y.sort((K,H)=>K-H);const{value:C}=ee,{value:_}=$,{range:B}=r,te=_?()=>!1:K=>B?K>=y[0]&&K<=y[y.length-1]:K<=y[0];for(const K of Object.keys(g)){const H=Number(K);d.push({active:te(H),label:g[K],style:{[C]:`${Pe(H)}%`}})}}return d});function he(d,g){const y=Pe(d),{value:C}=ee;return{[C]:`${y}%`,zIndex:g===T.value?1:0}}function Ae(d){return r.showTooltip||z.value===d||T.value===d&&x.value}function Kt(d){return x.value?!(T.value===d&&be.value===d):!0}function Ht(d){var g;~d&&(T.value=d,(g=o.get(d))===null||g===void 0||g.focus())}function jt(){h.forEach((d,g)=>{Ae(g)&&d.syncPosition()})}function X(d){const{"onUpdate:value":g,onUpdateValue:y}=r,{nTriggerFormInput:C,nTriggerFormChange:_}=b;y&&ke(y,d),g&&ke(g,d),m.value=d,C(),_()}function ot(d){const{range:g}=r;if(g){if(Array.isArray(d)){const{value:y}=R;d.join()!==y.join()&&X(d)}}else Array.isArray(d)||R.value[0]!==d&&X(d)}function Ve(d,g){if(r.range){const y=R.value.slice();y.splice(g,1,d),ot(y)}else ot(d)}function G(d,g,y){const C=y!==void 0;y||(y=d-g>0?1:-1);const _=M.value||[],{step:B}=r;if(B==="mark"){const H=ge(d,_.concat(g),C?y:void 0);return H?H.value:g}if(B<=0)return g;const{value:te}=v;let K;if(C){const H=Number((g/B).toFixed(te)),ve=Math.floor(H),Gt=H>ve?ve:ve-1,qt=H<ve?ve:ve+1;K=ge(g,[Number((Gt*B).toFixed(te)),Number((qt*B).toFixed(te)),..._],y)}else{const H=Wt(d);K=ge(d,[..._,H])}return K?fe(K.value):g}function fe(d){return Math.min(r.max,Math.max(r.min,d))}function Pe(d){const{max:g,min:y}=r;return(d-y)/(g-y)*100}function Vt(d){const{max:g,min:y}=r;return y+(g-y)*d}function Wt(d){const{step:g,min:y}=r;if(Number(g)<=0||g==="mark")return d;const C=Math.round((d-y)/g)*g+y;return Number(C.toFixed(v.value))}function ge(d,g=M.value,y){if(!(g!=null&&g.length))return null;let C=null,_=-1;for(;++_<g.length;){const B=g[_]-d,te=Math.abs(B);(y===void 0||B*y>0)&&(C===null||te<C.distance)&&(C={index:_,distance:te,value:g[_]})}return C}function Ie(d){const g=s.value;if(!g)return;const y=nr(d)?d.touches[0]:d,C=g.getBoundingClientRect();let _;return r.vertical?_=(C.bottom-y.clientY)/C.height:_=(y.clientX-C.left)/C.width,r.reverse&&(_=1-_),Vt(_)}function We(d){if(u.value||!r.keyboard)return;const{vertical:g,reverse:y}=r;switch(d.key){case"ArrowUp":d.preventDefault(),lt(g&&y?-1:1);break;case"ArrowRight":d.preventDefault(),lt(!g&&y?-1:1);break;case"ArrowDown":d.preventDefault(),lt(g&&y?1:-1);break;case"ArrowLeft":d.preventDefault(),lt(!g&&y?1:-1);break}}function lt(d){const g=T.value;if(g===-1)return;const{step:y}=r,C=R.value[g],_=Number(y)<=0||y==="mark"?C:C+y*d;Ve(G(_,C,d>0?1:-1),g)}function Ma(d){var g,y;if(u.value||!nr(d)&&d.button!==ds)return;const C=Ie(d);if(C===void 0)return;const _=R.value.slice(),B=r.range?(y=(g=ge(C,_))===null||g===void 0?void 0:g.index)!==null&&y!==void 0?y:-1:0;B!==-1&&(d.preventDefault(),Ht(B),Ba(),Ve(G(C,R.value[B]),B))}function Ba(){x.value||(x.value=!0,r.onDragstart&&ke(r.onDragstart),ht("touchend",document,ut),ht("mouseup",document,ut),ht("touchmove",document,dt),ht("mousemove",document,dt))}function ct(){x.value&&(x.value=!1,r.onDragend&&ke(r.onDragend),ft("touchend",document,ut),ft("mouseup",document,ut),ft("touchmove",document,dt),ft("mousemove",document,dt))}function dt(d){const{value:g}=T;if(!x.value||g===-1){ct();return}const y=Ie(d);y!==void 0&&Ve(G(y,R.value[g]),g)}function ut(){ct()}function Na(d){T.value=d,u.value||(z.value=d)}function $a(d){T.value===d&&(T.value=-1,ct()),z.value===d&&(z.value=-1)}function Da(d){z.value=d}function Ka(d){z.value===d&&(z.value=-1)}Vn(T,(d,g)=>void Jt(()=>be.value=g)),Vn(A,()=>{if(r.marks){if(Z.value)return;Z.value=!0,Jt(()=>{Z.value=!1})}Jt(jt)}),li(()=>{ct()});const Hn=P(()=>{const{self:{markFontSize:d,railColor:g,railColorHover:y,fillColor:C,fillColorHover:_,handleColor:B,opacityDisabled:te,dotColor:K,dotColorModal:H,handleBoxShadow:ve,handleBoxShadowHover:Gt,handleBoxShadowActive:qt,handleBoxShadowFocus:Ha,dotBorder:ja,dotBoxShadow:Va,railHeight:Wa,railWidthVertical:Ga,handleSize:qa,dotHeight:Ja,dotWidth:Za,dotBorderRadius:Xa,fontSize:Ya,dotBorderActive:Qa,dotColorPopover:ei},common:{cubicBezierEaseInOut:ti}}=i.value;return{"--n-bezier":ti,"--n-dot-border":ja,"--n-dot-border-active":Qa,"--n-dot-border-radius":Xa,"--n-dot-box-shadow":Va,"--n-dot-color":K,"--n-dot-color-modal":H,"--n-dot-color-popover":ei,"--n-dot-height":Ja,"--n-dot-width":Za,"--n-fill-color":C,"--n-fill-color-hover":_,"--n-font-size":Ya,"--n-handle-box-shadow":ve,"--n-handle-box-shadow-active":qt,"--n-handle-box-shadow-focus":Ha,"--n-handle-box-shadow-hover":Gt,"--n-handle-color":B,"--n-handle-size":qa,"--n-opacity-disabled":te,"--n-rail-color":g,"--n-rail-color-hover":y,"--n-rail-height":Wa,"--n-rail-width-vertical":Ga,"--n-mark-font-size":d}}),Ue=a?Ct("slider",void 0,Hn,r):void 0,jn=P(()=>{const{self:{fontSize:d,indicatorColor:g,indicatorBoxShadow:y,indicatorTextColor:C,indicatorBorderRadius:_}}=i.value;return{"--n-font-size":d,"--n-indicator-border-radius":_,"--n-indicator-box-shadow":y,"--n-indicator-color":g,"--n-indicator-text-color":C}}),ze=a?Ct("slider-indicator",void 0,jn,r):void 0;return{mergedClsPrefix:e,namespace:n,uncontrolledValue:m,mergedValue:A,mergedDisabled:u,mergedPlacement:se,isMounted:Ji(),adjustedTo:sn(r),dotTransitionDisabled:Z,markInfos:we,isShowTooltip:Ae,shouldKeepTooltipTransition:Kt,handleRailRef:s,setHandleRefs:l,setFollowerRefs:c,fillStyle:ue,getHandleStyle:he,activeIndex:T,arrifiedValues:R,followerEnabledIndexSet:f,handleRailMouseDown:Ma,handleHandleFocus:Na,handleHandleBlur:$a,handleHandleMouseEnter:Da,handleHandleMouseLeave:Ka,handleRailKeyDown:We,indicatorCssVars:a?void 0:jn,indicatorThemeClass:ze==null?void 0:ze.themeClass,indicatorOnRender:ze==null?void 0:ze.onRender,cssVars:a?void 0:Hn,themeClass:Ue==null?void 0:Ue.themeClass,onRender:Ue==null?void 0:Ue.onRender}},render(){var r;const{mergedClsPrefix:e,themeClass:n,formatTooltip:a}=this;return(r=this.onRender)===null||r===void 0||r.call(this),E("div",{class:[`${e}-slider`,n,{[`${e}-slider--disabled`]:this.mergedDisabled,[`${e}-slider--active`]:this.activeIndex!==-1,[`${e}-slider--with-mark`]:this.marks,[`${e}-slider--vertical`]:this.vertical,[`${e}-slider--reverse`]:this.reverse}],style:this.cssVars,onKeydown:this.handleRailKeyDown,onMousedown:this.handleRailMouseDown,onTouchstart:this.handleRailMouseDown},E("div",{class:`${e}-slider-rail`},E("div",{class:`${e}-slider-rail__fill`,style:this.fillStyle}),this.marks?E("div",{class:[`${e}-slider-dots`,this.dotTransitionDisabled&&`${e}-slider-dots--transition-disabled`]},this.markInfos.map(i=>E("div",{key:i.label,class:[`${e}-slider-dot`,{[`${e}-slider-dot--active`]:i.active}],style:i.style}))):null,E("div",{ref:"handleRailRef",class:`${e}-slider-handles`},this.arrifiedValues.map((i,s)=>{const o=this.isShowTooltip(s);return E(Qi,null,{default:()=>[E(es,null,{default:()=>E("div",{ref:this.setHandleRefs(s),class:`${e}-slider-handle-wrapper`,tabindex:this.mergedDisabled?-1:0,style:this.getHandleStyle(i,s),onFocus:()=>{this.handleHandleFocus(s)},onBlur:()=>{this.handleHandleBlur(s)},onMouseenter:()=>{this.handleHandleMouseEnter(s)},onMouseleave:()=>{this.handleHandleMouseLeave(s)}},Zi(this.$slots.thumb,()=>[E("div",{class:`${e}-slider-handle`})]))}),this.tooltip&&E(ts,{ref:this.setFollowerRefs(s),show:o,to:this.adjustedTo,enabled:this.showTooltip&&!this.range||this.followerEnabledIndexSet.has(s),teleportDisabled:this.adjustedTo===sn.tdkey,placement:this.mergedPlacement,containerClass:this.namespace},{default:()=>E(ci,{name:"fade-in-scale-up-transition",appear:this.isMounted,css:this.shouldKeepTooltipTransition(s),onEnter:()=>{this.followerEnabledIndexSet.add(s)},onAfterLeave:()=>{this.followerEnabledIndexSet.delete(s)}},{default:()=>{var l;return o?((l=this.indicatorOnRender)===null||l===void 0||l.call(this),E("div",{class:[`${e}-slider-handle-indicator`,this.indicatorThemeClass,`${e}-slider-handle-indicator--${this.mergedPlacement}`],style:this.indicatorCssVars},typeof a=="function"?a(i):i)):null}})})]})})),this.marks?E("div",{class:`${e}-slider-marks`},this.markInfos.map(i=>E("div",{key:i.label,class:`${e}-slider-mark`,style:i.style},i.label))):null))}}),fs=S("switch",`
 height: var(--n-height);
 min-width: var(--n-width);
 vertical-align: middle;
 user-select: none;
 -webkit-user-select: none;
 display: inline-flex;
 outline: none;
 justify-content: center;
 align-items: center;
`,[L("children-placeholder",`
 height: var(--n-rail-height);
 display: flex;
 flex-direction: column;
 overflow: hidden;
 pointer-events: none;
 visibility: hidden;
 `),L("rail-placeholder",`
 display: flex;
 flex-wrap: none;
 `),L("button-placeholder",`
 width: calc(1.75 * var(--n-rail-height));
 height: var(--n-rail-height);
 `),S("base-loading",`
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translateX(-50%) translateY(-50%);
 font-size: calc(var(--n-button-width) - 4px);
 color: var(--n-loading-color);
 transition: color .3s var(--n-bezier);
 `,[tr({left:"50%",top:"50%",originalTransform:"translateX(-50%) translateY(-50%)"})]),L("checked, unchecked",`
 transition: color .3s var(--n-bezier);
 color: var(--n-text-color);
 box-sizing: border-box;
 position: absolute;
 white-space: nowrap;
 top: 0;
 bottom: 0;
 display: flex;
 align-items: center;
 line-height: 1;
 `),L("checked",`
 right: 0;
 padding-right: calc(1.25 * var(--n-rail-height) - var(--n-offset));
 `),L("unchecked",`
 left: 0;
 justify-content: flex-end;
 padding-left: calc(1.25 * var(--n-rail-height) - var(--n-offset));
 `),J("&:focus",[L("rail",`
 box-shadow: var(--n-box-shadow-focus);
 `)]),I("round",[L("rail","border-radius: calc(var(--n-rail-height) / 2);",[L("button","border-radius: calc(var(--n-button-height) / 2);")])]),Wn("disabled",[Wn("icon",[I("rubber-band",[I("pressed",[L("rail",[L("button","max-width: var(--n-button-width-pressed);")])]),L("rail",[J("&:active",[L("button","max-width: var(--n-button-width-pressed);")])]),I("active",[I("pressed",[L("rail",[L("button","left: calc(100% - var(--n-offset) - var(--n-button-width-pressed));")])]),L("rail",[J("&:active",[L("button","left: calc(100% - var(--n-offset) - var(--n-button-width-pressed));")])])])])])]),I("active",[L("rail",[L("button","left: calc(100% - var(--n-button-width) - var(--n-offset))")])]),L("rail",`
 overflow: hidden;
 height: var(--n-rail-height);
 min-width: var(--n-rail-width);
 border-radius: var(--n-rail-border-radius);
 cursor: pointer;
 position: relative;
 transition:
 opacity .3s var(--n-bezier),
 background .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier);
 background-color: var(--n-rail-color);
 `,[L("button-icon",`
 color: var(--n-icon-color);
 transition: color .3s var(--n-bezier);
 font-size: calc(var(--n-button-height) - 4px);
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 display: flex;
 justify-content: center;
 align-items: center;
 line-height: 1;
 `,[tr()]),L("button",`
 align-items: center; 
 top: var(--n-offset);
 left: var(--n-offset);
 height: var(--n-button-height);
 width: var(--n-button-width-pressed);
 max-width: var(--n-button-width);
 border-radius: var(--n-button-border-radius);
 background-color: var(--n-button-color);
 box-shadow: var(--n-button-box-shadow);
 box-sizing: border-box;
 cursor: inherit;
 content: "";
 position: absolute;
 transition:
 background-color .3s var(--n-bezier),
 left .3s var(--n-bezier),
 opacity .3s var(--n-bezier),
 max-width .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier);
 `)]),I("active",[L("rail","background-color: var(--n-rail-color-active);")]),I("loading",[L("rail",`
 cursor: wait;
 `)]),I("disabled",[L("rail",`
 cursor: not-allowed;
 opacity: .5;
 `)])]),gs=Object.assign(Object.assign({},Ke.props),{size:{type:String,default:"medium"},value:{type:[String,Number,Boolean],default:void 0},loading:Boolean,defaultValue:{type:[String,Number,Boolean],default:!1},disabled:{type:Boolean,default:void 0},round:{type:Boolean,default:!0},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],checkedValue:{type:[String,Number,Boolean],default:!0},uncheckedValue:{type:[String,Number,Boolean],default:!1},railStyle:Function,rubberBand:{type:Boolean,default:!0},onChange:[Function,Array]});let Ge;const vs=Xe({name:"Switch",props:gs,setup(r){Ge===void 0&&(typeof CSS<"u"?typeof CSS.supports<"u"?Ge=CSS.supports("width","max(1px)"):Ge=!1:Ge=!0);const{mergedClsPrefixRef:e,inlineThemeDisabled:n}=cn(r),a=Ke("Switch","-switch",fs,di,r,e),i=Fr(r),{mergedSizeRef:s,mergedDisabledRef:o}=i,l=q(r.defaultValue),h=vr(r,"value"),c=Or(h,l),f=P(()=>c.value===r.checkedValue),b=q(!1),u=q(!1),v=P(()=>{const{railStyle:x}=r;if(x)return x({focused:u.value,checked:f.value})});function m(x){const{"onUpdate:value":Z,onChange:ee,onUpdateValue:ue}=r,{nTriggerFormInput:we,nTriggerFormChange:he}=i;Z&&ke(Z,x),ue&&ke(ue,x),ee&&ke(ee,x),l.value=x,we(),he()}function k(){const{nTriggerFormFocus:x}=i;x()}function A(){const{nTriggerFormBlur:x}=i;x()}function R(){r.loading||o.value||(c.value!==r.checkedValue?m(r.checkedValue):m(r.uncheckedValue))}function $(){u.value=!0,k()}function se(){u.value=!1,A(),b.value=!1}function M(x){r.loading||o.value||x.key===" "&&(c.value!==r.checkedValue?m(r.checkedValue):m(r.uncheckedValue),b.value=!1)}function T(x){r.loading||o.value||x.key===" "&&(x.preventDefault(),b.value=!0)}const be=P(()=>{const{value:x}=s,{self:{opacityDisabled:Z,railColor:ee,railColorActive:ue,buttonBoxShadow:we,buttonColor:he,boxShadowFocus:Ae,loadingColor:Kt,textColor:Ht,iconColor:jt,[Se("buttonHeight",x)]:X,[Se("buttonWidth",x)]:ot,[Se("buttonWidthPressed",x)]:Ve,[Se("railHeight",x)]:G,[Se("railWidth",x)]:fe,[Se("railBorderRadius",x)]:Pe,[Se("buttonBorderRadius",x)]:Vt},common:{cubicBezierEaseInOut:Wt}}=a.value;let ge,Ie,We;return Ge?(ge=`calc((${G} - ${X}) / 2)`,Ie=`max(${G}, ${X})`,We=`max(${fe}, calc(${fe} + ${X} - ${G}))`):(ge=Yt((oe(G)-oe(X))/2),Ie=Yt(Math.max(oe(G),oe(X))),We=oe(G)>oe(X)?fe:Yt(oe(fe)+oe(X)-oe(G))),{"--n-bezier":Wt,"--n-button-border-radius":Vt,"--n-button-box-shadow":we,"--n-button-color":he,"--n-button-width":ot,"--n-button-width-pressed":Ve,"--n-button-height":X,"--n-height":Ie,"--n-offset":ge,"--n-opacity-disabled":Z,"--n-rail-border-radius":Pe,"--n-rail-color":ee,"--n-rail-color-active":ue,"--n-rail-height":G,"--n-rail-width":fe,"--n-width":We,"--n-box-shadow-focus":Ae,"--n-loading-color":Kt,"--n-text-color":Ht,"--n-icon-color":jt}}),z=n?Ct("switch",P(()=>s.value[0]),be,r):void 0;return{handleClick:R,handleBlur:se,handleFocus:$,handleKeyup:M,handleKeydown:T,mergedRailStyle:v,pressed:b,mergedClsPrefix:e,mergedValue:c,checked:f,mergedDisabled:o,cssVars:n?void 0:be,themeClass:z==null?void 0:z.themeClass,onRender:z==null?void 0:z.onRender}},render(){const{mergedClsPrefix:r,mergedDisabled:e,checked:n,mergedRailStyle:a,onRender:i,$slots:s}=this;i==null||i();const{checked:o,unchecked:l,icon:h,"checked-icon":c,"unchecked-icon":f}=s,b=!(Xt(h)&&Xt(c)&&Xt(f));return E("div",{role:"switch","aria-checked":n,class:[`${r}-switch`,this.themeClass,b&&`${r}-switch--icon`,n&&`${r}-switch--active`,e&&`${r}-switch--disabled`,this.round&&`${r}-switch--round`,this.loading&&`${r}-switch--loading`,this.pressed&&`${r}-switch--pressed`,this.rubberBand&&`${r}-switch--rubber-band`],tabindex:this.mergedDisabled?void 0:0,style:this.cssVars,onClick:this.handleClick,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyup:this.handleKeyup,onKeydown:this.handleKeydown},E("div",{class:`${r}-switch__rail`,"aria-hidden":"true",style:a},Ee(o,u=>Ee(l,v=>u||v?E("div",{"aria-hidden":!0,class:`${r}-switch__children-placeholder`},E("div",{class:`${r}-switch__rail-placeholder`},E("div",{class:`${r}-switch__button-placeholder`}),u),E("div",{class:`${r}-switch__rail-placeholder`},E("div",{class:`${r}-switch__button-placeholder`}),v)):null)),E("div",{class:`${r}-switch__button`},Ee(h,u=>Ee(c,v=>Ee(f,m=>E(Xi,null,{default:()=>this.loading?E(Yi,{key:"loading",clsPrefix:r,strokeWidth:20}):this.checked&&(v||u)?E("div",{class:`${r}-switch__button-icon`,key:v?"checked-icon":"icon"},v||u):!this.checked&&(m||u)?E("div",{class:`${r}-switch__button-icon`,key:m?"unchecked-icon":"icon"},m||u):null})))),Ee(o,u=>u&&E("div",{key:"checked",class:`${r}-switch__checked`},u)),Ee(l,u=>u&&E("div",{key:"unchecked",class:`${r}-switch__unchecked`},u)))))}}),ps=S("thing",`
 display: flex;
 transition: color .3s var(--n-bezier);
 font-size: var(--n-font-size);
 color: var(--n-text-color);
`,[S("thing-avatar",`
 margin-right: 12px;
 margin-top: 2px;
 `),S("thing-avatar-header-wrapper",`
 display: flex;
 flex-wrap: nowrap;
 `,[S("thing-header-wrapper",`
 flex: 1;
 `)]),S("thing-main",`
 flex-grow: 1;
 `,[S("thing-header",`
 display: flex;
 margin-bottom: 4px;
 justify-content: space-between;
 align-items: center;
 `,[L("title",`
 font-size: 16px;
 font-weight: var(--n-title-font-weight);
 transition: color .3s var(--n-bezier);
 color: var(--n-title-text-color);
 `)]),L("description",[J("&:not(:last-child)",`
 margin-bottom: 4px;
 `)]),L("content",[J("&:not(:first-child)",`
 margin-top: 12px;
 `)]),L("footer",[J("&:not(:first-child)",`
 margin-top: 12px;
 `)]),L("action",[J("&:not(:first-child)",`
 margin-top: 12px;
 `)])])]),ys=Object.assign(Object.assign({},Ke.props),{title:String,titleExtra:String,description:String,descriptionClass:String,descriptionStyle:[String,Object],content:String,contentClass:String,contentStyle:[String,Object],contentIndented:Boolean}),le=Xe({name:"Thing",props:ys,setup(r,{slots:e}){const{mergedClsPrefixRef:n,inlineThemeDisabled:a,mergedRtlRef:i}=cn(r),s=Ke("Thing","-thing",ps,ui,r,n),o=qi("Thing",i,n),l=P(()=>{const{self:{titleTextColor:c,textColor:f,titleFontWeight:b,fontSize:u},common:{cubicBezierEaseInOut:v}}=s.value;return{"--n-bezier":v,"--n-font-size":u,"--n-text-color":f,"--n-title-font-weight":b,"--n-title-text-color":c}}),h=a?Ct("thing",void 0,l,r):void 0;return()=>{var c;const{value:f}=n,b=o?o.value:!1;return(c=h==null?void 0:h.onRender)===null||c===void 0||c.call(h),E("div",{class:[`${f}-thing`,h==null?void 0:h.themeClass,b&&`${f}-thing--rtl`],style:a?void 0:l.value},e.avatar&&r.contentIndented?E("div",{class:`${f}-thing-avatar`},e.avatar()):null,E("div",{class:`${f}-thing-main`},!r.contentIndented&&(e.header||r.title||e["header-extra"]||r.titleExtra||e.avatar)?E("div",{class:`${f}-thing-avatar-header-wrapper`},e.avatar?E("div",{class:`${f}-thing-avatar`},e.avatar()):null,e.header||r.title||e["header-extra"]||r.titleExtra?E("div",{class:`${f}-thing-header-wrapper`},E("div",{class:`${f}-thing-header`},e.header||r.title?E("div",{class:`${f}-thing-header__title`},e.header?e.header():r.title):null,e["header-extra"]||r.titleExtra?E("div",{class:`${f}-thing-header__extra`},e["header-extra"]?e["header-extra"]():r.titleExtra):null),e.description||r.description?E("div",{class:[`${f}-thing-main__description`,r.descriptionClass],style:r.descriptionStyle},e.description?e.description():r.description):null):null):E(rn,null,e.header||r.title||e["header-extra"]||r.titleExtra?E("div",{class:`${f}-thing-header`},e.header||r.title?E("div",{class:`${f}-thing-header__title`},e.header?e.header():r.title):null,e["header-extra"]||r.titleExtra?E("div",{class:`${f}-thing-header__extra`},e["header-extra"]?e["header-extra"]():r.titleExtra):null):null,e.description||r.description?E("div",{class:[`${f}-thing-main__description`,r.descriptionClass],style:r.descriptionStyle},e.description?e.description():r.description):null),e.default||r.content?E("div",{class:[`${f}-thing-main__content`,r.contentClass],style:r.contentStyle},e.default?e.default():r.content):null,e.footer?E("div",{class:`${f}-thing-main__footer`},e.footer()):null,e.action?E("div",{class:`${f}-thing-main__action`},e.action()):null))}}}),ms={},bs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ws=fi("path",{d:"M7.38 21.01c.49.49 1.28.49 1.77 0l8.31-8.31a.996.996 0 0 0 0-1.41L9.15 2.98c-.49-.49-1.28-.49-1.77 0s-.49 1.28 0 1.77L14.62 12l-7.25 7.25c-.48.48-.48 1.28.01 1.76z",fill:"currentColor"},null,-1),Ss=[ws];function Es(r,e){return D(),an("svg",bs,Ss)}const bt=hi(ms,[["render",Es]]);var Y=(r=>(r.NotLogin="NotLogin",r.WindowNostr="WindowNostr",r.PrivateKey="PrivateKey",r.NostrConnect="NostrConnect",r))(Y||{});function Ze(){const r=localStorage.getItem("__nostr_api_mode");return r==="WindowNostr"?"WindowNostr":r==="PrivateKey"?"PrivateKey":r==="NostrConnect"?"NostrConnect":"NotLogin"}function qe(r){localStorage.setItem("__nostr_api_mode",String(r))}class Nr extends Error{constructor(e){super(`NotFoundError:Not Found ${e}`)}}class At{constructor(e){this.nostrApiProvide=Promise.withResolvers(),this._pubkey=null,e&&this.nostrApiProvide.resolve(e()),this.getNostrApi=Ye(()=>this.nostrApiProvide.promise)}async getPublicKey(){return this._pubkey=await this.run("getPublicKey"),this._pubkey}getPubkey(){return this.getPublicKey().then(e=>{this._pubkey=e}),this._pubkey}signEvent(e){return this.run("signEvent",JSON.parse(JSON.stringify(e)))}getRelays(){return this.run("getRelays")}encrypt(e,n){return this.run("encrypt",e,n)}decrypt(e,n){return this.run("decrypt",e,n)}async run(e,...n){let i=(await this.getNostrApi())[e];if(!i)throw new Nr(e);return await i(...n)}}const xt=p(()=>[ie,Re],({mod:r,line:e})=>{let n=new WeakMap;return e.onCreateChildDep(a=>{a.onEvent((i,s)=>{let o=n.get(a);if(o){if(o.has(s.id))return!0}else o=new Set,n.set(a,o);return o.add(s.id),!1},{unShift:!0})}),r});class vn extends At{constructor(){super(),this.nostrApiProvide.resolve({})}}var ks=Object.defineProperty,U=(r,e)=>{for(var n in e)ks(r,n,{get:e[n],enumerable:!0})},Fe=Symbol("verified"),Cs=r=>r instanceof Object;function $r(r){if(!Cs(r)||typeof r.kind!="number"||typeof r.content!="string"||typeof r.created_at!="number"||typeof r.pubkey!="string"||!r.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(r.tags))return!1;for(let e=0;e<r.tags.length;e++){let n=r.tags[e];if(!Array.isArray(n))return!1;for(let a=0;a<n.length;a++)if(typeof n[a]=="object")return!1}return!0}var xs={};U(xs,{Queue:()=>As,QueueNode:()=>Dr,binarySearch:()=>pn,insertEventIntoAscendingList:()=>_s,insertEventIntoDescendingList:()=>Rs,normalizeURL:()=>Ls,utf8Decoder:()=>ce,utf8Encoder:()=>ae});var ce=new TextDecoder("utf-8"),ae=new TextEncoder;function Ls(r){r.indexOf("://")===-1&&(r="wss://"+r);let e=new URL(r);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function Rs(r,e){const[n,a]=pn(r,i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at);return a||r.splice(n,0,e),r}function _s(r,e){const[n,a]=pn(r,i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at);return a||r.splice(n,0,e),r}function pn(r,e){let n=0,a=r.length-1;for(;n<=a;){const i=Math.floor((n+a)/2),s=e(r[i]);if(s===0)return[i,!0];s<0?a=i-1:n=i+1}return[n,!1]}var Dr=class{constructor(r){Te(this,"value");Te(this,"next",null);Te(this,"prev",null);this.value=r}},As=class{constructor(){Te(this,"first");Te(this,"last");this.first=null,this.last=null}enqueue(r){const e=new Dr(r);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const r=this.first;return this.first=r.next,r.value}},Ps=class{generateSecretKey(){return ne.utils.randomPrivateKey()}getPublicKey(e){return O(ne.getPublicKey(e))}finalizeEvent(e,n){const a=e;return a.pubkey=O(ne.getPublicKey(n)),a.id=wt(a),a.sig=O(ne.sign(wt(a),n)),a[Fe]=!0,a}verifyEvent(e){if(typeof e[Fe]=="boolean")return e[Fe];const n=wt(e);if(n!==e.id)return e[Fe]=!1,!1;try{const a=ne.verify(e.sig,n,e.pubkey);return e[Fe]=a,a}catch{return e[Fe]=!1,!1}}};function Is(r){if(!$r(r))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,r.pubkey,r.created_at,r.kind,r.tags,r.content])}function wt(r){let e=Ne(ae.encode(Is(r)));return O(e)}var Pt=new Ps;Pt.generateSecretKey;Pt.getPublicKey;var me=Pt.finalizeEvent,yn=Pt.verifyEvent,Us={};U(Us,{Application:()=>zo,BadgeAward:()=>Ds,BadgeDefinition:()=>Lo,BlockedRelaysList:()=>uo,BookmarkList:()=>oo,Bookmarksets:()=>ko,Calendar:()=>$o,CalendarEventRSVP:()=>Do,ChannelCreation:()=>Wr,ChannelHideMessage:()=>Jr,ChannelMessage:()=>qr,ChannelMetadata:()=>Gr,ChannelMuteUser:()=>Zr,ClassifiedListing:()=>Oo,ClientAuth:()=>Xr,CommunitiesList:()=>lo,CommunityDefinition:()=>jo,CommunityPostApproval:()=>Zs,Contacts:()=>Ms,CreateOrUpdateProduct:()=>Ao,CreateOrUpdateStall:()=>_o,Curationsets:()=>Co,Date:()=>Bo,DraftClassifiedListing:()=>Mo,DraftLong:()=>Io,Emojisets:()=>Uo,EncryptedDirectMessage:()=>Bs,EncryptedDirectMessages:()=>Ns,EventDeletion:()=>$s,FileMetadata:()=>js,FileServerPreference:()=>vo,Followsets:()=>wo,GenericRepost:()=>Ks,Genericlists:()=>So,HTTPAuth:()=>wn,Handlerinformation:()=>Ho,Handlerrecommendation:()=>Ko,Highlights:()=>ro,InterestsList:()=>fo,Interestsets:()=>Ro,JobFeedback:()=>Qs,JobRequest:()=>Xs,JobResult:()=>Ys,Label:()=>Js,LightningPubRPC:()=>yo,LiveChatMessage:()=>Vs,LiveEvent:()=>To,LongFormArticle:()=>Po,Metadata:()=>Ts,Mutelist:()=>ao,NWCWalletInfo:()=>po,NWCWalletRequest:()=>Yr,NWCWalletResponse:()=>mo,NostrConnect:()=>bo,OpenTimestamps:()=>Hs,Pinlist:()=>io,ProblemTracker:()=>Ws,ProfileBadges:()=>xo,PublicChatsList:()=>co,Reaction:()=>bn,RecommendRelay:()=>Os,RelayList:()=>so,Relaysets:()=>Eo,Report:()=>Gs,Reporting:()=>qs,Repost:()=>mn,SearchRelaysList:()=>ho,ShortTextNote:()=>Fs,Time:()=>No,UserEmojiList:()=>go,UserStatuses:()=>Fo,Zap:()=>no,ZapGoal:()=>eo,ZapRequest:()=>to,classifyKind:()=>zs,isEphemeralKind:()=>jr,isParameterizedReplaceableKind:()=>Vr,isRegularKind:()=>Kr,isReplaceableKind:()=>Hr});function Kr(r){return 1e3<=r&&r<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(r)}function Hr(r){return[0,3].includes(r)||1e4<=r&&r<2e4}function jr(r){return 2e4<=r&&r<3e4}function Vr(r){return 3e4<=r&&r<4e4}function zs(r){return Kr(r)?"regular":Hr(r)?"replaceable":jr(r)?"ephemeral":Vr(r)?"parameterized":"unknown"}var Ts=0,Fs=1,Os=2,Ms=3,Bs=4,Ns=4,$s=5,mn=6,bn=7,Ds=8,Ks=16,Wr=40,Gr=41,qr=42,Jr=43,Zr=44,Hs=1040,js=1063,Vs=1311,Ws=1971,Gs=1984,qs=1984,Js=1985,Zs=4550,Xs=5999,Ys=6999,Qs=7e3,eo=9041,to=9734,no=9735,ro=9802,ao=1e4,io=10001,so=10002,oo=10003,lo=10004,co=10005,uo=10006,ho=10007,fo=10015,go=10030,vo=10096,po=13194,yo=21e3,Xr=22242,Yr=23194,mo=23195,bo=24133,wn=27235,wo=3e4,So=30001,Eo=30002,ko=30003,Co=30004,xo=30008,Lo=30009,Ro=30015,_o=30017,Ao=30018,Po=30023,Io=30024,Uo=30030,zo=30078,To=30311,Fo=30315,Oo=30402,Mo=30403,Bo=31922,No=31923,$o=31924,Do=31925,Ko=31989,Ho=31990,jo=34550,Vo={};U(Vo,{getHex64:()=>Sn,getInt:()=>Qr,getSubscriptionId:()=>Wo,matchEventId:()=>Go,matchEventKind:()=>Jo,matchEventPubkey:()=>qo});function Sn(r,e){let n=e.length+3,a=r.indexOf(`"${e}":`)+n,i=r.slice(a).indexOf('"')+a+1;return r.slice(i,i+64)}function Qr(r,e){let n=e.length,a=r.indexOf(`"${e}":`)+n+3,i=r.slice(a),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function Wo(r){let e=r.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=r.slice(e+7+1).indexOf('"');if(n===-1)return null;let a=e+7+1+n,i=r.slice(a+1,80).indexOf('"');if(i===-1)return null;let s=a+1+i;return r.slice(a+1,s)}function Go(r,e){return e===Sn(r,"id")}function qo(r,e){return e===Sn(r,"pubkey")}function Jo(r,e){return e===Qr(r,"kind")}var Zo={};U(Zo,{makeAuthEvent:()=>Xo});function Xo(r,e){return{kind:Xr,created_at:Math.floor(Date.now()/1e3),tags:[["relay",r],["challenge",e]],content:""}}var Yo;try{Yo=WebSocket}catch{}var Qo={};U(Qo,{BECH32_REGEX:()=>ea,Bech32MaxSize:()=>En,decode:()=>It,encodeBytes:()=>Ut,naddrEncode:()=>sl,neventEncode:()=>il,noteEncode:()=>rl,nprofileEncode:()=>al,npubEncode:()=>nl,nrelayEncode:()=>ol,nsecEncode:()=>tl});var En=5e3,ea=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function el(r){const e=new Uint8Array(4);return e[0]=r>>24&255,e[1]=r>>16&255,e[2]=r>>8&255,e[3]=r&255,e}function It(r){var i,s,o,l,h,c,f,b;let{prefix:e,words:n}=$e.decode(r,En),a=new Uint8Array($e.fromWords(n));switch(e){case"nprofile":{let u=gt(a);if(!((i=u[0])!=null&&i[0]))throw new Error("missing TLV 0 for nprofile");if(u[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:O(u[0][0]),relays:u[1]?u[1].map(v=>ce.decode(v)):[]}}}case"nevent":{let u=gt(a);if(!((s=u[0])!=null&&s[0]))throw new Error("missing TLV 0 for nevent");if(u[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(u[2]&&u[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(u[3]&&u[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:O(u[0][0]),relays:u[1]?u[1].map(v=>ce.decode(v)):[],author:(o=u[2])!=null&&o[0]?O(u[2][0]):void 0,kind:(l=u[3])!=null&&l[0]?parseInt(O(u[3][0]),16):void 0}}}case"naddr":{let u=gt(a);if(!((h=u[0])!=null&&h[0]))throw new Error("missing TLV 0 for naddr");if(!((c=u[2])!=null&&c[0]))throw new Error("missing TLV 2 for naddr");if(u[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((f=u[3])!=null&&f[0]))throw new Error("missing TLV 3 for naddr");if(u[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:ce.decode(u[0][0]),pubkey:O(u[2][0]),kind:parseInt(O(u[3][0]),16),relays:u[1]?u[1].map(v=>ce.decode(v)):[]}}}case"nrelay":{let u=gt(a);if(!((b=u[0])!=null&&b[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:ce.decode(u[0][0])}}case"nsec":return{type:e,data:a};case"npub":case"note":return{type:e,data:O(a)};default:throw new Error(`unknown prefix ${e}`)}}function gt(r){let e={},n=r;for(;n.length>0;){let a=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${a}`);e[a]=e[a]||[],e[a].push(s)}return e}function tl(r){return Ut("nsec",r)}function nl(r){return Ut("npub",De(r))}function rl(r){return Ut("note",De(r))}function Qe(r,e){let n=$e.toWords(e);return $e.encode(r,n,En)}function Ut(r,e){return Qe(r,e)}function al(r){let e=zt({0:[De(r.pubkey)],1:(r.relays||[]).map(n=>ae.encode(n))});return Qe("nprofile",e)}function il(r){let e;r.kind!==void 0&&(e=el(r.kind));let n=zt({0:[De(r.id)],1:(r.relays||[]).map(a=>ae.encode(a)),2:r.author?[De(r.author)]:[],3:e?[new Uint8Array(e)]:[]});return Qe("nevent",n)}function sl(r){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,r.kind,!1);let n=zt({0:[ae.encode(r.identifier)],1:(r.relays||[]).map(a=>ae.encode(a)),2:[De(r.pubkey)],3:[new Uint8Array(e)]});return Qe("naddr",n)}function ol(r){let e=zt({0:[ae.encode(r)]});return Qe("nrelay",e)}function zt(r){let e=[];return Object.entries(r).reverse().forEach(([n,a])=>{a.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)})}),kt(...e)}var on={};U(on,{decrypt:()=>ll,encrypt:()=>ta});async function ta(r,e,n){const a=r instanceof Uint8Array?O(r):r,i=fn.getSharedSecret(a,"02"+e),s=na(i);let o=Uint8Array.from(Ur(16)),l=ae.encode(n),h=zr(s,o).encrypt(l),c=ye.encode(new Uint8Array(h)),f=ye.encode(new Uint8Array(o.buffer));return`${c}?iv=${f}`}async function ll(r,e,n){const a=r instanceof Uint8Array?O(r):r;let[i,s]=n.split("?iv="),o=fn.getSharedSecret(a,"02"+e),l=na(o),h=ye.decode(s),c=ye.decode(i),f=zr(l,h).decrypt(c);return ce.decode(f)}function na(r){return r.slice(1,33)}var cl={};U(cl,{NIP05_REGEX:()=>ra,isValid:()=>hl,queryProfile:()=>aa,searchDomain:()=>ul,useFetchImplementation:()=>dl});var ra=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,Tt;try{Tt=fetch}catch{}function dl(r){Tt=r}async function ul(r,e=""){try{const n=`https://${r}/.well-known/nostr.json?name=${e}`;return(await(await Tt(n,{redirect:"error"})).json()).names}catch{return{}}}async function aa(r){var s;const e=r.match(ra);if(!e)return null;const[n,a="_",i]=e;try{const o=`https://${i}/.well-known/nostr.json?name=${a}`,l=await(await Tt(o,{redirect:"error"})).json();let h=l.names[a];return h?{pubkey:h,relays:(s=l.relays)==null?void 0:s[h]}:null}catch{return null}}async function hl(r,e){let n=await aa(e);return n?n.pubkey===r:!1}var fl={};U(fl,{parse:()=>gl});function gl(r){const e={reply:void 0,root:void 0,mentions:[],profiles:[]},n=[];for(const a of r.tags)a[0]==="e"&&a[1]&&n.push(a),a[0]==="p"&&a[1]&&e.profiles.push({pubkey:a[1],relays:a[2]?[a[2]]:[]});for(let a=0;a<n.length;a++){const i=n[a],[s,o,l,h]=i,c={id:o,relays:l?[l]:[]},f=a===0,b=a===n.length-1;if(h==="root"){e.root=c;continue}if(h==="reply"){e.reply=c;continue}if(h==="mention"){e.mentions.push(c);continue}if(f){e.root=c;continue}if(b){e.reply=c;continue}e.mentions.push(c)}return e}var vl={};U(vl,{fetchRelayInformation:()=>yl,useFetchImplementation:()=>pl});var ia;try{ia=fetch}catch{}function pl(r){ia=r}async function yl(r){return await(await fetch(r.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var ml={};U(ml,{getPow:()=>sa,minePow:()=>bl});function sa(r){let e=0;for(let n=0;n<r.length;n++){const a=parseInt(r[n],16);if(a===0)e+=4;else{e+=Math.clz32(a)-28;break}}return e}function bl(r,e){let n=0;const a=r,i=["nonce",n.toString(),e.toString()];for(a.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==a.created_at&&(n=0,a.created_at=s),i[1]=(++n).toString(),a.id=wt(a),sa(a.id)>=e)break}return a}var wl={};U(wl,{finishRepostEvent:()=>Sl,getRepostedEvent:()=>El,getRepostedEventPointer:()=>oa});function Sl(r,e,n,a){return me({kind:mn,tags:[...r.tags??[],["e",e.id,n],["p",e.pubkey]],content:r.content===""?"":JSON.stringify(e),created_at:r.created_at},a)}function oa(r){if(r.kind!==mn)return;let e,n;for(let a=r.tags.length-1;a>=0&&(e===void 0||n===void 0);a--){const i=r.tags[a];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(e!==void 0)return{id:e[1],relays:[e[2],n==null?void 0:n[2]].filter(a=>typeof a=="string"),author:n==null?void 0:n[1]}}function El(r,{skipVerification:e}={}){const n=oa(r);if(n===void 0||r.content==="")return;let a;try{a=JSON.parse(r.content)}catch{return}if(a.id===n.id&&!(!e&&!yn(a)))return a}var kl={};U(kl,{NOSTR_URI_REGEX:()=>Ft,parse:()=>xl,test:()=>Cl});var Ft=new RegExp(`nostr:(${ea.source})`);function Cl(r){return typeof r=="string"&&new RegExp(`^${Ft.source}$`).test(r)}function xl(r){const e=r.match(new RegExp(`^${Ft.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${r}`);return{uri:e[0],value:e[1],decoded:It(e[1])}}var Ll={};U(Ll,{finishReactionEvent:()=>Rl,getReactedEventPointer:()=>_l});function Rl(r,e,n){const a=e.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return me({...r,kind:bn,tags:[...r.tags??[],...a,["e",e.id],["p",e.pubkey]],content:r.content??"+"},n)}function _l(r){if(r.kind!==bn)return;let e,n;for(let a=r.tags.length-1;a>=0&&(e===void 0||n===void 0);a--){const i=r.tags[a];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(a=>a!==void 0),author:n[1]}}var Al={};U(Al,{matchAll:()=>Pl,regex:()=>kn,replaceAll:()=>Il});var kn=()=>new RegExp(`\\b${Ft.source}\\b`,"g");function*Pl(r){const e=r.matchAll(kn());for(const n of e)try{const[a,i]=n;yield{uri:a,value:i,decoded:It(i),start:n.index,end:n.index+a.length}}catch{}}function Il(r,e){return r.replaceAll(kn(),(n,a)=>e({uri:n,value:a,decoded:It(a)}))}var Ul={};U(Ul,{channelCreateEvent:()=>zl,channelHideMessageEvent:()=>Ol,channelMessageEvent:()=>Fl,channelMetadataEvent:()=>Tl,channelMuteUserEvent:()=>Ml});var zl=(r,e)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return me({kind:Wr,tags:[...r.tags??[]],content:n,created_at:r.created_at},e)},Tl=(r,e)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return me({kind:Gr,tags:[["e",r.channel_create_event_id],...r.tags??[]],content:n,created_at:r.created_at},e)},Fl=(r,e)=>{const n=[["e",r.channel_create_event_id,r.relay_url,"root"]];return r.reply_to_channel_message_event_id&&n.push(["e",r.reply_to_channel_message_event_id,r.relay_url,"reply"]),me({kind:qr,tags:[...n,...r.tags??[]],content:r.content,created_at:r.created_at},e)},Ol=(r,e)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return me({kind:Jr,tags:[["e",r.channel_message_event_id],...r.tags??[]],content:n,created_at:r.created_at},e)},Ml=(r,e)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return me({kind:Zr,tags:[["p",r.pubkey_to_mute],...r.tags??[]],content:n,created_at:r.created_at},e)},Bl={};U(Bl,{EMOJI_SHORTCODE_REGEX:()=>la,matchAll:()=>Nl,regex:()=>Cn,replaceAll:()=>$l});var la=/:(\w+):/,Cn=()=>new RegExp(`\\B${la.source}\\B`,"g");function*Nl(r){const e=r.matchAll(Cn());for(const n of e)try{const[a,i]=n;yield{shortcode:a,name:i,start:n.index,end:n.index+a.length}}catch{}}function $l(r,e){return r.replaceAll(Cn(),(n,a)=>e({shortcode:n,name:a}))}var Dl={};U(Dl,{useFetchImplementation:()=>Kl,validateGithub:()=>Hl});var xn;try{xn=fetch}catch{}function Kl(r){xn=r}async function Hl(r,e,n){try{return await(await xn(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${r}`}catch{return!1}}var jl={};U(jl,{default:()=>ql,v2:()=>ca});var Vl=new TextDecoder,N={minPlaintextSize:1,maxPlaintextSize:65535,utf8Encode:Ki,utf8Decode(r){return Vl.decode(r)},getConversationKey(r,e){const n=fn.getSharedSecret(r,"02"+e).subarray(1,33);return Hi(Ne,n,"nip44-v2")},getMessageKeys(r,e){const n=ji(Ne,r,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}},calcPaddedLen(r){if(!Number.isSafeInteger(r)||r<1)throw new Error("expected positive integer");if(r<=32)return 32;const e=1<<Math.floor(Math.log2(r-1))+1,n=e<=256?32:e/8;return n*(Math.floor((r-1)/n)+1)},writeU16BE(r){if(!Number.isSafeInteger(r)||r<N.minPlaintextSize||r>N.maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,r,!1),e},pad(r){const e=N.utf8Encode(r),n=e.length,a=N.writeU16BE(n),i=new Uint8Array(N.calcPaddedLen(n)-n);return kt(a,e,i)},unpad(r){const e=new DataView(r.buffer).getUint16(0),n=r.subarray(2,2+e);if(e<N.minPlaintextSize||e>N.maxPlaintextSize||n.length!==e||r.length!==2+N.calcPaddedLen(e))throw new Error("invalid padding");return N.utf8Decode(n)},hmacAad(r,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const a=kt(n,e);return Vi(Ne,r,a)},decodePayload(r){if(typeof r!="string")throw new Error("payload must be a valid string");const e=r.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(r[0]==="#")throw new Error("unknown encryption version");let n;try{n=ye.decode(r)}catch(s){throw new Error("invalid base64: "+s.message)}const a=n.length;if(a<99||a>65603)throw new Error("invalid data length: "+a);const i=n[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}};function Wl(r,e,n=Ur(32)){const{chacha_key:a,chacha_nonce:i,hmac_key:s}=N.getMessageKeys(e,n),o=N.pad(r),l=Tr(a,i,o),h=N.hmacAad(s,l,n);return ye.encode(kt(new Uint8Array([2]),n,l,h))}function Gl(r,e){const{nonce:n,ciphertext:a,mac:i}=N.decodePayload(r),{chacha_key:s,chacha_nonce:o,hmac_key:l}=N.getMessageKeys(e,n),h=N.hmacAad(l,a,n);if(!Wi(h,i))throw new Error("invalid MAC");const c=Tr(s,o,a);return N.unpad(c)}var ca={utils:N,encrypt:Wl,decrypt:Gl},ql={v2:ca},Jl={};U(Jl,{makeNwcRequestEvent:()=>Xl,parseConnectionString:()=>Zl});function Zl(r){const{pathname:e,searchParams:n}=new URL(r),a=e,i=n.get("relay"),s=n.get("secret");if(!a||!i||!s)throw new Error("invalid connection string");return{pubkey:a,relay:i,secret:s}}async function Xl(r,e,n){const i=await ta(e,r,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:Yr,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",r]]};return me(s,e)}var Yl={};U(Yl,{getZapEndpoint:()=>ec,makeZapReceipt:()=>rc,makeZapRequest:()=>tc,useFetchImplementation:()=>Ql,validateZapRequest:()=>nc});var Ln;try{Ln=fetch}catch{}function Ql(r){Ln=r}async function ec(r){try{let e="",{lud06:n,lud16:a}=JSON.parse(r.content);if(n){let{words:o}=$e.decode(n,1e3),l=$e.fromWords(o);e=ce.decode(l)}else if(a){let[o,l]=a.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${l}`).toString()}else return null;let s=await(await Ln(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function tc({profile:r,event:e,amount:n,relays:a,comment:i=""}){if(!n)throw new Error("amount not given");if(!r)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",r],["amount",n.toString()],["relays",...a]]};return e&&s.tags.push(["e",e]),s}function nc(r){let e;try{e=JSON.parse(r)}catch{return"Invalid zap request JSON."}if(!$r(e))return"Zap request is not a valid Nostr event.";if(!yn(e))return"Invalid signature on zap request.";let n=e.tags.find(([s,o])=>s==="p"&&o);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let a=e.tags.find(([s,o])=>s==="e"&&o);return a&&!a[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,o])=>s==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function rc({zapRequest:r,preimage:e,bolt11:n,paidAt:a}){let i=JSON.parse(r),s=i.tags.filter(([l])=>l==="e"||l==="p"||l==="a"),o={kind:9735,created_at:Math.round(a.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",r]]};return e&&o.tags.push(["preimage",e]),o}var ac={};U(ac,{getToken:()=>ic,hashPayload:()=>Rn,unpackEventFromToken:()=>ua,validateEvent:()=>ya,validateEventKind:()=>fa,validateEventMethodTag:()=>va,validateEventPayloadTag:()=>pa,validateEventTimestamp:()=>ha,validateEventUrlTag:()=>ga,validateToken:()=>sc});var da="Nostr ";async function ic(r,e,n,a=!1,i){const s={kind:wn,tags:[["u",r],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",Rn(i)]);const o=await n(s);return(a?da:"")+ye.encode(ae.encode(JSON.stringify(o)))}async function sc(r,e,n){const a=await ua(r).catch(s=>{throw s});return await ya(a,e,n).catch(s=>{throw s})}async function ua(r){if(!r)throw new Error("Missing token");r=r.replace(da,"");const e=ce.decode(ye.decode(r));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function ha(r){return r.created_at?Math.round(new Date().getTime()/1e3)-r.created_at<60:!1}function fa(r){return r.kind===wn}function ga(r,e){const n=r.tags.find(a=>a[0]==="u");return n?n.length>0&&n[1]===e:!1}function va(r,e){const n=r.tags.find(a=>a[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function Rn(r){const e=Ne(ae.encode(JSON.stringify(r)));return O(e)}function pa(r,e){const n=r.tags.find(i=>i[0]==="payload");if(!n)return!1;const a=Rn(e);return n.length>0&&n[1]===a}async function ya(r,e,n,a){if(!yn(r))throw new Error("Invalid nostr event, signature invalid");if(!fa(r))throw new Error("Invalid nostr event, kind invalid");if(!ha(r))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!ga(r,e))throw new Error("Invalid nostr event, url tag invalid");if(!va(r,n))throw new Error("Invalid nostr event, method tag invalid");if(a&&typeof a=="object"&&Object.keys(a).length>0&&!pa(r,a))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}class Ot extends At{constructor(e){super(),e?(this.nostrApiProvide.resolve({async encrypt(n,a){return await on.encrypt(e,n.toHex(),a)},async decrypt(n,a){return await on.decrypt(e,n.toHex(),a)},async signEvent(n){const a=Ai(Object.assign({kind:1,pubkey:e.getPubkey(),created_at:Math.floor(Date.now()/1e3),tags:[],content:""},n),e);return Promise.resolve(a)},async getPublicKey(){return e.getPubkey()}}),this.getPrikey=()=>e):this.nostrApiProvide.resolve(new vn)}}class ma extends At{constructor(){super(),this.provide()}provide(){gi(async()=>{if(window.nostr){this.nostrApiProvide.resolve(this.windowNostrToNostrApi(window.nostr));return}else this.nostrApiProvide.reject(new Nr("WebNostrApi"))})}windowNostrToNostrApi(e){let n={};e.getRelays&&(n.getRelays=e.getRelays.bind(e)),e.signEvent&&(n.signEvent=e.signEvent.bind(e)),e.getPublicKey&&(n.getPublicKey=async()=>re.fromHex(await e.getPublicKey()));let a=e.nip04;if(a){if(a.decrypt){let i=a.decrypt.bind(a);n.decrypt=(s,o)=>(a.decrypt??i)(s.toHex(),o)}if(a.encrypt){let i=a.encrypt.bind(a);n.encrypt=(s,o)=>(a.encrypt??i)(s.toHex(),o)}}return n}}const _n=p("now-create-at",r=>r.assignFn({nowCreateAt(){return Math.floor(Date.now()/1e3)}})),An=p("nostr-api",({mod:r,line:e})=>r.assignFeat({nostrApi:new vn,getNostrApi(){return this.nostrApi},setNostrApi(n){this.nostrApi=n}})),ba="prikey",wa=p(()=>[_n,An],"login",({mod:r,line:e})=>r.assignFn({logout(){this.nostrApi=Be()}}).inLine(n=>n.setNostrApi(oc(n))).assignFn({testAndVerifyNewUser(){const n=localStorage.getItem("newUserFlag"),a=localStorage.getItem("prikey"),i=a&&Pi(Et.fromHex(a));return!!(Ze()===Y.PrivateKey&&n&&n===i)},getNostrApiMode:Ze,setNostrApiMode:qe,loginPrikey(n){localStorage.setItem(ba,n.toHex()),qe(Y.PrivateKey);const a=new Ot(n);this.setNostrApi(a)},windowNostrLogin(){let n=new ma;this.loginApi(Y.WindowNostr,n)},loginApi(n,a){qe(n),this.setNostrApi(a)},registerPrikey(n=Et.create()){this.loginPrikey(n);const a=n.getPubkey();return localStorage.setItem("newUserFlag",a.toHex()),n},clearNewUserFlag(){localStorage.removeItem("newUserFlag")}}));function oc(r){switch(Ze()){case Y.NotLogin:return Be();case Y.WindowNostr:return new ma;case Y.PrivateKey:const n=localStorage.getItem(ba);return n?new Ot(Et.fromHex(n)):Be();case Y.NostrConnect:const a=localStorage.getItem("bunker");if(!a)return Be();try{const i=Bn.fromBunker(r,a);return i.connect(),i}catch{return Be()}default:return Be()}}function Be(){return qe(Y.NotLogin),new vn}const Pn=p(()=>[An],({mod:r,line:e})=>r.assignFn({async getPrikeyOrNull(){if(Ze()!==Y.PrivateKey)return null;let n=this.getNostrApi();if(!(n instanceof Ot))return null;if(n.getPrikey){try{return n.getPrikey()}catch{}return null}},async getPubkeyOrNull(n){try{return await this.getNostrApi().getPublicKey()}catch{return null}},async isLogin(){return!!this.getPubkeyOrNull()}})),et=p(()=>[xr("pool-staff")],r=>r.assignFeat({publish(e,n,a={}){this.relayPool.getLine().onOK((i,s)=>{var o;(o=a.onOK)==null||o.call(a,i,s)},{eventId:n.id}),this.relayPool.getLine().emit("publish",e,n)},publishes(e,n,a={}){for(const i of e)this.publish(i,n,a)},publishEvents(e,n,a={}){for(const i of n)this.publish(e,i,a)},publishesEvents(e,n,a={}){for(const i of n)this.publishes(e,i,a)}})),Sa=p("create-id",r=>r.defineFeat("createId",pr)),Mt=p(r=>r.defineEmit().assignChain({emitEose(e,n){this.emit({once:!0,type:`eose:${e}`,noPause:!0},e,n),this.emit({type:"eose",noPause:!0},e,n)},onEose(e,n){n!=null&&n.subId?this.on(`eose:${n.subId}`,e,Object.assign({once:!0},n)):this.on("eose",e,n)}}));let lc=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/sub/SubStaff.ts");const tt=p(()=>[Sa,xr("pool-staff"),ie,Mt],r=>r.assignFn({sub(e,n,{onEvent:a,onEose:i,subId:s,eoseAutoDesub:o}={}){lc.silly("sub",e,n);let l=s||this.createId();this.relayPool.getLine().onEvent((...h)=>{this.emitEvent(...h)},{subId:l}),this.relayPool.getLine().onEose((h,c)=>{o&&this.relayPool.getLine().emit("desub",h,c),this.emitEose(h,c)},{subId:l}),this.relayPool.getLine().emit("sub",e,n,l)},subs(e,n,a){for(const i of e)this.sub(i,n,a)}})),nt=p(r=>r.defineEmit().assignOwnFeat(()=>({urlList:new Set})).assignFeat({getUrls(){this.urlList}}).assignChain({addUrl(e){this.addUrls(new Set([e]))},addUrls(e){if(e.size===0)return;let n=new Set;for(const a of e)this.urlList.has(a)||(this.urlList.add(a),n.add(a));n.size>0&&this.emit("add-urls",n)}}).assignFeat({async addUrlsOrNull(e,n){if(!(!e||e.size===0))return this.addUrls(e),await(n==null?void 0:n())},async addUrlsWithTimeout(e,n=1e3){return await this.addUrlsOrNull(e,()=>W(n))}})),Ea=p(({mod:r,line:e})=>r.assignOwnFeat(()=>({filterList:new Array}))),He=p(()=>[nt,Re,et,tt,Ea],"add-filter-staff",r=>{let e=r.defineEmit().assignOwnFeat(()=>({filterMap:new Map,subOpts:void 0})).assignFeat({getFilters(){return this.filterList}}).assignChain({setSubOpt(n){this.subOpts=n},addFilter(n){this.addFilters([n])},addFiltersByOptions(n){n.filters&&this.addFilters(n.filters),n.filter&&this.addFilter(n.filter)},addFilters(n){if(n.length===0)return;let a=[];for(const i of n){let s=JSON.stringify(i);this.filterMap.has(s)||(this.filterMap.set(s,i),this.filterList.push(i),a.push(i))}a.length>0&&this.emit("add-filters",a)}});return e.line.onCreateChildDep(n=>{console.log("onCreateChildDep"),n.on("add-urls",a=>{n.subs(a,n.filterList,n.subOpts),n.on("add-filters",i=>{n.subs(a,i,n.subOpts)})})}),e}),Bt=p(()=>[nt,Re,et],"AddPublishStaff",({mod:r,line:e})=>{let n=r.defineEmit().assignOwnFeat(()=>({publishedEventIds:new Set,publishedEventList:[]})).assignChain({addPublish(a,i){this.publishedEventIds.has(a.id)||(this.emit("add-publish",a,i),this.publishedEventIds.add(a.id),this.publishedEventList.push(i?[a,i]:[a]))},addPublishes(a,i){for(const s of a)this.addPublish(s,i)}});return n.line.onCreateChildDep(a=>{a.on("add-urls",i=>{a.publishedEventList.map(([s,o])=>{a.publishes(i,s,o)}),a.on("add-publish",(s,o)=>{a.publishes(i,s,o)})})}),n}),cc=p(()=>[Dt,Bt,Tn,it],({mod:r,line:e})=>r.assignFn({async deleteEvent(n){console.log("deleteEvent",n);const a=this.createChild(),i=[];n.eventId&&i.push(["e",n.eventId]),n.a&&i.push(["a",n.a]),a.addPublish(await e.createEvent({kind:5,tags:i,content:""}),n.publishOpts),a.addUrlsByCubChain(n),a.asyncCall(async function(){this.addUrls(await this.relayConfigurator.initedGetWriteList())})}})),dc=p(()=>[at,Kn,Pn,He,Dt,Bt,Tn,cc,_e,it],({mod:r,line:e})=>r.assignFeat({reactionCache:e.reactive(new yr("reaction-cache")),reactionsKeyList:e.reactive(new vi("__reactionsKeyList"))}).assignFn({getLikeByPubkey(n,a){return n=typeof n=="string"?re.fromHex(n):n,this.commonEventList({...a,pubkey:n,filters:[{authors:[n.toHex()],kinds:[7],limit:20}]})},async sendReactions(n,a,i){if(this.hasReactions(n,a.id))return;let s=mt(a.tags,["e","p"]);s.push(["e",a.id]),s.push(["p",a.pubkey]),s.push(["k",a.kind.toString()]);const o=this.createChild(),l=await this.createEvent({content:n,kind:7,tags:s});o.addPublish(l,i),o.addUrlsByCub({...i,autoAdd10002Options:{read:!0},pubkeys:[a.pubkey],tags:a.tags}),o.addUrls(await this.relayConfigurator.initedGetWriteList()),this.reactionCache.set(this.createReactionsKey(n,a.id),l.id)},async sendLike(n,a){await this.sendReactions("+",n,a)},async sendDislike(n,a){await this.sendReactions("-",n,a)},async deleteReactions(n,a){if(a.eventId){const i=this.createReactionsKey(n,a.eventId);let s=this.reactionCache.get(i);s&&this.deleteEvent({eventId:s,publishOpts:a.onOK?{onOK:a.onOK}:void 0,autoAdd10002Options:{read:!0},...a.cue})}else a.likeId&&this.deleteEvent({eventId:a.likeId,publishOpts:a.onOK?{onOK:a.onOK}:void 0,autoAdd10002Options:{read:!0},...a.cue})},deleteLike(n){this.deleteReactions("+",n)},deleteDislike(n){this.deleteReactions("-",n)},hasReactions(n,a){const i=this.createReactionsKey(n,a);return!!this.reactionCache.get(i)},hasLike(n){return this.hasReactions("+",n)},hasDislike(n){return this.hasReactions("-",n)},createReactionsKey(n,a){return`reaction:${n}:${a}`},getReactionByEventId(n,a){return this.cacheByOptions(a,()=>this.createChild().add(xt).add(de).add(Fa).add(uc).provideReactionMap().addFilters([{"#e":[n],kinds:[7],limit:20}]).onEvent((i,s)=>{this.reactionsKeyList.add(s.content)}).chainCall(()=>this.addUrlsByCub(a)))},getReactionByEvent(n,a){return this.getReactionByEventId(n.id,{...a,pubkeys:[n.pubkey],autoAdd10002Options:{write:!0}})}})),uc=p(()=>[_e,ie],({mod:r,line:e})=>r.provide("ReactionMap",function(){let n=e.reactive({});return this.onEvent((a,i)=>{n[i.content]??(n[i.content]=[]).push(i)}),n}).assignFn({getReactiveMap(){return this.injectReactionMap()}}));class Nt{constructor(e){return e.add(dc).reactive(this)}}const de=p(()=>[nt,He,tt,et,Bt,Lr],"manager-staff",({mod:r,line:e})=>r),hc=p(()=>[In,Ra,Mt,ie],r=>r),ka=p("default-urls",({mod:r,line:e})=>r.assignFeat({defaultUrls:new Set(["wss://no.str.cr","wss://no-str.org","wss://nos.lol","wss://nostr.com.de","wss://relay.mostr.pub","wss://relay.nostr.wirednet.jp","wss://no-str.org","wss://brb.io"]),setDefaultUrls(n){this.defaultUrls=n},addDefaultUrls(n){pe(this.defaultUrls,n)}}));var Ca={exports:{}},Qt={exports:{}},ar;function fc(){return ar||(ar=1,function(r){(function(e){var n={bytesToHex:function(s){return a(s)},hexToBytes:function(s){if(s.length%2===1)throw new Error("hexToBytes can't have a string with an odd number of characters.");return s.indexOf("0x")===0&&(s=s.slice(2)),s.match(/../g).map(function(o){return parseInt(o,16)})}};function a(s){return s.map(function(o){return i(o.toString(16),2)}).join("")}function i(s,o){return s.length>o?s:Array(o-s.length+1).join("0")+s}r.exports?r.exports=n:e.convertHex=n})(gn)}(Qt)),Qt.exports}var en={exports:{}},ir;function gc(){return ir||(ir=1,function(r){(function(e){var n={bytesToString:function(a){return a.map(function(i){return String.fromCharCode(i)}).join("")},stringToBytes:function(a){return a.split("").map(function(i){return i.charCodeAt(0)})}};n.UTF8={bytesToString:function(a){return decodeURIComponent(escape(n.bytesToString(a)))},stringToBytes:function(a){return n.stringToBytes(unescape(encodeURIComponent(a)))}},r.exports?r.exports=n:e.convertString=n})(gn)}(en)),en.exports}(function(r){(function(e){var n={};r.exports?(n.bytesToHex=fc().bytesToHex,n.convertString=gc(),r.exports=h):(n.bytesToHex=e.convertHex.bytesToHex,n.convertString=e.convertString,e.sha256=h);var a=[];(function(){function c(v){for(var m=Math.sqrt(v),k=2;k<=m;k++)if(!(v%k))return!1;return!0}function f(v){return(v-(v|0))*4294967296|0}for(var b=2,u=0;u<64;)c(b)&&(a[u]=f(Math.pow(b,1/3)),u++),b++})();var i=function(c){for(var f=[],b=0,u=0;b<c.length;b++,u+=8)f[u>>>5]|=c[b]<<24-u%32;return f},s=function(c){for(var f=[],b=0;b<c.length*32;b+=8)f.push(c[b>>>5]>>>24-b%32&255);return f},o=[],l=function(c,f,b){for(var u=c[0],v=c[1],m=c[2],k=c[3],A=c[4],R=c[5],$=c[6],se=c[7],M=0;M<64;M++){if(M<16)o[M]=f[b+M]|0;else{var T=o[M-15],be=(T<<25|T>>>7)^(T<<14|T>>>18)^T>>>3,z=o[M-2],x=(z<<15|z>>>17)^(z<<13|z>>>19)^z>>>10;o[M]=be+o[M-7]+x+o[M-16]}var Z=A&R^~A&$,ee=u&v^u&m^v&m,ue=(u<<30|u>>>2)^(u<<19|u>>>13)^(u<<10|u>>>22),we=(A<<26|A>>>6)^(A<<21|A>>>11)^(A<<7|A>>>25),he=se+we+Z+a[M]+o[M],Ae=ue+ee;se=$,$=R,R=A,A=k+he|0,k=m,m=v,v=u,u=he+Ae|0}c[0]=c[0]+u|0,c[1]=c[1]+v|0,c[2]=c[2]+m|0,c[3]=c[3]+k|0,c[4]=c[4]+A|0,c[5]=c[5]+R|0,c[6]=c[6]+$|0,c[7]=c[7]+se|0};function h(c,f){c.constructor===String&&(c=n.convertString.UTF8.stringToBytes(c));var b=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],u=i(c),v=c.length*8;u[v>>5]|=128<<24-v%32,u[(v+64>>9<<4)+15]=v;for(var m=0;m<u.length;m+=16)l(b,u,m);var k=s(b);return f&&f.asBytes?k:f&&f.asString?n.convertString.bytesToString(k):n.bytesToHex(k)}h.x2=function(c,f){return h(h(c,{asBytes:!0}),f)}})(gn)})(Ca);var vc=Ca.exports;const pc=ls(vc),xa=p(r=>r.defineEmit()),La=p(r=>r.defineEmit("closeRelay",["url"]));async function yc(r){return new Promise((e,n)=>{logger.http("Start connecting:",r);try{const a=new URL(r);try{const i=new WebSocket(a);i.onopen=()=>{logger.http("Successfully connected:",r),e(i)},i.onerror=s=>{logger.http("connect failed:",r),n(s)}}catch(i){logger.error("WebSocket",i)}}catch{logger.error("Incorrect connection",r)}})}const mc=p("web-socket-factory",r=>r.assignFeat({webSocketFactory:yc})),bc=p(({mod:r})=>r.defineEmit()),sr=p(({mod:r,line:e})=>r.defineEmit().defineEmit()),ie=p(r=>r.defineEmit().defineEmit().assignChain({async emitEvent(e,n,a="local"){await this.emit({types:["event",`event:${e}`],onReturn:(i,{stop:s})=>i&&s()},e,n,a)},onEvent(e,n){n!=null&&n.subId?this.on(`event:${n.subId}`,e,n):this.on("event",e,n)}}));var Oe=Symbol("verified"),wc=r=>r instanceof Object;function Sc(r){if(!wc(r)||typeof r.kind!="number"||typeof r.content!="string"||typeof r.created_at!="number"||typeof r.pubkey!="string"||!r.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(r.tags))return!1;for(let e=0;e<r.tags.length;e++){let n=r.tags[e];if(!Array.isArray(n))return!1;for(let a=0;a<n.length;a++)if(typeof n[a]=="object")return!1}return!0}new TextDecoder("utf-8");var Ec=new TextEncoder,kc=class{generateSecretKey(){return ne.utils.randomPrivateKey()}getPublicKey(r){return O(ne.getPublicKey(r))}finalizeEvent(r,e){const n=r;return n.pubkey=O(ne.getPublicKey(e)),n.id=St(n),n.sig=O(ne.sign(St(n),e)),n[Oe]=!0,n}verifyEvent(r){if(typeof r[Oe]=="boolean")return r[Oe];const e=St(r);if(e!==r.id)return r[Oe]=!1,!1;try{const n=ne.verify(r.sig,e,r.pubkey);return r[Oe]=n,n}catch{return r[Oe]=!1,!1}}};function Cc(r){if(!Sc(r))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,r.pubkey,r.created_at,r.kind,r.tags,r.content])}function St(r){let e=Ne(Ec.encode(Cc(r)));return O(e)}var $t=new kc;$t.generateSecretKey;$t.getPublicKey;$t.finalizeEvent;var xc=$t.verifyEvent;const Ra=p(r=>r.defineEmit());let Lc=10*1e3;const In=p(r=>r.defineEmit().assignChain({emitOK(...[e,n]){this.emit({types:["ok",`ok:${e}`]},e,n)},onOK(e,n){if(n!=null&&n.eventId){const a=`ok:${n.eventId}`;this.once(a,e,n)}else{const a="ok";this.on(a,e,n),W(Lc).then(()=>{this.removeListener(a,e)})}}}));let tn=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/server/Relay.ts"),Rc=dn(10);class _c{constructor(e,n){this._line=e,this.subIds=new Set,this.timeout=void 0,this.isClose=!1,this.publishIds=new Set,this.getLine=pi(()=>this._line.add(Un.Staff,La,xa,et,In,Mt,Ra,ie)),this.ws=n,this.ws.onmessage=(...a)=>{Rc.unShift(()=>{this.handleMessage(...a)})}}handleMessage(e){try{const n=JSON.parse(e.data);tn.http("handleMessage",this.ws.url,n);let a="";if(Array.isArray(n))switch(n[0]){case"EVENT":a=n[1];let i=n[2];if(!xc(i)){tn.error("Event signature error");return}this.getLine().emitEvent(a,i,this.ws.url);break;case"NOTICE":this.getLine().emit("notice",n[1],this.ws.url);break;case"EOSE":a=n[1],this.getLine().emitEose(a,this.ws.url);break;case"OK":let s=n[1];this.getLine().emitOK(s,{ok:n[2],message:n[3],url:this.ws.url}),this.closePublish(s);break;case"AUTH":const o=n[1];this.getLine().emit("auth",this.ws.url,o);break;default:break}}catch{return}}auth(e){this.send(["AUTH",e])}send(e){tn.http("send:",e[0],this.ws.url,e),window.sendCount++,this.ws.send(JSON.stringify(e))}createSubId(){return Math.random().toString().slice(2)}req(e,n=this.createSubId()){this.addSubId(n);try{this.send(["REQ",n,...e])}catch{this.deleteSubId(n)}return n}closePublish(e){this.publishIds.has(e)&&(this.publishIds.delete(e),this.autoClose())}publish(e){this.send(["EVENT",e]),this.publishIds.add(e.id),setTimeout(()=>{this.closePublish(e.id)},6e4)}closeReq(e){this.subIds.has(e)&&(this.send(["CLOSE",e]),this.deleteSubId(e))}addSubId(e){this.isClose&&(this.isClose=!0,this.getLine().relayPool.getPool().set(this.ws.url,this)),this.subIds.add(e),this.getLine().relayPool.allSubIds.add(e)}deleteSubId(e){this.subIds.has(e)&&(this.subIds.delete(e),this.getLine().relayPool.allSubIds.delete(e),this.getLine().removeAllListener(`event:${e}`),this.autoClose())}close(){if(!this.isClose){this.isClose=!0;for(const e of this.subIds)this.deleteSubId(e);this.ws.close(),this.getLine().relayPool.closeRelay(this.ws.url),this.getLine().emit(`relay-closed:${this.ws.url}`)}}clearAutoClose(){clearTimeout(this.timeout),this.timeout=void 0}autoClose(e=!1){this.subIds.size>0||this.publishIds.size>0||(e?this.close():this.timeout=setTimeout(()=>{this.autoClose(!0)},6e4))}}const Un=Rr({name:"relayPool",id:"pool-staff"},class extends Nt{constructor(e){super(e),this.name="relayPool",this.pool=new Map,this.allSubIds=new Set,this.getLine=Ye(()=>e.createChild().add(mc).add(sr).add(sr).add(bc).add(La).add(xa).add(ie).add(Mt).add(In)),this.listen()}async listen(){logger.debug("listen"),this.getLine().on("sub",async(e,n,a)=>{logger.http("sub",e,a,n),(await this.getRelay(e)).req(n,a)}),this.getLine().on("desub",async(e,n)=>{if(logger.http("desub",n,e),!this.allSubIds.has(e))return;this.allSubIds.delete(e);const a=this.getRelayFromPool(n);a&&a.closeReq(e)}),this.getLine().on("publish",async(e,n)=>{logger.http("publish",e,n),(await this.getRelay(e)).publish(n)}),this.getLine().on("closeRelay",async e=>{logger.http("closeRelay",e);const n=this.getRelayFromPool(e);n&&n.close()}),this.getLine().on("auth",async(e,n)=>{logger.http("auth",e,n),(await this.getRelay(e)).auth(n)})}getPool(){return this.pool}async getRelay(e){const n=this.pool.get(e);return n||await this.createRelay(e)}getRelayFromPool(e){return this.pool.get(e)}closeRelay(e){if(!this.pool.has(e))return;let n=this.getRelayFromPool(e);if(n){for(const a of n.subIds)this.allSubIds.delete(a);n.close()}this.pool.delete(e)}async createRelay(e){return new Promise(async(n,a)=>{const i=await this.getLine().webSocketFactory(e);i.onerror=i.onclose=()=>{this.closeRelay(e)};const s=new _c(this.getLine(),i);this.pool.set(e,s),n(s)})}}),Ac=p(()=>[de,ka,Un.Staff,_e],({mod:r,line:e})=>{let n=dn(500),a=yi({max:10,min:10}),i="global-urls",{mod:s,line:o}=r.defineEmit().assignFeat({globalUrlList:e.reactive({value:new Set})}).assignFn({getCacheGlobalUrls(){let l=mi(i);return l&&new Set(l)},setGlobalUrlList(l){this.globalUrlList.value=l},loadCacheGlobalUrls(){let l=this.getCacheGlobalUrls();if(l)return this.setGlobalUrlList(pe(this.getGlobalUrls(),l)),o.emit("added-the-global-url-list",new Set(l),this.getGlobalUrls()),l},fetchGlobalUrls(l){logger.debug("fetchGlobalUrls");let h=Gn(f=>{br(i,[...f],{duration:1*1e3*3600*24,useLocalStorage:!0,useMemoryCache:!0})},1e4);l&&pe(this.getGlobalUrls(),l);let c=this.createChild();return c.onEvent((f,b)=>{const{write:u,read:v}=Ii(b.tags);let m=pe(new Set,u,v),k=bi(m,this.getGlobalUrls());if(pe(this.getGlobalUrls(),k),o.emit("added-the-global-url-list",k,this.getGlobalUrls()),c.emit("added-the-global-url-list",k,this.getGlobalUrls()),h(this.getGlobalUrls()),a.isValidVote()&&a.proportion(!1)>=.9){n.clear(),c.removeAllListener("added-the-global-url-list"),c.emitter.clear(),logger.silly("fetchGlobalUrls:已关闭并清理",a.proportion(!1));return}if(k.size===0||k.size/m.size<.1||this.getGlobalUrls().size>99){a.add(!1);return}a.add(!0),k.forEach(A=>{n.unShift(()=>{e.addUrl(A)})})}).setSubOpt({eoseAutoDesub:!0}).addFilter({kinds:[10002],limit:200}).addUrls(l||this.defaultUrls)},getGlobalUrls(){return this.globalUrlList.value},autoGetGlobalUrls(){return mr("autoGetGlobalUrls",()=>new Promise((l,h)=>{let c=this;function*f(){yield c.getGlobalUrls(),yield c.loadCacheGlobalUrls()}for(const v of f())if(v&&v.size>=30){l(v);return}let b=Gn(l,4e3),u=this.fetchGlobalUrls();u==null||u.on("added-the-global-url-list",()=>{b(this.getGlobalUrls())})}),{useLocalStorage:!1,useMemoryCache:!0,duration:99,requestMerge:!0})},addGlobalUrls(l){pe(this.getGlobalUrls(),l)}});return s});let or={};const _a=p(()=>[ka,Ac],({mod:r,line:e})=>r.assignFeat({async autoGlobalDiscoveryUserByPubkey(n,a=50,i){let s=qn.fromHex(n.toHex());function o(l){for(const h of l)or[h]=qn.fromHex(pc(h))}return o(await this.autoGetGlobalUrls()),new Set(Object.entries(or).map(([l,h])=>({url:l,priority:s.XOR(h).leadingZeroNumber()})).sort((l,h)=>h.priority-l.priority).slice(0,a).map(({url:l})=>l))}})),Lt=p(()=>[tt,Re],r=>(r.out().onCreateChildDep(n=>{n.on("eose",(a,i)=>{n.relayPool.getLine().emit("desub",a,i)})}),r)),Pc=p(()=>[tt],r=>r.assignFn({timeoutAutoUnsub(e=20*1e3*60){this.relayPool.getLine().on("sub",(n,a,i)=>{setTimeout(()=>{this.relayPool.getLine().emit("desub",i,n)},e)})}})),zn=p(()=>[_a],({mod:r,line:e})=>r.assignFeat({autoAddUrlByGlobalDiscoveryUser(n,a=5){let i=dn(1e3);function s(o,l){for(const h of o)i.unShift(()=>{l.addUrl(h)})}return this.autoGlobalDiscoveryUserByPubkey(n,a).then(o=>{s(o,this)}),()=>{i.clear()}}})),Tn=p(()=>[_n,Pn],({mod:r,line:e})=>r.assignFn({createEventTemplate(n){return Object.assign({kind:1,tags:[],content:"",created_at:this.nowCreateAt()},n)},async createEvent(n){const a=await this.getPubkeyOrNull();if(!a)throw new Error("pubkey");let i=Object.assign(this.createEventTemplate(n),{pubkey:a.toHex()});return this.createEventTemplate({}),i=JSON.parse(JSON.stringify(i)),i.id=St(i),i=await this.getNostrApi().signEvent(i),i}}));class Fn{constructor(e,n){this.map={},this.cacheOption={duration:1e3*60*60*24,...wi,...n==null?void 0:n.cacheOptions},this.KEY=e;const a=localStorage.getItem(e);if(a)try{const i=JSON.parse(a);typeof i=="object"&&(this.map=i)}catch{localStorage.removeItem(e)}}allMap(){const e={},n=this.map;for(const a in n){const i=this.get(a);i&&(e[a]=i)}return e}values(){const e=[],n=this.map;for(const a in n){const i=this.get(a);i&&e.push(i)}return e}set(e,n){const a=n.id;this.map[e]=a,br(a,n,this.cacheOption),this.updateMap()}delete(e){delete this.map[e],wr(e),this.updateMap()}get(e){return this._getEvent(e)}_getEvent(e){const n=this.map[e];if(n)try{return Si(n,this.cacheOption)}catch{this.delete(e);return}}updateMap(){localStorage.setItem(this.KEY,JSON.stringify(this.map))}}class vt extends Fn{static isParameterizedReplaceableEvent(e){return e>=3e4&&e<4e4}constructor(e){super(`PRE:${e}`)}add(e){var l;let n=e.kind,a=e.pubkey,i=((l=hn("d",e.tags))==null?void 0:l[1])??"",s=`${n}:${a}:${i}`,o=this.getByA(s);(!o||e.created_at>o.created_at)&&this.set(s,e)}getByA(e){return this.get(typeof e=="string"?e:`${e.kind}:${e.pubkey}:${e.identifier}`)}filter(e){return Object.entries(this.allMap()).filter(([n])=>{let[a,i,s]=n.split(":");return e(parseInt(a),i,s)}).map(([n,a])=>a)}query(e,n,a){const i=[];for(const[s,o]of[[new Set(e),0],[new Set(n),1],[new Set(a),2]])s&&i.push((...l)=>s.has(l[o]));return i.length===0?this.values():this.filter((s,o,l)=>i.every(h=>h(s,o,l)))}}const Ic=[0,3];class pt extends Fn{static isReplaceableKind(e){return 1e4<=e&&e<2e4||Ic.some(n=>n===e)}constructor(e){super(`RE:${e}`)}add(e){let n=this.getByPubkey(e.pubkey);(!n||e.created_at>n.created_at)&&this.set(e.pubkey,e)}deleteEventByPubkey(e){this.delete(e)}getByPubkey(e){return this.get(e)}query(e){let n=[];for(const a of e){let i=this.getByPubkey(a);i&&n.push(i)}return n}}const Uc=new Set([1]);class yt extends Fn{static isCommonEventKind(e){return e>=1e3&&e<1e4||Uc.has(e)}constructor(e){super(`CE:${e}`)}add(e){this.set(e.id,e)}deleteById(e){this.delete(e)}getById(e){return this.get(e)}query(e){let n=[];for(const a of e){let i=this.getById(a);i&&n.push(i)}return n}}function lr(r,e={}){var n;return!(e.exclude&&(e.exclude instanceof Set||(e.exclude=new Set(e.exclude)),e.exclude.has(r))||e.include&&(e.include instanceof Set||(e.include=new Set(e.include)),!((n=e.include)!=null&&n.has(r))))}const On=p(()=>[ie,Ea],({mod:r,line:e})=>r.assignFeat({localMap:{},autoLocalCache(n){this.autoLoadCache(),n!=null&&n.disabledAutoCache||this.autoCacheEvent(n)},autoLoadCache(n){for(const a of this.filterList)this.autoLoadCacheByFilter(a,Object.assign({},n,{disabledAutoCache:!0}))},autoLoadCacheByFilter(n,a={}){if(n.kinds){for(const i of n.kinds){if(!lr(i,a))return;pt.isReplaceableKind(i)?this.loadReplaceableEvent(this.getInitReplaceableEventMap(i),n.authors):vt.isParameterizedReplaceableEvent(i)?this.loadParameterizedReplaceableEvent(this.getInitParameterizedReplaceableEventMap(i),i,n.authors,n["#d"]):yt.isCommonEventKind(i)&&this.loadCommonEvent(this.getInitCommonEvent(i),n.ids)}a!=null&&a.disabledAutoCache||this.autoCacheEvent()}},autoCacheEvent(n){this.on("event",(a,i)=>{let s=i.kind;lr(s,n)&&(pt.isReplaceableKind(s)?this.getInitReplaceableEventMap(s).add(i):vt.isParameterizedReplaceableEvent(s)?this.getInitParameterizedReplaceableEventMap(s).add(i):yt.isCommonEventKind(s)&&this.getInitCommonEvent(s).add(i))})},loadReplaceableEvent(n,a){if(!a){this.loadEvents(n.values());return}this.loadEvents(n.query(new Set(a)))},loadParameterizedReplaceableEvent(n,a,i,s){if(!i||!s){this.loadEvents(n.query(new Set([a]),i&&new Set(i),s&&new Set(s)));return}for(const o of i)for(const l of s){const h=n.getByA({kind:a,pubkey:o,identifier:l});h&&this.loadEvents([h])}},loadCommonEvent(n,a){if(!a){this.loadEvents(n.values());return}this.loadEvents(n.query(new Set(a)))},loadEvents(n){for(const a of n)a&&this.emitEvent("local",a)},getInitReplaceableEventMap(n){if(!pt.isReplaceableKind(n))throw new Error(`kind${n} not is a ReplaceableEvent`);return this.localMap[n]||(this.localMap[n]=new pt(n))},getInitCommonEvent(n){if(!yt.isCommonEventKind(n))throw new Error(`kind${n} not is a CommonEvent`);return this.localMap[n]||(this.localMap[n]=new yt(n))},getInitParameterizedReplaceableEventMap(n){if(!vt.isParameterizedReplaceableEvent(n))throw new Error(`kind${n} not is a ParameterizedReplaceableEvent`);return this.localMap[n]||(this.localMap[n]=new vt(n))}}));let nn=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/discovery/AutoAddKind10002UrlStaff.ts");const rt=p(()=>[Mn,nt,On,Q.Staff,Kn],"auto-add-kind-url-staff",({mod:r,line:e})=>r.assignFn({autoAdd10002(n,a={}){typeof n=="string"&&(n=re.fromHex(n));let i,s=this.createChild().add(zn,je,xt).provideLatestEvent().addFilter({kinds:[10002],authors:[n.toHex()]});s.autoLocalCache();let o=s.isHasLatestEvent();nn.debug("isLocalHas",o),s.onHasLatestEvent(h=>{nn.debug("onHasLatestEvent");const{readUrl:c,writeUrl:f}=_r(h.tags);(a.read??!0)&&this.addUrls(c),(a.write??!0)&&this.addUrls(f),l(),!o&&(s.addUrls(c),s.addUrls(f))}),s.asyncCall(async()=>{s.isHasLatestEvent()||(a.urls&&s.addUrls(a.urls),await W(500),!s.isHasLatestEvent()&&(s.initedAddReadWrite(),await W(500),!s.isHasLatestEvent()&&(nn.debug("autoAddUrlByGlobalDiscoveryUser"),i=s.autoAddUrlByGlobalDiscoveryUser(n),await W(500))))});function l(){i==null||i()}return l}}));let Me=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/synchronizer/common/Synchronizer.ts");class Aa extends Nt{constructor(e,n,a){super(e),this.api=n,this._ready=new Ei,this.getLine=Ye(()=>e.createChild().add(Sa,Q.Staff,tt,de,hc,et,An,wa,Pn,_a,Lt,Pc,zn,Tn).mod.defineEmit("synchronizer-update").out()),this.options=a??{},this.name=n.name,this.eventMap=new yr(`__key_list:${n.name}`),this.init(a)}getFilters(){return this.api.getFilters()}serializeToData(e){return this.api.serializeToData(e)}deserializeToEvent(e,n){return this.api.deserializeToEvent(e,n)}eventToFilter(e){return this.api.eventToFilter(e)}createKey(e){return this.api.createKey(e)}setData(e,n){return this.api.setData(e,n)}getData(e){return this.api.getData(e)}getDataKeys(){return this.api.getDataKeys()}toChanged(e){return this.api.toChanged(e)}getChangeAt(e){return this.api.getChangeAt(e)}changesSaved(e){return this.api.changesSaved(e)}async onInited(e){return e?this._ready.promise.then(e):this._ready.promise}async init(e){await this.readEventMap(),e!=null&&e.autoSync&&await this.sync(),this._ready.toResolve()}async createKeyByEvent(e){return await this.createKey(await this.eventToFilter(e))}async readEventMap(){const e=this.eventMap.getMap();for(const[n,a]of e){const i=await this.serializeToData(a),s=this.cacheKeyToKey(n);this.setData(s,i)}}async setLocalEvent(e){const n=await this.createKeyByEvent(e);this.setEvent(n,e)}getEvent(e){return this.eventMap.get(this.createEventCacheKey(e))}setEvent(e,n){this.eventMap.set(this.createEventCacheKey(e),n)}createEventCacheKey(e){return`${this.name}:${e}`}cacheKeyToKey(e){return e.slice(this.name.length+1)}async getChangeAtByFilter(e){const n=await this.createKey(e);return this.getData(n)}getUpdateAt(e){const n=this.getEvent(e);return n?n.created_at:null}async getIsChanged(e){return!!await this.getChangeAt(e)}getRelayConfigurator(){return this.getLine().relayConfigurator}async syncOne(e,n){Me.debug(this.name,"syncOne");const a=new Set;a.add(e);let i=await this.getFilters();if(i.length===0)return;let s=await this._sync(i,n);s.on("synchronizer-update",o=>{s.publishes(pe(new Set,this.getRelayConfigurator().getWriteList(),this.getRelayConfigurator().getReadList()),o)}),s.addUrls(a)}async sync(e={}){e=Object.assign({},this.options,e),Me.silly(this.name,"sync",e,this.options);const n=pe(new Set,this.getRelayConfigurator().getWriteList(),this.getRelayConfigurator().getReadList(),e==null?void 0:e.moreUrls);Me.silly("sync:urls",n);let a=await this.getFilters();if(a.length===0)return;Me.silly("sync:filters",a);let i=await(await this._sync(a,e)).add(rt);Me.silly("sync:urls",i),i.addUrls(n);for(const o of a)if(o.authors)for(const l of o.authors)i.autoAdd10002(l);if(Me.silly("sync:addUrls:",n,"isAutoAddRelayUrl:",e.isAutoAddRelayUrl),!e.isAutoAddRelayUrl)return;const s=await i.getPubkeyOrNull();s&&i.autoAddUrlByGlobalDiscoveryUser(s)}async _sync(e,n={}){const a=new Set;let i=this.getLine().createChild();return this.firstPublish(i,a,n),i.setSubOpt({eoseAutoDesub:!0}),i.addFilters(e),i.onEvent((s,o,l)=>{var h;(h=n.onEvent)==null||h.call(n,o,l),this.syncEvent(i,o,l,a)}),i}async firstPublish(e,n,a){e.onEose((i,s)=>{n.has(s)||this.updatePublish(e,s,n,a)})}updatePublish(e,n,a,i){const s=this.eventMap.getValues(),{onOK:o,onPush:l}=i;e.publishEvents(n,s,{onOK:o}),a.add(n),l==null||l(n)}async syncEvent(e,n,a,i){const s=await this.createKeyByEvent(n),o=this.getUpdateAt(s);if(!o||n.created_at>o)this.setData(s,await this.serializeToData(n)),this.setLocalEvent(n),e.publishes(i,n),e.emit("synchronizer-update",n);else if(n.created_at<o&&a){const l=await this.getEvent(s);l&&e.publish(a,l)}a&&i.add(a)}async save(){const e=[...await this.getDataKeys()];for(const n of e){if(!await this.getIsChanged(n))continue;const i=await this.getChangeAt(n);if(!i)continue;const s=await this.getData(n);if(!s)continue;const o=await this.deserializeToEvent(s,i);this.setEvent(n,o),await this.changesSaved(n),await this.publish(o)}}async publish(e){await this.getLine().publishes(this.getRelayConfigurator().getWriteList(),e)}clear(){this.eventMap.clear()}}class zc{constructor(e,n,a){this.api=n,this.map=new Map;let i=this;this.synchronizer=new Aa(e,{...n,async setData(s,o){i.map.set(s,{data:o,changeAt:null})},async getData(s){var o;return((o=i.map.get(s))==null?void 0:o.data)??null},async getDataKeys(){return i.map.keys()},async toChanged(s){const o=i.map.get(s);o&&(o.changeAt=Sr())},async getChangeAt(s){const o=i.map.get(s);return o?o.changeAt:null},async changesSaved(s){const o=i.map.get(s);o&&(o.changeAt=null)}},a)}async addData(e,n){this.map.set(e,{data:n,changeAt:null}),this.synchronizer.toChanged(e)}async getDataKeys(){}}class Tc extends zc{constructor(e,n,a){super(e,{...n,async eventToFilter(i){const s=hn("d",i.tags);return[{kinds:[i.kind],authors:[i.pubkey],"#d":[(s==null?void 0:s[1])??""]}]},async createKey(i){var c,f,b;const s=i[0];if(!s)return"";const o=(c=s.kinds)==null?void 0:c[0],l=(f=s.authors)==null?void 0:f[0],h=(b=s["#d"])==null?void 0:b[0];return await cr({kind:o??-1,pubkey:l??"",identifier:h??""})}},a)}async addDataByAddressPointer(e,n){await this.addData(await this.createKeyByAddressPointer(e),n)}async createKeyByAddressPointer(e){return cr(e)}}async function cr(r){return`${r.kind}:${r.pubkey}:${r.identifier}`}class Pa extends Nt{constructor(e,n,a){super(e),this.changeAt=null,this.api=n;let i=this;this.data=this.createDefault(),this.synchronizer=new Aa(e,{...n,async eventToFilter(s){return[]},async createKey(s){return""},async setData(s,o){i.data=o},async getData(s){return i.data},async getDataKeys(){return[""]},async toChanged(s){i.changeAt=Sr()},async getChangeAt(s){return i.changeAt},async changesSaved(s){i.changeAt=null}},a)}getLine(){return this.synchronizer.getLine()}getData(){return this.data}save(){return this.synchronizer.save()}createDefault(){return this.api.createDefault()}getFilters(){return this.api.getFilters()}serializeToData(e){return this.api.serializeToData(e)}deserializeToEvent(e,n){return this.api.deserializeToEvent(e,n)}getDataSync(){return this.data}hasChange(){return!!this.changeAt}toChanged(){this.synchronizer.toChanged("")}getLocalEvent(){return this.synchronizer.getEvent("")}getUpdateAt(){return this.synchronizer.getUpdateAt("")}clear(){this.data=this.api.createDefault(),this.synchronizer.clear()}}const _t=class _t extends Nt{constructor(e){super(e);let n=this;this.replaceableSynchronizer=new Pa(e,{name:"RelayConfigurator",createDefault:function(){return{read:new Set,write:new Set,config:{}}},async deserializeToEvent(a,i){const s=zi(a.config);return await n.getLine().createEvent({kind:10002,tags:s,created_at:i})},async serializeToData(a){const{relayConfiguration:i}=_r(a.tags);return i},async getFilters(){const a=await n.getLine().getPubkeyOrNull();return a?[{kinds:[10002],authors:[a.toHex()]}]:[]}},{isAutoAddRelayUrl:!0,autoSync:!0})}hasChange(){this.replaceableSynchronizer.hasChange()}getLine(){return this.replaceableSynchronizer.synchronizer.getLine()}getDataSync(){return this.replaceableSynchronizer.getDataSync()}getData(){return this.replaceableSynchronizer.getDataSync()}getConfiguration(){return this.replaceableSynchronizer.getDataSync()}async initedGetWriteList(){return await this.onInited(),this.getWriteList()}getWriteList(){return this.getConfiguration().write}async initedGetReadList(){return await this.onInited(),this.getReadList()}getReadList(){return this.getConfiguration().read}async initedGetWriteReadList(){return await this.onInited(),new Set([...this.getWriteList(),...this.getReadList()])}addWriteRead(e){this.addRead(e),this.addWrite(e)}addWrite(e){this.replaceableSynchronizer.toChanged(),this.getRule(e).write=!0,this.getConfiguration().write.add(e)}remoteWrite(e){this.replaceableSynchronizer.toChanged(),this.getRule(e).write=!1,this.getConfiguration().write.delete(e)}addRead(e){this.replaceableSynchronizer.toChanged(),this.getRule(e).read=!0,this.getConfiguration().read.add(e)}remoteRead(e){this.replaceableSynchronizer.toChanged(),this.getRule(e).read=!1,this.getConfiguration().read.delete(e)}remove(e){this.replaceableSynchronizer.toChanged(),delete this.replaceableSynchronizer.getDataSync().config[e],this.getConfiguration().write.delete(e),this.getConfiguration().read.delete(e)}setRule(e,n,a){if(this.replaceableSynchronizer.toChanged(),!n&&!a)this.remove(e);else{const i=this.getRule(e);i.read=!!n,i.write=!!a,a?this.getConfiguration().write.add(e):this.getConfiguration().write.delete(e),n?this.getConfiguration().write.add(e):this.getConfiguration().write.delete(e)}}getRule(e){return this.getConfiguration().config[e]??(this.getConfiguration().config[e]={})}hasReadByUrl(e){return this.getReadList().has(e)}getUpdateAt(){return this.replaceableSynchronizer.getUpdateAt()}hasWriteByUrl(e){return this.getWriteList().has(e)}onInited(e){return this.replaceableSynchronizer.synchronizer.onInited(e)}clear(){this.replaceableSynchronizer.clear()}refresh(){this.clear(),this.replaceableSynchronizer.synchronizer.sync()}};_t.Staff=Ui("relayConfigurator",_t);let Q=_t;const Mn=p(()=>[Q.Staff,nt],({mod:r,line:e})=>r.assignFn({initedAddRead(){return this.relayConfigurator.onInited(()=>{this.addUrls(this.relayConfigurator.getReadList())})},initedAddWrite(){return this.relayConfigurator.onInited(()=>{this.addUrls(this.relayConfigurator.getWriteList())})},initedAddReadWrite(){return new Promise((n,a)=>{this.relayConfigurator.onInited(()=>{this.addUrls(this.relayConfigurator.getReadList()),this.addUrls(this.relayConfigurator.getWriteList()),n()})})},autoAddUrlForRelayConfiguratorByOptions(n){let{autoAddRelayUrls:a="read"}=n??{};return a===!0?this.initedAddReadWrite():a==="read"?this.initedAddRead():a==="write"?this.initedAddReadWrite():void 0}})),dr=24133;class Bn extends At{static fromBunker(e,n){const a=new URL(n);return new Bn(e,re.fromHex(a.pathname.slice(2)),new Set(a.searchParams.getAll("relay")))}constructor(e,n,a){super(),this.urls=a,logger.debug("NostrConnectNostrApiImpl",this),this.remoteUserPubkey=n;let i=Fc("client");this.clientPubkey=i.getPubkey(),this.clientNostrApi=new Ot(i),this.getLine=Ye(()=>e.createChild().add(He,Mn,wa,Bt,p(o=>o.defineEmit())));const s=this;this.nostrApiProvide.resolve({async encrypt(...o){return await s.request({method:"nip04_encrypt",params:[o[0].toHex(),o[1]]})},async decrypt(...o){return await s.request({method:"nip04_decrypt",params:[o[0].toHex(),o[1]]})},async getPublicKey(){return re.fromHex(await s.request({method:"get_public_key",params:[]}))},async getRelays(){return await s.request({method:"get_relays",params:[]})},async signEvent(o){return await s.request({method:"sign_event",params:[o]})}}),this.listen()}async connect(){return await this.request({method:"connect",params:[this.remoteUserPubkey.toHex()]})}async disconnect(){return await this.request({method:"disconnect",params:[]})}listen(){let e=this.getLine().createChild().addFilter({kinds:[dr],"#p":[this.clientPubkey.toHex()]}).onEvent((n,a)=>{(async()=>{try{const s=JSON.parse(await this.clientNostrApi.decrypt(re.fromHex(a.pubkey),a.content)),o=s.id;this.getLine().emit(`request:${o}`,s)}catch(s){logger.error(s)}})()});return e.addUrls(this.urls),e}async request(e){return new Promise(async(n,a)=>{const i=pr(),s=JSON.stringify({id:i,method:e.method,params:e.params}),o=await this.clientNostrApi.encrypt(this.remoteUserPubkey,s),l=await this.clientNostrApi.signEvent({kind:dr,created_at:this.getLine().nowCreateAt(),pubkey:this.clientPubkey.toHex(),content:o,tags:[["p",this.remoteUserPubkey.toHex()]]});this.getLine().once(`request:${i}`,h=>{h&&(h.error?a(h.error):n(h.result))}),this.getLine().publishes(this.urls,l)})}}function Fc(r){let e=localStorage.getItem(`__prikey__${r}`);return e||(e=Ti(),localStorage.setItem(`__prikey__${r}`,e)),Et.fromHex(e)}class Nn{constructor(e,n,a){if(this.kind=n,!Nn.isSetsKind(n))throw new Error("SetsSynchronizer: Not is a SetsKind");this.tagsHandle=new Ar(a);let i=this;this.parameterizedReplaceableMapSynchronizer=new Tc(e,{name:`SetsSynchronizer:${n}`,async getFilters(){return[{kinds:[n]}]},async serializeToData(s){var l;let o=await i.parameterizedReplaceableMapSynchronizer.synchronizer.getLine().getPubkeyOrNull();return{tags:i.tagsHandle.handle(s.tags),identifier:((l=hn("d",s.tags))==null?void 0:l[1])??"",kind:s.kind,pubkey:(o==null?void 0:o.toHex())??""}},async deserializeToEvent(s,o){const{tags:l,identifier:h,kind:c}=s,f=i.tagsHandle.toTagArrayList(l);return f.push(["d",h]),await i.parameterizedReplaceableMapSynchronizer.synchronizer.getLine().createEvent({kind:c,tags:f,created_at:o})}})}static isSetsKind(e){return e>=3e4&&e<4e4}async createKey(e){let n=await this.parameterizedReplaceableMapSynchronizer.synchronizer.getLine().getPubkeyOrNull();return await this.parameterizedReplaceableMapSynchronizer.createKeyByAddressPointer({kind:this.kind,pubkey:(n==null?void 0:n.toHex())??"",identifier:e})}async add(e,n){const{parameterizedReplaceableMapSynchronizer:{synchronizer:a}}=this;let i=await this.createKey(e),s=await a.getData(i);!s||s.tags.findIndex(l=>this.tagsHandle.tagIsEq(l,n))!==-1||(s.tags.push(n),a.toChanged(i),a.save())}async delete(e,n){let a=await this.createKey(e);const{parameterizedReplaceableMapSynchronizer:{synchronizer:i}}=this;let s=await i.getData(a);if(!s)return;let o=s.tags.findIndex(l=>this.tagsHandle.tagIsEq(l,n));o!==-1&&(s.tags.splice(o,1),i.toChanged(a),i.save())}}class $n{static isStandardListKind(e){return e>=1e4&&e<2e4||e===Dn.Follow}constructor(e,n,a){if(!$n.isStandardListKind(n))throw new Error("StandardListSynchronizer: Not is a StandardListKind");this.tagsHandle=new Ar(a);let i=this;this.synchronizer=new Pa(e,{name:`StandardListSynchronizer:${n}`,createDefault(){return[]},async getFilters(){let s=await i.synchronizer.synchronizer.getLine().getPubkeyOrNull();return s?[{kinds:[n],limit:1,authors:[s.toHex()]}]:[]},async deserializeToEvent(s,o){return await i.synchronizer.getLine().createEvent({kind:n,tags:i.tagsHandle.toTagArrayList(s),created_at:o})},async serializeToData(s){return i.tagsHandle.handle(s.tags)}},{autoSync:!0})}async add(e){const n=await this.synchronizer.getData();n.findIndex(i=>this.tagsHandle.tagIsEq(i,e))===-1&&(n.push(e),this.synchronizer.toChanged(),this.synchronizer.save())}async delete(e){let n=await this.synchronizer.getData(),a=n.findIndex(i=>this.tagsHandle.tagIsEq(i,e));a!==-1&&(n.splice(a,1),this.synchronizer.toChanged(),this.synchronizer.save())}has(e){return this.getList().findIndex(i=>this.tagsHandle.tagIsEq(i,e))!==-1}getList(){return this.synchronizer.getDataSync()}}const{a:Ce,e:xe,emoji:Ia,i:Oc,p:Ua,r:za,relay:ln,t:Je,version:Mc,word:Bc,follow:Nc}=Fi;var Ta=(r=>(r[r.FollowSets=3e4]="FollowSets",r[r.RelaySets=30002]="RelaySets",r[r.BookmarkSets=30003]="BookmarkSets",r[r.ArticlesCurationSets=30004]="ArticlesCurationSets",r[r.VideosCurationSets=30005]="VideosCurationSets",r[r.InterestSets=30015]="InterestSets",r[r.EmojiSets=30030]="EmojiSets",r[r.ReleaseArtifactSets=30063]="ReleaseArtifactSets",r))(Ta||{}),Dn=(r=>(r[r.MuteList=1e4]="MuteList",r[r.PinnedNotes=10001]="PinnedNotes",r[r.Bookmarks=10003]="Bookmarks",r[r.Communities=10004]="Communities",r[r.PublicChats=10005]="PublicChats",r[r.BlockedRelays=10006]="BlockedRelays",r[r.SearchRelays=10007]="SearchRelays",r[r.Interests=10015]="Interests",r[r.Emojis=10030]="Emojis",r[r.Follow=3]="Follow",r))(Dn||{});const $c={1e4:[Ua,Je,Bc,xe],10001:[xe],10003:[xe,Ce,Je,za],10004:[Ce],10005:[xe],10006:[ln],10007:[ln],10015:[Je,Ce],10030:[Ia,Ce],3:[Nc]},{FollowSets:Dc,RelaySets:Kc,BookmarkSets:Hc,ArticlesCurationSets:jc,VideosCurationSets:Vc,InterestSets:Wc,EmojiSets:Gc,ReleaseArtifactSets:qc}=Ta,Jc={[Dc]:[Ua],[Kc]:[ln],[Hc]:[xe,Ce,Je,za],[jc]:[Ce,xe],[Vc]:[Ce],[Wc]:[Je],[Gc]:[Ia],[qc]:[xe,Oc,Mc]};Rr("listSynchronizerManager",class{constructor(e){this.map=new Map,this.listEnum=Dn,this.getLine=Ye(()=>e.createChild())}getAndInitMap(e,n){let a=this.map.get(e);return a||(a=n(),this.map.set(e,a)),a}getInitStandardListSynchronizer(e){return this.getAndInitMap(e,()=>new $n(this.getLine(),e,$c[e]))}getInitSetsSynchronizer(e){return this.getAndInitMap(e,()=>new Nn(this.getLine(),e,Jc[e]))}});p(()=>[Q.Staff,at,Kn,it,Rt],({mod:r,line:e})=>r.assignFn({addressPointerLine(n,a={}){if(console.log("addressPointerLine,0"),typeof n=="string"){const i=Oi(n);if(!i)throw new Error("Not an address");n=i}return console.log("addressPointerLine,1"),e.cacheByOptions({name:`GEBID:${JSON.stringify(n)}`,...a},()=>(console.log("addressPointerLine"),this.createChild().add(de).add(je).add(rt).provideLatestEvent().addFilter({kinds:[n.kind],authors:[n.pubkey],"#d":[n.identifier],limit:1}).chainCall(async function(){console.log("AddressPointerApi","addressPointer.pubkey"),await this.autoAdd10002(re.fromHex(n.pubkey)),await W(500),await this.addUrlForHasLatestEventLine(a)})))}}));const Rt=p(()=>[je,de,rt,Q.Staff],({mod:r,line:e})=>r.assignChain({async addUrlForHasLatestEventLine(n){if(!this.isHasLatestEvent()&&!(n.urls&&(this.addUrls(n.urls),await W(500),this.isHasLatestEvent()))&&!((n.autoAddRelayUrls??!0)&&(e.relayConfigurator.onInited(()=>{this.addUrls(e.relayConfigurator.getReadList())}),await W(500),this.isHasLatestEvent()))&&!(n.pubkey&&(this.autoAdd10002(n.pubkey),await W(500),this.isHasLatestEvent()))&&n.pubkeys){for(const a of n.pubkeys)if(this.autoAdd10002(a),await W(500),this.isHasLatestEvent())return}}}));function ur(r){return`CE:${r.name?`${r.name}:`:""}:${JSON.stringify(r)}`}const at=p(({mod:r,line:e})=>r.assignFeat({cacheByOptions(n,a){return mr(ur(n),a,{duration:1e3*60*60,useMemoryCache:n.cache??!0,useLocalStorage:!1})},recacheByOptions(n){wr(ur(n))}}));function Zc(r,e){let n=r.get(e);return n||r.set(e,n={map:new Map,done:!e.limit&&!e.since}),n}function Xc(r,e,n){let a=r.map.get(e);return a||r.map.set(e,a=n()),a}let hr=10;function Yc(r,e,n=10){let a=td(r,e,n),i=ed(a);return Qc(i)}function Qc(r){let e={};return r.forEach(([n,a])=>{(e[n]||(e[n]=[])).push(a)}),e}function ed(r){let e=Math.floor(r.length/2);return r.slice(e)}const Fa=p(()=>[He,Re],({mod:r,line:e})=>r.assignOwnFeat(()=>({loadData:new WeakMap})).assignFeat({load(n=hr){let a=Yc(this.filterList,this.loadData,n);for(const[i,s]of Object.entries(a))this.sub(i,s,{eoseAutoDesub:!0})},loadNew(n=hr){}}).inLine(n=>n.onCreateChildDep(a=>{a.onEvent((i,s,o)=>{o&&a.filterList.forEach(l=>{let h=Zc(a.loadData,l);if(h.done)return;let c=Xc(h,o,()=>({newLoadDone:!1,loadDone:!1,since:s.created_at,until:s.created_at}));if(!c.loadDone&&s.created_at<c.since)return c.since=s.created_at;if(!c.newLoadDone&&s.created_at>c.until)return c.until=s.created_at})})})));function td(r,e,n){let a=[];for(const i of r){let s=e.get(i);if(s&&!s.done)for(const[o,l]of s.map){if(l.loadDone)continue;let h=ki(i);h.until=l.since,h.limit=n,un(a,[o,h],f=>f[1].until??0)}}return a}let nd=__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/api/EventApiStaff.ts");const Dt=p(()=>[xt,Q.Staff,Mn,_n,rt,at,it],"event-api-staff",({mod:r,line:e})=>r.assignChain({addUrlForCommonEventList(n){Er(async()=>{await this.addUrlsByCub(n),await this.autoAddUrlForRelayConfiguratorByOptions(n)})}}).assignFn({commonEventList(n){return nd.debug("commonEventList:",n),this.cacheByOptions(n,()=>(console.log("commonEventList:cacheByOptions",11),this.createChild().add(dd).add(xt).add(de).add(Fa).provideEventList().setupSort(n).addFiltersByOptions(n).addUrlForCommonEventList(n)))}})),_e=p("reactive-staff",({mod:r,line:e})=>r.assignFn({reactive(n){return n.__isReactive=!1,n},ref(n){return this.reactive({value:n})}})),je=p(()=>[ie,_e,Re],({mod:r,line:e})=>r.defineEmit().provide("latestEvent",function(){let n=this.reactive({value:null});return this.onEvent((a,i,s)=>{(!n.value||i.created_at>n.value.created_at)&&(n.value=i)}),n}).assignFeat({isHasLatestEvent(){return!!this.getLatestEvent()},setLatestEvent(n){return this.injectLatestEvent().value=n},getLatestEvent(){return this.injectLatestEvent().value},updateLatestEvent(n){let a=this.getLatestEvent();this.injectLatestEvent().value=n,this.emit("latestEvent:update",n,a)},onHasLatestEvent(n){this.isHasLatestEvent()&&n(this.getLatestEvent()),this.on("latestEvent:update",n)},onHasLatestEventOnce(n){this.isHasLatestEvent()?n(this.getLatestEvent()):this.on("latestEvent:update",n,{once:!0})}})),Oa=p(()=>[_e,je,Lr],"metadata-staff",({mod:r,line:e})=>r.assignOwnFeat(()=>({metadata:e.ref({})})).assignFeat({getMetadata(){return this.getLatestEvent()&&Yn(this.getLatestEvent())},onHasMetadata(n){this.onHasLatestEvent(a=>{n(Yn(a))})}}));__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/api/ChannelMetadataApiStaff.ts");p(()=>[Dt,On,Q.Staff],({mod:r,line:e})=>r.assignFeat({getChannelMetadataByChannelId(n,a={}){return this.cacheByOptions({name:rd(n),...a},()=>{const i=e.createChild().add(de).add(Oa).add(Lt).add(Rt).provideLatestEvent();return i.addFilters([{kinds:[40],ids:[n]},{kinds:[41],"#e":[n]}]),i.autoLocalCache(),i.addUrlForHasLatestEventLine(a),i})}}));function rd(r){return"GCMBI:"+r}p(({mod:r,line:e})=>r.assignFeat({getContactListLineByPubkey(n){return n=re.fromMaybeHex(n),ad()}}));function ad(r){throw new Error("Function not implemented.")}p(()=>[Q.Staff,at,it],({mod:r,line:e})=>r.assignChain({addUrlForEventById(n){Er(async()=>{await this.addUrlsByCub(n),await this.autoAddUrlForRelayConfiguratorByOptions(n)})}}).assignFn({getEventById(n,a={}){return this.cacheByOptions({name:"GEBID:"+n,...a},()=>this.createChild().add(zn).add(de).add(je).provideLatestEvent().addFilter({ids:[n],limit:1}).addUrlForEventById(a))}}));const id=p(()=>[je],({mod:r,line:e})=>r.assignFeat({getRelayConfiguration(){const n=this.getLatestEvent();return n?Qn(n.tags):null},onHasRelayConfiguration(n){this.onHasLatestEvent(a=>{n(Qn(a.tags))})}}));__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/api/UserApiStaff.ts");p(()=>[Dt,On,Q.Staff,at],({mod:r,line:e})=>r.assignFn({getUserMetadataLineByPubkey(n,a={}){return typeof n=="string"&&(n=re.fromHex(n)),this.cacheByOptions({name:"GUMLBP:"+n.toHex(),...a},()=>{const i=e.createChild().add(He).add(Oa).add(Lt).add(Rt).provideLatestEvent();return i.addFilter({kinds:[0],authors:[n.toHex()]}),i.autoLocalCache(),a.pubkey=n,i.addUrlForHasLatestEventLine(a),i})},getUserRelayUrlConfigByPubkey(n,a={}){return n=re.fromMaybeHex(n),this.cacheByOptions({name:"GURUCBP:"+n.toHex(),...a},()=>{const i=e.createChild().add(de).add(Lt).add(Rt).add(id).provideLatestEvent();return i.addFilter({kinds:[10002],authors:[n.toHex()]}),i.autoLocalCache(),a.pubkey=n,i.addUrlForHasLatestEventLine(a),i})}}));const it=p(()=>[rt],({mod:r,line:e})=>r.assignFn({async addUrlsByCub(n){const a=new Set;if(n){if(await this.addUrlsWithTimeout(n==null?void 0:n.urls,1e3),n.pubkey&&!a.has(n.pubkey.toString())&&(a.add(n.pubkey.toString()),this.autoAdd10002(n.pubkey,n.autoAdd10002Options),await W(500)),n!=null&&n.pubkeys)for(const i of n==null?void 0:n.pubkeys)a.has(i)||(a.add(i),this.autoAdd10002(i,n.autoAdd10002Options),await W(500));if(n.tags){for(const[i,s]of mt(n.tags,["r"]))s&&this.addUrl(s);for(const[i,s,o]of mt(n.tags,["e","a","q","p"]))o&&this.addUrl(o);for(const[i,s,o]of mt(n.tags,["p"]))a.has(s)||(a.add(s),this.autoAdd10002(s,o?{urls:new Set([o]),...n.autoAdd10002Options}:n.autoAdd10002Options));await W(500)}}}}).assignChain({addUrlsByCubChain(n){this.addUrlsByCub(n)}})),Kn=p(({mod:r,line:e})=>r.assignFeat({asyncCall(n,a,i){var s;(s=n.call(this))==null||s.then(a,i)},chainCall(n,a,i){return this.asyncCall(n,a,i),this}})),sd=p(()=>[st],({mod:r,line:e})=>e.defineConfig("lazyDelayForPapaw",0,{path:"papaw",displayType:"range",range:[0,1e3]}).defineConfig("enableLazyLoadPapawTree",!1,{path:"papaw"}).mod),od=p(()=>[st],({mod:r,line:e})=>e.defineConfig("autoPing",!0,{path:""}).mod),ld=p(()=>[st],({mod:r,line:e})=>e.defineConfig("enableTree",!1,{path:"papaw"}).mod);p(()=>[st,sd,od,ld],({mod:r,line:e})=>r);const Le={default(){return(r,e)=>{r.push(e)}},reverseDefault(){return(r,e)=>{r.unshift(e)}},insertOnObjectList(r){return(e,n)=>{un(e,n,r)}},reverseInsertOnObjectList(r){return(e,n)=>{kr(e,n,r)}}},cd=Ci(),fr=cd({positive:{default:Le.default(),"created-at":Le.insertOnObjectList(r=>r.created_at)},reverse:{"created-at":Le.reverseInsertOnObjectList(r=>r.created_at),default:Le.reverseDefault()}}),dd=p(()=>[Un.Staff,_e,Re,ie],({mod:r,line:e})=>{function n(){return e.ref([])}console.log("EventListStaff",e);let a=r.assignFeat({eventList:null,insertEventList:Le.default(),pushEvent(i,s="local",o="local"){console.log("pushEvent",this.getList().length),this.insertEventList(this.getList(),i)},getList(){if(!this.eventList)throw new Error("你需要调用'provideEventList'");return this.eventList.value},setList(i){if(!this.eventList)throw new Error("你需要调用'provideEventList'");this.eventList.value=i},useInsertObjectListByCreatedAt(){this.insertEventList=Le.insertOnObjectList(i=>i.created_at)},useReverseInsertObjectListByCreatedAt(){this.insertEventList=Le.reverseInsertOnObjectList(i=>i.created_at)}}).assignChain({setInsertEventList(i=fr.positive.default){this.insertEventList=i},setupSort(i){this.setInsertEventList(fr[i.reverseSort?"reverse":"positive"][i.sort??"default"]),this.resort()},resort(){let i=this.insertEventList,s=[];this.getList().map(o=>{i(s,o)}),this.setList(s)}}).assignChain({provideEventList(){this.eventList=n()}});return e.onCreateChildDep(i=>{i.on("event",(s,o,l)=>{i.pushEvent(o,l,s)})}),console.log(),a});p("insertObjectList",({mod:r,line:e})=>r.assignFeat({insertObjectList(n,a,i){n.push(a)}}));__loggerFactory.create("/home/runner/work/jumpalong/jumpalong/libraries/nostr/src/event/ReverseSearchInsertOnObjectListStaff.ts");p("reverseInsertOnObjectList",({mod:r,line:e})=>r.assignFeat({reverseInsertOnObjectList:kr}));p("insertOnObjectList",({mod:r,line:e})=>r.assignFeat({insertOnObjectList:un}));p(()=>[ie,He],r=>(r.out().on("event",(e,n)=>!!ud(n,[...r.out().filterList],0)),r));function ud(r,e,n){return e.length===0?!0:e.some(a=>hd(r,a,n))}function hd(r,e,n){const{ids:a,kinds:i,authors:s,since:o,until:l,limit:h,search:c}=e;return a&&!a.includes(r.id)||i&&!i.includes(r.kind)||s&&!s.includes(r.pubkey)||o&&!(r.created_at>=o)||l&&!(r.created_at<=l)||h&&!(n<h)?!1:fd(e,r.tags)?!(c&&!JSON.stringify(r).toLowerCase().includes(c.toLowerCase())):!1}function fd(r,e){for(let n in r)if(n[0]==="#"){let a=n.slice(1),i=r[`#${a}`];if(i&&!e.find(([s,o])=>s===a&&i.includes(o)))return!1}return!0}p(({mod:r,line:e})=>r.assignFeat({NostrApiMode:Y,getNostrApiMode:Ze,setNostrApiMode:qe}));p(({mod:r,line:e})=>r.assignFeat({publishEventIdList:new Set,publishEventList:[]}));p(r=>(r.assignFeat({}),r));p(r=>r.defineEmit());p(r=>r.assignFeat({subIds:new Set}));const gr="app-config",st=p(()=>[_e],({mod:r,line:e})=>{let n;try{let s=localStorage.getItem(gr);s&&(n=JSON.parse(s))}catch{}function a(s){localStorage.setItem(gr,JSON.stringify(s))}const i=e.reactive(n??{});return r.assignFeat({config:i,setting:e.reactive(new xi)}).assignFn({getConfig:function(){return this.config},defineConfig:function(s,o,l){return this.defineSetting(s,l),o===void 0?this:this.config[s]===void 0?(this.config[s]=o,a(this.config),this):this},defineSetting(s,o){const l={configName:s,...o};return o&&l.path&&this.setting.setValue(l.path,l),this},assignConfig:function(s){console.log("config",s),Object.assign(this.config,s),console.log("this.config",this.config),a(this.config)}})}),gd=Xe({__name:"SettingItem",props:{options:{}},emits:["pushSetting"],setup(r,{emit:e}){const n=r,a=e,i=ns(),s=Cr(),o=Pr(),l=Ir(st),h=q(n.options.configName&&o[n.options.configName]),c=P({get(){return h.value},set(m){n.options.configName&&(h.value=m,l.assignConfig({[n.options.configName]:m}))}}),f=P(()=>n.options.displayType??typeof c.value),b=P(()=>t(n.options.i18n||n.options.configName||n.options.path));function u(m){m&&window.open(m)}const v=P(()=>n.options.description&&t(n.options.description));return(m,k)=>{const A=Br;return D(),V(w(Mr),null,{default:F(()=>[m.options.displayType==="range"?(D(),V(w(le),{key:0,title:w(b),description:w(v)},{footer:F(()=>[j(w(hs),{value:w(c),"onUpdate:value":k[0]||(k[0]=R=>Zt(c)?c.value=R:null),min:m.options.range&&m.options.range[0],max:m.options.range&&m.options.range[1]},null,8,["value","min","max"])]),_:1},8,["title","description"])):w(f)==="number"?(D(),V(w(le),{key:1,title:w(b),description:w(v)},{footer:F(()=>[j(w(rs),{value:w(o)[m.options.configName??""],"onUpdate:value":k[1]||(k[1]=R=>w(o)[m.options.configName??""]=R)},null,8,["value"])]),_:1},8,["title","description"])):w(f)==="boolean"?(D(),V(w(le),{key:2,title:w(b),description:w(v)},{"header-extra":F(()=>[j(w(vs),{value:w(c),"onUpdate:value":k[2]||(k[2]=R=>Zt(c)?c.value=R:null)},null,8,["value"])]),_:1},8,["title","description"])):w(f)==="line"?(D(),V(w(Gi),{key:3,"title-placement":"left",title:w(b),description:w(v)},null,8,["title","description"])):w(f)==="string"?(D(),V(w(le),{key:4},{default:F(()=>[j(w(as),{value:w(c),"onUpdate:value":k[3]||(k[3]=R=>Zt(c)?c.value=R:null)},null,8,["value"])]),_:1})):w(f)==="text"?(D(),V(w(le),{key:5,title:w(b),onClick:k[4]||(k[4]=R=>u(m.options.url)),description:w(v)},Li({default:F(()=>[Jn(Zn(m.options.text)+" ",1)]),_:2},[m.options.url?{name:"footer",fn:F(()=>[Jn(Zn(m.options.url),1)]),key:"0"}:void 0,m.options.url?{name:"header-extra",fn:F(()=>[j(A,null,{default:F(()=>[j(bt)]),_:1})]),key:"1"}:void 0]),1032,["title","description"])):w(f)==="router-push"?(D(),V(w(le),{key:6,title:w(b),onClick:k[5]||(k[5]=()=>m.options.routerPush&&w(s).push(m.options.routerPush)),description:w(v)},{"header-extra":F(()=>[j(A,null,{default:F(()=>[j(bt)]),_:1})]),_:1},8,["title","description"])):w(f)==="dialog"?(D(),V(w(le),{key:7,title:w(b),onClick:k[6]||(k[6]=()=>{w(i).create(m.options.dialogOptions)}),description:w(v)},null,8,["title","description"])):w(f)==="setting-path"?(D(),V(w(le),{key:8,title:w(b),onClick:k[7]||(k[7]=()=>{var R;a("pushSetting",m.options.settingPath||`${(R=m.options.path)!=null&&R.endsWith("/")?m.options.path:`${m.options.path}/`}${m.options.configName}`)}),description:w(v)},{"header-extra":F(()=>[j(A,null,{default:F(()=>[j(bt)]),_:1})]),_:1},8,["title","description"])):Ri("",!0)]),_:1})}}}),jd=Xe({__name:"SettingsView",setup(r){const e=Ir(),n=_i(),a=Cr(),i=P(()=>n.params.path);Pr(Ni,Bi,Mi);const s=e.setting,o=P({get(){var v;return typeof i.value=="string"?i.value:((v=i.value)==null?void 0:v.join())??"/"},set(v){a.push("/settings"+(v.startsWith("/")?v:`/${v}`))}}),l=P(()=>s.getValue(o.value)),h=P(()=>new Set(l.value.filter(v=>v.displayType==="setting-path").map(v=>{var m;return v.settingPath||`${(m=v.path)!=null&&m.endsWith("/")?v.path:`${v.path}/`}${v.configName}`}))),c=P(()=>s.getChildrenPathName(o.value).filter(v=>!h.value.has(`${o.value.endsWith("/")?o.value:`${o.value}/`}${v}`)));e.defineSetting("clear_local_storage",{path:"storage",displayType:"dialog",dialogOptions:{type:"warning",title:t("warning"),content:t("clear_local_storage_warning"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:()=>{localStorage.clear(),location.reload()},onNegativeClick:()=>{}}}),e.defineSetting("IntelligentCleaning",{path:"storage",displayType:"dialog",i18n:"clear_expired_cache",dialogOptions:{type:"info",title:t("info"),content:t("are_you_sure"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:()=>{$i(),location.reload()}}}),e.defineSetting("clear-cache",{path:"storage",displayType:"dialog",i18n:"clear_all_caches",dialogOptions:{type:"info",title:t("info"),content:t("are_you_sure"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:()=>{Di(),location.reload()},onNegativeClick:()=>{}}}),e.defineSetting("i18n-setting",{path:"/advanced",i18n:"i18n-setting",displayType:"router-push",routerPush:{name:"language-settings"}}),e.defineSetting("move-house",{path:"/advanced",i18n:"move-house",displayType:"router-push",description:t("move-house-description"),routerPush:{name:"move-house"}}),e.defineSetting("about",{path:"/",i18n:"about",displayType:"setting-path"}),e.defineSetting("author",{path:"/about",i18n:"author",displayType:"text",text:"Mekefly",url:"https://github.com/Mekefly"}),e.defineSetting("source-code",{path:"/about",i18n:"source-code",displayType:"text",url:"https://github.com/mekefly/jumpalong"}),e.defineSetting("hide-rules",{path:"/general",i18n:"hide_rules",displayType:"router-push",routerPush:{name:"content-blacklist-view"}}),e.defineSetting("mute-user",{path:"/general",i18n:"mute_user",displayType:"router-push",routerPush:{name:"mute-user"}}),e.defineSetting("nostr-connect-setting",{path:"/general",i18n:"nostr_connect",displayType:"router-push",routerPush:{name:"nostr-connect-setting"}});function f(){let v=e.setting.getParentPath(o.value);if(!v){a.back();return}o.value=v}const b=P(()=>{let v=o.value.split("/").map(m=>t(m)).join("/");return v||t("settings")}),u=JSON;return(v,m)=>{const k=le,A=Br,R=Mr;return D(),V(w(os),{size:"large",vertical:""},{default:F(()=>[j(w(ss),{subtitle:w(b),onBack:f},null,8,["subtitle"]),j(w(is),{clickable:"",hoverable:""},{default:F(()=>[(D(!0),an(rn,null,Xn(w(c),$=>(D(),V(R,{key:$,onClick:()=>{o.value=w(o)+$}},{suffix:F(()=>[j(A,null,{default:F(()=>[j(bt)]),_:1})]),default:F(()=>[j(k,{title:v.t($)},null,8,["title"])]),_:2},1032,["onClick"]))),128)),(D(!0),an(rn,null,Xn(w(l),$=>(D(),V(gd,{options:$,key:w(u).stringify($),onPushSetting:m[0]||(m[0]=se=>o.value=se)},null,8,["options"]))),128))]),_:1})]),_:1})}}});export{jd as default};
