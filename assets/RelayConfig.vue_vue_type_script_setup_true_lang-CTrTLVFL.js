import{N as D}from"./Scrollbar-DlbzZyTV.js";import{R as Z}from"./ReloadCircleSharp-DAOD49WP.js";import{_ as O}from"./Tooltip.vue_vue_type_script_setup_true_lang-qU6rsbI7.js";import{u as x,Q as P,r as J,k as X,s as Y,I as ee,c as te}from"./ProvideEventLine-XLCKst21.js";import{f as $,S as W,L as S,k as R,o as y,m as w,w as o,n as s,y as b,z as g,q as n,B,E as f,$ as H,A as ne,af as se,ag as oe,r as V,ah as E,ai as T,_ as L,U as I,aj as ae,Z as re,H as le,ak as ce,al as ie}from"./index-Bp8Ru9nj.js";import{u as j}from"./use-theme-vars-CgboMLjC.js";import{b as N}from"./Button-DF3Ei97P.js";import{C as ue}from"./Close-B9e7xJbN.js";import{N as z}from"./Icon-BUbDyWQc.js";import{_ as _e}from"./DateTime.vue_vue_type_script_setup_true_lang-DsYL1IqC.js";import{_ as de,a as fe,b as me,c as he,d as pe}from"./RelayAddButton.vue_vue_type_script_setup_true_lang-oIf49E0K.js";import{_ as ye}from"./Card-z75eEPHe.js";import{_ as G}from"./Input-uRxkwxbK.js";import{_ as ge}from"./Space-D7Gj9TeE.js";import{u as ve}from"./composables-Den7Xj81.js";const Ce={key:0},we=$({__name:"Broadcast",setup(h){let e=x(P.Staff).relayConfigurator;const i=W(),a=S(null);function d(){const u=e.broadcast({slef:se({})});if(!u){i.error(t("broadcast_error_message"));return}a.value=u}const r=R(()=>{var u,c,p,C;return(((u=a.value)==null?void 0:u.numberOfSuccesses)??0)+(((c=a.value)==null?void 0:c.numberOfErrors)??0)+(((p=a.value)==null?void 0:p.numberOfOvertime)??0)<(((C=a.value)==null?void 0:C.total)??0)}),m=j();return(u,c)=>{const p=N;return y(),w(O,{tooltip:n(e).hasChange()?u.t("broadcast_has_change_tip"):u.t("broadcast_no_change_tip")},{default:o(()=>[s(p,{onClick:d,type:"default",loading:n(r),disabled:n(r)||n(e).hasChange()},{default:o(()=>[b(g(n(r)?u.t("success_timeout_failure_total"):u.t("broadcast"))+" ",1),n(a)?(y(),B("span",Ce,[f("span",{style:H({color:n(m).successColor})},g(n(a).numberOfSuccesses),5),b(" / "),f("span",{style:H({color:n(m).warningColor})},g(n(a).numberOfOvertime),5),b(" / "),f("span",{style:H({color:n(m).errorColor})},g(n(a).numberOfErrors),5),b(" / "),f("span",null,g(n(a).total),1)])):ne("",!0)]),_:1},8,["loading","disabled"])]),_:1},8,["tooltip"])}}}),K=$({__name:"ButtonClose",emits:["click"],setup(h,{emit:_}){const e=_;return(i,a)=>{const d=z,r=N;return y(),w(r,{text:"",circle:"",type:"error",class:"text-[#6c5ce7] hover:text-[#a29bfe]",onClick:a[0]||(a[0]=m=>e("click",m))},{icon:o(()=>[s(d,null,{default:o(()=>[s(ue)]),_:1})]),_:1})}}}),M=$({__name:"RelayConnectListCard",props:{urls:{},title:{},loadable:{type:Boolean}},setup(h){const _=h;return(e,i)=>{const a=ye;return y(),w(a,{title:_.title??"中续"},oe({default:o(()=>[s(n(D),{class:"max-h-[40em]"},{default:o(()=>[s(de,E(T(_)),{right:o(d=>[V(e.$slots,"right",E(T(d)))]),_:3},16)]),_:3}),V(e.$slots,"bottom")]),_:2},[e.$slots["header-extra"]?{name:"header-extra",fn:o(()=>[V(e.$slots,"header-extra")]),key:"0"}:void 0,e.$slots.footer?{name:"footer",fn:o(()=>[V(e.$slots,"footer")]),key:"1"}:void 0,e.$slots.action?{name:"action",fn:o(()=>[V(e.$slots,"action")]),key:"2"}:void 0]),1032,["title"])}}}),be={},$e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ke=f("path",{d:"M12 22H5a2 2 0 0 1-2-2l.01-14c0-1.1.88-2 1.99-2h1V3c0-.55.45-1 1-1s1 .45 1 1v1h8V3c0-.55.45-1 1-1s1 .45 1 1v1h1c1.1 0 2 .9 2 2v6h-2v-2H5v10h7v2zm10.13-5.01l.71-.71a.996.996 0 0 0 0-1.41l-.71-.71a.996.996 0 0 0-1.41 0l-.71.71l2.12 2.12zm-.71.71l-5.01 5.01c-.18.18-.44.29-.7.29H14.5c-.28 0-.5-.22-.5-.5v-1.21c0-.27.11-.52.29-.71l5.01-5.01l2.12 2.13z",fill:"currentColor"},null,-1),xe=[ke];function Se(h,_){return y(),B("svg",$e,xe)}const Re=L(be,[["render",Se]]),ze={key:1},Be=$({__name:"RelayConfigurator",setup(h){let e=x(P.Staff).relayConfigurator;const i=R(()=>new Set([...e.getConfiguration().read,...e.getConfiguration().write]));function a(l){e.hasWriteByUrl(l)?e.remoteWrite(l):e.addWrite(l)}function d(l){e.hasReadByUrl(l)?e.remoteRead(l):e.addRead(l)}const r=S("");function m(){r.value&&e.addWriteRead(r.value)}const u=W();function c(){e.replaceableSynchronizer.save(),u.success(t("relay_configurator_save_message"))}function p(){e.replaceableSynchronizer.synchronizer.sync(),u.success(t("relay_configurator_sync_message"))}const C=R(()=>{const l=e.getUpdateAt();return l||null});function v(){e.refresh()}return(l,A)=>{const Q=Z,q=G,U=N;return y(),w(M,{urls:n(i),title:l.t("relay_configuration")},{"header-extra":o(()=>[s(n(z),{class:"mr-2",onClick:v},{default:o(()=>[s(Q)]),_:1}),s(n(z),{class:"mr-1"},{default:o(()=>[s(Re)]),_:1}),n(C)?(y(),w(_e,{key:0,secondTimestamp:n(C)},null,8,["secondTimestamp"])):(y(),B("span",ze,"No"))]),right:o(({url:k})=>[s(fe,{active:n(e).hasWriteByUrl(k),class:"mr-1",onSwitch:()=>a(k)},null,8,["active","onSwitch"]),s(me,{active:n(e).hasReadByUrl(k),class:"mr-2",onSwitch:()=>d(k)},null,8,["active","onSwitch"]),s(K,{text:"",onClick:()=>n(e).remove(k)},null,8,["onClick"])]),action:o(()=>[s(n(ge),null,{default:o(()=>[s(q,{value:n(r),"onUpdate:value":A[0]||(A[0]=k=>I(r)?r.value=k:null),type:"text",placeholder:"eg: wss://nostr.wine"},null,8,["value"]),s(U,{onClick:m,type:"primary",disabled:!n(r)},{default:o(()=>[b(g(l.t("add")),1)]),_:1},8,["disabled"]),s(O,{tooltip:n(e).replaceableSynchronizer.hasChange()?l.t("tips.save_changes"):l.t("currently_not_modified")},{default:o(()=>[s(U,{onClick:c,type:"primary",disabled:!n(e).replaceableSynchronizer.hasChange()},{default:o(()=>[b(g(l.t("save")),1)]),_:1},8,["disabled"])]),_:1},8,["tooltip"]),s(O,{tooltip:n(e).replaceableSynchronizer.hasChange()?l.t("relay_configurator_sync_has_change_tip"):l.t("relay_configurator_sync_no_change_tip")},{default:o(()=>[s(U,{onClick:p,type:"primary",disabled:n(e).replaceableSynchronizer.hasChange()},{default:o(()=>[b(g(l.t("sync")),1)]),_:1},8,["disabled"])]),_:1},8,["tooltip"]),s(we)]),_:1})]),_:1},8,["urls","title"])}}}),Ve={},Le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Oe=f("path",{d:"M17 11h3a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-3a2 2 0 0 0-2 2v1H9.01V5a2 2 0 0 0-2-2H4c-1.1 0-2 .9-2 2v4a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2V8h2v7.01c0 1.65 1.34 2.99 2.99 2.99H15v1a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-3a2 2 0 0 0-2 2v1h-1.01c-.54 0-.99-.45-.99-.99V8h2v1c0 1.1.9 2 2 2z",fill:"currentColor"},null,-1),Pe=[Oe];function Ne(h,_){return y(),B("svg",Le,Pe)}const F=L(Ve,[["render",Ne]]),Ue={class:"flex-shrink-0"},He=$({__name:"RelayConnected",setup(h){let _=x(P.Staff),i=x().relayPool,a=_.relayConfigurator;const d=R(()=>i.getPool()),r=R(()=>[...d.value.keys()]);function m(c){const p=i.getRelayFromPool(c);return p?p.subIds.size:0}function u(c){const p=i.getRelayFromPool(c);return p?p.publishIds.size:0}return(c,p)=>{const C=z;return y(),w(M,{urls:n(r),title:c.t("active_relay")},{"header-extra":o(()=>[s(C,{class:"mr-1"},{default:o(()=>[s(F)]),_:1}),b(" "+g(n(r).length),1)]),right:o(({url:v})=>[f("span",Ue," ("+g(m(v))+","+g(u(v))+") ",1),s(he,{disabled:n(a).hasReadByUrl(v)||n(a).hasWriteByUrl(v),class:"ml-2",onClick:()=>n(a).addWriteRead(v)},null,8,["disabled","onClick"]),s(K,{class:"ml-2",onClick:()=>n(i).closeRelay(v),onClose:()=>{var l;return(l=n(d).get(v))==null?void 0:l.close()}},null,8,["onClick","onClose"])]),_:1},8,["urls","title"])}}}),We={},Me={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ae=f("path",{d:"M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85c-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28c77.418-.07 144.315-53.144 162.787-126.849c1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z",fill:"currentColor"},null,-1),Ee=[Ae];function Te(h,_){return y(),B("svg",Me,Ee)}const De=L(We,[["render",Te]]);function Ie(h,_,e,{message:i,dialog:a}){return new Promise((d,r)=>{e.replaceableSynchronizer.synchronizer.syncOne(h,{onEvent(m,u){a.success({title:t("success"),content:t("handel_sync_on_event_message",{url:u}),positiveText:t("yes")}),d("pull")},onPush(){i.warning(t("handel_sync_on_push_message",{url:h})),d("push")},onOK:_}),i.info(t("handel_sync_info",{url:h}))})}function je(h){let e=x(P.Staff).relayConfigurator;const i=ve(),a=W(),d=S(),r=S("default"),m=j(),u=J(),c=R(()=>{switch(r.value){case"pull":return m.value.successColor;case"push":return m.value.primaryColor;default:return m.value.textColor1}});return{isLoading:d,status:r,color:c,handelSync:async()=>{d.value=!0,r.value=await Ie(n(h),u,e,{message:a,dialog:i}),d.value=!1}}}const Ge=$({__name:"SyncButton",props:{url:{}},setup(h){const _=h,{handelSync:e,status:i,isLoading:a,color:d}=je(ae(_,"url"));return(r,m)=>{const u=z,c=N;return y(),w(O,{tooltip:r.t("sync_tooltip")},{default:o(()=>[s(c,{text:"",onClick:n(e),class:re({turn:n(a)})},{default:o(()=>[s(u,{color:n(d)},{default:o(()=>[s(De)]),_:1},8,["color"])]),_:1},8,["onClick","class"])]),_:1},8,["tooltip"])}}}),Ke=L(Ge,[["__scopeId","data-v-9c075bd2"]]),Fe={},Qe={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 512 512","enable-background":"new 0 0 512 512","xml:space":"preserve"},qe=f("g",null,[f("g",null,[f("g",null,[f("g",null,[f("path",{d:`M337.509,305.372h-17.501l-6.571-5.486c20.791-25.232,33.922-57.054,33.922-93.257\r
					C347.358,127.632,283.896,64,205.135,64C127.452,64,64,127.632,64,206.629s63.452,142.628,142.225,142.628\r
					c35.011,0,67.831-13.167,92.991-34.008l6.561,5.487v17.551L415.18,448L448,415.086L337.509,305.372z M206.225,305.372\r
					c-54.702,0-98.463-43.887-98.463-98.743c0-54.858,43.761-98.742,98.463-98.742c54.7,0,98.462,43.884,98.462,98.742\r
					C304.687,261.485,260.925,305.372,206.225,305.372z`})])])])],-1),Ze=[qe];function Je(h,_){return y(),B("svg",Qe,Ze)}const Xe=L(Fe,[["render",Je]]),Ye={class:"flex items-center justify-center flex-shrink flex-grow"},et={class:"flex-shrink-0 flex justify-center items-center"},tt={class:"flex-shrink ml-2 flex-grow w-32 sm:w-auto"},nt=f("div",{class:"w-4"},null,-1),st=$({__name:"RelayOther",setup(h){let _=x(ee),e=x(te);const i=S(""),a=S([]),d=X(()=>e.getPubkeyOrNull()),r=Y([d],async([c])=>{if(c)return[...c?await _.autoGlobalDiscoveryUserByPubkey(c,9999999):await _.autoGetGlobalUrls()]});function m(){if(r.value){if(i.value===""){a.value=r.value;return}a.value=Array.from(r.value).filter(c=>c.includes(i.value))}}m();const u=ie(m,1e3);return le([i,r],u,{deep:!0}),(c,p)=>{const C=z,v=G;return y(),w(M,{urls:n(a),title:c.t("more")},{"header-extra":o(()=>[f("div",Ye,[f("div",et,[s(C,{class:"mr-1"},{default:o(()=>[s(F)]),_:1}),f("span",null,g(n(a).length),1)]),f("div",tt,[s(v,{round:"",placeholder:c.t("search"),value:n(i),"onUpdate:value":p[0]||(p[0]=l=>I(i)?i.value=l:null),onKeyup:ce(m,["enter"]),onChange:m},{suffix:o(()=>[s(C,null,{default:o(()=>[s(Xe)]),_:1})]),_:1},8,["placeholder","value"])])])]),right:o(({url:l})=>[s(pe,{class:"mr-2",url:l},null,8,["url"]),s(Ke,{url:l},null,8,["url"]),nt]),_:1},8,["urls","title"])}}}),ot={class:"mt-2"},at={class:"mt-2"},wt=$({__name:"RelayConfig",setup(h){return(_,e)=>(y(),w(n(D),{class:"h-full w-full"},{default:o(()=>[f("div",null,[s(Be)]),f("div",ot,[s(He)]),f("div",at,[s(st)])]),_:1}))}});export{wt as _};
