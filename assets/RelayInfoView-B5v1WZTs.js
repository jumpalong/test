import{_ as q}from"./PubkeyLink.vue_vue_type_script_setup_true_lang-PgJ-fWWY.js";import{b as F}from"./utils-Bn9avYFz.js";import{a as M}from"./RelayInfoView-C2QNYFmX.js";import{f as U,S as H,V as I,k as y,L as v,H as S,o as s,B as p,q as o,n as c,w as i,m as w,y as g,z as m,A as l,F as x,C as J,E as G}from"./index-Bp8Ru9nj.js";import{u as K}from"./composables-Den7Xj81.js";import{_ as Q}from"./Spin-C2RU7Xjq.js";import{_ as W}from"./Space-D7Gj9TeE.js";import{_ as X}from"./Result-BU5T2nQ6.js";import{_ as Y}from"./Card-z75eEPHe.js";import{_ as Z}from"./Tree-CJnU2Fc_.js";import{_ as ee}from"./Tag-D0_dwZG-.js";import"./ProvideEventLine-XLCKst21.js";import"./metadata-CUvUkMsM.js";import"./Button-DF3Ei97P.js";import"./use-rtl-gkSu3eK_.js";import"./is-browser-Ki2-8vi-.js";import"./use-css-vars-class-DV7GkkKb.js";import"./Scrollbar-Bcd6cbpf.js";import"./index-vZmvdULR.js";import"./use-compitable-BZNVtFY-.js";import"./get-slot-Bk_rJcZu.js";import"./Icon-C2DldZ3i.js";import"./Warning-BHWEvLya.js";import"./replaceable-B2OdU2Vz.js";import"./Close-sZEX0j0N.js";import"./Close-B84N3VcG.js";import"./keysOf-HiGXOwLp.js";import"./Checkbox-Bvv02CAZ.js";import"./render-n15ElYMw.js";import"./create-DlBt9mlr.js";import"./fade-in-height-expand.cssr-BOUpW_kQ.js";import"./VirtualList-ZJmNvtbX.js";import"./Empty-oWNKc7k_.js";import"./use-locale-DHyx6amc.js";const te={key:0,size:"large"},re=G("div",{class:"h-[80vh]"},null,-1),oe={key:2},ne={key:0},se={key:0},ae={key:1},ie={key:2},pe="https://cors-anywhere.herokuapp.com/",He=U({__name:"RelayInfoView",setup(ce){const{error:V}=H(),j=K(),B=I(),d=y(()=>{const e=B.params.url;if(e){const r=new URL(e);return r.protocol="http://",r.toString()}return e}),_=v(null),n=v(null);S(d,async()=>{_.value=null,d.value&&D(d.value).then(e=>{n.value=e}).catch(e=>{_.value=e})},{immediate:!0});let k=v(!1);function A(e){let r={headers:{accept:"application/nostr+json"}};return fetch(`${e}`,r).catch(()=>(k.value=!0,fetch(`${pe}${e}`,r)))}async function D(e){return await F(`fetch:${e}:get:application/nostr+json`,async()=>await A(e).then(r=>r.text()).then(r=>{try{return JSON.parse(r)}catch{return r.includes("/corsdemo")&&(V(r,{duration:2e5,closable:!0}),j.warning({title:t("warning"),content:t("relay_info_view_verified"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:()=>{window.open("https://cors-anywhere.herokuapp.com/corsdemo")},onNegativeClick:()=>{}})),Promise.reject(r)}}),{cacheError:!1})}const b=M();S(n,()=>{var r;const e=(r=n.value)==null?void 0:r.supported_nips;e&&e.forEach(a=>{b.value.add(a)})});const E=y(()=>{var e;return new Set((e=n.value)==null?void 0:e.supported_nips)});function z(e){const r=`https://github.com/nostr-protocol/nips/blob/master/${e.toString().padStart(2,"0")}.md`;window.open(r)}const O=y(()=>C(n.value));function C(e){return e?Array.isArray(e)?e.map(r=>({whateverLabel:r,whateverKey:r})):typeof e=="object"?Object.entries(e).map(([r,a])=>typeof a=="string"||typeof a=="number"?{whateverLabel:`${r}: ${a}`,whateverKey:r}:{whateverLabel:r,whateverKey:r,whateverChildren:C(a)}):[]:[]}return(e,r)=>{const a=Q,f=W,P=X,h=Y,R=ee,T=Z;return s(),p(x,null,[o(_)===null&&!o(n)?(s(),p("div",te,[c(f,{vertical:""},{default:i(()=>[o(_)===null&&!o(n)?(s(),w(a,{key:0,size:"large"},{description:i(()=>[g(m(e.t("loading")),1)]),default:i(()=>[re]),_:1})):l("",!0)]),_:1})])):l("",!0),o(_)?(s(),w(P,{key:1,status:"404",title:`404 ${e.t("resource_does_not_exist")}`,description:"生活总归带点荒谬"},null,8,["title"])):l("",!0),o(n)?(s(),p("div",oe,[c(f,{vertical:""},{default:i(()=>{var $;return[o(n).name?(s(),p("h1",ne,m(($=o(n))==null?void 0:$.name),1)):l("",!0),c(h,{title:"基本信息"},{default:i(()=>{var u,N,L;return[o(k)?(s(),p("p",se,"提示：使用了proxy")):l("",!0),(u=o(n))!=null&&u.description?(s(),p("p",ae,"描述 ："+m((N=o(n))==null?void 0:N.description),1)):l("",!0),(L=o(n))!=null&&L.pubkey?(s(),p("p",ie,[g(" 管理者 ："),c(q,{pubkey:o(n).pubkey},null,8,["pubkey"])])):l("",!0)]}),_:1}),c(h,{title:"支持的nip情况"},{default:i(()=>[c(f,null,{default:i(()=>[(s(!0),p(x,null,J(o(b),u=>(s(),w(R,{bordered:!1,type:o(E).has(u)?"success":"error",onClick:()=>z(u)},{default:i(()=>[g(" nip-"+m(u),1)]),_:2},1032,["type","onClick"]))),256))]),_:1})]),_:1}),c(h,{title:"更多信息"},{default:i(()=>[c(T,{"block-line":"",data:o(O),"key-field":"whateverKey","label-field":"whateverLabel","children-field":"whateverChildren",selectable:""},null,8,["data"])]),_:1})]}),_:1})])):l("",!0)],64)}}});export{He as default};
