import{f as ae,h as m,i as on,j as he,N as P,k as $,U as B,a4 as $n,c as K,b as Z,a as F,d as fe,e as be,u as Un,g as rn,dN as Mn,_ as ke,M as C,af as Te,P as Me,p as zn}from"./index.1b90d9b0.js";import{N as jn,d as Hn,i as ze,c as M,a as Vn}from"./Loading.68c8fb32.js";import{N as qn}from"./Icon.8b94fe05.js";import{a as Gn}from"./Checkbox.945c7e6c.js";import{r as je}from"./render.71a5584a.js";import{i as Xn}from"./is-browser.21659b45.js";import{b as Wn,X as en}from"./Scrollbar.d017889b.js";import{h as nn,c as Yn,f as tn,a as Qn}from"./create.2deeaf6a.js";import{p as Zn,a as Jn}from"./index.62f1e1b0.js";import{N as et}from"./Button.426eb201.js";import{f as ln}from"./fade-in-height-expand.cssr.b76b5d75.js";import{u as nt}from"./use-rtl.e3f5641a.js";import{u as Ae}from"./cssr.ebdd28c2.js";import{u as tt}from"./use-css-vars-class.2322281d.js";import{V as lt}from"./VirtualList.11936635.js";import{_ as at}from"./Empty.36cca092.js";function dn(e){return typeof e=="string"?`s-${e}`:`n-${e}`}const it=ae({name:"Switcher",render(){return m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},m("path",{d:"M12 8l10 8l-10 8z"}))}}),cn=on("n-tree-select"),me=on("n-tree"),ot=ae({name:"NTreeSwitcher",props:{clsPrefix:{type:String,required:!0},expanded:Boolean,selected:Boolean,hide:Boolean,loading:Boolean,onClick:Function},setup(e){const{renderSwitcherIconRef:l}=he(me,null);return()=>{const{clsPrefix:c}=e;return m("span",{"data-switcher":!0,class:[`${c}-tree-node-switcher`,e.expanded&&`${c}-tree-node-switcher--expanded`,e.hide&&`${c}-tree-node-switcher--hide`],onClick:e.onClick},m("div",{class:`${c}-tree-node-switcher__icon`},m(jn,null,{default:()=>{if(e.loading)return m(Hn,{clsPrefix:c,key:"loading",radius:85,strokeWidth:20});const{value:u}=l;return u?u({expanded:e.expanded,selected:e.selected}):m(qn,{clsPrefix:c,key:"switcher"},{default:()=>m(it,null)})}})))}}}),rt=ae({name:"NTreeNodeCheckbox",props:{clsPrefix:{type:String,required:!0},right:Boolean,focusable:Boolean,disabled:Boolean,checked:Boolean,indeterminate:Boolean,onCheck:Function},setup(e){const l=he(me);function c(s){const{onCheck:d}=e;if(d)return d(s)}function u(s){e.indeterminate?c(!1):c(s)}return{handleUpdateValue:u,mergedTheme:l.mergedThemeRef}},render(){const{clsPrefix:e,mergedTheme:l,checked:c,indeterminate:u,disabled:s,focusable:d,handleUpdateValue:v}=this;return m("span",{class:[`${e}-tree-node-checkbox`,this.right&&`${e}-tree-node-checkbox--right`],"data-checkbox":!0},m(Gn,{focusable:d,disabled:s,theme:l.peers.Checkbox,themeOverrides:l.peerOverrides.Checkbox,checked:c,indeterminate:u,onUpdateChecked:v}))}}),dt=ae({name:"TreeNodeContent",props:{clsPrefix:{type:String,required:!0},disabled:Boolean,checked:Boolean,selected:Boolean,onClick:Function,onDragstart:Function,tmNode:{type:Object,required:!0},nodeProps:Object},setup(e){const{renderLabelRef:l,renderPrefixRef:c,renderSuffixRef:u,labelFieldRef:s}=he(me),d=P(null);function v(g){const{onClick:b}=e;b&&b(g)}function x(g){v(g)}return{selfRef:d,renderLabel:l,renderPrefix:c,renderSuffix:u,labelField:s,handleClick:x}},render(){const{clsPrefix:e,labelField:l,nodeProps:c,checked:u=!1,selected:s=!1,renderLabel:d,renderPrefix:v,renderSuffix:x,handleClick:g,onDragstart:b,tmNode:{rawNode:h,rawNode:{prefix:w,suffix:y,[l]:f}}}=this;return m("span",Object.assign({},c,{ref:"selfRef",class:[`${e}-tree-node-content`,c==null?void 0:c.class],onClick:g,draggable:b===void 0?void 0:!0,onDragstart:b}),v||w?m("div",{class:`${e}-tree-node-content__prefix`},v?v({option:h,selected:s,checked:u}):je(w)):null,m("div",{class:`${e}-tree-node-content__text`},d?d({option:h,selected:s,checked:u}):je(f)),x||y?m("div",{class:`${e}-tree-node-content__suffix`},x?x({option:h,selected:s,checked:u}):je(y)):null)}});function an({position:e,offsetLevel:l,indent:c,el:u}){const s={position:"absolute",boxSizing:"border-box",right:0};if(e==="inside")s.left=0,s.top=0,s.bottom=0,s.borderRadius="inherit",s.boxShadow="inset 0 0 0 2px var(--n-drop-mark-color)";else{const d=e==="before"?"top":"bottom";s[d]=0,s.left=`${u.offsetLeft+6-l*c}px`,s.height="2px",s.backgroundColor="var(--n-drop-mark-color)",s.transformOrigin=d,s.borderRadius="1px",s.transform=e==="before"?"translateY(-4px)":"translateY(4px)"}return m("div",{style:s})}function ct({dropPosition:e,node:l}){return l.isLeaf===!1||l.children?!0:e!=="inside"}function st(e){return $(()=>e.leafOnly?"child":e.checkStrategy)}function J(e,l){return!!e.rawNode[l]}function sn(e,l,c,u){e==null||e.forEach(s=>{c(s),sn(s[l],l,c,u),u(s)})}function ut(e,l,c,u,s){const d=new Set,v=new Set,x=[];return sn(e,u,g=>{if(x.push(g),s(l,g)){v.add(g[c]);for(let b=x.length-2;b>=0;--b)if(!d.has(x[b][c]))d.add(x[b][c]);else return}},()=>{x.pop()}),{expandedKeys:Array.from(d),highlightKeySet:v}}if(Xn&&Image){const e=new Image;e.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}function ft(e,l,c,u,s){const d=new Set,v=new Set,x=new Set,g=[],b=[],h=[];function w(f){f.forEach(k=>{if(h.push(k),l(c,k)){d.add(k[u]),x.add(k[u]);for(let N=h.length-2;N>=0;--N){const L=h[N][u];if(!v.has(L))v.add(L),d.has(L)&&d.delete(L);else break}}const R=k[s];R&&w(R),h.pop()})}w(e);function y(f,k){f.forEach(R=>{const N=R[u],L=d.has(N),A=v.has(N);if(!L&&!A)return;const j=R[s];if(j)if(L)k.push(R);else{g.push(N);const _=Object.assign(Object.assign({},R),{[s]:[]});k.push(_),y(j,_[s])}else k.push(R)})}return y(e,b),{filteredTree:b,highlightKeySet:x,expandedKeys:g}}const ht=ae({name:"TreeNode",props:{clsPrefix:{type:String,required:!0},tmNode:{type:Object,required:!0}},setup(e){const l=he(me),{droppingNodeParentRef:c,droppingMouseNodeRef:u,draggingNodeRef:s,droppingPositionRef:d,droppingOffsetLevelRef:v,nodePropsRef:x,indentRef:g,blockLineRef:b,checkboxPlacementRef:h,checkOnClickRef:w,disabledFieldRef:y}=l,f=B(()=>!!e.tmNode.rawNode.checkboxDisabled),k=B(()=>J(e.tmNode,y.value)),R=B(()=>l.disabledRef.value||k.value),N=$(()=>{const{value:i}=x;if(!!i)return i({option:e.tmNode.rawNode})}),L=P(null),A={value:null};$n(()=>{A.value=L.value.$el});function j(){const{tmNode:i}=e;if(!i.isLeaf&&!i.shallowLoaded){if(!l.loadingKeysRef.value.has(i.key))l.loadingKeysRef.value.add(i.key);else return;const{onLoadRef:{value:p}}=l;p&&p(i.rawNode).then(D=>{D!==!1&&l.handleSwitcherClick(i)}).finally(()=>{l.loadingKeysRef.value.delete(i.key)})}else l.handleSwitcherClick(i)}const _=B(()=>!k.value&&l.selectableRef.value&&(l.internalTreeSelect?l.mergedCheckStrategyRef.value!=="child"||l.multipleRef.value&&l.cascadeRef.value||e.tmNode.isLeaf:!0)),q=B(()=>l.checkableRef.value&&(l.cascadeRef.value||l.mergedCheckStrategyRef.value!=="child"||e.tmNode.isLeaf)),ee=B(()=>l.displayedCheckedKeysRef.value.includes(e.tmNode.key)),xe=B(()=>{const{value:i}=q;if(!i)return!1;const{value:p}=w;return typeof p=="boolean"?p:p(e.tmNode.rawNode)});function ne(i){const{value:p}=l.expandOnClickRef,{value:D}=_,{value:re}=xe;if(!D&&!p&&!re||nn(i,"checkbox")||nn(i,"switcher"))return;const{tmNode:we}=e;D&&l.handleSelect(we),p&&!we.isLeaf&&j(),re&&oe(!ee.value)}function Ee(i){var p,D;b.value||(R.value||ne(i),(D=(p=N.value)===null||p===void 0?void 0:p.onClick)===null||D===void 0||D.call(p,i))}function ie(i){var p,D;!b.value||(R.value||ne(i),(D=(p=N.value)===null||p===void 0?void 0:p.onClick)===null||D===void 0||D.call(p,i))}function oe(i){l.handleCheck(e.tmNode,i)}function pe(i){l.handleDragStart({event:i,node:e.tmNode})}function Fe(i){i.currentTarget===i.target&&l.handleDragEnter({event:i,node:e.tmNode})}function H(i){i.preventDefault(),l.handleDragOver({event:i,node:e.tmNode})}function X(i){l.handleDragEnd({event:i,node:e.tmNode})}function W(i){i.currentTarget===i.target&&l.handleDragLeave({event:i,node:e.tmNode})}function Pe(i){i.preventDefault(),d.value!==null&&l.handleDrop({event:i,node:e.tmNode,dropPosition:d.value})}return{showDropMark:B(()=>{const{value:i}=s;if(!i)return;const{value:p}=d;if(!p)return;const{value:D}=u;if(!D)return;const{tmNode:re}=e;return re.key===D.key}),showDropMarkAsParent:B(()=>{const{value:i}=c;if(!i)return!1;const{tmNode:p}=e,{value:D}=d;return D==="before"||D==="after"?i.key===p.key:!1}),pending:B(()=>l.pendingNodeKeyRef.value===e.tmNode.key),loading:B(()=>l.loadingKeysRef.value.has(e.tmNode.key)),highlight:B(()=>{var i;return(i=l.highlightKeySetRef.value)===null||i===void 0?void 0:i.has(e.tmNode.key)}),checked:ee,indeterminate:B(()=>l.displayedIndeterminateKeysRef.value.includes(e.tmNode.key)),selected:B(()=>l.mergedSelectedKeysRef.value.includes(e.tmNode.key)),expanded:B(()=>l.mergedExpandedKeysRef.value.includes(e.tmNode.key)),disabled:R,checkable:q,mergedCheckOnClick:xe,checkboxDisabled:f,selectable:_,expandOnClick:l.expandOnClickRef,internalScrollable:l.internalScrollableRef,draggable:l.draggableRef,blockLine:b,nodeProps:N,checkboxFocusable:l.internalCheckboxFocusableRef,droppingPosition:d,droppingOffsetLevel:v,indent:g,checkboxPlacement:h,contentInstRef:L,contentElRef:A,handleCheck:oe,handleDrop:Pe,handleDragStart:pe,handleDragEnter:Fe,handleDragOver:H,handleDragEnd:X,handleDragLeave:W,handleLineClick:ie,handleContentClick:Ee,handleSwitcherClick:j}},render(){const{tmNode:e,clsPrefix:l,checkable:c,expandOnClick:u,selectable:s,selected:d,checked:v,highlight:x,draggable:g,blockLine:b,indent:h,disabled:w,pending:y,internalScrollable:f,nodeProps:k,checkboxPlacement:R}=this,N=g&&!w?{onDragenter:this.handleDragEnter,onDragleave:this.handleDragLeave,onDragend:this.handleDragEnd,onDrop:this.handleDrop,onDragover:this.handleDragOver}:void 0,L=f?dn(e.key):void 0,A=R==="right",j=c?m(rt,{right:A,focusable:this.checkboxFocusable,disabled:w||this.checkboxDisabled,clsPrefix:l,checked:this.checked,indeterminate:this.indeterminate,onCheck:this.handleCheck}):null;return m("div",Object.assign({class:`${l}-tree-node-wrapper`},N),m("div",Object.assign({},b?k:void 0,{class:[`${l}-tree-node`,{[`${l}-tree-node--selected`]:d,[`${l}-tree-node--checkable`]:c,[`${l}-tree-node--highlight`]:x,[`${l}-tree-node--pending`]:y,[`${l}-tree-node--disabled`]:w,[`${l}-tree-node--selectable`]:s,[`${l}-tree-node--clickable`]:s||u||this.mergedCheckOnClick},k==null?void 0:k.class],"data-key":L,draggable:g&&b,onClick:this.handleLineClick,onDragstart:g&&b&&!w?this.handleDragStart:void 0}),Wn(e.level,m("div",{class:`${l}-tree-node-indent`},m("div",{style:{width:`${h}px`}}))),m(ot,{clsPrefix:l,expanded:this.expanded,selected:d,loading:this.loading,hide:e.isLeaf,onClick:this.handleSwitcherClick}),A?null:j,m(dt,{ref:"contentInstRef",clsPrefix:l,checked:v,selected:d,onClick:this.handleContentClick,nodeProps:b?void 0:k,onDragstart:g&&!b&&!w?this.handleDragStart:void 0,tmNode:e}),g?this.showDropMark?an({el:this.contentElRef.value,position:this.droppingPosition,offsetLevel:this.droppingOffsetLevel,indent:h}):this.showDropMarkAsParent?an({el:this.contentElRef.value,position:"inside",offsetLevel:this.droppingOffsetLevel,indent:h}):null:null,A?j:null))}}),un=ht;function gt({props:e,fNodesRef:l,mergedExpandedKeysRef:c,mergedSelectedKeysRef:u,handleSelect:s,handleSwitcherClick:d}){const{value:v}=u,x=he(cn,null),g=x?x.pendingNodeKeyRef:P(v.length?v[v.length-1]:null);function b(h){if(!e.keyboard)return;const{value:w}=g;if(w===null){if((h.key==="ArrowDown"||h.key==="ArrowUp")&&h.preventDefault(),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(h.key)&&w===null){const{value:y}=l;let f=0;for(;f<y.length;){if(!y[f].disabled){g.value=y[f].key;break}f+=1}}}else{const{value:y}=l;let f=y.findIndex(k=>k.key===w);if(!~f)return;if(h.key==="Enter")s(y[f]);else if(h.key==="ArrowDown")for(h.preventDefault(),f+=1;f<y.length;){if(!y[f].disabled){g.value=y[f].key;break}f+=1}else if(h.key==="ArrowUp")for(h.preventDefault(),f-=1;f>=0;){if(!y[f].disabled){g.value=y[f].key;break}f-=1}else if(h.key==="ArrowLeft"){const k=y[f];if(k.isLeaf||!c.value.includes(w)){const R=k.getParent();R&&(g.value=R.key)}else d(k)}else if(h.key==="ArrowRight"){const k=y[f];if(k.isLeaf)return;if(!c.value.includes(w))d(k);else for(f+=1;f<y.length;){if(!y[f].disabled){g.value=y[f].key;break}f+=1}}}}return{pendingNodeKeyRef:g,handleKeydown:b}}const vt=ae({name:"TreeMotionWrapper",props:{clsPrefix:{type:String,required:!0},height:Number,nodes:{type:Array,required:!0},mode:{type:String,required:!0},onAfterEnter:{type:Function,required:!0}},render(){const{clsPrefix:e}=this;return m(et,{onAfterEnter:this.onAfterEnter,appear:!0,reverse:this.mode==="collapse"},{default:()=>m("div",{class:[`${e}-tree-motion-wrapper`,`${e}-tree-motion-wrapper--${this.mode}`],style:{height:Zn(this.height)}},this.nodes.map(l=>m(un,{clsPrefix:e,tmNode:l})))})}}),yt=K("tree",`
 font-size: var(--n-font-size);
 outline: none;
`,[Z("ul, li",`
 margin: 0;
 padding: 0;
 list-style: none;
 `),Z(">",[K("tree-node",[Z("&:first-child",{marginTop:0})])]),K("tree-node-indent",`
 flex-grow: 0;
 flex-shrink: 0;
 height: 0;
 `),K("tree-motion-wrapper",[F("expand",[ln({duration:"0.2s"})]),F("collapse",[ln({duration:"0.2s",reverse:!0})])]),K("tree-node-wrapper",`
 box-sizing: border-box;
 padding: 3px 0;
 `),K("tree-node",`
 transform: translate3d(0,0,0);
 position: relative;
 display: flex;
 border-radius: var(--n-node-border-radius);
 transition: background-color .3s var(--n-bezier);
 `,[F("highlight",[K("tree-node-content",[fe("text",{borderBottomColor:"var(--n-node-text-color-disabled)"})])]),F("disabled",[K("tree-node-content",`
 color: var(--n-node-text-color-disabled);
 cursor: not-allowed;
 `)]),be("disabled",[F("clickable",[K("tree-node-content",`
 cursor: pointer;
 `)])])]),F("block-node",[K("tree-node-content",`
 flex: 1;
 min-width: 0;
 `)]),be("block-line",[K("tree-node",[be("disabled",[K("tree-node-content",[Z("&:hover",{backgroundColor:"var(--n-node-color-hover)"})]),F("selectable",[K("tree-node-content",[Z("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),F("pending",[K("tree-node-content",`
 background-color: var(--n-node-color-hover);
 `)]),F("selected",[K("tree-node-content",{backgroundColor:"var(--n-node-color-active)"})])])])]),F("block-line",[K("tree-node",[be("disabled",[Z("&:hover",{backgroundColor:"var(--n-node-color-hover)"}),F("pending",`
 background-color: var(--n-node-color-hover);
 `),F("selectable",[be("selected",[Z("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),F("selected",{backgroundColor:"var(--n-node-color-active)"})]),F("disabled",`
 cursor: not-allowed;
 `)])]),K("tree-node-switcher",`
 cursor: pointer;
 display: inline-flex;
 flex-shrink: 0;
 height: 24px;
 width: 24px;
 align-items: center;
 justify-content: center;
 transition: transform .15s var(--n-bezier);
 vertical-align: bottom;
 `,[fe("icon",`
 position: relative;
 height: 14px;
 width: 14px;
 display: flex;
 color: var(--n-arrow-color);
 transition: color .3s var(--n-bezier);
 font-size: 14px;
 `,[K("icon",[ze()]),K("base-loading",`
 color: var(--n-loading-color);
 position: absolute;
 left: 0;
 top: 0;
 right: 0;
 bottom: 0;
 `,[ze()]),K("base-icon",[ze()])]),F("hide",{visibility:"hidden"}),F("expanded",{transform:"rotate(90deg)"})]),K("tree-node-checkbox",`
 display: inline-flex;
 height: 24px;
 width: 16px;
 vertical-align: bottom;
 align-items: center;
 justify-content: center;
 margin-right: 4px;
 `,[F("right","margin-left: 4px;")]),F("checkable",[K("tree-node-content",`
 padding: 0 6px;
 `)]),K("tree-node-content",`
 position: relative;
 display: inline-flex;
 align-items: center;
 min-height: 24px;
 box-sizing: border-box;
 line-height: 1.5;
 vertical-align: bottom;
 padding: 0 6px 0 4px;
 cursor: default;
 border-radius: var(--n-node-border-radius);
 text-decoration-color: #0000;
 text-decoration-line: underline;
 color: var(--n-node-text-color);
 transition:
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[Z("&:last-child",{marginBottom:0}),fe("prefix",`
 display: inline-flex;
 margin-right: 8px;
 `),fe("text",`
 border-bottom: 1px solid #0000;
 transition: border-color .3s var(--n-bezier);
 flex-grow: 1;
 max-width: 100%;
 `),fe("suffix",`
 display: inline-flex;
 `)]),fe("empty","margin: auto;")]);var bt=globalThis&&globalThis.__awaiter||function(e,l,c,u){function s(d){return d instanceof c?d:new c(function(v){v(d)})}return new(c||(c=Promise))(function(d,v){function x(h){try{b(u.next(h))}catch(w){v(w)}}function g(h){try{b(u.throw(h))}catch(w){v(w)}}function b(h){h.done?d(h.value):s(h.value).then(x,g)}b((u=u.apply(e,l||[])).next())})};const Le=30;function kt(e,l,c,u){return{getIsGroup(){return!1},getKey(d){return d[e]},getChildren:u||(d=>d[l]),getDisabled(d){return!!(d[c]||d.checkboxDisabled)}}}const mt={allowCheckingNotLoaded:Boolean,filter:Function,defaultExpandAll:Boolean,expandedKeys:Array,keyField:{type:String,default:"key"},labelField:{type:String,default:"label"},childrenField:{type:String,default:"children"},disabledField:{type:String,default:"disabled"},defaultExpandedKeys:{type:Array,default:()=>[]},indeterminateKeys:Array,renderSwitcherIcon:Function,onUpdateIndeterminateKeys:[Function,Array],"onUpdate:indeterminateKeys":[Function,Array],onUpdateExpandedKeys:[Function,Array],"onUpdate:expandedKeys":[Function,Array]},xt=Object.assign(Object.assign(Object.assign(Object.assign({},rn.props),{accordion:Boolean,showIrrelevantNodes:{type:Boolean,default:!0},data:{type:Array,default:()=>[]},expandOnDragenter:{type:Boolean,default:!0},expandOnClick:Boolean,checkOnClick:{type:[Boolean,Function],default:!1},cancelable:{type:Boolean,default:!0},checkable:Boolean,draggable:Boolean,blockNode:Boolean,blockLine:Boolean,disabled:Boolean,checkedKeys:Array,defaultCheckedKeys:{type:Array,default:()=>[]},selectedKeys:Array,defaultSelectedKeys:{type:Array,default:()=>[]},multiple:Boolean,pattern:{type:String,default:""},onLoad:Function,cascade:Boolean,selectable:{type:Boolean,default:!0},indent:{type:Number,default:16},allowDrop:{type:Function,default:ct},animated:{type:Boolean,default:!0},checkboxPlacement:{type:String,default:"left"},virtualScroll:Boolean,watchProps:Array,renderLabel:Function,renderPrefix:Function,renderSuffix:Function,nodeProps:Function,keyboard:{type:Boolean,default:!0},getChildren:Function,onDragenter:[Function,Array],onDragleave:[Function,Array],onDragend:[Function,Array],onDragstart:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onUpdateCheckedKeys:[Function,Array],"onUpdate:checkedKeys":[Function,Array],onUpdateSelectedKeys:[Function,Array],"onUpdate:selectedKeys":[Function,Array]}),mt),{internalTreeSelect:Boolean,internalScrollable:Boolean,internalScrollablePadding:String,internalRenderEmpty:Function,internalHighlightKeySet:Object,internalUnifySelectCheck:Boolean,internalCheckboxFocusable:{type:Boolean,default:!0},internalFocusable:{type:Boolean,default:!0},checkStrategy:{type:String,default:"all"},leafOnly:Boolean}),_t=ae({name:"Tree",props:xt,setup(e){const{mergedClsPrefixRef:l,inlineThemeDisabled:c,mergedRtlRef:u}=Un(e),s=nt("Tree",u,l),d=rn("Tree","-tree",yt,Mn,e,l),v=P(null),x=P(null),g=P(null);function b(){var n;return(n=g.value)===null||n===void 0?void 0:n.listElRef}function h(){var n;return(n=g.value)===null||n===void 0?void 0:n.itemsElRef}const w=$(()=>{const{filter:n}=e;if(n)return n;const{labelField:t}=e;return(a,o)=>{if(!a.length)return!0;const r=o[t];return typeof r=="string"?r.toLowerCase().includes(a.toLowerCase()):!1}}),y=$(()=>{const{pattern:n}=e;return n?!n.length||!w.value?{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}:ft(e.data,w.value,n,e.keyField,e.childrenField):{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}}),f=$(()=>Yn(e.showIrrelevantNodes?e.data:y.value.filteredTree,kt(e.keyField,e.childrenField,e.disabledField,e.getChildren))),k=he(cn,null),R=e.internalTreeSelect?k.dataTreeMate:f,{watchProps:N}=e,L=P([]);N!=null&&N.includes("defaultCheckedKeys")?ke(()=>{L.value=e.defaultCheckedKeys}):L.value=e.defaultCheckedKeys;const A=C(e,"checkedKeys"),j=Ae(A,L),_=$(()=>R.value.getCheckedKeys(j.value,{cascade:e.cascade,allowNotLoaded:e.allowCheckingNotLoaded})),q=st(e),ee=$(()=>_.value.checkedKeys),xe=$(()=>{const{indeterminateKeys:n}=e;return n!==void 0?n:_.value.indeterminateKeys}),ne=P([]);N!=null&&N.includes("defaultSelectedKeys")?ke(()=>{ne.value=e.defaultSelectedKeys}):ne.value=e.defaultSelectedKeys;const Ee=C(e,"selectedKeys"),ie=Ae(Ee,ne),oe=P([]),pe=n=>{oe.value=e.defaultExpandAll?R.value.getNonLeafKeys():n===void 0?e.defaultExpandedKeys:n};N!=null&&N.includes("defaultExpandedKeys")?ke(()=>pe(void 0)):ke(()=>pe(e.defaultExpandedKeys));const Fe=C(e,"expandedKeys"),H=Ae(Fe,oe),X=$(()=>f.value.getFlattenedNodes(H.value)),{pendingNodeKeyRef:W,handleKeydown:Pe}=gt({props:e,mergedSelectedKeysRef:ie,fNodesRef:X,mergedExpandedKeysRef:H,handleSelect:Be,handleSwitcherClick:Xe});let i=null,p=null;const D=P(new Set),re=$(()=>e.internalHighlightKeySet||y.value.highlightKeySet),we=Ae(re,D),Re=P(new Set),fn=$(()=>H.value.filter(n=>!Re.value.has(n)));let He=0;const ge=P(null),Ne=P(null),Se=P(null),Ce=P(null),Ke=P(0),hn=$(()=>{const{value:n}=Ne;return n?n.parent:null});Te(C(e,"data"),()=>{Re.value.clear(),W.value=null,ye()},{deep:!1});let Ie=!1;const Oe=()=>{Ie=!0,Me(()=>{Ie=!1})};let ve;Te(C(e,"pattern"),(n,t)=>{if(e.showIrrelevantNodes)if(ve=void 0,n){const{expandedKeys:a,highlightKeySet:o}=ut(e.data,e.pattern,e.keyField,e.childrenField,w.value);D.value=o,Oe(),ce(a,z(a),{node:null,action:"filter"})}else D.value=new Set;else if(!n.length)ve!==void 0&&(Oe(),ce(ve,z(ve),{node:null,action:"filter"}));else{t.length||(ve=H.value);const{expandedKeys:a}=y.value;a!==void 0&&(Oe(),ce(a,z(a),{node:null,action:"filter"}))}});function Ve(n){return bt(this,void 0,void 0,function*(){const{onLoad:t}=e;if(!t)return yield Promise.resolve();const{value:a}=Re;if(!a.has(n.key)){a.add(n.key);try{(yield t(n.rawNode))===!1&&se()}catch(o){console.error(o),se()}a.delete(n.key)}})}ke(()=>{var n;const{value:t}=f;if(!t)return;const{getNode:a}=t;(n=H.value)===null||n===void 0||n.forEach(o=>{const r=a(o);r&&!r.shallowLoaded&&Ve(r)})});const de=P(!1),Y=P([]);Te(fn,(n,t)=>{if(!e.animated||Ie){Me(De);return}const a=new Set(t);let o=null,r=null;for(const T of n)if(!a.has(T)){if(o!==null)return;o=T}const I=new Set(n);for(const T of t)if(!I.has(T)){if(r!==null)return;r=T}if(o===null&&r===null)return;const{virtualScroll:E}=e,G=(E?g.value.listElRef:v.value).offsetHeight,le=Math.ceil(G/Le)+1;let V;if(o!==null&&(V=t),r!==null&&(V===void 0?V=n:V=V.filter(T=>T!==r)),de.value=!0,Y.value=f.value.getFlattenedNodes(V),o!==null){const T=Y.value.findIndex(O=>O.key===o);if(~T){const O=Y.value[T].children;if(O){const Q=tn(O,n);Y.value.splice(T+1,0,{__motion:!0,mode:"expand",height:E?Q.length*Le:void 0,nodes:E?Q.slice(0,le):Q})}}}if(r!==null){const T=Y.value.findIndex(O=>O.key===r);if(~T){const O=Y.value[T].children;if(!O)return;de.value=!0;const Q=tn(O,n);Y.value.splice(T+1,0,{__motion:!0,mode:"collapse",height:E?Q.length*Le:void 0,nodes:E?Q.slice(0,le):Q})}}});const gn=$(()=>Qn(X.value)),vn=$(()=>de.value?Y.value:X.value);function De(){const{value:n}=x;n&&n.sync()}function yn(){de.value=!1,e.virtualScroll&&Me(De)}function z(n){const{getNode:t}=R.value;return n.map(a=>{var o;return((o=t(a))===null||o===void 0?void 0:o.rawNode)||null})}function ce(n,t,a){const{"onUpdate:expandedKeys":o,onUpdateExpandedKeys:r}=e;oe.value=n,o&&M(o,n,t,a),r&&M(r,n,t,a)}function qe(n,t,a){const{"onUpdate:checkedKeys":o,onUpdateCheckedKeys:r}=e;L.value=n,r&&M(r,n,t,a),o&&M(o,n,t,a)}function bn(n,t){const{"onUpdate:indeterminateKeys":a,onUpdateIndeterminateKeys:o}=e;a&&M(a,n,t),o&&M(o,n,t)}function _e(n,t,a){const{"onUpdate:selectedKeys":o,onUpdateSelectedKeys:r}=e;ne.value=n,r&&M(r,n,t,a),o&&M(o,n,t,a)}function kn(n){const{onDragenter:t}=e;t&&M(t,n)}function mn(n){const{onDragleave:t}=e;t&&M(t,n)}function xn(n){const{onDragend:t}=e;t&&M(t,n)}function pn(n){const{onDragstart:t}=e;t&&M(t,n)}function wn(n){const{onDragover:t}=e;t&&M(t,n)}function Rn(n){const{onDrop:t}=e;t&&M(t,n)}function ye(){Nn(),te()}function Nn(){ge.value=null}function te(){Ke.value=0,Ne.value=null,Se.value=null,Ce.value=null,se()}function se(){i&&(window.clearTimeout(i),i=null),p=null}function Ge(n,t){if(e.disabled||J(n,e.disabledField))return;if(e.internalUnifySelectCheck&&!e.multiple){Be(n);return}const a=t?"check":"uncheck",{checkedKeys:o,indeterminateKeys:r}=R.value[a](n.key,ee.value,{cascade:e.cascade,checkStrategy:q.value,allowNotLoaded:e.allowCheckingNotLoaded});qe(o,z(o),{node:n.rawNode,action:a}),bn(r,z(r))}function Sn(n){if(e.disabled)return;const{key:t}=n,{value:a}=H,o=a.findIndex(r=>r===t);if(~o){const r=Array.from(a);r.splice(o,1),ce(r,z(r),{node:n.rawNode,action:"collapse"})}else{const r=f.value.getNode(t);if(!r||r.isLeaf)return;let I;if(e.accordion){const E=new Set(n.siblings.map(({key:G})=>G));I=a.filter(G=>!E.has(G)),I.push(t)}else I=a.concat(t);ce(I,z(I),{node:n.rawNode,action:"expand"})}}function Xe(n){e.disabled||de.value||Sn(n)}function Be(n){if(!(e.disabled||!e.selectable)){if(W.value=n.key,e.internalUnifySelectCheck){const{value:{checkedKeys:t,indeterminateKeys:a}}=_;e.multiple?Ge(n,!(t.includes(n.key)||a.includes(n.key))):qe([n.key],z([n.key]),{node:n.rawNode,action:"check"})}if(e.multiple){const t=Array.from(ie.value),a=t.findIndex(o=>o===n.key);~a?e.cancelable&&t.splice(a,1):~a||t.push(n.key),_e(t,z(t),{node:n.rawNode,action:~a?"unselect":"select"})}else ie.value.includes(n.key)?e.cancelable&&_e([],[],{node:n.rawNode,action:"unselect"}):_e([n.key],z([n.key]),{node:n.rawNode,action:"select"})}}function Cn(n){if(i&&(window.clearTimeout(i),i=null),n.isLeaf)return;p=n.key;const t=()=>{if(p!==n.key)return;const{value:a}=Se;if(a&&a.key===n.key&&!H.value.includes(n.key)){const o=H.value.concat(n.key);ce(o,z(o),{node:n.rawNode,action:"expand"})}i=null,p=null};n.shallowLoaded?i=window.setTimeout(()=>{t()},1e3):i=window.setTimeout(()=>{Ve(n).then(()=>{t()})},1e3)}function Kn({event:n,node:t}){!e.draggable||e.disabled||J(t,e.disabledField)||(We({event:n,node:t},!1),kn({event:n,node:t.rawNode}))}function Dn({event:n,node:t}){!e.draggable||e.disabled||J(t,e.disabledField)||mn({event:n,node:t.rawNode})}function Tn(n){n.target===n.currentTarget&&te()}function An({event:n,node:t}){ye(),!(!e.draggable||e.disabled||J(t,e.disabledField))&&xn({event:n,node:t.rawNode})}function Ln({event:n,node:t}){!e.draggable||e.disabled||J(t,e.disabledField)||(He=n.clientX,ge.value=t,pn({event:n,node:t.rawNode}))}function We({event:n,node:t},a=!0){var o;if(!e.draggable||e.disabled||J(t,e.disabledField))return;const{value:r}=ge;if(!r)return;const{allowDrop:I,indent:E}=e;a&&wn({event:n,node:t.rawNode});const G=n.currentTarget,{height:le,top:V}=G.getBoundingClientRect(),T=n.clientY-V;let O;I({node:t.rawNode,dropPosition:"inside",phase:"drag"})?T<=8?O="before":T>=le-8?O="after":O="inside":T<=le/2?O="before":O="after";const{value:Bn}=gn;let S,U;const $e=Bn(t.key);if($e===null){te();return}let Qe=!1;O==="inside"?(S=t,U="inside"):O==="before"?t.isFirstChild?(S=t,U="before"):(S=X.value[$e-1],U="after"):(S=t,U="after"),!S.isLeaf&&H.value.includes(S.key)&&(Qe=!0,U==="after"&&(S=X.value[$e+1],S?U="before":(S=t,U="inside")));const Ze=S;if(Se.value=Ze,!Qe&&r.isLastChild&&r.key===S.key&&(U="after"),U==="after"){let Je=He-n.clientX,Ue=0;for(;Je>=E/2&&S.parent!==null&&S.isLastChild&&Ue<1;)Je-=E,Ue+=1,S=S.parent;Ke.value=Ue}else Ke.value=0;if((r.contains(S)||U==="inside"&&((o=r.parent)===null||o===void 0?void 0:o.key)===S.key)&&!(r.key===Ze.key&&r.key===S.key)){te();return}if(!I({node:S.rawNode,dropPosition:U,phase:"drag"})){te();return}if(r.key===S.key)se();else if(p!==S.key)if(U==="inside"){if(e.expandOnDragenter){if(Cn(S),!S.shallowLoaded&&p!==S.key){ye();return}}else if(!S.shallowLoaded){ye();return}}else se();else U!=="inside"&&se();Ce.value=U,Ne.value=S}function En({event:n,node:t,dropPosition:a}){if(!e.draggable||e.disabled||J(t,e.disabledField))return;const{value:o}=ge,{value:r}=Ne,{value:I}=Ce;if(!(!o||!r||!I)&&!!e.allowDrop({node:r.rawNode,dropPosition:I,phase:"drag"})&&o.key!==r.key){if(I==="before"){const E=o.getNext({includeDisabled:!0});if(E&&E.key===r.key){te();return}}if(I==="after"){const E=o.getPrev({includeDisabled:!0});if(E&&E.key===r.key){te();return}}Rn({event:n,node:r.rawNode,dragNode:o.rawNode,dropPosition:a}),ye()}}function Fn(){De()}function Pn(){De()}function In(n){var t;if(e.virtualScroll||e.internalScrollable){const{value:a}=x;if(!((t=a==null?void 0:a.containerRef)===null||t===void 0)&&t.contains(n.relatedTarget))return;W.value=null}else{const{value:a}=v;if(a!=null&&a.contains(n.relatedTarget))return;W.value=null}}Te(W,n=>{var t,a;if(n!==null){if(e.virtualScroll)(t=g.value)===null||t===void 0||t.scrollTo({key:n});else if(e.internalScrollable){const{value:o}=x;if(o===null)return;const r=(a=o.contentRef)===null||a===void 0?void 0:a.querySelector(`[data-key="${dn(n)}"]`);if(!r)return;o.scrollTo({el:r})}}}),zn(me,{loadingKeysRef:Re,highlightKeySetRef:we,displayedCheckedKeysRef:ee,displayedIndeterminateKeysRef:xe,mergedSelectedKeysRef:ie,mergedExpandedKeysRef:H,mergedThemeRef:d,mergedCheckStrategyRef:q,nodePropsRef:C(e,"nodeProps"),disabledRef:C(e,"disabled"),checkableRef:C(e,"checkable"),selectableRef:C(e,"selectable"),expandOnClickRef:C(e,"expandOnClick"),onLoadRef:C(e,"onLoad"),draggableRef:C(e,"draggable"),blockLineRef:C(e,"blockLine"),indentRef:C(e,"indent"),cascadeRef:C(e,"cascade"),checkOnClickRef:C(e,"checkOnClick"),checkboxPlacementRef:e.checkboxPlacement,droppingMouseNodeRef:Se,droppingNodeParentRef:hn,draggingNodeRef:ge,droppingPositionRef:Ce,droppingOffsetLevelRef:Ke,fNodesRef:X,pendingNodeKeyRef:W,disabledFieldRef:C(e,"disabledField"),internalScrollableRef:C(e,"internalScrollable"),internalCheckboxFocusableRef:C(e,"internalCheckboxFocusable"),internalTreeSelect:e.internalTreeSelect,renderLabelRef:C(e,"renderLabel"),renderPrefixRef:C(e,"renderPrefix"),renderSuffixRef:C(e,"renderSuffix"),renderSwitcherIconRef:C(e,"renderSwitcherIcon"),labelFieldRef:C(e,"labelField"),multipleRef:C(e,"multiple"),handleSwitcherClick:Xe,handleDragEnd:An,handleDragEnter:Kn,handleDragLeave:Dn,handleDragStart:Ln,handleDrop:En,handleDragOver:We,handleSelect:Be,handleCheck:Ge});function On(n){var t;(t=g.value)===null||t===void 0||t.scrollTo(n)}const _n={handleKeydown:Pe,scrollTo:On,getCheckedData:()=>{if(!e.checkable)return{keys:[],options:[]};const{checkedKeys:n}=_.value;return{keys:n,options:z(n)}},getIndeterminateData:()=>{if(!e.checkable)return{keys:[],options:[]};const{indeterminateKeys:n}=_.value;return{keys:n,options:z(n)}}},Ye=$(()=>{const{common:{cubicBezierEaseInOut:n},self:{fontSize:t,nodeBorderRadius:a,nodeColorHover:o,nodeColorPressed:r,nodeColorActive:I,arrowColor:E,loadingColor:G,nodeTextColor:le,nodeTextColorDisabled:V,dropMarkColor:T}}=d.value;return{"--n-arrow-color":E,"--n-loading-color":G,"--n-bezier":n,"--n-font-size":t,"--n-node-border-radius":a,"--n-node-color-active":I,"--n-node-color-hover":o,"--n-node-color-pressed":r,"--n-node-text-color":le,"--n-node-text-color-disabled":V,"--n-drop-mark-color":T}}),ue=c?tt("tree",void 0,Ye,e):void 0;return Object.assign(Object.assign({},_n),{mergedClsPrefix:l,mergedTheme:d,rtlEnabled:s,fNodes:vn,aip:de,selfElRef:v,virtualListInstRef:g,scrollbarInstRef:x,handleFocusout:In,handleDragLeaveTree:Tn,handleScroll:Fn,getScrollContainer:b,getScrollContent:h,handleAfterEnter:yn,handleResize:Pn,cssVars:c?void 0:Ye,themeClass:ue==null?void 0:ue.themeClass,onRender:ue==null?void 0:ue.onRender})},render(){var e;const{fNodes:l,internalRenderEmpty:c}=this;if(!l.length&&c)return c();const{mergedClsPrefix:u,blockNode:s,blockLine:d,draggable:v,disabled:x,internalFocusable:g,checkable:b,handleKeydown:h,rtlEnabled:w,handleFocusout:y}=this,f=g&&!x,k=f?"0":void 0,R=[`${u}-tree`,w&&`${u}-tree--rtl`,b&&`${u}-tree--checkable`,(d||s)&&`${u}-tree--block-node`,d&&`${u}-tree--block-line`],N=A=>"__motion"in A?m(vt,{height:A.height,nodes:A.nodes,clsPrefix:u,mode:A.mode,onAfterEnter:this.handleAfterEnter}):m(un,{key:A.key,tmNode:A,clsPrefix:u});if(this.virtualScroll){const{mergedTheme:A,internalScrollablePadding:j}=this,_=Jn(j||"0");return m(en,{ref:"scrollbarInstRef",onDragleave:v?this.handleDragLeaveTree:void 0,container:this.getScrollContainer,content:this.getScrollContent,class:R,theme:A.peers.Scrollbar,themeOverrides:A.peerOverrides.Scrollbar,tabindex:k,onKeydown:f?h:void 0,onFocusout:f?y:void 0},{default:()=>{var q;return(q=this.onRender)===null||q===void 0||q.call(this),m(lt,{ref:"virtualListInstRef",items:this.fNodes,itemSize:Le,ignoreItemResize:this.aip,paddingTop:_.top,paddingBottom:_.bottom,class:this.themeClass,style:[this.cssVars,{paddingLeft:_.left,paddingRight:_.right}],onScroll:this.handleScroll,onResize:this.handleResize,showScrollbar:!1,itemResizable:!0},{default:({item:ee})=>N(ee)})}})}const{internalScrollable:L}=this;return R.push(this.themeClass),(e=this.onRender)===null||e===void 0||e.call(this),L?m(en,{class:R,tabindex:k,onKeydown:f?h:void 0,onFocusout:f?y:void 0,style:this.cssVars,contentStyle:{padding:this.internalScrollablePadding}},{default:()=>m("div",{onDragleave:v?this.handleDragLeaveTree:void 0,ref:"selfElRef"},this.fNodes.map(N))}):m("div",{class:R,tabindex:k,ref:"selfElRef",style:this.cssVars,onKeydown:f?h:void 0,onFocusout:f?y:void 0,onDragleave:v?this.handleDragLeaveTree:void 0},l.length?l.map(N):Vn(this.$slots.empty,()=>[m(at,{class:`${u}-tree__empty`,theme:this.mergedTheme.peers.Empty,themeOverrides:this.mergedTheme.peerOverrides.Empty})]))}});export{_t as _};
