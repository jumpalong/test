import{T as b,c as w}from"./nostr.754d0882.js";import{q as R,n as B,E as L,v as A}from"./use.1e6bcf04.js";import{q as C,e as N,P as V}from"./Papaw.58818fc9.js";import{f as k,k as v,N as g,G as z,an as E,C as h,ag as F,n as t,o as n,l as m,z as f,m as c,w as y,v as M,x as I,aL as q,y as x,F as G,A as H,ak as U,M as j}from"./index.1b90d9b0.js";import{a as T,b as D}from"./PapawList.vue_vue_type_script_setup_true_lang.b771e1a5.js";import{a as O,S as Y}from"./Scrollbar.2eeae0bc.js";import{_ as J}from"./Button.426eb201.js";import{_ as K}from"./Empty.36cca092.js";import{_ as Q}from"./PostList.vue_vue_type_script_setup_true_lang.7d7a35b5.js";import{_ as W}from"./RichTextEditBox.vue_vue_type_script_setup_true_lang.e3cb5e5e.js";const X={key:1},Z={key:0,class:"w-full flex justify-center items-center"},ee=k({__name:"PapawTreeParent",props:{id:null,relays:null,chindEvent:null},setup(a){const d=a,l=R(b.EventApi),_=v(()=>l.getEventLineById(d.id,{urls:d.relays})),i=v(()=>_.value.feat.useEvent()),s=g(!1),p=z();function u(){s.value=!0,p.start(),setTimeout(()=>{p.finish()},1e3)}const e=E(),r=O();if(r){const o=r.on("refresh",()=>{s.value?e.success(h("non_existent")):(o(),setTimeout(()=>{u(),e.success(h("load_parent_success"))}))});F(o)}return!w.enablePapawTreeLazyMode&&u(),(o,oe)=>{const S=J,$=K;return t(i)&&s.value?(n(),m(P,{key:0,event:t(i),relays:a.relays},null,8,["event","relays"])):(n(),f("div",X,[!s.value&&t(i)?(n(),f("div",Z,[c(S,{text:"",onClick:u},{default:y(()=>[M(I(t(h)("load_parent")),1)]),_:1})])):(n(),m($,{key:1,description:t(h)("not_found"),size:"huge"},null,8,["description"])),c(C,null,{default:y(()=>[c(T,{event:a.chindEvent},null,8,["event"])]),_:1})]))}}}),te={key:0},ne={key:1},se={key:2},P=k({__name:"PapawTreeAutoFindRoot",props:{event:null,relays:null,deleteEvent:null,withPapawOptionsButtons:{type:Boolean,default:!0}},setup(a){const d=a,{event:l}=q(d),_=v(()=>l.value.tags.filter(e=>e[0]==="e"&&e[1]&&(e[2]===void 0||e[2]==="reply"))),i=v(()=>U(new Set(d.relays),B(l.value.tags))),s=v(()=>_.value.length>0),p=v(()=>new Set(_.value.map(e=>e[1]))),u=v(()=>{var e;return(e=L(l.value.tags))==null?void 0:e[1]});return(e,r)=>t(u)?(n(),f("div",te,[c(N,{id:t(u)},{reply:y(({event:o})=>[o?(n(),m(D,{key:0,event:o},null,8,["event"])):x("",!0)]),_:1},8,["id"])])):t(s)?(n(),f("div",ne,[(n(!0),f(G,null,H(t(p),o=>(n(),m(ee,{chindEvent:t(l),relays:t(i),id:o},null,8,["chindEvent","relays","id"]))),256))])):(n(),f("div",se,[c(T,{event:t(l)},null,8,["event"])]))}}),ae={key:0,class:"flex flex-col w-full h-full overflow-auto"},me=k({__name:"Article",props:{event:null,urls:null},emits:["pushEvent"],setup(a,{emit:d}){const l=a,_=E(),i=j(l,"urls"),s=g(void 0),p=A(1,void 0,g(e=>{var r;(r=s.value)==null||r.call(s,e),d("pushEvent",e)}),{urls:i});async function u(e){await p(e),_.info("send")}return(e,r)=>a.event?(n(),f("div",ae,[c(Y,{class:"w-full h-0 flex-shrink flex-1",loadable:"",refreshable:""},{default:y(()=>[t(w).enablePapawTree?(n(),m(P,{key:0,event:a.event},null,8,["event"])):(n(),m(V,{key:1,event:a.event},{reply:y(()=>[c(Q,{pushEvent:s.value,"onUpdate:pushEvent":r[0]||(r[0]=o=>s.value=o),urls:t(i),filter:{"#e":[a.event.id],kinds:[1,30023]},active:"",disabledReply:""},null,8,["pushEvent","urls","filter"])]),_:1},8,["event"]))]),_:1}),c(W,{onSend:u})])):x("",!0)}});export{me as _};
