import{b as ze,c as re,f as q,u as Fe,g as fe,c0 as Oe,N as k,k as G,M as je,h as L,L as Pe,aH as Ue,P as ne,c1 as Ae,ae as pe,_ as Le,aF as he,aL as ae,o as M,z as D,m as _,w as C,v as Z,x as Q,n as w,l as O,F as me,A as ve,au as V,y as De,aJ as se,a8 as He,af as _e,ab as Ne,a9 as We,aa as Ke,ap as qe,C as ge,c2 as Xe,at as Je,aD as J,bd as ee,bc as te,aC as Ye,bl as Ge}from"./index.1b90d9b0.js";import{a as ue}from"./nostr.5da3da54.js";import{_ as xe,a as ye,p as Qe,u as le,b as Ze,c as et,C as tt,d as nt}from"./Papaw.58818fc9.js";import{y as ot,R as at,E as st,n as ce,B as lt}from"./use.1e6bcf04.js";import{_ as we}from"./RelayInfoView.f4d9e053.js";import{_ as it}from"./Tooltip.e97f4bd5.js";import{_ as be}from"./Button.426eb201.js";import{_ as Ce}from"./Space.233e452c.js";import{S as Se}from"./Scrollbar.2eeae0bc.js";import{_ as rt}from"./Result.bf419f37.js";import{_ as ke}from"./Input.6cd78f60.js";import{_ as ut}from"./Card.0e05d980.js";import{_ as ct,a as dt}from"./Tabs.0f3bfb7a.js";import{C as ft}from"./Close.accddb8c.js";import{i as pt}from"./is-browser.21659b45.js";import{f as ht}from"./fade-in-scale-up.cssr.769ecc19.js";import{u as mt,e as vt,c as Y}from"./Loading.68c8fb32.js";import{c as _t}from"./create.2deeaf6a.js";import{u as gt}from"./cssr.ebdd28c2.js";import{u as xt}from"./use-css-vars-class.2322281d.js";import{N as yt}from"./SelectMenu.f15b4eaf.js";import{u as oe,V as wt,a as bt,b as Ct}from"./Follower.46005694.js";import{u as St}from"./Upload.b824065e.js";import{_ as kt}from"./UploadButton.vue_vue_type_script_setup_true_lang.446f5e11.js";import{N as Et}from"./Icon.d35ca04d.js";function Mt(e,f={debug:!1,useSelectionEnd:!1,checkWidthOverflow:!0}){const d=e.selectionStart!==null?e.selectionStart:0,u=e.selectionEnd!==null?e.selectionEnd:0,i=f.useSelectionEnd?u:d,p=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],a=navigator.userAgent.toLowerCase().includes("firefox");if(!pt)throw new Error("textarea-caret-position#getCaretPosition should only be called in a browser");const r=f==null?void 0:f.debug;if(r){const m=document.querySelector("#input-textarea-caret-position-mirror-div");m!=null&&m.parentNode&&m.parentNode.removeChild(m)}const l=document.createElement("div");l.id="input-textarea-caret-position-mirror-div",document.body.appendChild(l);const t=l.style,n=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,s=e.nodeName==="INPUT";t.whiteSpace=s?"nowrap":"pre-wrap",s||(t.wordWrap="break-word"),t.position="absolute",r||(t.visibility="hidden"),p.forEach(m=>{if(s&&m==="lineHeight")if(n.boxSizing==="border-box"){const b=parseInt(n.height),E=parseInt(n.paddingTop)+parseInt(n.paddingBottom)+parseInt(n.borderTopWidth)+parseInt(n.borderBottomWidth),T=E+parseInt(n.lineHeight);b>T?t.lineHeight=`${b-E}px`:b===T?t.lineHeight=n.lineHeight:t.lineHeight="0"}else t.lineHeight=n.height;else t[m]=n[m]}),a?e.scrollHeight>parseInt(n.height)&&(t.overflowY="scroll"):t.overflow="hidden",l.textContent=e.value.substring(0,i),s&&l.textContent&&(l.textContent=l.textContent.replace(/\s/g,"\xA0"));const c=document.createElement("span");c.textContent=e.value.substring(i)||".",c.style.position="relative",c.style.left=`${-e.scrollLeft}px`,c.style.top=`${-e.scrollTop}px`,l.appendChild(c);const g={top:c.offsetTop+parseInt(n.borderTopWidth),left:c.offsetLeft+parseInt(n.borderLeftWidth),absolute:!1,height:parseInt(n.fontSize)*1.5};return r?c.style.backgroundColor="#aaa":document.body.removeChild(l),g.left>=e.clientWidth&&f.checkWidthOverflow&&(g.left=e.clientWidth),g}const Tt=ze([re("mention","width: 100%; z-index: auto; position: relative;"),re("mention-menu",`
 box-shadow: var(--n-menu-box-shadow);
 `,[ht({originalTransition:"background-color .3s var(--n-bezier), box-shadow .3s var(--n-bezier)"})])]),$t=Object.assign(Object.assign({},fe.props),{to:oe.propTo,autosize:[Boolean,Object],options:{type:Array,default:[]},type:{type:String,default:"text"},separator:{type:String,validator:e=>e.length!==1?(Ue("mention","`separator`'s length must be 1."),!1):!0,default:" "},bordered:{type:Boolean,default:void 0},disabled:Boolean,value:String,defaultValue:{type:String,default:""},loading:Boolean,prefix:{type:[String,Array],default:"@"},placeholder:{type:String,default:""},placement:{type:String,default:"bottom-start"},size:String,renderLabel:Function,status:String,"onUpdate:show":[Array,Function],onUpdateShow:[Array,Function],"onUpdate:value":[Array,Function],onUpdateValue:[Array,Function],onSearch:Function,onSelect:Function,onFocus:Function,onBlur:Function,internalDebug:Boolean}),Rt=q({name:"Mention",props:$t,setup(e){const{namespaceRef:f,mergedClsPrefixRef:d,mergedBorderedRef:u,inlineThemeDisabled:i}=Fe(e),p=fe("Mention","-mention",Tt,Oe,e,d),a=mt(e),r=k(null),l=k(null),t=k(null),n=k("");let s=null,c=null,g=null;const m=G(()=>{const{value:o}=n;return e.options.filter(h=>o?typeof h.label=="string"?h.label.startsWith(o):typeof h.value=="string"?h.value.startsWith(o):!1:!0)}),b=G(()=>_t(m.value,{getKey:o=>o.value})),E=k(null),T=k(!1),$=k(e.defaultValue),S=je(e,"value"),B=gt(S,$),v=G(()=>{const{self:{menuBoxShadow:o}}=p.value;return{"--n-menu-box-shadow":o}}),I=i?xt("mention",void 0,v,e):void 0;function x(o){if(e.disabled)return;const{onUpdateShow:h,"onUpdate:show":y}=e;h&&Y(h,o),y&&Y(y,o),o||(s=null,c=null,g=null),T.value=o}function R(o){const{onUpdateValue:h,"onUpdate:value":y}=e,{nTriggerFormChange:z,nTriggerFormInput:P}=a;y&&Y(y,o),h&&Y(h,o),P(),z(),$.value=o}function F(){return e.type==="text"?r.value.inputElRef:r.value.textareaElRef}function j(){var o;const h=F();if(document.activeElement!==h){x(!1);return}const{selectionEnd:y}=h;if(y===null){x(!1);return}const z=h.value,{separator:P}=e,{prefix:H}=e,X=typeof H=="string"?[H]:H;for(let A=y-1;A>=0;--A){const U=z[A];if(U===P||U===`
`||U==="\r"){x(!1);return}if(X.includes(U)){const K=z.slice(A+1,y);x(!0),(o=e.onSearch)===null||o===void 0||o.call(e,K,U),n.value=K,s=U,c=A+1,g=y;return}}x(!1)}function N(){const{value:o}=l;if(!o)return;const h=F(),y=Mt(h);y.left+=h.parentElement.offsetLeft,o.style.left=`${y.left}px`,o.style.top=`${y.top+y.height}px`}function Ee(){var o;!T.value||(o=t.value)===null||o===void 0||o.syncPosition()}function Me(o){R(o),W()}function W(){setTimeout(()=>{N(),j(),ne().then(Ee)},0)}function Te(o){var h,y;if(o.key==="ArrowLeft"||o.key==="ArrowRight"){if(!((h=r.value)===null||h===void 0)&&h.isCompositing)return;W()}else if(o.key==="ArrowUp"||o.key==="ArrowDown"||o.key==="Enter"){if(!((y=r.value)===null||y===void 0)&&y.isCompositing)return;const{value:z}=E;if(T.value){if(z)if(o.preventDefault(),o.key==="ArrowUp")z.prev();else if(o.key==="ArrowDown")z.next();else{const P=z.getPendingTmNode();P?ie(P):x(!1)}}else W()}}function $e(o){const{onFocus:h}=e;h==null||h(o);const{nTriggerFormFocus:y}=a;y(),W()}function Re(){var o;(o=r.value)===null||o===void 0||o.focus()}function Be(){var o;(o=r.value)===null||o===void 0||o.blur()}function Ve(o){const{onBlur:h}=e;h==null||h(o);const{nTriggerFormBlur:y}=a;y(),x(!1)}function ie(o){var h;if(s===null||c===null||g===null)return;const{rawNode:{value:y=""}}=o,z=F(),P=z.value,{separator:H}=e,X=P.slice(g),A=X.startsWith(H),U=`${y}${A?"":H}`;R(P.slice(0,c)+U+X),(h=e.onSelect)===null||h===void 0||h.call(e,o.rawNode,s);const K=c+U.length+(A?1:0);ne().then(()=>{z.selectionStart=K,z.selectionEnd=K,j()})}function Ie(){e.disabled||W()}return{namespace:f,mergedClsPrefix:d,mergedBordered:u,mergedSize:a.mergedSizeRef,mergedStatus:a.mergedStatusRef,mergedTheme:p,treeMate:b,selectMenuInstRef:E,inputInstRef:r,cursorRef:l,followerRef:t,showMenu:T,adjustedTo:oe(e),isMounted:vt(),mergedValue:B,handleInputFocus:$e,handleInputBlur:Ve,handleInputUpdateValue:Me,handleInputKeyDown:Te,handleSelect:ie,handleInputMouseDown:Ie,focus:Re,blur:Be,cssVars:i?void 0:v,themeClass:I==null?void 0:I.themeClass,onRender:I==null?void 0:I.onRender}},render(){const{mergedTheme:e,mergedClsPrefix:f,$slots:d}=this;return L("div",{class:`${f}-mention`},L(ke,{status:this.mergedStatus,themeOverrides:e.peerOverrides.Input,theme:e.peers.Input,size:this.mergedSize,autosize:this.autosize,type:this.type,ref:"inputInstRef",placeholder:this.placeholder,onMousedown:this.handleInputMouseDown,onUpdateValue:this.handleInputUpdateValue,onKeydown:this.handleInputKeyDown,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,bordered:this.mergedBordered,disabled:this.disabled,value:this.mergedValue}),L(wt,null,{default:()=>[L(bt,null,{default:()=>L("div",{style:{position:"absolute",width:0,height:0},ref:"cursorRef"})}),L(Ct,{ref:"followerRef",placement:this.placement,show:this.showMenu,containerClass:this.namespace,to:this.adjustedTo,teleportDisabled:this.adjustedTo===oe.tdkey},{default:()=>L(Pe,{name:"fade-in-scale-up-transition",appear:this.isMounted},{default:()=>{const{mergedTheme:u,onRender:i}=this;return i==null||i(),this.showMenu?L(yt,{clsPrefix:f,theme:u.peers.InternalSelectMenu,themeOverrides:u.peerOverrides.InternalSelectMenu,autoPending:!0,ref:"selectMenuInstRef",class:[`${f}-mention-menu`,this.themeClass],loading:this.loading,treeMate:this.treeMate,virtualScroll:!1,style:this.cssVars,onToggle:this.handleSelect,renderLabel:this.renderLabel},d):null}})})]}))}});function Bt(){const e=k(null),f=Ae(()=>import("./emoji.ca34a9ca.js"),[],import.meta.url),d=k(!0);return f.then(u=>{d.value=!1,e.value=u.default}),{data:e,isLoading:d}}function Vt(e,f){const d=k({}),u=pe((...p)=>{d.value=i(...p)},500);Le(()=>{u(f.value,e.value)});function i(p,a){if(!a)return{};const r=he({});for(const l of a){const t=l[0],n=l[1],s=l[2],c=l[3];if(!s.includes(p))continue;let g=r[t];g||(g=[],r[t]=g),g.push({type:t,emoji:n,name:s,UNICODE:c})}return r}return{emojiClassificationTable:d}}const It={class:"text-xl"},zt=q({__name:"EmojiBoxItem",props:{type:null,emojiList:null},emits:["click"],setup(e,{emit:f}){const d=e,{type:u,emojiList:i}=ae(d),[p,a]=ot(10);return(r,l)=>{const t=xe,n=we,s=it,c=be,g=Ce;return M(),D("div",{ref_key:"target",ref:p,class:"target"},[_(t,null,{default:C(()=>[Z(Q(w(u)),1)]),_:1}),w(a)?(M(),O(g,{key:1},{default:C(()=>[(M(!0),D(me,null,ve(w(i),(m,b)=>(M(),O(c,{quaternary:"",onClick:()=>f("click",m.emoji),"data-type":w(u),"data-index":b,"data-emoji":m.emoji},{default:C(()=>[_(s,{trigger:"hover"},{trigger:C(()=>[V("span",It,Q(m.emoji),1)]),default:C(()=>[Z(" "+Q(m.name),1)]),_:2},1024)]),_:2},1032,["onClick","data-type","data-index","data-emoji"]))),256))]),_:1})):(M(),O(n,{key:0,class:"w-full h-52"}))],512)}}}),Ft={class:"flex flex-col w-full h-96 max-h-full overflow-hidden relative"},Ot={class:"py-4 flex-shrink-0"},jt={key:1,class:"flex-shrink flex-1 w-full h-0 flex justify-center items-center"},Pt=q({__name:"EmojiBox",props:{show:{type:Boolean}},emits:["click"],setup(e,{emit:f}){const d=e,{show:u}=ae(d),i=k(""),{data:p,isLoading:a}=Bt(),{emojiClassificationTable:r}=Vt(p,i),l=G(()=>Object.keys(r.value));function t(n){f("click",n)}return(n,s)=>{const c=we,g=ke,m=rt,b=ut,E=ct,T=dt,$=ye;return M(),O($,{show:w(u)},{default:C(()=>[V("div",Ft,[_(T,{"default-value":"Emoji",class:"flex w-full h-full"},{default:C(()=>[_(E,{class:"flex-shrink flex-1 h-0 flex flex-col",name:"Emoji",tab:"Emoji"},{default:C(()=>[w(a)?(M(),O(c,{key:0,class:"w-full h-full"})):De("",!0),V("div",Ot,[_(g,{class:"flex-shrink-0",size:"large",round:"",placeholder:"Search",value:i.value,"onUpdate:value":s[0]||(s[0]=S=>i.value=S)},null,8,["value"])]),w(l).length===0?(M(),D("div",jt,[_(m,{status:"418",title:"\u4EC0\u4E48\u90FD\u6CA1\u627E\u5230",description:"\u8FD9\u662F\u4E00\u4E2A\u60B2\u5267"})])):(M(),O(b,{key:2,class:"flex-shrink flex-1 w-full h-0 flex",contentStyle:{height:"100%",width:"100%"}},{default:C(()=>[_(Se,{class:"w-full h-full"},{default:C(()=>[(M(!0),D(me,null,ve(w(l),S=>(M(),O(zt,{onClick:t,key:S,type:S,emojiList:w(r)[S]},null,8,["type","emojiList"]))),128))]),_:1})]),_:1}))]),_:1})]),_:1})])]),_:1},8,["show"])}}}),Ut={},At={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},Lt=V("g",{fill:"none"},[V("path",{d:"M10.53 1.72a.75.75 0 0 0-1.06 0l-4 4a.75.75 0 0 0 1.06 1.06l2.72-2.72v10.19a.75.75 0 0 0 1.5 0V4.06l2.72 2.72a.75.75 0 1 0 1.06-1.06l-4-4zM4.5 16.5a.75.75 0 0 0 0 1.5h11a.75.75 0 0 0 0-1.5h-11z",fill:"currentColor"})],-1),Dt=[Lt];function Ht(e,f){return M(),D("svg",At,Dt)}const Nt=se(Ut,[["render",Ht]]),Wt={},Kt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},qt=V("g",{fill:"none"},[V("path",{d:"M12.007 6.81l-5.949 5.95c-.319.318-.719.545-1.156.654l-2.283.57a.498.498 0 0 1-.604-.603l.57-2.283a2.49 2.49 0 0 1 .656-1.156l5.948-5.95l2.818 2.817zm1.41-4.226c.777.778.777 2.039 0 2.817l-.706.704l-2.817-2.818l.705-.703a1.992 1.992 0 0 1 2.817 0z",fill:"currentColor"})],-1),Xt=[qt];function Jt(e,f){return M(),D("svg",Kt,Xt)}const Yt=se(Wt,[["render",Jt]]),Gt={},Qt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Zt=V("path",{d:"M928 161H699.2c-49.1 0-97.1 14.1-138.4 40.7L512 233l-48.8-31.3A255.2 255.2 0 0 0 324.8 161H96c-17.7 0-32 14.3-32 32v568c0 17.7 14.3 32 32 32h228.8c49.1 0 97.1 14.1 138.4 40.7l44.4 28.6c1.3.8 2.8 1.3 4.3 1.3s3-.4 4.3-1.3l44.4-28.6C602 807.1 650.1 793 699.2 793H928c17.7 0 32-14.3 32-32V193c0-17.7-14.3-32-32-32zM404 553.5c0 4.1-3.2 7.5-7.1 7.5H211.1c-3.9 0-7.1-3.4-7.1-7.5v-45c0-4.1 3.2-7.5 7.1-7.5h185.7c3.9 0 7.1 3.4 7.1 7.5v45zm0-140c0 4.1-3.2 7.5-7.1 7.5H211.1c-3.9 0-7.1-3.4-7.1-7.5v-45c0-4.1 3.2-7.5 7.1-7.5h185.7c3.9 0 7.1 3.4 7.1 7.5v45zm416 140c0 4.1-3.2 7.5-7.1 7.5H627.1c-3.9 0-7.1-3.4-7.1-7.5v-45c0-4.1 3.2-7.5 7.1-7.5h185.7c3.9 0 7.1 3.4 7.1 7.5v45zm0-140c0 4.1-3.2 7.5-7.1 7.5H627.1c-3.9 0-7.1-3.4-7.1-7.5v-45c0-4.1 3.2-7.5 7.1-7.5h185.7c3.9 0 7.1 3.4 7.1 7.5v45z",fill:"currentColor"},null,-1),en=[Zt];function tn(e,f){return M(),D("svg",Qt,en)}const nn=se(Gt,[["render",tn]]);function on(){var u,i,p;const e=new Map,f=he([]),d=at.kind0.allMap();for(const a in d){const r=d[a],l=Qe(r),t=(p=(u=l.displayName)!=null?u:l.name)!=null?p:(i=r.pubkey)==null?void 0:i.slice(8),n=encodeURI(t);e.set(n,{event:r,metadata:l}),f.push({label:t,value:n,key:r.pubkey})}return{userRefMentionOption:f,userMap:e}}function an(e){const f=new Map,d=k([]),u=[];function i(t){const{content:n,id:s}=t;u.push({label:n.slice(0,20),value:`${l(t)}`,key:s})}function p(t,n){f.set(l(t),{event:t,marker:n}),i(t)}function a(t){var n;d.value=[],d.value.push(["e",t.id]),d.value.push(["p",t.pubkey]),d.value.push((n=st(t.tags))!=null?n:["e",t.id,"","root"]),d.value.push(...t.tags.filter(s=>s[0]==="e"&&s[1]&&(!s[3]||s[3]==="reply")).map(s=>{var c;return[s[0],s[1],(c=s[2])!=null?c:"","mention"]})),d.value.push(...t.tags.filter(s=>s[0]==="p"&&s[1]).map(s=>s.map(c=>c!=null?c:""))),d.value.push(...t.tags.filter(s=>s[0]==="r"&&s[1]).map(s=>s.map(c=>c!=null?c:"")))}function r(t){e.value===""?e.value+=`&${l(t)}
`:e.value+=`
&${l(t)}
`,p(t,"mention")}function l(t){return`${t.id}`}return{eventMap:f,eventMentionOption:u,replyEvent:a,relaysTags:d,addEvent:p,mentionEvent:r}}function sn(e,f,d){function u(i){const p={userMap:{},eventMap:{},value:i,tags:[],replyTags:d.value},{tags:a}=p,r=i.replace(/@\S+|(\s|^)#\S+|&\S+/g,l=>{var s,c;const t=l[0];let n=l.slice(1);switch(t){case"@":const g=e.get(n);if(!g)return l;p.userMap[n]=g;const m=ce(g.event.tags);return a.push(["p",g.event.pubkey,[...m][0]]),`#[${a.length-1}]`;case`
`:case" ":n=n.slice(1);case"#":return a.push(["t",n]),`#[${a.length-1}]`;case"&":const b=f.get(n);if(!b)return l;p.eventMap[n]=b;const E=b.event,T=[...ce(b.event.tags)];T.forEach(S=>a.push(["r",S])),a.push(["e",b.event.id,(s=[...T][0])!=null?s:"",b.marker]);const $=a.length-1;return a.push(["p",b.event.pubkey,(c=[...T][0])!=null?c:"","mention"]),a.push(...E.tags.filter(S=>S[0]==="e").map(S=>["e",S[1],S[2],"mention"])),a.push(...E.tags.filter(S=>S[0]==="p")),`#[${$}]`;default:return l}});return a.push(...p.replyTags),[r,a,p]}return u}const de={...He,duration:1e3*60*60};function ln(e,f,d,u){const i="rich-text-source-options",p=le();_e(()=>p.id,()=>{try{const t=Ne(r(),de);for(const[n,s]of Object.entries(t.userMap))w(e).set(n,s);for(const[n,s]of Object.entries(t.eventMap))w(f).set(n,s);d.value=t.value,u.value=t.replyTags}catch{}},{immediate:!0});function a(t){We(r(),t,de)}function r(){return`${i}:${p.id}`}function l(){Ke(r())}return{changeSourceCache:a,clearCache:l}}const rn=q({__name:"RichTextEditBoxInput",props:{rawValue:null},emits:["change","blur","focus","update:rawValue"],setup(e,{emit:f}){const d=e,{rawValue:u}=ae(d);let i="";const p=le(),a=lt(d,"rawValue"),{userRefMentionOption:r,userMap:l}=on(),{eventMap:t,eventMentionOption:n,addEvent:s,replyEvent:c,mentionEvent:g,relaysTags:m}=an(a),b=sn(l,t,m);_e(u,async()=>{await ne(),B()},{immediate:!0}),p.onRichTextEditBox("reply",x=>{c(x),v()}),p.onRichTextEditBox("mention",x=>{g(x),v()}),p.onRichTextEditBox("clear",I);const E=k([]);function T(x,R){R==="@"?E.value=r:R==="&"&&(E.value=n)}const{changeSourceCache:$,clearCache:S}=ln(l,t,a,m);function B(){const x=a.value;i!==x&&(i=x,v())}function v(){const x=a.value,[R,F,j]=b(x);$(j),f("change",R,{tags:F,sourceOptions:j})}function I(){S(),m.value=[],a.value="",v()}return(x,R)=>{const F=Rt;return M(),O(F,{type:"textarea",autosize:"",class:"w-full",onBlur:R[0]||(R[0]=()=>x.$emit("blur")),onFocus:R[1]||(R[1]=()=>x.$emit("focus")),placeholder:w(ge)("rich_text_edit_box_input_placeholder"),onChange:B,"show-count":"",maxlength:3e3,value:w(a),"onUpdate:value":R[2]||(R[2]=j=>qe(a)?a.value=j:null),options:E.value,prefix:["@","&"],onSearch:T},null,8,["placeholder","value","options"])}}}),un={class:"w-full flex-shrink-0 flex flex-col justify-between"},cn={class:"flex justify-between"},On=q({__name:"RichTextEditBox",emits:["send"],setup(e,{emit:f}){const d=le(),u=k(""),i=k(ue({})),p=k(!1),a=k(!1),r=k(null);Xe(r,B=>{p.value=!1,a.value=!1});function l(B,v){i.value=ue({content:B,tags:v.tags})}function t(){f("send",i.value)}const n=pe(()=>{p.value=!1},2e3),s=()=>{var B;(B=n.clear)==null||B.call(n),p.value=!0};function c(){a.value=!1}function g(B){u.value+=B}const m=k(!1),b=St();async function E(B){const v=`$$${Ge()}$$`;u.value.length===0?u.value+=`${v}
`:u.value+=`
${v}
`;const I=await b(B);u.value=u.value.replace(v,I.url)}Ze(r,E),et(r,E);function T(){d.emitRichTextEditBox("clear")}const $=Je("__rich_size_mode",2);function S(){$.value=(1+$.value)%3}return(B,v)=>{const I=xe,x=be,R=Ce,F=Et,j=ye;return M(),D("div",{class:"w-full h-max box-border flex flex-col overflow-hidden flex-shrink-1",ref_key:"target",ref:r,style:J({minHeight:w($)===0?"100%":"0%",maxHeight:m.value||w($)===0?"100%":p.value||m.value?"30em":"10em",transition:"max-height 300ms,min-height 300ms"}),onDblclick:v[5]||(v[5]=()=>a.value=!0),onMouseleave:v[6]||(v[6]=(...N)=>w(n)&&w(n)(...N))},[V("div",un,[_(Pt,{show:m.value,onClick:g},null,8,["show"]),_(I,{class:"flex-shrink-0",style:J({marginBottom:"0.5em",marginTop:"0.5em"})},null,8,["style"]),V("div",cn,[V("div",null,[_(R,null,{default:C(()=>[_(x,{class:"text-xl",quaternary:"",onClick:v[0]||(v[0]=()=>m.value=!m.value)},{default:C(()=>[Z(" \u{1F601} ")]),_:1}),_(kt,{upload:E})]),_:1})]),V("div",null,[_(x,{class:"mr-2",onClick:S},{default:C(()=>[V("div",{style:J({transform:w($)===2?"rotateX(0turn)":"rotateX(0.5turn)",transition:"transform 0.5s ease"})},[_(F,null,{default:C(()=>[_(Nt)]),_:1})],4)]),_:1}),_(x,{class:"mr-2",onClick:T,disabled:!u.value&&!i.value.tags.length},{default:C(()=>[_(F,null,{default:C(()=>[_(ft)]),_:1})]),_:1},8,["disabled"]),_(x,{class:"mr-2",disabled:!i.value.content,onClick:v[1]||(v[1]=()=>a.value=!a.value)},{default:C(()=>[_(F,null,{default:C(()=>[a.value?(M(),O(nn,{key:0})):(M(),O(Yt,{key:1}))]),_:1})]),_:1},8,["disabled"]),_(x,{disabled:!i.value.content,type:"primary",onClick:t},{default:C(()=>[Z(Q(w(ge)("send")),1)]),_:1},8,["disabled"])])])]),ee(_(I,{class:"flex-shrink-0",style:J({marginBottom:"0.5em",marginTop:"0.5em"})},null,8,["style"]),[[te,w($)!==2]]),V("div",{class:"flex-1 flex-shrink relative h-0",style:{},onMouseenter:s},[_(j,{class:"flex-1 flex-shrink relative h-full",show:w($)!==2},{default:C(()=>[_(Se,{class:Ye(["h-full box-border",{"py-2":i.value.tags.length>0||w($)===0}])},{default:C(()=>[ee(V("div",{class:"px-3 py-2",onClick:v[2]||(v[2]=()=>a.value=!0)},[_(tt,{event:i.value,disabledReply:""},null,8,["event"])],512),[[te,!a.value&&i.value.content]]),ee(_(rn,{class:"transition",rawValue:u.value,"onUpdate:rawValue":v[3]||(v[3]=N=>u.value=N),onBlur:c,onFocus:v[4]||(v[4]=()=>a.value=!0),onChange:l},null,8,["rawValue"]),[[te,a.value||!i.value.content]]),_(nt,{event:i.value},null,8,["event"])]),_:1},8,["class"])]),_:1},8,["show"])],32)],36)}}});export{On as _};
