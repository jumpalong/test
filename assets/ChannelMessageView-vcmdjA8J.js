import{a3 as z,o as d,B as k,E as v,L as F,ap as G,H as K,S as N,f as V,ao as Q,m as L,q as _,V as U,W as Y,k as u,R as Z,n as i,w as m,A as y,y as ee,z as te}from"./index-DVMYH3P6.js";import{_ as ne}from"./PapawList.vue_vue_type_script_setup_true_lang-DhIrlK79.js";import{w as oe,u as A,p as h,x as ae,$ as re,X as se,o as ie,k as le,m as ce}from"./ProvideEventLine-BcjESPsS.js";import{u as ue}from"./Papaw-Deuq0NJ6.js";import{_ as me}from"./RichTextEditBox.vue_vue_type_script_setup_true_lang-Cw9asIR0.js";import{S as pe}from"./Scrollbar-Ci8GVXLr.js";import{u as fe}from"./naiveUi-D97WfHUp.js";import{n as de}from"./MavonEditor-U6vvA0Sq.js";import{_ as ve}from"./PageHeader-Dni_zWZI.js";import{N as _e}from"./Icon-affED87R.js";import{b as he}from"./Button-Czpa3xjC.js";import"./utils-BXkRfzfk.js";import"./Card-mMUmU99e.js";import"./use-rtl-CqBkFAUg.js";import"./index-vZmvdULR.js";import"./use-css-vars-class-DpRsL9zm.js";import"./Close-CMpDg3pB.js";import"./Icon-DjYnwRew.js";import"./Close-Dj7wgTNH.js";import"./replaceable-DvMWTdGr.js";import"./keysOf-HiGXOwLp.js";import"./Tooltip-BuuQH49V.js";import"./Popover-C3ccDlka.js";import"./Follower-R8EgPpAd.js";import"./Scrollbar-BXVF4b7l.js";import"./format-length-B-p6aW7q.js";import"./use-compitable-CysNw4x-.js";import"./is-browser-BikuuYFQ.js";import"./NaddrLink.vue_vue_type_script_setup_true_lang-CCeX8OoD.js";import"./Markdown-CCAxwuGA.js";import"./Image-Dkv-cPOO.js";import"./utils-ByHrdkP9.js";import"./fade-in-scale-up.cssr-CUPxiz5B.js";import"./use-locale-CYSJLCZe.js";import"./download-sglA049O.js";import"./DateTime.vue_vue_type_script_setup_true_lang-CutDhaEt.js";import"./Spin-D-ja7p5P.js";import"./Tag-Cl4r3gCd.js";import"./Space-CvpcAwGw.js";import"./get-slot-Bk_rJcZu.js";import"./use-theme-vars-Cj3ejyij.js";import"./fade-in-height-expand.cssr-JdnZy7mo.js";import"./ContentBlacklistView-BsctE9vS.js";import"./Input-Bl1B22BO.js";import"./Dropdown-DxJRtvYm.js";import"./render-BaVY8WQh.js";import"./create-DlBt9mlr.js";import"./profile-2-400x400-D2vuwnc_.js";import"./Ellipsis-0EM5UHUc.js";import"./Empty-CBIm7nuM.js";import"./Divider-Dkdhd_MI.js";import"./Result-BxKSbHjS.js";import"./Warning-CFOd0oLB.js";import"./Tabs-v5GAMoQb.js";import"./Add-B8K751Td.js";import"./omit-DbnPTcif.js";import"./SelectMenu-P-o4iW_T.js";import"./Checkmark-C3ejFAAO.js";import"./VirtualList-Ds_3EfD8.js";import"./UploadButton.vue_vue_type_script_setup_true_lang-DLAEcrTL.js";import"./Close-DB389nBU.js";import"./ReloadCircleSharp-GyWaURTC.js";import"./Scrollbar-CnPFJxyc.js";import"./Checkbox-5kBy0qes.js";import"./composables-CG8Dm3JP.js";import"./DrawerContent-CWwlzEAX.js";import"./index-DsSU6HIH.js";import"./hkdf-MGlbgreC.js";const ge={},we={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 512 512","enable-background":"new 0 0 512 512","xml:space":"preserve"},xe=v("g",null,[v("g",null,[v("path",{d:`M383.822,344.427c-16.045,0-31.024,5.326-41.721,15.979l-152.957-88.42c1.071-5.328,2.142-9.593,2.142-14.919\r
			c0-5.328-1.071-9.593-2.142-14.919l150.826-87.35c11.762,10.653,26.741,17.041,43.852,17.041c35.295,0,64.178-28.766,64.178-63.92\r
			C448,72.767,419.117,44,383.822,44c-35.297,0-64.179,28.767-64.179,63.92c0,5.327,1.065,9.593,2.142,14.919l-150.821,87.35\r
			c-11.767-10.654-26.741-17.041-43.856-17.041c-35.296,0-63.108,28.766-63.108,63.92c0,35.153,28.877,63.92,64.178,63.92\r
			c17.115,0,32.089-6.389,43.856-17.042l151.891,88.421c-1.076,4.255-2.141,8.521-2.141,13.847\r
			c0,34.094,27.806,61.787,62.037,61.787c34.229,0,62.036-27.693,62.036-61.787C445.858,372.12,418.052,344.427,383.822,344.427z`})])],-1),ye=[xe];function Le(s,o){return d(),k("svg",we,ye)}const ke=z(ge,[["render",Le]]),Ce={},Se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 576 512"},be=v("path",{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z",fill:"currentColor"},null,-1),Be=[be];function Ee(s,o){return d(),k("svg",Se,Be)}const $e=z(Ce,[["render",Ee]]);function Me(s){const o=oe(),l=F(!0),r=()=>{l.value=!1};for(const a of["scroll","touchmove"])G(o==null?void 0:o.containerRef,a,r,{once:!0});const n=K(()=>{var a;return(a=s.value)==null?void 0:a.length},()=>{var a;l.value?(a=o==null?void 0:o.scrollbarInst.value)==null||a.scrollBy({top:99999,behavior:"smooth"}):n()})}function ze(s){const o=N();let r=A(h.ListSynchronizerManager.Staff).listSynchronizerManager.getInitStandardListSynchronizer(h.ListEnum.PublicChats);function n(){s.value&&(r.add({type:"e",value:{id:s.value}}),o.info("已提交加入群聊的请求"))}function a(){s.value&&(r.delete({type:"e",value:{id:s.value}}),o.info("已经提交了离开群聊的请求"))}return{handleJoinChannel:n,handleLeaveChannel:a}}const Ne=V({__name:"ChannelMessageList",props:{eventList:{}},emits:["eventDeletion"],setup(s,{emit:o}){const l=s,{eventList:r}=Q(l),n=o;return Me(r),(a,p)=>(d(),L(ne,{withPapawOptionsButtons:!1,eventList:_(r),onEventDeletion:p[0]||(p[0]=f=>n("eventDeletion",f))},null,8,["eventList"]))}}),Ve={key:0,class:"flex flex-col h-full overflow-auto"},Ae={class:"felx items-center justify-center"},Kt=V({__name:"ChannelMessageView",setup(s){const o=U(),l=Y(),r=u(()=>ae(o.params.value)),n=u(()=>{var e;return(e=r.value)==null?void 0:e.id}),a=A(se,re,h.ListSynchronizerManager.Staff,ce);Z(()=>{n.value}),ue(n);const p=u(()=>{var e,c;return n.value?a.getChannelMetadataByChannelId(n.value,{...(e=r.value)!=null&&e.relays?{urls:new Set((c=r.value)==null?void 0:c.relays)}:{}}):void 0}),f=u(()=>{var e,c;if(n.value)return a.commonEventList({filters:[{kinds:[42],"#e":[n.value],limit:5}],reverseSort:!0,...(e=r.value)!=null&&e.relays?{urls:new Set((c=r.value)==null?void 0:c.relays)}:{}})}),R=u(()=>p.value&&p.value.feat.getMetadata()),C=u(()=>{var e;if(n.value)return(e=p.value)==null?void 0:e.getLatestEvent()}),S=N();function b(){var e;(e=f.value)==null||e.feat.loadNew(),S.info(t("refreshing"))}function B(){var e;(e=f.value)==null||e.feat.load(),S.info(t("loading"))}const{handleJoinChannel:D,handleLeaveChannel:H}=ze(n);function J(){g.value?H():D()}const P=ie(42);function O(e){n.value&&(e.tags=[...e.tags,["e",n.value,"","root"]],P(e))}const g=u(()=>n.value?a.listSynchronizerManager.getInitStandardListSynchronizer(h.ListEnum.PublicChats).has({id:n.value,type:"e"}):!1),T=fe();function E(){if(n.value)return de.neventEncode({id:n.value,relays:[]})}function j(){const e=E();e&&T(e)}function I(){const e=E();e&&l.push({name:"edit-channel",params:{value:e}})}const W=le(()=>a.getPubkeyOrNull());return(e,c)=>{var M;const X=$e,$=_e,w=he,q=ke;return n.value?(d(),k("div",Ve,[i(_(ve),{class:"flex-shrink-0",subtitle:((M=R.value)==null?void 0:M.name)??n.value.slice(0,10),onBack:c[0]||(c[0]=x=>_(l).back())},{extra:m(()=>{var x;return[v("div",Ae,[C.value&&C.value.pubkey===((x=_(W))==null?void 0:x.toHex())?(d(),L(w,{key:0,class:"mr-2",round:"",onClick:I},{default:m(()=>[i($,null,{default:m(()=>[i(X)]),_:1})]),_:1})):y("",!0),i(w,{class:"mr-2",round:"",onClick:j},{default:m(()=>[i($,null,{default:m(()=>[i(q)]),_:1})]),_:1}),i(w,{round:"",type:g.value?"default":"primary",onClick:J},{default:m(()=>[ee(te(g.value?e.t("leave"):e.t("join")),1)]),_:1},8,["type"])])]}),_:1},8,["subtitle"]),i(pe,{class:"flex-shrink flex-1",loadable:"",refreshable:"",onLoad:b,onAutoLoad:b,onRefresh:B,onAutoRefresh:B},{default:m(()=>[f.value?(d(),L(Ne,{key:0,eventList:f.value.getList()},null,8,["eventList"])):y("",!0)]),_:1}),i(me,{onSend:O})])):y("",!0)}}});export{Kt as default};
