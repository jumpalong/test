import{H as $,q as A,p as L}from"./use.b23b6c29.js";import{p as T,m as I,P as O}from"./Papaw.635c4eff.js";import{b as U}from"./RelayConnectList.vue_vue_type_script_setup_true_lang.2443e1f7.js";import{E as F}from"./Ellipsis.021c946e.js";import{f as V,aL as H,k,o as r,z as f,au as b,m as E,w as l,v as M,x as R,n as d,y as h,N as j,af as q,l as n,A as g,F as C,E as z,D as G}from"./index.8f62a545.js";import{a as x,T as D}from"./nostr.c03670ae.js";import{t as Y,e as J}from"./nostr.0043d5e6.js";import{_ as K,a as Q}from"./ListItem.5a517004.js";import{_ as W}from"./Card.6e48fdd4.js";import{_ as X}from"./Space.32f062de.js";import"./Staff.e039c64f.js";import"./RegExpUtils.102c01f0.js";import"./utils.e1137b57.js";import"./is-browser.f4df612e.js";import"./Scrollbar.8d5a1903.js";import"./use-rtl.6d35c504.js";import"./cssr.21c6f8e2.js";import"./use-css-vars-class.1ada0b07.js";import"./fade-in-scale-up.cssr.5ebe4351.js";import"./use-locale.cbb1f83b.js";import"./Loading.0b953150.js";import"./use-style.d8216a24.js";import"./Follower.7ba57362.js";import"./Icon.1c3d6ebf.js";import"./replaceable.815b8f5c.js";import"./Button.22997a19.js";import"./create-key.7b548031.js";import"./Tooltip.d86a0762.js";import"./Popover.6590eae2.js";import"./format-length.3612bbc8.js";import"./nostr.ad89cf30.js";import"./createEventSourceTracers.1da380d1.js";import"./Icon.904bc99e.js";import"./NaddrLink.vue_vue_type_script_setup_true_lang.e9edc141.js";import"./error.469adc75.js";import"./login.0b8718d8.js";import"./Markdown.05f716d1.js";import"./Empty.81d9c633.js";import"./UserLink.vue_vue_type_script_setup_true_lang.0cad1bf3.js";import"./RelayAddButton.vue_vue_type_script_setup_true_lang.03e333cd.js";import"./MavonEditor.aa4b0597.js";import"./use-theme-vars.c704e62a.js";import"./Tag.7e30ed31.js";import"./Close.dba1bcea.js";import"./Close.7d56270d.js";import"./DrawerProvide.vue_vue_type_script_setup_true_lang.da186b5d.js";import"./DrawerContent.bb261013.js";import"./index.71604e6f.js";import"./RelayInfoView.0394eae9.js";import"./index.62f1e1b0.js";import"./Scrollbar.c7e90ffe.js";import"./LoadProgress.a8e5dee8.js";import"./Scrollbar.75edf2b0.js";import"./fade-in-height-expand.cssr.a4865c47.js";import"./naiveUi.02e209d9.js";import"./composables.10bdf172.js";import"./Input.90533fe2.js";import"./nostrApiUse.43d55506.js";import"./ContentBlacklistView.1f898a24.js";import"./Dropdown.09a70bb4.js";import"./render.568a1ab1.js";import"./create.2deeaf6a.js";import"./profile-2-400x400.3309f571.js";import"./keysOf.8a025f7e.js";import"./get-slot.4ceacf82.js";const Z={class:"font-bold"},ee={key:0,class:"w-full"},te=V({__name:"SearchChannelItem",props:{event:null},setup(S){const w=S,{event:u}=H(w),v=k(()=>u.value&&T(u.value)),t=k(()=>{if(u.value.kind===40)return u.value.id;if(u.value.kind===41){const p=$(u.value.tags);return p?p[1]:void 0}});return(p,c)=>(r(),f("div",{class:"flex flex-col",onClick:c[0]||(c[0]=()=>d(t)&&p.$router.push({name:"channel-message",params:{value:d(t)}}))},[b("div",Z,[E(F,null,{default:l(()=>{var a;return[M(R((a=d(v).name)!=null?a:d(t)&&d(t).slice(0,10)),1)]}),_:1})]),d(v).about?(r(),f("div",ee,[E(F,{class:"w-full"},{default:l(()=>[b("small",null,R(d(v).about),1)]),_:1})])):h("",!0)]))}}),ae=b("div",{class:"flex items-center justify-center"},[b("div",{id:"search-input"})],-1),_t=V({__name:"SearchView",setup(S){const w=A(D.EventApi),u=A(D.UserApi);z();const v=G(),t=k(()=>v.params.value),p=k(()=>t.value&&Y(t.value)),c=k(()=>t.value&&J(t.value)),a=j({}),y=x.createChild().addStaff(L());function N(){return y.createChild().addStaff(L())}q(t,()=>{if(a.value={},!(!t.value||t.value.length===0))if(p.value){const e=p.value.relays,o=u.getUserMetadataLineByPubkey(p.value.pubkey,{urls:e&&new Set(e)});y.addChild(o),a.value[0]=o}else if(c.value){const e=c.value,o=c.value.relays,s=w.getEventLineById(e.id,o&&{urls:new Set(o)});y.addChild(s),s.feat.onHasEventOnce(m=>{B(m,a.value)})}else{const e=x.createChild().addStaff(L()).addStaff({push(_){B(_,a.value)}});y.addChild(e);const o=[{search:t.value},{["#r"]:[t.value]}],s=e.createChild().addFilters(o).addExtends(x);e.addExtends(s);const m=e.createChild().addFilter({search:t.value,limit:50}).addReadUrl();e.addExtends(m)}},{immediate:!0});function B(e,o){var s,m;switch(e.kind){case 0:case 1:case 2:case 3:((s=o[e.kind])!=null?s:o[e.kind]=N()).pushEvent(e);break;case 40:case 41:((m=o.channel)!=null?m:o.channel=N()).pushEvent(e);break}}return(e,o)=>{const s=Q,m=K,_=W,P=X;return r(),n(P,{vertical:""},{default:l(()=>[ae,a.value.channel?(r(),n(_,{key:0,class:"w-full",title:"\u7FA4\u804A"},{default:l(()=>[E(m,{class:"w-full",hoverable:"",clickable:""},{default:l(()=>[(r(!0),f(C,null,g(a.value.channel.getList(),i=>(r(),n(s,{key:i.id},{default:l(()=>[E(te,{event:i},null,8,["event"])]),_:2},1024))),128))]),_:1})]),_:1})):h("",!0),a.value[0]?(r(),n(_,{key:1,title:"\u7528\u6237"},{default:l(()=>[(r(!0),f(C,null,g(a.value[0].getList(),i=>(r(),n(I,{key:i.id,pubkey:i.pubkey,created_at:i.created_at},null,8,["pubkey","created_at"]))),128))]),_:1})):h("",!0),a.value[2]?(r(),n(_,{key:2,title:"relay"},{default:l(()=>[(r(!0),f(C,null,g(a.value[2].getList(),i=>(r(),n(U,{key:i.id,url:i.content},null,8,["url"]))),128))]),_:1})):h("",!0),a.value[1]?(r(),n(_,{key:3,title:"\u6D88\u606F"},{default:l(()=>[(r(!0),f(C,null,g(a.value[1].getList(),i=>(r(),n(O,{key:i.id,event:i},null,8,["event"]))),128))]),_:1})):h("",!0)]),_:1})}}});export{_t as default};
